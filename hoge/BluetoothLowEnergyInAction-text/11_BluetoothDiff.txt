■H1■第10章　Bluetooth Core仕様書のバージョンごとの変化
4.2と5.1そして5.2での比較5.1と5.2を入れているのは、Audioが入っているから。
■H2■10.1　物理層
使う周波数の範囲と、チャネルの分割は、変化なし。2.400-2.4835 GHz, f=2402+k*2 MHz, k=0, ... ,39
出力パワーが、4.2の最大10mWから100mWになっている。パワー調整の仕組みが、新規に追加されている。0.01 mW (-20 dBm) 10 mW (+10 dBm)0.01 mW (-20 dBm) - 100 mW (+20 dBm)
v5.2で、パワークラスという概念が導入されている。v4.2には、こんなのなかったけど。Table3.2, 最大出力電力で分類されている。クラス1というのは、遠距離用なんだろうけど。どこの国で使えるのだsろう?
シンボルとか周波数偏差とかはv4.2とv5で同じ。ただ2Mのシンボルでの最低周波数の偏差の記述が追加されている。
変調のスペクトルも同じミニマムの6dBのバンドはば、送信のスペクトラムの。は少なくとも500kHz。
インバンドのスプリ明日エミッションv5で2Mのが追加されている。1Mシンボルで、キャリア周波数から2Mhz離れてところ、2Msで4M離れたところでの。1MHzバンド幅で計測したパワーの合計値。
受信機の最低感度v4.2で、ペイロードのバイトが広がったことで、BERの定義がテーブルになっている。11と37でBER 0.1%、１２８と255でBER 0.017%。リファレンスのは-70dBm。LE Uncoded PHY < -70dBm、S-" < -75 とコーデッドPHYが追加になっている。
■H2■10.2　リンク層
めちゃくちゃ拡張されている。90ぺーじくらいだったのが、200ページくらいになっている。
リンクレイヤのステートStandbyAdvertisingScanningInitiatingConnectionSynchronization				<- この2つが追加。Isochronous Broadcasting
リンク層のステート遷移が、SyncとIsoで2つ状態が増えている。ステートとロールの組み合わせの説明が、許された状態とロールの組み合わせと変更されている。
デバイスのアドレスのタイプPublic, Random Static、(v5.2) RResolvable Private address
Air Linkのパケット。1Msと2Msでプリアンブルが異なる。パケット途中でシンボルレートが切り替わることはない。PDUは2~258oct。ver4.2だと~257だったけど。トーンが末尾に追加。
アクセスアドレスver4.2だとアドバタイジングは決まった値、リンクはランダム生成だったけど、複雑化。Periodic Advだと、トレインを生成するたびに、新たなアドレスを生成する。
接続してても、Connected Isochronous Streamで、新しいアクセスアドレスを生成する。ブロードキャストのIsoなアドレスは、SAAから生成で、SAAは、ビット配列にルールがあって。
PDUの種類が増えてる。アドバチ人る、データ PhysicalChannePDU、IsochronousPhysica lChannePDU。
トーン信号は、ホワイトニングしない、一定の1での変調を与えたもの。Isoにはつかない。
LE Coded PHYでの、パケット構造は別に定義。
LL COntrol PDU、~0x15までだったのが、めっちゃ拡張されている。LL_PHY_REQ, ...
リンクの、パケット伝搬の時間が遅延に考慮で入っている。
この技術はすでに広く普及してます。もしも私達の耳に電波が聞き取れたならば、その騒がしいおしゃべりに、きっと驚くことでしょう。本書の目的は、Bluetooth Low Energy技術で、ものとものとをおしゃべりさせる方法や知識をまとめることです。
もしも人が耳で電波を聞き取れても、騒がしいおしゃべりに驚くだけで、おしゃべりの内容まではわかりません。Bluetooth Low Energy技術のような高度なデジタル・データ通信は、電波を使いデジタル・データをやり取りしています。高速でやりとりされる0と1の羅列は、人の脳では理解が追いつきません。
今目の前に、Bluetooth Low Energy技術でスマートフォンと接続している、ワイヤレス・キーボードがあるとします。ワイヤレス・キーボードのaというキーを押すと、今aというキーが押されたよと、キーボードがおしゃべりをします。それをスマートホンが聞き取って、画面にaという文字を表示します。
仮に、このワイヤレス・キーボードを分解したとします。内部にあるいくつもの電子部品の中に、このキーが押されたら、こんなおしゃべりをするという振る舞いがプログラムされた、マイクロ・コントローラがあります。そのプログラムを、キーが押されたらピアノのドの鍵盤が押されたよとおしゃべりするものに書き換えたら、どうなるでしょうか。おしゃべり相手のスマートホンは、これは楽器なのだと聞き取り、楽器演奏の音を出すでしょう。私達の目には、変わらずワイヤレス・キーボードに見えますが、おしゃべりの振る舞い次第で、楽器にもなるのです。
これはBluetooth Low Energy技術の、ものとものとのおしゃべりの1例です。人には電波を聞き取ったり話したりする能力はありません。ですから、こういう場合には、こう話してほしい、こう聞かれたら、こう答えてほしいと、おしゃべりの振る舞いをプログラムにして、それをマイクロ・コントローラに実行させます。私達が考えることは、どのようなおしゃべりの場面を作るかです。私達が作るものは、その振る舞いを起こすハードウェアとプログラムです。
Bluetooth Low Energy技術を学ぶつもりだったけど、もしかすると、Bluetooth Low Energy技術を学ぶ必要はないのではと思われたかもしれません。その通りです。
ラピッド・プロトタイピングやプログラミング教育向けに、スマートホンでプログラムを作り、それをBluetooth Low Energy技術で転送して動かせる小さな電子回路が、数千円で市販されています。文字表示やモータを動かす豊富な例題をまず動かして、学びながら変更を加えていけばよいのです。プログラムから見ると、通信機能は部品として整備されていて、詳細を知る必要はありません。ですが、もしも無線通信技術そのものがどう動いているのかに興味があるならば、本書がそのブラックボックスの中を照らすでしょう。
新規事業の創出や既存事業の拡大に、ものとものとのおしゃべりが使えそうだと思うかもしれません。アイディアを思いつくにも、その実現可能性の検討にも、Bluetooth Low Energy技術の知識は必要です。自分でできる範囲で試作を繰り返し検証を行ったのちに、専門家を集めチームを形成して事業的規模で開発を始めるでしょう。開発が事業の目的や方向と一致するように、専門家たちと会話をするのにも、無線通信技術の知識は不可欠です。また全ての専門家が無線通信技術を学んでいるわけではありません。共有すべき背景知識として、本書が役に立てるでしょう。
Bluetooth Low Energy技術を用いるスマートホンのアプリケーション開発を依頼されるかもしれません。アプリケーションからできることは、通信相手の探索と発見、通信の開始と終了、そしてデジタルデータの読み書きと変更検出だけです。ですから、ラピッド・プロトタイピングの場合と同じく、無線通信の詳細を学ぶ必要はありません。よく設計されて十分に検証された開発プロジェクトであれば、アプリケーション開発だけに専念できるでしょう。
ですが、もしも手渡された通信相手となる機器が、期待した振る舞いをしない場合、アプリケーション開発者はどうすればよいでしょうか。何かがよくないが、何がよくないのかはわからないことは、開発過程でしばしば遭遇します。機器の設計者に調査を依頼して、引き受けてもらえるでしょうか。アプリケーション側に間違いがないと言い切れるでしょうか。誰が調査をするか、その議論と交渉には大変な労力がかかります。ですが、ものとものとのおしゃべり、つまり1つ1つの通信パケットを記録して、その会話を見ていけば、取るべき行動はすぐにわかるかもしれません。議論と交渉を単なる作業に置き換えるのに、本書は役立つでしょう。
機器設計を担当している方が、Bluetooth Low Energy技術の導入を求められるかもしれません。機器の設計者は、半導体や回路構成、そしてマイクロ・コントローラの開発環境を選択できます。望めば通信パケット1つ1つを扱うことすらできます。
高い自由度には、深い理解と大きな責任が求められます。無線通信のセキュリティやプライバシーの保護、電力消費量やユーザ体験にふさわしい適切な通信パラメータの設定、販売する国ごとの電波法の技術基準適合証明の取得に、Bluetooth製品登録など、知らなかったではすまされない、すべきことが多くあります。機器設計者には、1ヶ月から2ヶ月の研修コースや教材もあるでしょう。本書は、知るべきを知る専門家には責任は持てません。
ものとものとのおしゃべりが、もしも人の耳に聞こえたならば、それは見知らぬ外国語が飛び交う雑踏の中にいるような不思議な感じがするでしょう。知識があれば、飛び交うデジタル・データが理解できるはずです。通信相手は、人のように、言葉に不慣れな相手に合わせたり、こちらの意図を想像して補ってくれたりはしない、単なるプログラムです。プログラムに書かれたルールに従い動くだけの、ものとものですが、その賑やかなおしゃべりが生み出す場面は楽しく、その場面を作り出す喜びは大きなものです。
