\maketitle
\thispagestyle{empty}

# はじめに{.unnumbered}

高度に発達した科学技術は一見すると魔法のように思えますが、その仕組みを理解すれば誰にでも使える単なる手段にすぎません。

本書は、Bluetooth &reg; 低消費電力技術 (Bluetooth low energy)を活用するための知識と情報とを、詳細かつ具体的にまとめています。

本書は、ハードウェアの設計や製造あるいはアプリケーションやネットワーク・サービスの開発などの、いわゆる技術者や開発者に向けた本ではありません。開発や製造また事業の立案や企画あるいは経営を通じて、スマートフォンと通信ネットワークがあたりまえになったこれからの社会を形作っていく、戦略と戦術とを担う方々に向けた本です。

Bluetooth low energy は、スマートフォンと、ものやものごととの間にある最後の1メートルをつなぐ無線通信技術として急速に利用場面が広がっています。爆発的に普及したモバイル機器と成熟したネットワーク・サービスの先にある、身の回りにあるあらゆるものがネットワークにつながる未来を実現する鍵となる技術です。

Bluetooth無線技術は、1999年に仕様書バージョン1.0が発表された、低消費電力かつ高速な近接無線通信技術です。いまや、ほとんどのパソコンやモバイル機器に搭載されて、ヘッドセットやキーボードなどの周辺機器をつなぐ、広く普及した高いブランド力がある規格になっています。

Bluetooth low energy は、それまでのBluetooth3.0の技術では要望を満たしきれない分野に向けて開発された新技術で、2010年に発表された Bluetooth4.0 で規格に統合されました。その特徴は、Bluetooth3.0 と比べて消費電力が1桁小さい無線通信技術と、多種多様なものをデータとして表現する強力なデータベースの仕組みにあります。

新しい無線通信技術が一般に普及するには、その通信相手も普及しなければならないので、通常は長い時間がかかります。いくつもの超低消費電力無線通信の技術や規格が続々と登場するなかで、なかでも Bluetooth low energy がひときわ強い注目を集めているのは、すでに普及しているBluetoothというブランドに統合されたこと、そして2011年からiPhoneを含むApple社のすべての製品が Bluetooth4.0 に対応していて、すでに世界中に通信相手があるからです。

Bluetooth low energy の登場が、活動量計やスマートウォッチなどの、常に身につけるいわゆるウェアラブル機器の市場を生み出しています。この市場には、機器の製造販売を収益源とする従来からある会社だけではなく、機器にスマートフォンやネットワーク・サービスなどの新しい要素を組み合わせた健康管理など、サービスを収益源とする会社も現れてきています。

この技術は、ビーコンと呼ばれる新しい近接と位置検出技術としても活用されています。ユーザが事前に対応アプリケーションをスマートフォンにインストールしていれば、事業者が設置したビーコンが発信する電波にアプリケーションが反応します。ビーコンは、屋内案内や販売促進のクーポン発行など、極めて狭い範囲で反応させたいアプリケーションやサービスに利用され始めています。

Bluetooth low energy は、ものやものごとがそこにあることを感じ取ったり、なんとなくつなげる強力な手段です。通知によりユーザの行動が変化するということは、この技術がネットワーク側から実世界を変化させられる技術だということを示しています。またユーザの歩数や心拍といった日々の振る舞いがデータとして収集できることは、この技術が実世界をネットワーク側にリアルタイムに同期させられる技術だということを示しています。

高度に発達した科学技術の仕組みを理解していても、実際にハードウェアやアプリケーションを作り出せないならば、絵に描いた餅でしかありません。Bluetooth low energy は、これまで無線通信技術が使われてこなかった分野にも広く使われていく技術です。その普及のために、様々な会社が開発を容易にするツールや情報を提供しています。もはや Bluetooth low energyを使ったハードウェアやアプリケーションの試作や実験は、方法さえ学べば誰にでもできるといってよいほど、容易になっています。

成熟したハードウェアやソフトウェアがあることが当然といえる社会に、新しい世界に自らの手をのばそうとする方々にとっての、魔法のようなこの技術をその手にする道を示す、導きの書となればと思います。

2015年6月12日 上原 昭宏

## 章の構成 {.unnumbered}

本書は4章で構成されます。本書は、Bluetooth low energy を活用して事業を立ち上げるチームで利用されることを想定しています。そのため、想定読者は、そのチームの経営や企画立案、また企画の実施に必要なハードウェアおよびアプリケーションの試作までの担当者を想定しています。

特に専門知識がなくとも本書だけで内容が理解できるように構成しています。ただし、アプリケーションあるいはハードウェアの技術詳細は、一般的なアプリケーション開発あるいは電子回路の基礎知識があることを前提とし解説をしています。

1章は、Bluetooth low energy の概要と、その活用場面を解説しています。技術や企画などの担当分野に関係なく、チームの全員が共有すべき内容をここにまとめています。2章以降は、チームで作り上げた企画を実際に形にするために必要な知識と具体的な方法を示していきます。

2章は、Bluetooth low energy の無線通信技術と通信規格を解説します。電波工学から通信プロトコルにわたる広い範囲を解説しているので、すべてを一度に理解する必要はありません。図を見て必要だと思った部分をまず読む、あるいは他の章を読んでいて通信規格をもっと詳しく知りたいときに該当箇所を読むなど、必要だと思った部分また理解できる部分を読んでください。

3章は、Bluetooth low energy を iOSアプリケーションで利用するときに使う CoreBluetoothフレームワーク を解説します。このフレームワークは、デバイスの発見と接続、そしてデバイスが持つデータベースの読み書きの機能を提供しています。フレームワークのそれぞれのクラスの振る舞いを、実際の無線通信と対応づけて解説します。

4章は、ハードウェアの試作についての技術情報をまとめます。どのような半導体や通信モジュールがあるかなどを解説します。そして、Bluetooth USB アダプタを使い Mac で動作する簡易的な Bluetooth low energy の通信スタックを自作して、iPhoneとの実際の通信を具体的に解説します。

担当分野ごとの読むべき章の目安は、以下のとおりです:

- 経営や企画を担う方 : 第1章
- アプリケーション開発者 : 第1章、第2章後半のGATTの解説部分、第3章
- ハードウェアの試作 : 第1章、第2章、第4章

## 開発対象とその開発環境 {.unnumbered}

本書は、iOSデバイスとの Bluetooth low energy での通信を解説します。AndroidやWindowsPhone、あるいはGNU/LinuxシステムやWindowsなどの他のオペレーティング・システムは取り扱いません。

本書が対象とするiOSおよび開発環境のバージョンは次のとおりです。

- OSのバージョン: iOS8
- 開発環境: Xcode 6.3
- 開発言語: Objective-C および Swift 1.2
- 対象機種: iPhone4s 以降に発売されたiOSデバイス
	- iPhone4s, iPhone5, iPhone5c, iPhone5s, iPhone6, iPhone6s
	- iPad mini, iPad mini2, iPad mini3
	- iPad (第4世代), iPad Air, iPad Air2
	- iPod touch (第5世代)

iOS8を搭載したiOSデバイスは、Bluetooth4.1に対応しています。本書は最新の Bluetooth4.2 の仕様書に基づいて解説します。Bluetooth4.0と4.1および4.2のそれぞれの差異は、必要に応じて解説します。

## サンプルコードのダウンロード  {.unnumbered}

<!--TBD--> 本書のサンプルソースコードは Github [https://github.com/reinforce-lab/BluetoothLowEnergyInAction](https://github.com/reinforce-lab/BluetoothLowEnergyInAction)  にあります。ライセンスは Apache License Version 2.0 です。バグや問題を見つけた場合は、pull requestを送ってください。

## 本書の問い合わせ先  {.unnumbered}

本書への疑問や質問は、ツイッター @u_akihiro でメンションを送るか、もしくは電子メール・アドレス u-akihiro@reinforce-lab.com にメールを送ってください。

問い合わせいただいた内容の一部または全てを本書への追記または筆者が運営するブログで利用するかもしれません。掲載する文章は質問者が特定できる情報が入らぬようになど配慮をしますが、情報共有のための利用をご了承ください。

また、本書の内容を超える問い合わせには回答しかねます。企画や設計についてはコンサルティング・サービスも提供していますので、別途問い合わせてください。

## 謝辞 {.unnumbered}

本書の Bluetooth low energy についての知見は、2012年からの[(有)トリガーデバイス](http://www.triggerdevice.com/blebu/index.html) [^001] 佐藤 忠彦さんとの技術調査および技術セミナーや開発案件から得られました。また表紙カバーは(有)トリガーデバイスの池本 貴子さんに描いていただきました。一目で本書とわかる特徴的な表紙という無理なお願いを聞いていただき、感謝します。

Bluetooth low energy の利用場面や企画での活用は、[株式会社 Matilde(マチルダ）](http://ma-tilde.com) [^002] 白鳥　啓さん、[(株)GOCCO](http://goccojapan.com) [^003] 森 誠之さん、情報科学芸術大学院大学 [IAMAS] [赤松 正行](http://akamatsu.org)さん [^004] とのディスカッションから、多くを得ました。

本書のタイトル「うれしい! たのしい! びー・える・いー!」は [@ksksue](https://twitter.com/ksksue)[^005] さんにいただきました。[@ksksue](https://twitter.com/ksksue) さんは、Internet of Things スタートアップをアクセラレートするためのソフトウェア＆ハードウェアプロジェクト [Physicaloid](http://www.physicaloid.com)[^006] を展開されています。

本書が目指したのは技術解説ではなく、技術を手段として社会で活用する人達のためのガイドブックでした。それを表すタイトルに悩んでいた時に、このタイトルをいただいたことを感謝します。

日本からも Bluetooth low energy を用いたユニークな製品を発表する会社が登場してきています。これは、Bluetooth low energy の半導体を販売している [Nordic Semiconductor ASA](http://www.nordicsemi.com) の 山崎 光男 さんの、開発を容易にするための様々な働きかけがあってのことです。山崎氏の活動がなければ、本書を世に出すことはありえませんでした。

また [達人出版会](http://tatsu-zine.com) の 高橋 征義 さんには、2011年12月に本書の出版を相談してから4年も待っていただきました。

このほかにも、岐阜県大垣市で開催されたBluetooth low energyセミナーやiBeaconハッカソン、またBluetooth low energyのプロトタイピングでのやりとりなど、数多くの方々からいただいた知見も盛り込んでいます。

[^001]: [(有)トリガーデバイス http://www.triggerdevice.com/blebu/index.html](http://www.triggerdevice.com/blebu/index.html) 
[^002]: [株式会社 Matilde(マチルダ）http://ma-tilde.com](http://ma-tilde.com)
[^003]: [(株)GOCCO http://goccojapan.com](http://goccojapan.com) 
[^004]: [http://akamatsu.org](http://akamatsu.org)
[^005]: [@ksksue https://twitter.com/ksksue](https://twitter.com/ksksue)
[^006]: [Physicaloid http://www.physicaloid.com](http://www.physicaloid.com)
[^007]: [Nordic Semiconductor ASA http://www.nordicsemi.com](http://www.nordicsemi.com)
[^008]: [達人出版会 http://tatsu-zine.com](http://tatsu-zine.com)

## 免責と商標について  {.unnumbered}

- 本書に登場する会社名、製品名、サービス名は、各社の登録商標または商標です。
- 本文中では、<!-- ®、™、© --> &reg;、&trade;、および&copy;マークは明記していません。
- Bluetooth &reg; のワードマークおよびロゴは、Bluetooth SIG, Inc.が所有する登録商標です。
- 本書の内容に基づき実施または運用したことで発生したいかなる損害も著者は一切の責任を負いません。
- 本書の内容は2015年6月時点のものです。本書で紹介した製品およびサービスの名称や内容は執筆時点から変更される可能性があります。

<!-- <div style="text-align: center;"> この手に、魔法を </div> -->


























