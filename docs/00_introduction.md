\maketitle
\thispagestyle{empty}

# はじめに{.unnumbered}











本書は、スマートフォンと、我々の身の回りにある物や物事との間にある最後の1メートルをつなぐ、超低消費電力無線通信規格 Bluetooth Low Energy の技術とその活用方法を解説します。

2007年頃から世界に広く普及し始めたスマートフォンは、10年も経たないうちに、もはや毎日の生活や仕事に不可欠なものとなっています。ソーシャルメディアあるいはオンライン・ショッピングなど、スマートフォンを通じて提供されている様々なサービスが、人と人をつないだり、物を届けたりしています。

爆発的に普及したスマートフォンとネットワーク・サービスは、さらに我々の生活を変えていくでしょう。その未来をもたらす可能性の1つが、いまはネットワークとつながらずに単体で機能している身の回りの機器や物事とネットワークとの連携です。

ある分野では、すでに未来に手が届き始めています。例えばフィットネス分野では、スマートフォンを通じてネットワーク・サービスと連携する活動量計が登場して、新しい運動体験を提供する企業が登場しています。







また一方で、スマートフォンを通じて外出先から操作できるエアコンや、夕食のレシピを表示する冷蔵庫などの電化製品も販売されています。しかし、それらはネットワークを通じてリモートコントロールができる新機能がついた機器にすぎません。


極論、パソコンの延長線、毎日持ち歩くことでネットワークとの接触時間が増加したことで。
持ち歩く、身につけていることが。

我々の日常生活を大きく変えてきたスマートフォンは、ネットワーク・サービス
次の段階、
シェアリング・エコノミー
民間、宿泊、利用権利。カー・シェアリング。スマートフォンを通じて予約。
目の前にある何か、誰かの所有物。一時的に利用できる。ネットワークを通じて。
契約とその証明、鍵。権利。

万歩計、どこにいたのか、データ。スマートフォン自体、活動量計、気がつけばデータが同期している。データは、プライバシー、サービスの発端。


機器がネットワークにつながるだけではなく、ネットワークを通じて、サービスが機器や物事と連携した新しいユーザ体験こそが、未来の可能性の1つです。そして、技術は、可能性を現実のものにするための手段にすぎません。

では、我々はどうすれば新しいサービスや価値を生み出せるでしょうか。可能性を現実にする技術を理解したり使いこなすのは、専門教育を受けた技術者にしかできないことなのでしょうか。高度に発達した科学技術は、一見すると魔法のように思えますが、その仕組みを理解すれば誰にでも使える単なる手段にすぎません。

本書は、スマートフォンとネットワークがあたりまえになった、これからの社会で、物や物事とネットワークとの新たな関係を生み出し作り上げていく、戦略と戦術とを担う方々やチームのための、ガイドブックです。

本書がきっかけとなり、いまは可能性でしかないものが未来において現実のものとなることを、望みます。

2015年11月 上原 昭宏

## 想定読者と章構成 {.unnumbered}

本書の想定読者は、経営および企画立案をおこなう方、そしてハードウェアやアプリケーションの設計や試作開発をおこなう方です。また、いくつもの専門分野の方々がチームを組む場面で活用することを想定しています。

そのため、専門知識がなくとも内容が理解できるように記述します。ハードウェアまたはスマートフォンのアプリケーション開発の詳細な技術解説で必要になる一般的な開発情報は、参考文献のリストを示します。

Bluetooth Low Energyは、Bluetooth4.0ではじめてBluetoothに取り入れられた新技術です。現在の最新の規格は Bluetooth4.2 です。本書は Bluetooth4.2 の仕様書に基づいて解説をして、必要なところでは、Bluetooth4.0と4.1および4.2のそれぞれの差異を述べます。

本書は4つの章で構成されます。

1章は、Bluetooth Low Energy の概要と、基礎知識および活用に役立つものを解説します。技術は手段として活用して初めて価値を生み出せるため、企画あるいは技術などの担当分野に関係なく、チーム全体で共有すべき共通知識をここにまとめます。

2章は、Bluetooth Low Energy の無線通信技術と規格とを解説します。解説は、電波工学から通信プロトコルにわたる広い範囲にわたります。すべてを一度に理解する必要はありません。図を見て、必要だと思う部分を読む、あるいは他の章を読んでいて通信規格をより詳しく知りたくなった時に該当箇所を読むなど、理解できる部分を読んでください。

3章は、iOSアプリケーションからBluetooth Low Energyを利用するための Core Bluetooth フレームワークを解説します。このフレームワークはアプリケーションに、Bluetooth Low Energy デバイスの発見と接続、そしてデバイスの読み書きの機能を提供します。

4章は、ハードウェアとファームウェアの試作についての情報をまとめます。5章は、簡易なBluetoothスタックを自作して、iOSとの間で実際にどのような通信がおこなわれているかを、解説します。

## 開発対象とその開発環境 {.unnumbered}

Bluetooth Low Energyをサポートするプラットホームは、iOS、Android、Windows PhoneおよびWindows、あるいは Linux などいくつかありますが、本書ではiOSのみを取り上げます。

本書のサンプルコードを実際に動かすためには、OS XがインストールされたMacとiOSデバイスが必要です。iOSシミュレータでは、Bluetooth Low Energyの機能は動作しません。そのため必ずiOSデバイス実機が必要になります。

Xcode7からは、Apple IDだけで、iOSデバイス実機でのアプリケーションの実行とデバッグができます。ですから、自分が所有するiOSデバイス実機でのテストであれば、年額が必要なApple社の Apple Developer Program への加入は必要ありません。

iOSデバイスは、2011年に発売されたiPhone4s以降のiOSデバイスであれば、全て使うことができます。もしも動作確認のために新たにデバイスを購入するならば、iPod touchが安価でよいです。

Apple Watchは、そのOSである watchOS2がCore Bluetoothフレームワークをサポートしていないため、使うことができません。Apple TVは、tvOSがCore Bluetoothフレームワークをサポートしていますから、動作するはずです。本書ではApple TVでの動作確認はとっていません。

開発環境および対象機種は、まとめると次のとおりです:

- OS Xのバージョン: El Capitan (バージョン 10.11.1) またはそれ以降のバージョン
- 開発環境: Xcode 7.1 またはそれ以降のバージョン
- 開発言語: Objective-C および Swift 2.1
- iOSのバージョン: iOS8またはiOS9
- iOSデバイス: iPhone4s 以降に発売されたiOSデバイス

## サンプルコードのダウンロード  {.unnumbered}

 本書のサンプルソースコードは Github [https://github.com/reinforce-lab/BluetoothLowEnergyInAction](https://github.com/reinforce-lab/BluetoothLowEnergyInAction)  にあります。ライセンスは Apache License Version 2.0 です。バグや問題を見つけた場合は、pull requestを送ってください。

## 本書の問い合わせ先  {.unnumbered}

本書への疑問や質問は、ツイッター @u_akihiro でメンションを送るか、もしくは電子メール・アドレス u-akihiro@reinforce-lab.com にメールを送ってください。

問い合わせいただいた内容の一部または全てを本書への追記または筆者が運営するブログで利用するかもしれません。掲載する文章は質問者が特定できる情報が入らぬようになど配慮をしますが、情報共有のために利用することを了解ください。

個別の設計相談などの、本書の内容を超える問い合わせには回答しかねます。筆者は企画または設計の業務受託も提供していますから、個別に問い合わせてください。

## 謝辞 {.unnumbered}

本書の Bluetooth Low Energy の解説の多くは、2012年からの[(有)トリガーデバイス](http://www.triggerdevice.com/blebu/index.html) [^001] 佐藤 忠彦さんとの技術調査および技術セミナーや開発案件から得られています。

また、表紙カバー絵は(有)トリガーデバイスの池本 貴子さんに描いていただきました。あえて技術書とはわからない特徴のある絵という無理なお願いを聞いていただき、感謝します。

スマートフォンと物や物事との関わりについては、[株式会社 Matilde(マチルダ）](http://ma-tilde.com) [^002] 白鳥　啓さん、[(株)GOCCO](http://goccojapan.com) [^003] 森 誠之さん、情報科学芸術大学院大学 [IAMAS] [赤松 正行](http://akamatsu.org)さん [^004] とのブレイン・ストーミングおよびディスカッションから、多くを得ています。

本書のタイトル「うれしい! たのしい! びー・える・いー!」は、技術解説ではなく、技術を手段として活用するためのガイドブックであることを表すタイトルが思いつかず悩んでいた時に、[@ksksue](https://twitter.com/ksksue)[^005] さんにいただきました。[@ksksue](https://twitter.com/ksksue) さんは、Internet of Things スタートアップをアクセラレートするためのソフトウェア＆ハードウェアプロジェクト [Physicaloid](http://www.physicaloid.com)[^006] を展開されています。

このほかにも、岐阜県大垣市で開催されたBluetooth Low EnergyセミナーやiBeaconハッカソン、またBluetooth Low Energyのプロトタイピングでのやりとりなどで、数多くの方々からいただいた知見も盛り込んでいます。

[^001]: [(有)トリガーデバイス http://www.triggerdevice.com/blebu/index.html](http://www.triggerdevice.com/blebu/index.html)
[^002]: [株式会社 Matilde(マチルダ）http://ma-tilde.com](http://ma-tilde.com)
[^003]: [(株)GOCCO http://goccojapan.com](http://goccojapan.com)
[^004]: [http://akamatsu.org](http://akamatsu.org)
[^005]: [@ksksue https://twitter.com/ksksue](https://twitter.com/ksksue)
[^006]: [Physicaloid http://www.physicaloid.com](http://www.physicaloid.com)

## 免責と商標について  {.unnumbered}

- 本書に登場する会社名、製品名、サービス名は、各社の登録商標または商標です。
- 本文中では、<!-- ®、™、© --> &reg;、&trade;、および&copy;マークは明記していません。
- Bluetooth &reg; のワードマークおよびロゴは、Bluetooth SIG, Inc.が所有する登録商標です。
- 本書の内容に基づき実施または運用したことで発生したいかなる損害も著者は一切の責任を負いません。
- 本書の内容は2015年11月時点のものです。本書で紹介した製品およびサービスの名称や内容は執筆時点から変更される可能性があります。
