
\putTableofcontents

# Bluetooth Low Energy とは何か

Bluetooth low energy は、2010年に公開された Bluetooth 4.0 がその規格の一部として統合した超低消費電力無線通信技術です。

Bluetooth low energyは、より高速な通信を追い求めてきた Bluetooth 3.0 では要望があわない、少量のデータを低頻度でやりとりできれば十分だが、電池交換の手間を増やしたくないので消費電力はとても小さくあってほしい利用分野に向けて開発された新技術です。

通信には、必ず通信相手がいなくてはなりません。ですから、新しい通信技術が一般に広く普及するには、その通信相手も同時に普及しなければならないため、通常は長い時間がかかります。ところが、2011年に iOS5を搭載したiPhone4S が Bluetooth4.0 に対応しました。世界に広く普及しているiPhoneが通信相手になったことで、Bluetooth low energy は急速に普及しています。

形あるハードウェアが一般に普及するには、それを製造販売する事業者が登場しなくてはなりません。また、新しい技術を利用した製品を理解して購入してくれる顧客が増えるまでには、通常は長い時間がかかります。ところが、iOS5は Bluetooth low energy デバイスとの通信を、どの iOSアプリケーション からも使えるように開放しました。これにより、多種多様な Bluetooth low energy 製品と対応アプリケーション群が登場して、それが市場を形作っています。

このように、Bluetooth low energy は、その通信相手となる iOS とともに急速にその利用範囲を広げ市場が形作られてきています。

この章は、 Bluetooth low energy の技術概要を述べて、次にこの技術の活用場面や方法の生み出し方を見ていきます。

<!-- 規格の成り立ちを通じて、よくある勘違い、音声とか、をまとめていく-->
## 規格の生い立ちとその特色

まず規格の生い立ちを通じて、Bluetooth low energyという新しい技術の特色を見ていきます。

世の中が新たな要望を出した時に、その要望に答えられる技術だけが一般に普及していきます。通信には必ず通信相手がいますから、通信技術が普及するには、お互いがお互いに通信しあうために技術を共有すること、つまり規格が不可欠なのです。

### Bluetooth無線技術の変遷

Bluetooth規格は、1998年に設立された非営利の非株式会社 Bluetooth Special Interest Group (SIG), Inc. (Bluetooth SIG)が開発を監督しています [^1009]。

[^1009]:[Bluetooth SIG について https://www.bluetooth.org/ja-jp/members/about-sig-overview](https://www.bluetooth.org/ja-jp/members/about-sig-overview)

Bluetooth SIG は Bluetooth 対応製品の開発、製造、販売はしません。メンバーが協力して革新できるようにして、多種多様な機器を接続するための望ましい無線技術を開発することよって Bluetooth ブランドを強化することを使命としています。

Bluetooth SIGの主な任務は:

- Bluetooth 仕様の公開
- 認証プログラムの管理運営
- Bluetooth 商標の保護
- Bluetooth 無線技術の普及促進

です。

Bluetooth low energy が Bluetooth無線技術 に統合されるまでの変遷を [#fig_BT_history] に示します。

![ #fig_BT_history Bluetooth 無線技術の変遷](fig/ch01_fig010_BT_history.png)

1999年にバージョン1.0の仕様が公開されてから、Bluetooth無線技術はより高い通信速度を目指して、バージョン2.0、3.0と仕様書のバージョンを上げてきました。そして、ヘッドセットやイーサネットなど、それまで有線接続だったものを無線接続に置き換える近接無線通信技術として、広く普及しました。

しかし、身の回りには、例えばキーボードやマウスあるいは心拍計のように、1回にやりとりするデータ量が数バイトで十分で、その通信頻度も30ミリ秒あるいは1秒ごとで十分である製品も数多くあります。そのような利用分野は、高速な通信速度よりも、より小さな電池消費量とより小さな製造費用が求められます。

ノキア・リサーチ・センターは、Bluetooth規格を継承しつつ、より低消費電力で低価格な新しい無線通信技術の開発を2001年にはじめました。この技術は、紆余曲折を経てBluetooth4.0に統合されます [^1010]。

[^1010]: [http://en.wikipedia.org/wiki/Bluetooth_low_energy](http://en.wikipedia.org/wiki/Bluetooth_low_energy)

この技術は、2004年にBluetooth Low End Extensionとして公開されました。さらに、EU FP6プロジェクトMIMOSA(Microsystems Platform for Mobile Services and Applications)といった、パートナーと更に開発を進めた後に、この技術はBluetoothとしてではなく、Wibree(ウィブリー)ブランドという独立した規格として2006年10月に公開されました。

一方でBluetooth無線技術は、1999年にバージョン1.0が公開されてから、2007年に Bluetooth 2.1 + EDR (Enhanced Data Rate)そして2009年に Bluetooth 3.0 + HS (High Speed)と、新しい仕様が登場しました。これらの規格は、それまでの通信規格で作られた機器とも通信ができる後方互換性を確保して、新しい規格で作られた機器同士ではより高速な通信ができるものです。

そして、2010年の Bluetooth4.0 で初めて超低消費電力無線通信技術が統合されました。[#fig_BT_history] では、この2つの技術を区別するために Bluetooth3.0 までの技術をクラシックBluetooth (Classic Bluetooth) と表記しています。Bluetooth4.0 は、クラシックBluetooth と、それとは互換性がない Bluetooth low energy という2つの技術をとりこんだ規格と言えます。

### Bluetooth Smart Ready とBluetooth Smart

Bluetooth無線技術は、無線でデータをやりとりするだけの技術ではなく、無線を通じて機器を利用するための技術です。Bluetooth無線技術に適合した製品には、Bluetooth SIG, Inc.からライセンスの許諾をうけて、Bluetooth商標が使用できます。消費者はこの商標を見て、接続性が確保されていると安心して購入できます。

![ #fig_BT_logo Bluetooth商標](fig/ch01_fig020_BT_logo.png)

Bluetooth商標 [^1020] を[#fig_BT_logo]に示します。Bluetooth商標は、Bluetooth 3.0までは ( [#fig_BT_logo] (a) ) 1つだけでした。

[^1020]: [Bluetooth Smart マークの使用 https://www.bluetooth.org/ja-jp/bluetooth-brand/how-to-use-smart-marks](https://www.bluetooth.org/ja-jp/bluetooth-brand/how-to-use-smart-marks)

Bluetoothコア仕様は改定されてバージョンが上がっても、バージョン3.0までは、それ以前のバージョンの技術との後方互換性を保っていました。新しいバージョンで作られた製品は、すでに広く普及している以前のバージョンで作られた製品とも接続できますし、また新しいバージョンで作られた製品同士では、より高速でよりセキュリティの高い技術が利用できます。ですから、コア仕様のバージョンが上がっても、相互接続を表す商標はそれまでと同じ1つの商標でした。

ですが、クラシックBluetooth と Bluetooth low energy には互換性がないので、すでに市場に普及している Bluetooth3.0 までの機器からは Bluetooth low energy機器に接続できません。これまで保たれていた後方互換性が、初めて一部失われたのです。

このため、Bluetooth 4.0 から、Bluetooth Smart Ready ( [#fig_BT_logo] (b) ) および Bluetooth Smart ( [#fig_BT_logo] (c) ) の2つの商標になりました。

Bluetooth Smart Readyは、クラシックBluetoothとBluetooth low energyの両方を実装した機器に与えられる商標です。このような機器は、2つの機能を持つのでデュアルモードデバイス とも呼ばれます。ヘッドセットなども接続するパソコンや携帯電話などは、Bluetooth Smart Ready機器です。

Bluetooth Smartは、Bluetooth low energyだけを実装した機器に与えられる商標です。Bluetooth low energy のみの機器なので、シングルモードデバイスと呼ばれます。周辺機器は Bluetooth Smart でなければならないことはありません。消費電力を小さくしたい機器には Bluetooth Smart が採用されるでしょうし、高速なデータ通信や音声通信も必要な機器には Bluetooth Smart Ready を採用します。

Bluetooth Smart Ready機器は、Bluetooth 3.0機器を含めた、市場にある全てのBluetooth機器と接続できます。Bluetooth Smart機器は、Blueooth Smart Ready機器または Bluetooth Smart機器と接続できます。

また、Bluetoothコア仕様は、バージョン4.0が登場してからすでにバージョン4.1そしてバージョン4.2と、規格が改定されています。しかし、バージョン4.0以降は後方互換性を保っていますから、例えばBluetoothコア仕様バージョン4.2の Bluetooth Smart機器は、それ以前のバージョン4.0の機器と接続できます。

バージョンにかかわらず後方互換性が保たれていくので、Bluetooth Smart ReadyおよびBluetooth Smartの商標には、コア仕様のバージョン番号は入りません。

### Bluetooth Low Energy の無線通信技術の特徴

Bluetooth low energy は クラシックBluetooth を置き換える技術ではなく、クラシックBluetooth ではカバーしづらい利用分野に向けて開発された技術です。クラシックBluetoothの知識が邪魔になりこの新しい技術を誤解しないように、Bluetooth low energy の特徴を見ていきます。

この技術の特徴は:

- 低頻度、少量データの通信に特化
- 超低消費電力で無線通信しつづけられる

です。

Bluetooth low energy は、低頻度で少量のデータがやりとりできればいいが、必要があればすぐにデータをやりとりしたい分野に特化した技術です。

例えば、心拍センサーならば、2バイトで表せる心拍値を1秒に数回送信できれば十分です。 またテレビのリモコンは、普段は使われることがなく、たまにユーザがボタンが押されます。ですが、 ボタンが押されたら直ちにテレビが反応しなければなりません。

このような機器は、使い手が無線通信を意識しなくてもよくて、必要なときに直ちに無線通信できる技術が求められます。例えば、リモコンのボタンを押せば、すぐに機器が操作できて当たり前です。ですから、リモコンを使う前に、無線通信の開始ボタンを押させたり、あるいは無線通信が電力を消費して毎月電池交換が必要になるようでは、不便で使われません。

Bluetooth low energyは、低頻度かつ少量データがやりとりできればよいという場面に特化させて、不必要な電力消費を削ぎ落した技術です。クラシックBluetoothと比べると消費電力は1/10から1/100にでき、コンビニエンスストアでも売られているような直径2cmのリチウムコイン型電池1つで、1年間ほど無線通信しつづけられます。

超低消費電力にするには、どうしても消費電力が大きくなる無線通信回路を使う時間、つまり電波の送受信をする時間をなるべく短くするほかありません。Bluetooth low energy は、接続した機器同士が正確にタイミングを同期して、コネクション・インターバルと呼ばれる周期ごとに無線通信回路をオンにして、その間にデータをやりとりします。

### プロトコルとプロファイル

Bluetooth無線技術は、無線通信技術を通じて機器やアプリケーションがお互いに機能するための規格です。ですから、多くの無線通信技術が通信技術だけを規定するのとは異なり、Bluetooth無線技術は、通信を通じた機器やアプリケーションの振る舞いも規定します。この無線通信を通じた、データをやりとりする仕様をプロトコル、振る舞いの仕様をプロファイルと呼びます。

Bluetooth low energyは、ジェネリック・アトリビュート・プロファイル(Generic Attribute profile, GATT Profile)という、ものをデータベースとして表現する仕組みがあります。すべての機器のプロファイル、つまりふるまいは、このGATTプロファイルを使い作られます。

Bluetooth Smart機器では、GATTプロファイルをベースにして、任意のプロファイルが設計できます [^1030]。これをカスタム・プロファイルと呼びます。しかし、体重計や心拍センサーのような一般的な機器では、メーカーごとにばらばらのプロファイルではなく、1つのプロファイルに統一されることが必要です。そのようなものには、メーカーなどが提出したプロファイルをBluetooth SIGが承認することで、採択済みBluetoothプロファイルにすることができます。

[^1030]:[​Bluetooth Interoperability and Profiles https://developer.bluetooth.org/DevelopmentResources/Pages/Custom-Profile-Development.aspx](https://developer.bluetooth.org/DevelopmentResources/Pages/Custom-Profile-Development.aspx)

カスタム・プロファイルにより、オリジナルの多種多様なBluetooth Smart機器をすばやく製品化することができます。そして、
一般的な機器は、採択済みBluetoothプロファイルに従うことで、どのアプリケーションからも利用ができる製品として、市場に流通させることができます。

### カスタム・プロファイルとアプセサリ

カスタムプロファイルのBluetooth Smart機器と接続するiOSアプリケーションの構成を [#fig_app_and_device] に示します。

任意の設計が許されるカスタム・プロファイルに、iOSが対応することは不可能です。また、パソコンとは異なりiOSでは、ユーザがインストールできるのはアプリケーションだけで、任意のデバイス・ドライバをインストールすることはできません。

そこで、iOSはアプリケーションに、CoreBluetoothフレームワークを通じて、アプリケーションからBluetooth Smart機器の探索と発見、接続と切断そしてGATTサーバへのアクセスを提供しています。アプリケーションに、デバイス・ドライバに相当する処理部分を持たせることで、カスタム・プロファイルに対応できます。

![ #fig_app_and_device Bluetooth Smart機器と接続するアプリケーション](fig/ch01_fig030_app_and_device.png)

CoreBluetoothフレームワークは、GATTベースプロファイルをアプリケーションに提供するので、iOSアプリケーションからは、Bluetooth Smart機器がGATTサーバというデータベースに見えます。アプリケーションからは、Bluetooth low energyのパケットのやりとりや無線通信は隠蔽されます。

Bluetooth Smart機器とのやりとりは、その機器のGATTデータベースへのアクセスで行われます。データベースの値は、機種が製造された時に書き込まれる機種名のような固定値、機器のセンサーが検出した外界や機器内部の物理値や物理値から計算された値、そしてエアコンの設定温度や運転状態のような制御目標値や動作指示値などの意味をもちます。例えば [#fig_app_and_device] の心拍センサーのGATTサーバには、胸や手首などのセンサーの設置位置や、刻一刻と変化する測定された心拍値が記録されています。

次々と登場する新しいBluetooth Smart機器には、キーボードのような従来からある周辺機器と異なり、iOSアプリケーションと連携して初めて価値を感じる機器が登場してきています。そのような、アプリケーション(Application)とアクセサリ(Accessory)が渾然一体となったものは、2つの単語を組み合わせたアプセサリ(Appcessory)という造語で呼ばれます。

### スマートフォンでのBluetooth low energy体験

Bluetooth low energy は、スマートフォンという新しい通信相手とアプセサリという新しい分野を見つけたことで、急速にその利用が広まっています。その体験は、クラシックBluetoothそして通信相手がパソコンであった頃の体験とは異なります。過去の体験は知識としていかしつつ、今ある新しい技術と過去にはなかったスマートフォンという周囲環境をふまえた、柔らかい発想が重要です。

Bluetooth low energyには、クラシックBluetoothにはなかった体験が作れます。ビーコンのような無線接続をしない利用場面も登場しています。クラシックBluetoothと同じように無線接続をする利用場面でも、細かい体験が異なります。

例えば、クラシックBluetoothでは、新しい機器に接続するときには必ずペアリングという、ユーザへの接続確認が必要でした。ですが、Bluetooth Smart機器では設計次第で、ペアリングなしにすぐに接続することも、あるいはペアリングをして高度なセキュリティーやプライバシー保護の機能を活用することもできます。

例えば、公共施設のフィットネス機器を自分のスマートフォンに接続して、一時的に利用したいだけならば、一手間かかるペアリングは不要に思うでしょう。周囲にいればお互いが見えるのですから、運動データを保護する必要もないでしょう。しかし、自宅にある自分が所有するフィットネス機器であれば、運動データが誰かに盗聴されては嫌ですから、ペアリングをして強固なセキュリティー機能でデータを保護したくなるでしょう。

逆に、クラシックBluetoothでの体験はそのままBluetooth low energyでも実現できるとは限りません。

例えば、Bluetooth low energy は、大きなデータファイルのやりとりには適しません。GATTベースのアーキテクチャでの実効通信速度は60kビット/秒程度と、クラシックBluetoothでの実効通信速度に比べて1桁から2桁小さいものです。Bluetooth Smart機器のファームウェア更新であれば100キロバイト程度ですから15秒程度で送信できます。しかし、iPhoneで撮影した写真ファイル・サイズは2メガバイトを超えていますから、1枚を送信するだけで6分間かかります。

また、Bluetooth low energy には、音声をやりとりする仕様はありません。しかし、ウエアラブル機器では、例えば着信電話にすぐでられるように、常に使うわけではないがたまに音声通話は使いたい場面は多くあります。将来には、そのような機能が規格に取り込まれていくかもしれません。

### Bluetooth無線技術のこれから

Bluetooth無線技術は、スマートフォンと目に見える範囲にある多種多様な機器とを接続する技術として、広く普及しました。そしていま、身の回りにあるものやものごとがネットワークにつながることで、新しいさらに便利な世界が作れるのではないかと話題になっています。その新しい時代に向けて、Bluetooth無線技術は、新しい技術や利用方法を急速に採用してきています。

これまでも、Bluetooth Smart機器の利用場面をより便利により広げるために、強力なセキュリティ技術が取り込まれてきました。今後も要望にあわせて、例えば無線通信速度の高速化や音声通信など、求められる新しい技術を規格に取り込むでしょう。

さらに、家電が連携するスマートホームなどが求める、Bluetooth Smrt機器群がパケットを中継しあい自律的にネットワークを構築する技術もはいってくるでしょう。さらに、インターネットとものとものごとをつなぐために、スマートフォンを介さずに、Bluetooth Smart機器からインターネットに接続したり、逆にインターネットからBluetooth Smart機器に接続する技術も取り込まれていくでしょう。

このような急速な新しい技術の取り込みは、通常はその採用機器の一般販売を阻害します。その規格を採用した機器を開発しても、一般販売を開始する頃には新しい規格が登場して使えなくなると消費者に思われると、機器を買ってもらえないからです。

Bluetooth無線技術の半導体は、それを見越して、ファームウェアを無線で更新できる機能を入れて、今後登場する新しい技術に対応できるように設計されています。Bluetooth無線技術は、これまで後方互換性を保持して市場にあるあらゆる機器との相互接続を確保してきた実績があります。

これから、いくつもの超低消費電力無線技術の規格が、家庭や職場で利用してもらおうと登場してきます。それらの中でも、Bluetooth無線技術は、強力なブランドを作り上げていくと思われます。

<!-- リンク層の話をここにまとめる -->



## まとめ

2000年までの無線通信技術は、ほとんどがストリーム通信での定義された制御コードのやりとりでした。Bluetooth low energy は、ものが持つデータを表現するためにデータベースの仕組みを備えたことで、多種多様なものに無線通信を付加する強力な技術となりました。

また、無線通信には必ず通信相手がいます。iOS が開発環境を一般開発者に開放したことで、世界に広く普及したiOSデバイスが通信相手となりました。さらに、ハードウェアの設計および製造支援サービスや、クラウドファンディングの盛り上がりも後押しとなり、いまも様々なアプセサリが生み出されています。

Bluetooth low energy は、スマートフォン連携機能や、アプセサリを作る上での重要な技術として、いままで実現できなかったことを実現できるようにする鍵となる、使える技術です。

道具は手段です。高度に発達した技術が、たとえ魔術のように見えたとしても、それは術であるかぎり学び理解すれば、誰にでも使える手段です。しかし、どのような術であれ、その術を普及させて日常生活に溶けこませことができれば、それは魔法に見えるのかもしれません。その手に魔法を。
