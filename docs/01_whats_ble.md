
\putTableofcontents

# Bluetooth Low Energy とその使い方

Bluetooth Low Energy は、2010年に規格化されたばかりの新しい技術にもかかわらず、2014年には多種多様な製品が販売されています。

この急速な普及は、 Bluetooth Low Energy が、 実現したくても実現できなかったことが実現できるキー・テクノロジーであり、また早くから iPhone が Bluetooth Low Energy に対応したからです。

この章は、 Bluetooth Low Energy の活用場面と、その場面を支える技術を見ていきます。

## Bluetooth Low Energy と周辺状況

Bluetooth Low Energy は、低頻度で少量のデータを長期間やりとりする用途、例えば1秒ごとに2バイトも送信すればいい心拍センサーなど、に適した技術です。

従来の Bluetooth と比較してBluetooth Low Energy は、無線接続時の平均消費電力を 1/10 から 1/100 にもできる超低消費電力無線通信技術です。ですが1ビットの情報を伝えるのに消費する電力は、むしろ従来のBluetoothよりも大きくなります。

従来の Bluetooth と Bluetooth Low Energy は、どちらがより優れているかというものではありません。どちらも、それぞれの用途にあわせて開発された無線通信技術なのです。

新しい技術には新しい使われ方があります。そして新しい技術をとりまく周囲も新しくなることで、初めて技術が現実に使われ始めます。そこで、従来とは違う新しい技術として Bluetooth Low Energy とその周囲状況を見てみます。

### Bluetooth Low Energy の登場

Bluetooth Low Energyは、超低消費電力、かつ、多種多様な物が持つデータを表現するデータベースを備えた無線通信技術です。

Bluetooth Low Energy は、Bluetooth3.0 までの技術がカバーできない、例えばヘルスケアやウエアラブルなどの領域に向けて開発された、Bluetooth 3.0とは互換性がない新しい技術です。それまでの Bluetooth3.0 に、この新しい Bluetooth Low Energy の技術を加えて1つの無線通信規格にまとめたのが、2010年に発表された Bluetooth4.0 です。

それまでの Bluetooth3.0 と Bluetooth Low Energy の技術は、電波をやりとりする基本的な方式、電波の変調方式から異なる技術です。ですから、Bluetooth3.0 しかなかった時代に開発された Bluetooth 機器では、Bluetooth Low Energy での通信ができません [^1010] 。

[^1010]: ハードウェアはBluetooth4.0 対応でも、OS等が未対応であるため Bluetooth3.0 対応として発売された機種もあります。そのような機種は、Bluetooth4.0の再承認を受けたファームウェアに更新して、Bluetooth4.0対応になることがあります。

Bluetooth3.0までの技術と、Bluetooth Low Energy とを区別するときに、Bluetooth3.0までの技術を クラシックBluetooth と呼ぶ場合もあります。このクラシックという単語は、以前から規格になっていたという意味です。

### Bluetooth Smart Ready 機器と Bluetooth Smart 機器

Bluetooth3.0までは、新しい規格で作られたBluetooth機器は古い規格で作られた機器と接続できる後方互換性を維持してきました。このおかげで、Bluetoothのロゴがある製品であれば、規格のバージョン番号や製造された時期を気にすることなく、接続して利用ができました。

ですが、Bluetooth4.0では、この後方互換性が一部失われました。

Bluetooth4.0以降は、それまでの Bluetooth3.0 と Bluetooth Low Energy 両方に対応する機器と、Bluetooth Low Energy のみに対応する機器の、2種類のBluetooth機器が作れます。

ですから、 Bluetooth3.0 に対応した機器からは、Bluetooth Low Energy のみに対応した機器には接続できません。

<!--TBD 図 Bluetoothロゴと接続できる関係 -->

このため、Bluetooth Smart Ready と Bluetooth Smart という2つのロゴが新しく導入されました [^1020]。

[^1020]: [Bluetooth Smart マークの使用 https://www.bluetooth.org/ja-jp/bluetooth-brand/how-to-use-smart-marks](https://www.bluetooth.org/ja-jp/bluetooth-brand/how-to-use-smart-marks)

Bluetooth Smart Ready 機器は、Bluetooth3.0 と Bluetooth Low Energyの2つの方式に対応できるもので、パソコンやスマートフォンがこれにあたります。Bluetooth Smart は、Bluetooth Low Energy のみを搭載する機器で、キーボードや心拍センサなどの周辺機器がこれにあたります。

いままでの無印のBluetoothロゴの機器は、Bluetooth Smart Ready 機器とは接続ができますが、Bluetooth Smart 機器とは接続ができません。

また、Bluetooth4.0 が公開されてから、Bluetooth4.1 および Bluetooth4.2 が公開されています。Bluetooth4.0 以降は、後方互換性を保ちながら機能強化および新機能の追加が進められています。

Bluetooth 4.0 から 4.2 までの変更点は、おもに Bluetooth Low Energy に関するものです。通信の高速化やセキュリティ強化といった機能強化、および IPv6 対応などの新機能の追加がなされています。

### クラシックBluetooth と Bluetooth Low Energy の利用場面

Bluetooth3.0までの技術は、より高速な通信をより小さな電力で提供することです。その利用分野は、通話や高音質な音楽を聞くためのヘッドセットや、テザリングのような通信、あるいはファイル交換などです。LANケーブルやオーディオケーブルなどの有線接続を無線化するために発展した技術と言えます。

Bluetooth Low Energy は、身の回りにある些細なものに無線機能を付加する技術です。そのために必要とされたのが、超低消費電力と、ものが持つ多様なデータの表現能力です。

超低消費電力は、電池交換頻度を実用範囲にするためと、機器の外観を実用にするために必要です。

仮に Bluetooth Low Energy を搭載した機器が、身の回りに100個あったとします。もしも電池が1週間で切れてしまうならば、1日に約14個の充電あるいは電池交換が必要になります。実用ではありません。もしも電池が5年間で切れるならば、電池交換は18日に1回になります。また5年利用すれば破棄して新しい機器に買い換えるかもしれません。その場合には電池交換することもありません。

また、外観やデザインを満たそうとすると、回路や電池に許される物理的な形状や容積は小さなものになります。腕時計型であれば丸く薄い形状が求められますし、メガネ型であればレンズを耳に固定するツル部分に収めることになります。

電池の容積の大きさは、そのまま電池容量の大きさです。ですから、電池の交換や充電頻度が適切な程度になる電池の大きさと、その電池を内蔵する外観デザインとが両立する点を見つけなければなりません。

超低消費電力であればあるほど、電池容積が小さくできるので、外観デザインの自由度が高まります。

ものが持つ多様なデータの表現能力は、多種多様な機器を生み出すために不可欠です。

Bluetooth Low Energy は、多様なものの情報を格納するデータベースを提供する、ジェネリック・アトリビュート・プロファイル (Generic Attribute Profile、GATT) という仕組みを持っています。

GATT は、ものの機能をサービス、機能の中にあるセンサーや制御目標などの値をキャラクタリスティクスという概念で表します。1つのキャラクタリスティクスにはいるデータ量は最大でも512バイト<!--TBD-->です。

例えば、電池を内蔵した機器であれば、バッテリーサービスを備えています。バッテリーサービスの中にある、バッテリー残量を表すキャラクタリスティクスを読み出すことで、その残量がわかります。また、残量が変化すると、データベースから値の変化をプッシュしてもらうこともできます。

つまり、Bluetooth Low Energy の本質は、データ変化などのイベントごとに、小さなデータをやりとりして、ものが持っているデータベースと読み取り側とでデータを同期する無線通信技術と言えます。

このようにクラシックBluetooth とBluetooth Low Energy は利用分野が違います。ですから、Bluetooth Low Energy 機器の企画立案などでは、クラシックBluetooth での体験は邪魔な先入観でしかありません。

例えば、Bluetooth Low Energy には音声通信の規格はありません。通話に使われるヘッドセットのプロファイルがあるクラシックBluetoothであれば、すでに部品が通話機能を備えているので実装は容易かもしれませんが、それと同じことを BLuetooth Low Energy で実現しようとすると、その通話部分の技術を自分たちで実装しなくてはならなくなり、結果として大きな費用が必要になる場合もあります。

### Bluetooth Low Energy と iOS

新しい無線通信技術が登場すると、その通信相手があるのか、が話題になります。

通信には必ず通信相手がいます。ですから、新しい通信技術を搭載した装置それ自体が安価であっても、その通信相手となる装置も買い換えないといけないとなると、それなりの費用とシステムの再構築のような手間がかかります。

Bluetooth Low Energy には、iOSがいました。

2010年に規格化された翌年2011年に発表された、iPhone4s は世界ではじめて Bluetooth4.0 に対応した端末となりました。また同時に公開された iOS5 は、Bluetooth Low Energy を一般アプリ開発者に開放しました。

この iOS の Bluetooth Low Energy の対応が、新技術普及に不可欠な3つの要素:

1. 新しい無線通信技術を採用した魅力的な周辺機器
2. その周辺機器が通信する端末
3. 周辺機器と連携する魅力的なアプリケーション群

を一度に提供したのです。

とくに、iOSアプリケーション開発にとっては、Bluetooth Low Energy で接続通信するフレームワーク CoreBluetooth が一般開発者に公開されたことが大きな出来事でした。

それまでは iOS デバイスの周辺機器およびその連携アプリケーション開発には、Apple社と [Made for iPhone (MFi)プログラム](https://developer.apple.com/jp/programs/mfi/) [^1030] という秘密保持契約を締結して初めて、開発に必要な情報や開発キットの提供を受けられました。契約対象の会社であると審査が通るのかなどの壁がありました。

[^1030]: [https://developer.apple.com/jp/programs/mfi/](https://developer.apple.com/jp/programs/mfi/)

ところが Bluetooth Low Energy については、MFiプログラムに関係なく、どのような Bluetooth Low Energy 機器ともiOSアプリケーションが接続できるようになりました。

これにより、iOSアプリケーションと連携するユニークな周辺機器を製造する会社が登場したり、Bluetooth Low Energy対応の脳波や脈拍センサーに連携するiOSアプリケーション群が登場しました。

ただし、これは一般的な Bluetooth Low Energy を採用した機器についてのみ当てはまります。Bluetoooth3.0 までの高速通信ができる Blueooth技術を採用する周辺機器の開発には、従来と同じくMFiプログラムが必要です。

また、無線通信技術に Bluetooth Low Energy を使っているものでも、次の節に登場する iBeacon や HomeKit などの、Apple社の所有する技術を使うものはMFiプログラムの対象になります。

### iOS にとっての Bluetooth Low Energy

iOSはいち早く 
Bluetooth Low Energy への対応は、iOSだけではなく Android や WindowsPhone また Windows8 などでも進められています。

このような周辺機器以外に、iOS それ自体が Bluetooth Low Energy を利用する独自技術を持っています。

2013年に公開されたiOS7では、次の2つの機能が実装されました:

- iBeacon
- Apple Notification Center Service

[iBeacon](https://developer.apple.com/ibeacon/) [^1039] は、Apple社の新しい位置と近接の検出技術です。MFiプログラムの対象です [^1040]。

[^1039]: [iBeacon https://developer.apple.com/ibeacon/](https://developer.apple.com/ibeacon/)

[^1040]: [iBeacon for Developers https://developer.apple.com/ibeacon/](https://developer.apple.com/ibeacon/)

iBeaconは、Bluetooth Low Energyのデバイス発見につかうアドバタイズメントという仕組みを利用して周囲に識別子情報を送信しつづけるビーコンと、そのビーコンをフォアグラウンドおよびバックグラウンドで検出するiOSを組み合わせたものです。

衛星からの電波が届かない屋内衛星からの電波が届かない屋内でも、屋内にビーコンを設置することで、おおよその現在位置を検出するGPSを補う技術として利用できます。また、識別子を設定したビーコンを配置させて、特定の位置でiOSアプリケーションを起動させることができます。

[Apple Notification Center Service (ANCS) ](https://developer.apple.com/library/ios/documentation/CoreBluetooth/Reference/AppleNotificationCenterServiceSpecification/Specification/Specification.html) [^1050] は、iOSデバイスのロック画面に表示されている通知情報を同期する技術です。ANCS自体は、MFiプログラムの対象ではありません。

[^1050]: [Apple Notification Center Service https://developer.apple.com/library/ios/documentation/CoreBluetooth/Reference/AppleNotificationCenterServiceSpecification/Specification/Specification.html](https://developer.apple.com/library/ios/documentation/CoreBluetooth/Reference/AppleNotificationCenterServiceSpecification/Specification/Specification.html)

iPhoneと連携する腕時計は、iPhone本体に表示された電子メールや予定などの通知情報をユーザに知らせる機能があります。ANCSを実装することで、周辺機器にそのような通知表示機能を持たせられます。[Apple Watch](https://www.apple.com/jp/watch/) [^1060] も、この技術を利用していると思われます。

[^1060]: [Apple Watch https://www.apple.com/jp/watch/](https://www.apple.com/jp/watch/) 

iOS8では、さらに次の3つで Bluetooth Low Energy が使われています:

- HealthKit
- HomeKit
- Handoff機能

[HealthKit](https://developer.apple.com/healthkit/) [^1090] は、ユーザの健康情報を収集蓄積するヘルス・アプリと、iOSが持つ健康データベースを読み書きするための Health Kit フレームワークから構成されます。

[^1070]: [HealthKit https://developer.apple.com/healthkit/](https://developer.apple.com/healthkit/)

iOSではユーザが追加できるものはアプリケーションだけです。ですから、パソコンのようにデバイス・ドライバを追加することはできません。そのために、パソコンであればデバイス・ドライバが担ってくれる、Bluetooth Low Energy 機器の動作制御やデータ取得と言った部分を、iOSアプリケーションに実装しなければなりません。

このヘルス・アプリは、心拍や血糖値センサなどの標準化されている Bluetooth Low Energy 機器からのデータ収集に対応しています。そして収集したデータは、iOSの健康データベースに記録します。ちょうどデバイス・ドライバと同じく、標準化されたハードウェアへのアクセス部分を担います。

この健康データのデータ・ベースには、HealthKitフレームワークを通じてアクセスできます。ですから、iOSアプリケーションは、Bluetooth Low Energy で通信をしなくとも、このデータベースから必要なデータを得ることができます。

[HomeKit](https://developer.apple.com/homekit/) [^1080] は、照明機器や電子錠などの身の回りの機器とiOSとを Bluetooth Low Energy または Wi-Fi で連携させる技術です。

[^1080]: [HomeKit https://developer.apple.com/homekit/](https://developer.apple.com/homekit/)

機器とiOSとの通信仕様と、機器の設定や操作をiOSアプリケーションに提供する HomeKit フレームワーク から構成されます。HomeKit に対応する機器は MFi の対象ですが、HomeKit フレームワークは一般開発者開放されています。

Handoff機能は、iOS 8 および OS X Yosemite の連携機能です。例えば、あるiOSデバイスでメールを書いている時に、他のiOSデバイスをや OS X Yosemite を開くと、編集作業中の状態が同期されていて、編集作業をシームレスに継続できます。

Handoff機能の通信仕様は公開されておらず、どのように実装されているかは外部からはわかりません。近くにあるデバイスの検出に Bluetooth Low Energy を活用して、デバイス間同期でのまとまった量のデータのやりとりには高速なクラシックBluetoothやWi-Fiを利用するようです。

## Bluetooth Low Energy の無線通信技術

Bluetooth Low Energy は規格化された無線通信技術です。ですから、無線通信の詳細技術をしらなくても、無線モジュールを購入して、開発キットの説明にしたがって開発すれば、無線通信をするなにかを開発はできます。

たしかに詳細を知る必要はないのですが、Bluetooth Low Energy の最大の特徴である超低消費電力はどのような技術で実現されているのかは、単純に興味をひきます。

あるいは、具体的な機器の利用場面をつめていくと、処理待ちや結果が返ってくるまでの時間がどの程度になるのかを知りたくなる場合もあります。

通信には、通信速度とレイテンシという2つの性能があります。通信速度は1秒間にどれだけのデータを送信できるか、レイテンシは送信したいデータが相手に届くまでの時間です。どちらも同じようなものじゃないかと思われるかもしれませんが、この2つは意味が異なる性能値です。

通信速度とレイテンシを知らないと、例えば、パソコンに文字を入力するキーボードを設計しているのに、レイテンシを1秒にしていたら、押したキーが画面に表示されるまで1秒かかるキーボードになってしまいます。

Bluetooth Low Energy を、うまく使いこなすための基礎知識として、その無線通信技術を簡単に見ていきます。

### 電波と無線通信

無線通信には、電磁波のやりとりがよく使われます。電界と磁界が振動しながら空間を伝搬する波を電磁波と呼びます。そのうち、周波数が 3THz (テラヘルツ) 以下の電磁波を電波と呼びます。

Hz(ヘルツ)は周波数の単位で、1Hzは1秒あたり1回の振動です。周波数はよく大きな値になるので、単位Hzの前に桁を表す接頭辞をよくつけます。T(テラ)は、 $ 1 * 10^12 $ を表す接頭辞です。

電磁波が真空中を伝わる速度は $ 3 * 10^8  メートル/秒 $ なので、最も周波数の高い電波 3THz は波長 0.1 ミリメートルの波になります。人間の目に見える可視光も電磁波ですが、可視光の波長は 500 nm  (ナノメートル、ナノは $ 1 * 10^-9 $ を表す) 、 0.0005 ミリメートル  くらいです。

現在の回路技術では、3THzの電波の送受信はとても高度な技術で、まだ日常で利用できるようなものではありません。一般で使われているBluetoothやWi-Fiは、2.4GHz帯や5GHz帯を使っています。G(ギガ)は、 $ 1 * 10^9 $ を表す接頭辞です。

無線通信には必ず、送信側と受信側があります。そして送信側が電波を発射したときに、受信側が受信状態であれば、電波で通信ができます。

電波は目に見えなくて、とらえどころがありませんが、理解する必要はありません。送信側が、高周波信号を送信回路からアンテナに入力すると、アンテナから空間に電波が波として広がっていきます。その電波が受信側のアンテナに届くと、それが高周波信号になり受信回路に入り、信号が伝わります。そんなものか、という感覚的な把握で十分です。

### 無線通信を音声会話に例えてみると

機器が無線通信をする様子は、人間が目を閉じて音声だけで周囲と会話する様子と同じです。

この目を閉じてという条件を忘れないことが重要です。無線通信を音声会話に例えると、人間にとっては視覚で周囲状況を把握することが当たり前のことすぎて、この条件を忘れがちになります。

周囲の人と会話が成り立つには、3つの条件が必要です。

1. 相手に自分の声が聞こえること
2. 相手の声が自分に聞こえること
3. お互いに話している内容が理解できること

声は電波に例えられます。声の大きさは、電波の送信電力に相当します。肺を圧縮して声帯を震わせる空気を絞り出す筋力が電池などの電力に、空気の流れのエネルギーを音波に変換する声帯がアンテナに相当します。

まず、相手に自分の声が届かなければなりません。すぐ近くに相手がいるならば、ささやき声のような小さな声で十分でしょう。相手がとても遠くにいるならば、力いっぱい大声を出さないといけません。

同じ声の大きさで、より遠くの相手に声を届けたい時に、メガホンや両手を口に添えて、声を一方向に集中させます。無線通信でも、高周波電力を電波として空間に放出するアンテナに、一方向に強く電波を送信する指向性をもたせる工夫があります。

Bluetooth Low Energy では、なるべくアンテナに指向性を持たせない設計がされます。持ち歩いたり、身の回りにあるものに使われる技術なので、事前に通信相手がどこにいるのかがわからないからです。

携帯電話の基地局やWi-Fiのルータのように、大きな製造コストと消費電力が許される機器には、アンテナを複数もうけて、回路技術でアンテナの指向性を最適な特性に調整する技術を搭載するものもあります。これはしかし、安価に製造したい Bluetooth Low Energy には必要を超える技術です。

周囲にある不特定多数の機器に一方向に情報を伝えるブロードキャストであれば、電波を送信するだけです。ですが、お互いに情報をやりとりする通信をするならば、相手の声が自分に聞こえなければなりません。

相手の声が自分に聞こえるかどうかは、自分に届いている相手の声の大きさと、自分の耳の感度の掛け算で決まります。この耳の感度は、アンテナが電波を集める効率の高さと、受信回路の検出下限で決まります。

声の大きさと耳の感度、つまり送信電力と受信感度の組み合わせで、お互いにお互いの声のやりとりが出来て初めて通信が成り立ちます。送信電力だけは大きいのに、受信感度が低ければ、相手の声が聞こえず会話にはなりません。また、受信感度が高くても送信電力が小さいと、相手が自分の声を聞き取れず、やはり会話にはなりません。

このほかに、声を吸収したり、遮ったりするようなものが周囲にあるかどうかも、通信に影響します。

会話をするためには、お互いに声が届くだけではだめです。同じ言語や同じ背景知識を共有していなければなりません。また、人間の会話では当たり前すぎて忘れがちになるのですが、相手が話している間は聞き、相手が聞いている間に自分が話す、といったタイミング制御もとても大切です。

### Bluetooth Low Energy と2.4GHz帯

Bluetooth Low Energyが無線通信に使う周波数帯は、クラシックBluetoothと同じ 2.4GHz帯です。この2.4GHz帯は、一般販売する無線通信機器に都合が良い周波数帯です。

まず、2.4GHz帯は、周波数帯の割り当て申請やライセンスの取得をしなくても、世界の多くの国で使用できる周波数帯です。

電波は公共の財産なので、国が法律を作り免許制度のもとで管理運営しています。携帯電話やタクシーや消防車の業務無線など、無線通信の用途や機器ごとに周波数の割り当てがあります。

この2.4GHzは、国際的な組織 [国際電気通信連合 (ITU)](http://www.itu.int/) [^1090] で、電波を無線通信以外の産業・科学・医療に高周波エネルギー源として利用するために割り当てられた周波数帯です。加盟各国はこの割り当てに従っています。

[^1090]: [http://www.itu.int/](http://www.itu.int/)

もともとは、2.4GHz帯の電波は水に強く吸収されるので、高周波加熱つまり電子レンジに使われています。ですが、この各国で共通して割り当て利用できることに着目して、現在は Wi-Fi や Bluetooth などに利用が開放されています。

そして、2.4GHzの波長は 12.5センチメートル と短いので、小型機器に収まるくらいの小さなアンテナが使えます。そして 2.4GHz の周波数であれば、高周波回路が現在の量産されている半導体技術で作れるので、大量に安価に製造ができます。

### 通信規格の役割

無線通信規格がなければ、無線通信は成り立ちません。

あたりまえのことですが、1つの機器だけでは通信はできません。通信には必ず2つ以上の機器が関わります。2つの機器が電波で通信するためには、情報の伝え方や表現など膨大な取り決めが必要です。その取り決めを提供するのが、Bluetooth をはじめとする無線通信規格です。

また、無線通信技術には、高周波回路素子や半導体素子などのハードウェアから、通信を制御するソフトウェアやアプリケーションまで、数多くの構成要素が必要です。無線通信規格にある仕様どおりに、それぞれの構成要素をそれぞれの会社が製造して組み合わせることで、初めて使える無線通信技術になります。

Bluetooth Low Energy は、一般に利用される無線通信技術を提供する規格です。これは、通信のための3つの仕組みを提供します。

1. 電波でデジタル信号を表現する方法
2. 付近にある機器の発見と通信
3. データの意味づけと機器の振る舞いや機能の定義

一般利用する無線通信技術には、通信できるだけではなく、さらに次の仕組みが重要です。

1. 電子レンジや他方式の無線通信との共存
2. 他のBluetooth Low Energy機器との共存
3. セキュリティの確保とプライバシーの保護

まず、2.4GHz帯は電子レンジやWi-Fiその他の無線通信も利用しています。ですから、同じ周波数帯を使う Bluetooth Low Energy が、他の無線通信を妨害したり、逆に他の機器の影響をうけて通信ができなくなりにくい工夫が重要です。

さらに、Bluetooth Low Energy は身の回りのものに内蔵する無線通信技術です。ですから、例えば一人が1つの機器を持っているだけでも、街の雑踏では、電波が届く半径50メートル範囲内には何百人もの人がいます。それらの多数の機器が通信をしていても、他の機器の通信を阻害しない工夫も重要です。

また、セキュリティの確保は、無線通信技術を信頼してもらうための最重要課題です。セキュリティとは、通信を通じた情報の盗み取りや、悪意ある制御を引き起こす不正アクセスから、機器を守ることです。

無線通信技術のセキュリティ確保は、チャレンジングな課題です。いま受信した電波が、どこから送信されているのかを知ることはできません。ですから、電波だけから通信相手が既知の信頼できるものかは、わかりません。

さらに、Bluetooth Low Energyの無線通信規格は一般公開されていますから、だれでも規格を入手してその内容を知り尽くすことができます。また、Bluetooth Low Energy の電波を送受信する開発者向け機材ですら、通信販売で誰でも安価に入手できます。

ですから、悪意があり技術も道具もある実行能力がある侵入者を想定しなくてはなりません。また、暗号化処理を複雑で高度なものにするほど、より大きな回路規模つまり製造費用と電力消費につながります。

Bluetooth Low Energy の電気回路は安価であることも重要ですから、安価かつ十分にセキュリティを確保するバランスのよい技術が求められます。

そのうえ、Bluetooth Low Energyは人が身につける機器、いわゆるウエアラブル機器にも使われる技術です。特定の人が特定の電波を送信する機器を身につけるため、その機器からの電波で誰がそこにいるかが検出されると、プライバシーの侵害を引き起こすかもしれません。

### 周辺機器のための通信規格の役割

Bluetooth Low Energy は、キーボードやヘッドセットをはじめとした多種多様な周辺機器のための無線通信規格です。ですから、この規格は、無線通信できるだけではなく、無線接続した機器が期待した動作をすることまで規格化しなければなりません。

パソコンで使われる無線LANであれば、無線ルータとパソコンとの間の無線通信を提供するだけで十分です。電子メールや動画視聴などのネットワークサービスは、パソコンのアプリケーションが処理するので、ネットワークサービスまで規格化する必要がありません。

周辺機器は、目的に応じて設計された、それ単体で機能するものです。ですから、パソコンのように万能の装置ではありませんし、またユーザがアプリケーションをインストールするようなものではありません。

クラシックBluetooth は、ヘッドセットやキーボードといった機器ごとに、通信と機器の振る舞いをセットにして細部にいたるまで規格化していました。そのおかげで、Bluetooth のロゴがあれば、何年も以前に発売された製品でも、安心して利用できるのです。

ところが、Bluetooth Low Energy は多種多様なもののための通信規格なので、具体的にどのようなものに使われるかは限定できません。そこで、Bluetooth Low Energy は、サービスとキャラクタリスで構成されるデータベースの仕組みを提供しています。

このデータベースにどのような意味があるデータをどう定義するのか、そしてデータベースの読み書きと機器の振る舞いはどう対応するのかの定義は、プロファイルと呼ばれ規格とは分離して定義が与えられています [^1100]。 

[^1100]: [Profile Overview, https://developer.bluetooth.org/TechnologyOverview/Pages/Profiles.aspx](https://developer.bluetooth.org/TechnologyOverview/Pages/Profiles.aspx)

この規格とプロファイルの定義とを分離したことで、Bluetooth Low Energy は、新しい機器が登場するごとに新しいプロファイルを追加できます。

### 妨害と混信と共存への技術

Bluetooth Low Energyが使う 2.4GHz帯 は、多数の無線通信機器がひしめき合って利用している周波数帯です。この周波数帯では、電子レンジからの漏洩電波が妨害となり通信ができなくなったり、他の無線通信機器の通信に影響を与えたりせずに、共存するための技術が必要です。

電波はアンテナから、文字通り四方八方に広がっていきます。ですから、電波の混信と妨害は、送受信をしている間に、無視できない強さ電波がどこかからやってくること、です。

ですから、まず送信する電波の電力を必要以上に大きくしないことです。送信回路がアンテナに出力する電力の大きさを空中線電力または出力電力と呼びます。空中線はアンテナの日本語表記です。

出力電力は、通信規格と、国ごとに定めている技術基準の、2つの制約がかけられています。

Bluetooth Low Energy は、出力電力を最大 10ミリワットとしています。また日本の技術認定基準では、Bluetooth が採用している周波数ホッピング方式では 3 mW/MHz を上限としています。Bluetooth Low Energy の1チャネルの周波数幅は 2 MHz ですから、日本での出力電力は 6 mW ( 7.7 dBm) までです [^1100]。

[^1100]: 2.4GHz帯高度化小電力データ通信システム の技術基準は出力電力を、Bluetoothが採用する周波数ホッピング方式 で 3 mW/MHz、無線LANが採用する直接スペクトラム拡散方式で 10 mW/Hz としています。

次に、周波数を細分して、同時に同じ周波数を使う確率を下げることです。2.4 GHz帯は、2.4 GHz から 2.4835 GHz の 83.5 MHz の周波数幅があります。Bluetooth Low Energy は、これを 2 MHz 幅の40のチャンネルに分割して、それぞれのチャンネルで通信します。

この周波数帯とチャンネルの関係は、ピアノの鍵盤に例えられます。

ずらっと並んだ鍵盤が周波数帯を表します。左から右に、周波数が低い方(低音)から高い方(高音)に鍵盤が並んでいます。鍵盤は1つのチャンネルに相当します。鍵盤を押せば、特定の周波数の信号(音)が出力されます。

1つのチャンネルでの通信は、例えばドの鍵盤の音を、ほんの僅か音色を変化させてデジタル・データを送信しているようなものです。他の機器が隣接するチャンネル、この例でいえばドの鍵盤の両隣にあるシやレの音、で通信をしていても、ドのあたりの音だけを通してシやレの音は通さないフィルタリングする信号処理を使えば、目的の信号だけを取り出せます。

ですが、このチャンネルの工夫があっても、同じチャンネルで同時に通信が行われて、送信したい情報が相手に届かない時があります [^1110]。さらに、機器が移動したり、パソコンや電子レンジの電源が入れられたりして電波状況が変化して、今まで通信ができていたチャンネルでも通信ができなくなることもあります。

[^1110]: Bluetooth Low Energyには、電波を送信する前に、そのチャンネルを受信して他の無線通信が行われていれば送信をとりやめる、キャリア・センスの仕組みはありません。

そこで、一定時間ごとにチャンネルを切り替えていきます。あるチャンネルで通信ができないのに、すぐ隣りのチャンネルに切り替えても、やはりそのチャンネルでも通信ができない確率は高そうです。そこで、チャンネルをいくつか飛ばして飛び跳ねるように切り替えていくので、周波数ホッピングと呼びます。

また、Wi-Fiが近くになるなどで、通信につかえそうになりチャンネルが事前にわかっている場合は、そのチャンネルにはホッピングしません。周囲の状況に合わせてホッピングを変えるこの方式を、適応周波数ホッピングと呼びます。

適応周波数ホッピングを使うことで、たまたまWi-Fiの通信と重なり通信ができなくなっても、Wi-Fiと重なっていないチャンネルに切り切り替われば、通信が再開できます。またWi-Fiにとっても、もしもBluetoothの影響で通信が乱れることがあっても、チャンネルを切り替えていくので、その状態がずっと継続することはありません。

### 超低消費電力無線通信技術の仕組み

無線通信は外乱や雑音の影響があるのが、あたりまえです。ですから無線通信技術は、送信したいデータを小さなデータに分割します。この分割した塊をパケットと呼び、パケットをやりとりする通信をパケット通信と呼びます。

パケットには、受信したデータが欠落したり値が化けていないかを検出できる、検査用のデータを付加する工夫が入っています。そして、あるパケットに誤りがあれば、それを再度送信してもらうことを繰り返して、誤りなくデータのやりとりができます。

パケット通信の消費電力は、送信する電波の電力、2.4GHzという高い周波数を扱う高周波回路および通信制御回路の消費電力の、3つにわけられます。Bluetooth Low Energy の超低消費電力無線通信は、電波を送受信する瞬間だけ高周波回路や通信制御回路を動かすこととで実現されています。

身の回りにあるスマートフォンやパソコンに搭載されたプロセッサでも、動作周波数が2.4GHz程度のものがありますが、重い処理をさせると手で触れてわかるほど発熱します。高い周波数で動作する回路の消費電力を劇的に低減する魔法のような技術はありません。つまり、消費電力を小さくしようとすれば、回路を動かす時間を極限まで小さくするほかありません。

Bluetooth Low Energy の無線通信技術は、1ビットの情報を1マイクロ秒( $ 1 * 10^-6 $ 秒)で送信します。つまり、物理層のビットレートは、1 Mビット/秒 ( 1 * 10^6 ビット/秒 )です。パケットの最大長は376ビットなので、1回あたりの送信時間は最大でも 376 マイクロ秒と、とても短い時間です。

1 Mビット/秒 という高いビットレートは、消費電力の低減に大きく役立ちます。2.4GHzの電波を送受信する高周波回路は、動作しているだけで電流を消費します。ですから、ビットレートが高いければ高いほど、パケット1つを送受信する時間は短くなり、高周波回路を使う時間が短くできます。

しかしビットレートを高める技術は、より複雑な処理が必要になり、回路規模と消費電力と製造費用があがってしまいます。Bluetooth Low Energy はそのバランスとして、このビットレートが採用されています。

半導体技術が進歩すると、同じ電力と同じ製造コストでより複雑な処理ができるようになります。半導体技術の進歩に合わせて、Bluetooth Low Energy のビットレートはさらに高速化されるでしょう。それは、さらなる低消費電力化をもたらします。

### 超低消費電力なパケット通信

通信時の、パケットのやりとりと消費電流の時間変化を<!-- 図を入れる? -->に示します。

送信側と受信側は、接続処理時にお互いの時計を同期して、パケットを送受信する時間を正確に同期しています。送信側は、決められた時刻にパケットを送信します。受信側は、決められた時刻に受信回路を動作させて、送信されているだろうパケットを受信しようとします。

受信側は、パケットを受信できたならばパケットを返信します。このパケットの返信のタイミングも、時刻が決められているので、送信側は返信パケットが来るだろう間だけ、受信回路を動作させます。お互いに送信したいデータがあるかぎり、このパケットのやりとりを繰り返します。

<!-- 図 -->は、このときの消費電流の時間変化です。

Bluetooth Low Energyの典型的な半導体チップは、電源電圧が 1.8 ボルト、送受信動作中に 10 ミリワット から 20ミリアンペア の電流を消費します。仮に、1秒に1回パケットを送信するとすれば、平均消費電流は 8 マイクロアンペア (1マイクロアンペアは $ 1 * 10^-6 $ アンペア) になります。

電波の送受信をしている間のピーク電流を低減する魔法のような回路技術はこの世にはありません。
このように、送受信の時刻を同期することで、高周波回路の動作時間を必要最小限にして、平均として小さい消費電流を実現しています。

ただし、機器を発見するアドバタイジングでは、こうはなりません。機器を発見する側は、いつ送信されてくるかわからないパケットを検出するために、ずっと受信動作をし続けなければなりません。そのため、通信時のように超低消費電力に抑えることができません。

Bluetooth Low Energy をスマートフォンと周辺機器間の通信に使うならば、充電ができるスマートフォンよりも、電池で動く周辺機器の電力のほうが高価です。ですから、この消費電力が大きい機器を発見する側はスマートフォンが担うように、よく設計されます。

### パケット通信のスループットとレイテンシー

パケット通信には、スループットとレイテンシーという2つの重要な値があります。スループットは1秒あたりに送受信できるデータ量を、レイテンシーは送信しようとしたデータが相手に届くまでの時間です。

Bluetooth Low Energy は少量のデータを低頻度でやりとりする技術なので、ほとんどの利用分野でスループットよりもレイテンシーのほうが重要です。

例えば、キーボードであれば、キーを押したり離したりする回数は1秒に40回もいきませんから、スループットは40バイトもあれば十分です。ですが、キーを押したり離したりしたデータが無線通信で伝わり画面に表示されるまでの時間、つまりレイテンシーは、画面更新レート ( 30 フレーム/秒 ならば 33 ミリ秒 ) 程度は必要です。

レイテンシーは、<!-- 図 -->のパケットのやりとりの周期で決まります。もしも前節の例の計算で、パケットのやりとりを 1 秒ごとから 33 ミリ秒にすれば、平均消費電流は 30 倍になります。

Bluetooth Low Energy には、電池の消費量をおさえつつ、小さいレイテンシーを確保する細かい工夫がいくつかあります。

その1つが、パケットをやりとりする周期を、必要に応じて変更する仕組みです。機器が使われてない間は周期を長くして消費電流を最小に、機器が使われている間は周期を短くしてレイテンシーを十分小さくします。

### セキュリティとプライバシー

無線通信技術にとって、セキュリティの確保は最重要です。

例えば、だれしも自宅の家電が自分にだけしか操作できないのは当然だと思っています。自分が許可していない誰かが自分に断りなく勝手に操作ができてしまうような機器は、信用されず、使ってもらえません。

一般的な家電には、セキュリティは確保されていません。ドアに鍵がかかっている知らない人が入ってこないはずの家の中に設置される前提で設計されるので、その必要がないのです。

ですが、Bluetooth Low Energy は電波を使う技術です。電波は家の壁を超えて、周囲に広がります。したがって、Bluetooth Low Energy は、家の鍵がかかっているのと同じセキュリティを、通信技術で確保していなくてはなりません。

また、Bluetooth Low Energy は、家の電子鍵にも使われる技術です。ですから、自分の持ち物や権限が守られていると信頼される、十分なセキュリティとプライバシーが確保できる技術が必要になります [^1120]。

[^1120]: [​Security, Bluetooth Smart (Low Energy), https://developer.bluetooth.org/TechnologyOverview/Pages/LE-Security.aspx](https://developer.bluetooth.org/TechnologyOverview/Pages/LE-Security.aspx)

人間がどう使うか、人間にとってどんな価値があるかといった文脈で、必要とされるセキュリティやプライバシーの確保は、異なってきます。

例えば、フィットネスに使われる心拍計は、自分が所有している心拍計もあれば、ジムに備え付けられたランニング・マシンに内蔵された心拍計もあります。自分が所有しているものであれば、自分以外には利用できないようにしたいものです。ですが、一時的に利用するランニング・マシンが内蔵する心拍計であれば、その時の利用者が手軽に利用できるようにしたいものです。

さらに、ランニング・マシンのモニタに心拍値が表示されていて、回りにいる人であれば誰にでも読み取れるでしょうから、その情報を他人に読み取られないように無線通信を保護する必要も、ないかもしれません。

Bluetooth Low Energy は、必要な場面にあわせられるように セキュリティのモデル をいくつか提供しています。

Bluetooth Low Energy のセキュリティ技術を、具体的に2つの場合:

1. 自分だけの情報を無線通信から読み取られないこと、
2. 自分以外が機器と無線通信をしたり操作できないこと

で見てみます。

電波は四方八方に広がるうえ、Bluetooth Low Energy は規格化された技術なので、誰でもその通信を読み取れます。もしも、機器とクレジットカードや住所などの重要な情報をやりとりするならば、その情報を他人に読み取られては、困ります。

ですから、通信データが読み取られても、そこから大切な情報を読み取られないようにするデータの暗号化技術が不可欠です。

Bluetooth Low Energy は暗号化アルゴリズムに AES (Advanced Encryption Standard) を採用しています。AESは、米国のNIST(National Institute of Standards and Technology)が公募して採択した標準暗号化方式で、通信で広く使われている方式です。

また、電波はいたるところを飛び交っているので、電波だけから、どの機器からきた電波かを確認することはできません。もしも、Bluetooth Low Energy で操作できるエアコンに、家の外から電波を送って勝手に操作されては、困ります。

ですから、電波をやりとりしている相手が確かに所有者であると確認する、認証(Authentication)技術が不可欠です。

Bluetooth Low Energy は、既知の相手からのパケットだけを受け付けるホワイトリスト方式、そしてAESを利用した認証技術などのいくつかの技術で、権限のない人が勝手に機器を操作することができないようにしています。

Bluetooth Low Energy を使う身につけたりして常時持ち歩く機器では、プライバシー保護のために、無線通信から機器を特定できなくする技術も求められます。

電波は四方八方に広がるので、受信した電波がどこから来たのかを電波だけから判別することはできません。ですから、パケットには、そのパケットの宛先と送信元を示すアドレス値が入っています。宛先が自分で、かつ信用できる送信元のアドレスのパケットのみを受け付けます。

パケットの発信元や宛先が固定値であれば、その値の意味はわからなくても、ずっと電波を追跡して所有者の行動を追跡できるかもしれません。

そのため Bluetooth Low Energy は、このパケットのアドレスを一定時間ごとにランダムに変更する仕組みがあります。信頼できる機器のみがAESの仕組みを使って、ランダムなアドレス値を解読して、通信を確保できます。

このように、パケット通信からデータの暗号化まで、幅広い範囲で対処してはじめて、セキュリティやプライバシーが確保できます。このため、規格がしっかりした技術を提供することが、とても重要になります。

このように、Bluetooth Low Energy は、身につけて移動するなど想定される利用場面に求められる技術を、製造費用と設計の複雑さとの兼ね合いをとりながら、提供しています。

## Bluetooth Low Energy のデータ表現

Bluetooth Low Energyは、多種多様なものに向けた無線通信技術です。ですから、この規格は、今はまだない機器が新しく登場しても、それらが相互に接続して利用できる仕組みを提供しなければなりません。

クラシックBluetoothは、これまでの有線接続を無線接続で置き換えるための技術だと言えます。

クラシックBluetoothは、利用場面が規格で決められています。通信とデータ表現仕様を1つの組にして、利用場面ごとに適したものとなるように、決めています。例えば、同じオーディオ・データを送る機器でも、通話に使うヘッドセットには音声品質よりも小さい遅延時間が重要であり、音楽鑑賞に使うヘッドフォンでは、遅延時間よりも高品質な音が求められます。

Bluetooth Low Energyは、多種多様なもののための無線通信規格です。無線通信から、多種多様なものを見ると、それはデータの塊に見えます。そこで、Bluetooth Low Energyは、ものを表現するために、サービスとキャラクタリスで構成されるデータベースとそのデータ同期の仕組みを提供しています。

Bluetooth Low Energyの、このデータベースの仕組みは、スマートフォンのアプリケーション開発にも影響しています。

アプリケーションからクラシックBluetooth対応機器を見ると、音声データの入出力端子や、任意の通信データの入出力端子など、通信ソケットに見えます。ですが、アプリケーションから見たBluetooth Low Energy対応機器は、データベースに見えます。

この節では、この多様性を実現している要となる、Bluetooth Low Energyのデータ表現を見ていきます。

### サービスとキャラクタリス

無線通信から"もの"をみると、それは情報の塊、つまりデータベースとして認識できます。スマートフォンのアプリケーションから、Bluetooth Low Energy で接続した機器をみると、サービスとキャラクタリスというデータの集合体に見えます。

Bluetooth Low Energy のサービスとキャラクタリスは、ものをデータベースとして表現する仕組みです。

サービスは、キャラクタリスの集合です。キャラクタリスは、値を格納するものを表します。キャラクタリスは、読み出し、書き出し、そして値の変更の接続先への通知の3つの属性が設定できます。キャラクタリスには最大TBD 512バイトまでのバイナリ・データを格納できます。

キャラクタリスの値は、外部センサー、内部状態、および制御目標のいずれか3つの意味をもちます。例えば、室内照明であれば、室内気温という外部センサーの値、コンプレッサーの動作状況やファンの回転数といった内部状態、および設定温度という制御目標があるでしょう。

サービスとキャラクタリスには、その種類を表す UUID という 128 ビットの識別子が設定れています。UUIDの値とその意味は事前に定義されているので、接続したスマートフォンのアプリケーションは、UUIDの値でそれがどのようなものなのかを判別できます。

iOSアプリケーション開発者ならば Objective-C でいう、クラスのインスタンスがサービスに、プロパティがキャラクタリスに対応していると理解できます。プロパティには、読み書き属性があります。またキー値監視( Key-Value Observing ) [^1130] でプロパティの値変化の通知が受け取れるのと同じく、キャラクタリスに監視登録をすれば、その値変化の通知を受け取れます。

[^1130]: [Introduction to Key-Value Observing Programming Guide]( https://developer.apple.com/library/ios/documentation/Cocoa/Conceptual/KeyValueObserving/KeyValueObserving.html )

サービスとキャラクタリスの検索と取得、そしてキャラクタリスへの値の読み書きと値変化の通知取得の仕組みは、通信路の上にある アトリビュート・プロトコル(Attribute Protocol、ATT) と Generic Attribute Profile(ジェネリック アトリビュート プロファイル、GATT) の2つの層です。

Bluetooth Low Energy を搭載する周辺機器のファームウェア、つまり周辺機器に内蔵されているアプリケーションの開発は、この2つの層の上に実装します。つまり、データベースとして抽象化された層で開発します。これは、通信路に流れるバイナリ・データの流れを直接扱う通常よくある無線通信機器のアプリケーション開発と異なる点です。

### もののデータベース表現

Bluetooth Low Energy は、ものを、これ以上分割できない最小の機能の集合として見ます。

機器は、その最小単位の機能に対応する種類のサービスの集合体となります。機器が同じ機能のハードウェアを複数持っていれば、その種類のサービスを複数持ちます。例えば、温度センサーは1つのサービスにできます。室内エアコンが、室外温度と室内温度それぞれの温度センサーをもっているなら、それぞれの温度センサーに対応する2つのサービスを持ちます。

もしも最小の機能ではなく、機器の見た目そのままを分割単位とするとどうなるのでしょうか。

例えば、赤外線リモコンがある照明機器の、Bluetooth Low Energy 搭載にした新製品を開発するとします。赤外線リモコンの受信回路を、Bluetooth Low Energyの無線回路で置き換えて、赤外線リモコンはスマートフォンのアプリケーションで提供するとします。

ちょうどリモコンを1つのサービスとみたてて、そこに赤外線リモコンのボタン1つ1つに対応するキャラクタリスを入れたとします。このやり方でも、1アプリケーションに1機種が対応するだけなら、うまくいきます。

しかし、2機種3機種と対応機種が増えていくと、新機種ごとに機器内部の受信回路とスマートフォンのアプリケーションとを開発しなくてはなりません。これでは、開発にかかる費用も時間も大きくなります。

ここで、機器の最小機能単位で設計すればどうなるでしょうか。

例えば、照明機器であれば、どの機種にも共通する基本機能、電源のオン・オフ、明るさ調整および色合い調整などを1つのサービスにしたとします。この設計であれば、開発した機器とスマートフォンのアプリケーションは、今後発売されるものも含めた全ての照明の基本機能に対応できます。

また、上位機種に、例えば映画鑑賞時の照明機能のような、それまでなかった新機能を追加したとします。これは、基本機能とは独立した機能なので、この心機能を1つのサービスとして追加します。こうすると、基本機能のソフトウェアのソースコードは、そのまま再利用して、追加したサービスに対応するソースコードのみを新規開発することで、上位機種に対応するアプリケーションが開発できます。

このように、お互いに独立した最小単位機能をサービスに対応させることで、ソースコードの再利用をはじめとした利点が生じます。

### データベースとしてのものの表現

ものを Bluetooth Low Energy から見ると、それは最小の機能の集合を表すデータベースでしかありません。Bluetooth Low Energy は、最小の機能単位とその組み合わせで、多種多様なものを表します。

例えば、身の回りには多種多様の照明機器があります。天井や机そして床に設置されるシーリング・ライトやテーブル・ライトそしてフロア・スタンド、また外観デザインも1つ1つ異なります。人間には多種多様に見えますが、しかし、その機能はどれも照明機器です。ですから、Bluetooth Low Energy から見れば、いずれも照明機器の基本機能を表す1つのサービスでしかありません。

また、懐中電灯は電池を内蔵した照明機器です。これは電池残量などの基本機能をあらわすサービスと、照明基本機能のサービスの、2つのサービスの組み合わせで表現できます。このように照明機能もある機器でも、機能に対応するサービスの組み合わせとして表現ができます。

またサービスは、新しい機能が必要となった時に、従来のサービスはそのままに新しいサービスに拡張する仕組みがあります。これは、オブジェクト指向のクラス継承に相当します。

例えば、人を検出して自動点灯する照明機器が登場して、それを照明基本機能に追加したいとします。この場合は、従来のサービスに人体検出を表すキャラクタリスティクスを追加した新しいサービスを定義して対応できます。

新しいサービスの定義でできることは、従来サービスにキャラクタリスを追加することだけで、キャラクタリスを削除することはできません。また、すでにあるキャラクタリスの値の意味を変えることもできません。ですから、新しいサービスは、その追加されたキャラクタリスを無視すれば、従来サービスとして扱うことができます。

このように、Blueooth Low Energyの、ものを表現するデータベースは、多様性と将来の拡張性そして後方互換性を保てるようになっています。

多様性は、サービスの組み合わせの掛け算で実現できます。将来の拡張性は、サービスの拡張で対応できます。また新しいサービスはその元となったサービスとして扱えるので、その新しいサービスに対応していないアプリケーションでも従来機能を同じように利用し続けることができます。つまり、後方互換性が自動的に保たれます。

### サービスとプロファイル

Bluetoothは、Bluetooth で機器と通信したときの振る舞いと、その使われ方の定義とをプロファイルと呼びます。プロファイルの定義のなかで、機器の機能を表すサービスも定義されます。

簡単にいえば、サービスの定義までが機器単体の機能を定義します。プロファイルは、スマートフォンのアプリケーションとその機器とが、お互いにどう振る舞うのかを定義します。プロファイルの定義は、Bluetoothの相互接続を確保するための仕組みです。

サービスが最小単位の機能を表していたように、プロファイルも最小単位の使い方を定義します。たいていの製品は、複数のプロファイルを持ちます。

鍵の置き忘れ防止に Bluetooth Low Energy がよく使われている、キー・フォブ (key fob) と呼ばれる鍵に取り付けるアクセサリを例に、kのプロファイルとサービスの組み合わせの実例を見てみます。

スマートフォンとキーホルダーとは、無線接続して使います。鍵もしくはスマートフォンのどちらかを置き忘れると、距離が離れて電波強度が下がるか通信が切断します。この時に警告を出力して、置き忘れを防止します。また、鍵もしくはスマートフォンのどちらかが見つからない時は、ボタンを押して接続先の機器から音を出させることができます。

このキーホルダーには、Proximity Profile (プロクシミティ・プロファイル) [^1140] と Find Me Profile (ファインド・ミー・プロファイル) [^1150] の2つのプロファイルが実装されます。

Proximity Profile は、ある一定距離離れた時にキーホルダーから警告を出力する振る舞いを定義します。 Find Me Profile は、ボタンが押された時に接続先から警告を出力させる振る舞いを定義します。つまり、製品の2つの機能がそれぞれプロファイルとして定義されているわけです。

[^1140]: [Proximity Profile (PXP), https://developer.bluetooth.org/TechnologyOverview/Pages/PXP.aspx](https://developer.bluetooth.org/TechnologyOverview/Pages/PXP.aspx)

[^1150]: [Find Me Profile (FMP), https://developer.bluetooth.org/TechnologyOverview/Pages/FMP.aspx](https://developer.bluetooth.org/TechnologyOverview/Pages/FMP.aspx)

プロファイルは、1つのサービスを共有して利用できます。例えば、さきほどの Proximity Profile と Find Me Profile は、いずれも Immediate Alert Servide (イミディエイト・アラート・サービス)  [^1160] を使います。

[^1160]: [Immediate Alert Service https://developer.bluetooth.org/gatt/services/Pages/ServiceViewer.aspx?u=org.bluetooth.service.immediate_alert.xml](https://developer.bluetooth.org/gatt/services/Pages/ServiceViewer.aspx?u=org.bluetooth.service.immediate_alert.xml)

イミディエイト・アラート・サービスは、警告音を出す機能です。Proximity Profile では、置き忘れの警告レベルの設定に使われます。Find Me Profile では、直ちに警告を出力するために使われます。2つのプロファイルが1つのサービスを共有しても、使い方に不都合を生じない問題ありません。

### カスタム・プロファイルとプロファイルの標準化

Bluetooth Low Energy は、自由にプロファイルを設定できます。これをカスタム・プロファイルと呼びます。カスタム・プロファイルに必要なサービスやキャラクタリスも自由に設定ができます。

サービスやキャラクタリスは、UUIDという識別子で識別します。通常は、識別子は、違う人が同じ識別子を違う人が違う意味で重複して利用しないように、サーバーや認証機関で一元管理されています。

このUUIDは、サーバーがない一元管理することができない分散処理系で、個々の機器が勝手に生成しても、それらが重複しないように工夫されてた識別子です。Mac OS X であれば、ターミナルでコマンド uuidgen を実行すれば、UUIDを生成できます。

独自の Bluetooth Low Energy 機器の開発は、まず機器の振る舞いをカスタム・プロファイルとして定義して、次に、そのプロファイルに必要なサービスとキャラクタリスに生成したUUIDを割り当てて、設計していきます。カスタム・プロファイルの機器に対応するスマートフォンのアプリケーションは、そのカスタム・プロファイルの定義とサービスとキャラクタリスのUUIDの情報があれば、設計できます。

また Blutooth SIG のメンバーになることで、Bluetoothにプロファイルを提案して採択してもらうことができます。

1社で製品とその対応アプリケーションを提供するだけであれば、カスタム・プロファイルでよいのです。ですが、例えば心拍計のような一般的な機器でこのようなやり方をすると、同じ目的の機器に対して、会社ごと異なる無数のカスタム・プロファイルが出てきてしまいます。

業界に関わる会社群が、標準化したプロファイルを Bluetooth SIG に提案して採択してもらい、同じ振る舞いを1つのプロファイルに統合することが、機器市場をつくり上げるうえでも必要になります。

2015年1月には、次の15のプロファイルが採択されています。Bluetooth Low Energy が登場する以前から無線化が進んでいた、フィットネスや自転車などの分野で使われる機器のプロファイルが、特に早くから採択されてきています。

[Profiles | Bluetooth Development Portal](http://developer.bluetooth.org/gatt/profiles/Pages/ProfilesHome.aspx)

- アラート通知 (Alert Notification)
- 血圧計 (Blood Pressure)
- 自転車のパワーメータ (Cycling Power)
- 自転車の速度とペダル回転数 (Cycling Speed and Cadence)
- デバイスの発見 (Find Me)
- 血糖値 (Glucose)
- 体温計 (Health Thermometer)
- 心拍 (Heart Rate)
- 入力装置 (HID OVER GATT)
- 位置と経路誘導 (Location and Navigation)
- 電話の警告(Phone Alert Status)
- 近接 (Proximity)
- ランナーの速度とペース (Running Speed and Cadence)
- スキャナの通信パラメータ設定 (Scan Parameters)	
- 時刻 (Time)


## iOSとアプセサリ

iOSが早くから Bluetooth Low Energy に対応したおかげで、これまでなかったユニークなものも含めた多種多様な、個人向けのiOSデバイスの周辺機器が登場し普及してきています。

これらの周辺機器(アクセサリ)は、機器単体ではなく、機器とアプリケーションとの連携から価値が生まれます。これまでの周辺機器にはなかった、この新しい概念は、アプリケーション(Application)とアクセサリ(Accessory)を組み合わせたアプセサリ(Appcessory = App + cessory) という造語で表現されています。

アプセサリは、アプリケーションが持つ高度な表示、蓄積、解析、通信と組み合わせるもので、これまでにない可能性を秘めています。

アプセサリを使うことで、これまでアプリケーションだけでは実現できない新しい利用場面が広がります。アプセサリというハードウェアで、アプリケーション販売とは異なる収益体制が組めます。アプセサリを通じて、これまでに実現できなかった新しいサービスが可能になります。

アプセサリの急激な盛り上がりは、iOSのソフトウェア開発環境とアプリ・ストアが一般解放されたばかりの時期の、iOSアプリケーション市場の盛り上がりを思い出させます。

しかし、アプセサリは不可能を可能にする万能の魔法ではありません。アプセサリは、これまで見てきた Bluetooth Low Energy やiOSなどの技術を手段としてつくり上げる、ものです。

ここでは、アプセサリとはどんなものかを見ていきます。

### クラシックBluetoothとiOS周辺機器開発

Bluetooth は、スマートフォンの周辺機器、つまりアクセサリ ( Accessory ) に広く使われている技術です。

Bluetooth 4.0では、それまでのBluetooth3.0までの技術(ここでは、クラシックBluetoothと読んでいます)と、クラシックBluetoothとは無線通信方式から異なる超低消費電力無線通信技術 Bluetooth Low Energy の2つの異なる技術が統合されました。

クラシックBluetooth は、キーボードやマウスあるいはヘッドフォンなどの、有線で接続していた機器を無線接続にする技術と言えます。ジョギング中にヘッドフォンが使われだすなど、無線化したことで利用場面が広がりはしますが、機器自体の使われ方は有線接続のものと同じです。

スマートフォンのオペレーティング・システム (Operationg system, OS) が、キーボードやヘッドセットとの接続と通信を処理してくれます。アプリケーションからは、接続が有線か無線かを気にせずに、キーボードやヘッドフォンというハードウェアがアプリケーションから扱えます。

クラシックBluetoothを使ったiOS周辺機器開発には、MFiプログラムが必須です。クラシックBluetoothには、任意のバイナリ通信を提供する シリアル・ポート・プロファイル ( Serial Port Profile, SPP ) がありますが、iOS機器はこのプロファイルをサポートしません。

そのかわり、MFiプログラムのもとで提供される、ライセンスをうけた正式なiOS周辺機器であることを証明する認証チップを組み込むことで、iOSデバイスは、その周辺機器と対応アプリケーションとの通信を許可します。

クラシックBluetoothのiOS周辺機器開発は、開発情報が管理された、機器とアプリケーションが1対1対応する世界です。また、機器とiOSデバイスの接続管理は、ユーザが設定アプリから行います。

### Bluetooth Low EnergyとiOS周辺機器開発

Bluetooth Low Energyは、これまで解説してきたように多種多様なものに無線通信機能を与える技術です。無線通信では、ものはデータの塊として捉えられます。そのデータは、GATT (Generic ATTribute Profile, ジェリック・アトリビュート・プロファイル)が提供するデータベースとして表現されます。

多様な機器がある Bluetooth Low Energy では、機器の種類が限られる クラシックBluetooth と違い、iOSが機器の振る舞い (プロファイル) を全てサポートすることはできません。

iOSはこの多様さへの対応を、Core Bluetoothフレームワークを通じて、アプリケーションに機器の発見、接続と切断、そして通信を提供することで解決しています。機器の振る舞いを作り出す、パソコンでいえばデバイス・ドライバに相当する部分は、アプリケーションに実装して提供します。

一般開発者権限で開発できるiOSアプリケーションが、任意の Bluetooth Low Energy 機器と連携できるようになったことで、MFiプログラムを受けるのに二の足を踏んでいた小規模な会社の参入、またiOSやAndroidなどのプラットフォームに縛られない周辺機器の開発が可能になったことで、フィットネス機器などの会社の参入が始まりました。

Bluetooth Low Energyの周辺機器は、機器とアプリケーションがMFiプログラムがなくても開発できる世界です。そして、アプリケーションと機器が1対1対応に縛られない世界です。例えば、スマートフォンのあるアプリケーションが、Bluetooth Low Energyで機器と通信している間でも、他のアプリケーションがその機器と通信できます。

また、機器とiOSデバイスの接続管理は、すべてアプリケーションが行います。クラシックBluetoothのように、ユーザが意識することはありません。Bluetooth Low Energy機器が、セキュリティの確保のために共通鍵を必要とする場合は、ユーザがが設定アプリで、その機器の鍵を管理します。

クラシックBluetoothと異なり、Bluetooth Low Energyは、機器との接続や切断などの通信や機器とのやりとりをアプリケーションが把握するので、ユーザに無線通信を意識させません。また、機器とアプリケーションが1対1対応でしばられません。ですから、ハードウェアの製造販売の会社が、販売台数を増やす目的でそのハードウェアの仕様をアプリケーション開発会社に広く公開することもできます。

### iOSアプリケーションの Bluetooth Low Energy 開発環境

iOSは、ソフトウェアであるiOSとハードウェアであるiOSデバイスとが、統合されて開発されています。iOSは、アプセサリ開発に不可欠な、使いやすいソフトウェア開発環境と Bluetooth Low Energy 機器との安定した通信、そして消費電力に注意して設計されたバックグラウンド・モードを、一貫して提供してきています。

iOSは、1年に1回のメイジャー・リリースごとに、Bluetooth Low Energy の新しい機能やサービスを提供してきています。

Blueooth Low Energyには2つの役割、セントラル・ロールとペリフェラル・ロールがあります。Bluetooth Low Energyのネットワークは、1つのセントラル・ロールの機器に、複数のペリフェラル・ロールの機器がつながる、スター型です。通常は、iOSデバイスがセントラル・ロール、周辺機器がペリフェラル・ロールになります。

iOS5ではじめて Bluetooth Low Energy に対応したときは、セントラル・ロールのみに対応していました。その翌年のiOS6では、ペリフェラル・ロールにも対応しました。さらにiOS7およびiOS8では、Bluetooth Low Energy を使うキーボードへの対応や、HomeKitをはじめとするiOS独自の技術が追加されています。

周辺機器と接続するときは、iOSデバイスはセントラル・ロールになります。1つのセントラルに同時に接続できるペリフェラル数は、規格では上限は6万以上で実質上限はありません。ですが、iOSデバイス自体の制約で、同時接続の上限は10です。

すでに10台のペリフェラルと接続していても、ペリフェラルの発見はできます。ですが、11台目への接続要求は失敗します。

iOSアプリケーションは、画面に表示されていない状態でも、ある限られた処理ができます。この状態をバックグラウンド状態と呼びます。バックグラウンド状態のアプリケーションは、何か外部からイベントがあれば、iOSから、そのイベント通知とアプリケーションの実行時間をもらえます。

iOSアプリケーションのビルド設定で、セントラル・ロールのバックグラウンド・モードを有効にすると、バックグラウンド状態でも周辺機器との無線接続が維持されます。周辺機器から値の変更通知を処理できます。

周辺機器を発見するスキャンは、バックグラウンド状態でも継続します。ただし、消費電力を低減するために、スキャンの頻度は10分に1回程度と低くおさえられます。

iOSアプリケーションで、リモコンなどの周辺機器の機能を提供、あるいはアドバタイジング・パケットを送信するときは、アプリケーションをペリフェラル・ロールにします。

ペリフェラル・ロールにもバックグラウンド・モードがあり、これを有効にするとバックグラウンド状態でもセントラルとの接続が維持されます。

iOS6では、iOSアプリケーションで、マウスやキーボードなどの HOGP [^1190] ( HID [^1180] Over GATT Profile ) に対応した入力機器の機能を提供できました。しかし、iOS7でHOGPがサポートされて、一般アプリケーションからは、HOGPのサービスに触れられなくなったため、iOS7位光はHOGP相当の機能をアプリケーションで提供することが、できなくなりました。

[^1180]: HID は Human Interface Device の略語で、マウスやキーボードなど人間が使う入力装置を指します。

[^1190]: [HID Over GATT Profile (HOGP) , https://developer.bluetooth.org/TechnologyOverview/Pages/HOGP.aspx](https://developer.bluetooth.org/TechnologyOverview/Pages/HOGP.aspx)

### iOSの Bluetooth Low Energy 活用

iOSが Bluetooth Low Energy に対応してからの2年間、iOS5およびiOS6まで、iOS自体は Bluetooth Low Energy を全く利用していませんでした。この間、Bluetooth Low Energy は、一部の開発者や周辺機器開発で話題になっていただけでした。

Bluetooth Low Energy を用いた独自技術やサービスが、アップル社が毎年開催する開発者向けイベント Worldwide Developers Conference（ワールドワイド デベロッパーズ カンファレンス、WWDC) に初めて登場したのは、iOS5 が登場してから2年後の iOS7 からです。

これは、Bluetooth Low Energy という新技術を意識しなくても、ユーザのどの iPhone でも新しい体験ができる状況になるまでに、2年が必要だったのでしょう。

日本の携帯電話会社は、契約期間を2年間とすることで月額料金を大幅に割引するプランを提供しています。このとき、iPhoneユーザは最新機種によく買い替えます。また、2年間で iPhone5 および iPhone5s が発表されると、世界ではじめて Bluetooth Low Energy に対応した iPhone4s が、携帯電話会社が扱う最も古い機種となりました。

Bluetooth Low Energy は通信規格ですから、通信には必ず通信の相手が必要です。iOSは、通信相手となる Bluetooth Low Energy に対応した iPhone が十分普及した時期にあわせて、新技術の利用をはじめたのでしょう。

### iOS7と Bluetooth Low Energy

iOS7では、周辺機器サポートとして、キーボードと独自規格のゲームコントローラー、また通知技術 Apple Notification Center Service そして 新しい位置と近接検出技術 iBeacon が登場しました。

iOS7 で、Bluetooth Low Energy 対応のキーボードやマウスを使うために必要な HOGP [^1190] ( HID [^1180] Over GATT Profile ) がサポートされました。

文字変換や単語修正などのキーボード入力機能は、OSの機能でアプリケーションから操作することはできません。ですから、アプリケーションが Bluetooth Low Energy 対応キーボードと接続してキータイプの情報を直接読み取れても、入力支援機能が使えないので、実用ではありませんでした。

iOS7 が HOGP に対応したため、アプリケーションが CoreBluetoothフレームワークで、HOGP のサービスに触れることはできなくなりました。このため、iOS6では実装できた、Bluetooth Low Energy対応キーボードやマウスとして振る舞うアプリケーションは、iOS7からは作れません。

Bluetooth SIG が採択するプロファイルに、ゲーム・コントローラーのプロファイルはありません。iOS7が対応した Bluetooth Low Energy 対応ゲーム・コントローラーは、Apple社が独自に定義したプロファイルのものです。

その技術情報は MFiプログラム のもとで提供されるので、一般には内容を知ることはできません。ですが、ゲームコントローラーは操作が画面に反映されるまでの遅れ時間が特に気になる入力装置です。ですから、コントローラーからiOSデバイスにデータが届くまでの遅れ時間が可能な限り小さくなるような、接続パラメータの工夫があると思われます。

ゲーム・コントローラーとの無線接続や通信は、キーボードと同じくiOSが処理します。アプリケーションからは、それが有線なのか無線なのかといったハードウェア仕様の差を意識することなく、GameKitフレームワークを通じてコントローラーを利用できます。

スマートフォンと連携して、電話やメール着信などの通知情報を表示する機能は、常に身につけて利用する、いわゆるウエアラブル・デバイスの定番機能です。

Apple Notification Center Service (ANCS) は、iOSのロック画面に表示されている通知情報を、Bluetooth Low Energy で周辺機器に伝える技術です。

ANCSは、MFiプログラムの対象ではありません。一般公開されている仕様書には、ANCSのサービスやキャラクタリスティクスの定義およびデータ・フォーマットの詳細説明があります。

ANCSは、2015年に発売される AppleWatch のために用意された技術だと思われますが、それがMFiプログラムではなく一般公開されたのか、その意図はわかりません。通知機能が多種多様な周辺機器に搭載されることが、それらと連携するiOSデバイスのさらなる魅力となるなど、何かしらの利益があるのかもしれません。

ANCSが登場したことで、通知機能の実現が可能になりました。それは、ユーザのプライバシー情報を保護するために、iOSアプリケーションからは通知情報を読み出せないからです。例えば、アプリケーションが電話の通知情報を読み出せると、ユーザのプライバシー情報の漏洩の可能性となりえます。

ですから、アプリケーションがなくとも、iOSから周辺機器に直接通知情報を届けてくれるANCSは、まさにOSにしか提供できない、またOSが提供すべき機能といえます。

そして、iBeacon もOSにしか提供できない、またOSが提供すべき機能と言えます。

iBeacon は、Bluetooth Low Energy のアドバタイジング・パケットを利用するビーコンを使う、位置と近接の検出技術です。ビーコンの検出機能は、iOSの位置情報を提供する CoreLocationフレームワークに統合されています。開発者は、Bluetooth Low Energy を意識することなくiBeaconを利用できます。

iBeacon のビーコンが送信する情報は、128ビットの識別子(UUID)と16ビットの値が2つだけです。ビーコン設置者から提供されたビーコンの設置情報と送信情報を使い、屋内の経路案内や博物館の展示案内などのアプリケーションが開発できます。

iBeacon は新しい技術ではありません。むしろ、電波で識別情報を送信するタグとその活用場面は、何十年も前から知られたものです。

iBeaconがなかったiOS6でも、アドバタイジング・パケットを送信するタグとiOSアプリケーションを開発して、iBeaconと同等の機能を独自に開発できました。ビーコンの検出は高周波受信回路を動かし続けるので、消費電力が大きくなります。さらに、バックグラウンドでは節電のためにOSが受信回路の動作時間を大幅に制限するので、バックグラウンドではほぼビーコンを検出できません。

しかし、iOS7は、バックグラウンドでのビーコン検出を小さな消費電力で実現しています。高周波受信回路などのiOSデバイスのハードウェアとiOSとの連携で実現されていると思われます。このような高度な連携は、OSとハードウェアとを統合して最適化できるApple社だけができることです。

iBeaconはMFiプログラムで提供されています。iBeaconへのMFiプログラムは、少しユニークです。

まず、iBeaconに限定したMFiプログラムが用意されました。それまで、iOSデバイスと連携する周辺機器開発が1つのMFiプログラムとなっていました。そのためにMFiプログラムには厳正な審査があります。ですが、iBeaconだけに限定されたことで、様々な会社からiBeaconのビーコンが販売されるようになりました。

このMFiプログラムの形態は、意図したものかどうかはわかりませんが、iBeaconが広まった経緯に沿うものでした。

2013年9月にiPhone5sが発売された頃から、一般でiBeaconが話題になり始めました。この時点では、Apple社がiBeaconのビーコンを販売するのか、あるいはMFiプログラムを提供する予定があるのかすら誰も知りませんでした。ですが、iOSという広く普及したプラットフォームの、新しい位置と近接技術の可能性に、行動を起こした人たちがいました。

ビーコンが送信しているアドバタイジング・パケットのデータ形式は単純で、すぐに解析できるものでした。2014年11月ごろから、いくつかの会社がそれぞれ独自に、解析した情報を元にiBeaconで利用できるビーコンを作り発売を開始しました。

そして、2014年2月にiBeaconのMFiプログラムが発表されました。ですが、MFiプログラムがiBeaconに限定されていたことで、それまでの周辺機器とは異なり、迅速な審査と技術情報の提供がなされたことで、すでに販売を開始していた会社は混乱なく、MFiプログラムに参加していきました。

iBeaconという技術は、Apple社だけでは広めることができな技術です。まず多種多様な利用場面にあうビーコンが必要です。MFiプログラムがあることで、それぞれの会社がそれぞれの利用場面ごとに、技術仕様に準拠してビーコンを提供しました。また、いくつかの会社が競い合うことで、ビーコンの利用場面がアプリケーション開発者の広く知るところとなり、また使いやすい開発環境や安価なビーコンの提供が急速に整いました。

iBeaconは、まだこれから活用が始まる技術です。ちょうどiOS5がCoreBluetoothを提供してから2年後に、Apple社がBluetooth Low Energyを利用し始めたように、例えば地図の屋内位置検出への統合のような、Apple社のiBeaconの活用は、2015年以降になるのでしょう。

### iOS8と Bluetooth Low Energy

iOS8では、MIDI over Bluetooth Low Energy および HealthKit および HomeKit が登場しました。

MIDIは、Musical Instrument Digital InterfaceMusical Instrument Digital Interface の略語で、デジタル・データで楽器の演奏データを扱うための通信インタフェースやデータ表現の規格です。

MIDI over Bluetooth Low Energy は、文字通り演奏データをBluetooth Low Energy でやりとりするための仕様です。Bluetooth SIGに採択されたプロファイルに、MIDIを扱うプロファイルはありません。これはApple社が独自に定義した技術ですが、その技術仕様はMFiプログラムではなく一般公開されています。

MIDIのデータが届くまでの時間は、そのまま、楽器を操作してから音が出力されるまでの遅れ時間として人間に聞こえます。このため、遅延時間が十分に小さくなるように、技術仕様が工夫されています。

MIDIの通信は 31.25 Kbps のシリアル通信です。このシリアル通信を、 Bluetooth Low Energy で表現するためのサービスとキャラクタリスティクスの定義、そしてデータが相手に届くまでの遅延時間を決める コネクション・インターバル が定義されています。

iOSデバイスは、MIDI over Bluetooth Low Energy が登場する4年前、iOS4 でドックコネクタで拡張する有線のMIDIインタフェース・アダプタと、MIDI機器と連携するアプリケーションを開発するための Core MIDIフレームワーク が提供されました。

これまで有線であった周辺機器が Bluetooth Low Energy で無線化されることで利用場面が広がるのか、また実現できなかった新しい利用場面が広がるのかは、まだわかりません。それは、アプリケーションや利用者次第なのでしょう。

HelthKit は、健康および医療機器からのデータ収集と蓄積を担います。これまでの iOSの Bluetooth Low Energy 機器対応は、例えばキーボードなど、アプリケーションと機器とを直接接続するものでした。ですが、HealthKit は、データの収集と蓄積とを分離しています。

健康データは、重要な個人データであり、蓄積した健康データは医療診断のみならず大きなビジネスを生み出す資源です。したがって、重要な資源はiOSに所有させて個々のアプリケーションには持たせずに、iOSがiOSアプリケーションに健康データの活用を許す形態にしたと思われます。

iOSの標準アプリ ヘルス・アプリが、Bluetooth Low Energy の各種健康機器からデータ収集をおこないます。アプリケーションからは、HealthKitフレームワーク を通じて、iOSの健康データベースの読み書きと、値更新のイベントを取得できます。

HealthKitが発表されてから1年が経ちますが、HealthKitへの対応の動きは、まったくといっていいほどありません。

その理由を、フィットネス分野のアプリケーションを例に見てみます。スマートフォン以前から、運動強度の測定の習慣が根付いているフィットネス分野は、Bluetooth Low Energy対応の心拍センサーと対応アプリケーションが急速に普及しています。

アプリケーションが提供するのは、ユーザの体験です。そのために心拍値は必要な情報ですが、逆に心拍値が取得できただけではユーザの体験にはなりません。

例えばランニングであれば、運動中に音声ガイドで運動強度のアドバイスをだすことで適切な運動が自動的に達成できます。また、GPSでランニングコースおよび速度を記録して、心拍値と合わせて解析することで、次回へのアドバイスの提供もできます。

このような魅力的なアプリケーションの開発には、費用がかかります。その費用は心拍センサーの販売利益から出ています。

心拍センサのプロファイルは Bluetooth SIG で採択されているので、心拍センサーとアプリケーションは、それぞれ別の会社の製品を組み合わせて使うこともできるはずです。ですが、ユーザは、快適に問題なく利用できる安心感と信頼感から、アプリケーションと同じロゴがある心拍センサーを購入します。

このような、製品とアプリケーションとが組み合わさって初めて本当のユーザ体験がもたらされる分野では、心拍センサーという製品の販売利益で、アプリケーションが開発され、そのアプリケーションが提供するより素晴らしいユーザ体験が、、ユーザがその会社の製品を選んで購入する理由になります。この魅力とお金の循環が、心拍センサーの急速な普及の原動力なのです。

すでに構築されたこの循環に、HealthKit が入り込む余地はありません。

もしも、アプリケーションがHealthKitに対応したとします。そうすると、ヘルス・アプリで心拍センサーとの接続とデータ取得設定を行って初めて、フィットネスのアプリケーションが使えるようになります。これまで1つのアプリケーションで完了していた操作が、2つのアプリケーションにまたがるのは、ユーザにとって大きな手間になり体験を大きく損ないます。

また、もしもユーザが、ヘルス・アプリで接続さえしてしまえば、フィットネスのアプリケーションが使えるのだと思うようになると、これまでのアプリケーションと製品の関連付けが切れてしまい、アプリケーションを無料で提供することはできなくなります。

これは、製品とアプリケーションとの対応づけで作られていた信頼感が、ヘルス・アプリに取って代わられることになります。こうなると、フィットネスの会社には、心拍センサーという製品販売から、サービスやフィットネス体験などのソフトウェアから利益を出さなくてはならない、大変革が必要になります。

Bluetooth Low Energy 対応機器に対応するほどの手間はかけられないが、もしも手軽に値が利用できるなら利用したいアプリケーション、例えば心拍と演出が連動するゲーム・アプリケーションのような、であればHealthKitを使う理由になります。

また、将来の疾患の可能性や生活改善のためのヒントのような、新しい解析手法などでデータから価値を取り出せるアプリケーションには、HealthKitは大きな価値を持ちます。

例えば、解析にはある程度のデータ量が必要だとします。これをアプリケーション単体で提供すると、アプリケーションがデータを蓄積するまでの間、ユーザに待ってもらわねばなりません。長期間、結果も得られないのに待つユーザは少ないでしょう。蓄積データが利用できるならば、即座に結果をユーザに返すことができます。

このように、HealthKitは、アプリケーション提供者がBluetooth Low Energy機器それ自体には興味がないが生体情報の利用には興味がある場合、アプリケーションを超えてデータを共有する利用場面に価値がある場合、あるいは、蓄積されたデータに価値を見出す場合には、有効です。


[HomeKit](https://developer.apple.com/homekit/) [^1190] は、照明機器や電子錠などの身の回りの機器とiOSとを Bluetooth Low Energy または Wi-Fi で連携させる技術です。

[^1190]: [HomeKit https://developer.apple.com/homekit/](https://developer.apple.com/homekit/)

HomeKit は、機器メーカ向けのHomeKit対応機器を開発するための通信仕様と、アプリケーションに機器の登録や操作を提供する HomeKit フレームワーク から構成されます。

HomeKit対応機器開発は、MFiプログラムの対象です。MFiプログラムを締結して初めて、技術情報およびHomeKitに対応した無線通信モジュールなどの開発機材の提供を受けられます。一方で、HomeKitフレームワークは一般開発者に開放されています。

HomeKitの無線通信は、すべてApple社独自の技術で構築されています。HomeKitは、Bluetooth Low Energy を単なる無線通信としてのみ利用します。家電の無線化では、セキュリティの確保とプライバシーの保護が重要な課題です。Bluetooth Low Energy の規格にもそれらの技術が盛り込まれています。ですが、HomeKitは規格にある機能は使わず、すべてを独自に提供します。これはWi-Fiでも同じです。

設定の容易さと、セキュリティおよびプライバシーの保護を両立させるのは、1つの技術的な挑戦です。また家電の無線化は、たとえ1例でもセキュリティを突破して悪用できることが実証されてしまうと、一般からの信頼感を失いますから、とても高いセキュリティ対策技術が必要です。

Wi-Fiルータにパソコンを繋ぎたい時に、設定に時間がかかった経験は、だれにでもあるでしょう。接続保護のパスワードを1文字でも間違えれば、つながりません。しかし、パスワードなどで保護しなければ、だれでも接続できるので悪用されるかもしれません。

その設定の手間を、身の回りにあるすべての家電1つ1つが求めてきたらどうなるかを想像してみます。便利な機能だと思っていても、設定の手間にとまどい、その機能を利用することはないでしょう。HomeKitが、それらの技術をすべて自前で提供するのは、そのような状況に対応するためなのかもしれません。

HomeKitが普及するかは、まだ対応機器もほとんどなく、わかりません。技術が広く使われるかどうかは、利用者が使い方と便利さを理解できるか、導入費用が妥当かにかかっています。

HomeKitは、スマートホームあるいは住宅のオートメーション化を提供する技術といえます。それは、家にある電気製品の動作を連携させたり自動化したり、あるいは遠隔操作を提供する仕組みです。

スマートホームは、とても古くからあります。例えば、1975年に開発された、屋内電力配線で制御信号を送るX10という技術は、電灯の遠隔操作パネルなどに欧米で広く使われています。

X10は、家のあちこちにある機器を集中制御する技術です。例えば、寒い冬の日に外に出なくても、温かい居間からガレージの照明を消したりできます。利用場面が理解しやすく、また通信に電力線を使うので、コンセントに対応機器をつなぐだけで余分な導入コストはかかりません。

このような経験をしているユーザであれば、HomeKitは、いままでの操作パネルがiOSアプリケーションに置き換わったものと理解できます。また、無線通信なので屋内配線工事は必要なく余計な導入費用はかかりません。さらに、音声認識技術 Siri で音声で操作ができるなど、これまでなかった新しい機能は魅力となります。無線通信機能が製品価格に反映されたとしても、この新しい魅力でその価格を説明できるでしょう。

### iOSと Bluetooth Low Energy の今後

iOS と Bluetooth Low Energy の、これまでを見てきました。超低消費電力で多種多様なものを表現する能力がある Bluetooth Low Energy は、モバイル機器を中心にした情報とものとの関わりを作る重要な無線通信技術となっています。

では、iOS と Bluetooth Low Energy の今後はどうなるでしょうか。それは予測できませんが、Apple社が関わらない分野と、Apple社がつくり上げる分野にわけてみます。

まず、iOS5で開放された Bluetooth Low Energy 周辺機器は、フィットネスだけでなく広い分野に広がり、それぞれの分野で新しい利用場面や新規参入を引き起こしていくでしょう。

これはちょうど、iOSアプリケーション開発とアプリケーション市場が一般に開放されて、短期間に数多くのiOSアプリケーションが登場した様子に似ています。初期の競争を生き残った企業が、今の成熟したiOSアプリケーション市場で大きな売上を生み出しているように、このアプセサリの分野でも同じことが起きると思われます。

一方で、Apple社はiOSデバイスと連携する独自の領域を作り始めています。HealthKitは健康データの収集と集約を、HomeKitはあらゆるスマートな家電とiOSデバイスとを連携します。

Bluetooth Low Energy の使い方は、データ収集 (入力)と、外部装置の操作 (出力)の2つに、大きく2つに分けられます。HealthKitとHomeKitは、ちょうどその2つに対応しています。

HealthKitとHomeKit、この2つのサービスは、1つのネットワーク・アカウントに、様々な個人情報と家電の操作権限を結びつけます。したがって、ネットワーク・アカウントとその個人情報を守るために、強固なセキュリティの確保とプライバシーの保護が求められます。

Apple ID と iCloud を通じて、決済とコンテンツ購入そして写真などのユーザ・データのアーカイブを提供してきたApple社が、このようなサービスを提供するユーザ・アカウントを提供できる会社であるのは、たしかでしょう。

あらゆる個人の権限とデータがネットワーク・アカウントに集約し蓄積する時代になれば、購買などの人間の活動の多くがネットワークを通じて行われます。ユーザ・アカウントを提供管理する会社は、コンテンツを提供することで、また購買手続きから手数料を得ることができる立場になれます。

手数料という大きな利益は、より信頼できるクラウド・サービスや魅力的な新たなサービス開発の原資となります。このループは、規模と質を向上させながら10年は継続していくと思われます。


## アプセサリとデータの流れ

強力な処理能力と通信機能があるモバイル機器、スマートフォンと組み合わさることで、いままでにない利用場面を作り出せる Bluetooth Low Energy 機器は、アプリケーション(Application)とアクセサリ(Accessory)を組み合わせたアプセサリ(Appcessory = App + cessory) という造語で表現されています。

ここまで見てきた Bluetoot Low Energy の技術概略、そして iOS と Bluetooth Low Energy の関わりが、アプセサリを考える基礎知識になります。そしてアプセサリを発想するうえで、データの流れを意識することが大切です。ここでは、アプセサリとデータの2つの単語をキーワードに、その関係を見ていきます。

### 既存機器からアプセサリへの変化

あらためて、アプセサリの立ち位置から、アプセサリとはなにかを見ていきます。

パソコン時代からあるキーボードやマウスあるいはヘッドセットなどの周辺機器は、アプセサリとは呼びません。それらは、有線接続が無線接続になった周辺機器です。

アプセサリは、その造語が示すとおり、特定のアプリケーションとの連携から価値が生まれるものです。ですから、アプセサリの利用場面には、アプリケーションと、そのアプリケーションが実行されるスマートフォンあるいは組み込み機器が、どこかで登場します。

アプセサリは新しい概念ですが、今普及してきている分野自体は、古くからあるものです。ここでは、ラジコン、フィットネスの2つの場面で、iOSアプリケーションと機器とを組み合わせたアプセサリの活用場面を見てみます。

ラジコンは無線通信技術のわかりやすい利用場面です。ラジコンは、車または飛行物の本体と、それを操作する2本のスティックのついた無線操縦装置で構成されます。この操縦装置をスマートフォンに置き換えると、タッチパネルによる操作また強力な画像処理機能などの付加機能がアプリケーションから提供できます。

このような高度な機能がある無線操縦装置は高価になりますが、ユーザが所有しているスマートフォンの活用で、手頃な価格で提供できます。

高機能なクワドロコプターには、Wi-Fiを搭載してカメラ映像が転送できるものもあります。ですが、Bluetooth Low Energy は、画像が転送できるほどの高速通信はできません。そこで、単純な操作データの送受信だけでよい、本体を目の前で見ながら動かす、小型の室内ラジコンによく使われます。

iOSデバイスを載せて動く雲台なども、小さなモータで機構が動くラジコンとハードウェア構成は同じになります。iOSデバイスの顔追跡機能や音声認識機能を使い、アプリケーションが人間の代わりに雲台を操縦することで、ビデオ会話で話し手を自動追尾するなど、高度な機能を提供できます。

フィットネスも、利用者に理解しやすい利用場面です。毎日の歩数測定やランニング時の速度や心拍測定は、スマートフォン登場以前から根付いている慣習です。

たんなる歩数計も、スマートフォンの表示、蓄積、解析、通信機能と組み合わせると、これまでにない魅力が出ます。アプリケーションの表示機能を使うと、大画面を活かした詳細な時間ごとの歩数データのグラフ表示もできます。安価で小さな万歩計に搭載できる、小さな白黒液晶表示器とは比べるまでもない豊かな表示表現ができます。

いまのスマートフォンは歩数計の機能を内蔵しています。ですが、スマートフォンは高額です。歩数計のように、常に持ち歩いていて紛失したり、あるいはランニング時に落として破損する恐れがある用途では、専用の安価で小型の専用機器が求められます。

アプリケーションは、蓄積された過去の情報と現在の情報を比較表示して改善度を示したり、歩数に体重など他の記録データとを合わせて解析することで、運動の効果がどの程度得られたか、あるいは今後のアドバイスも表示できます。通信機能を使い、蓄積したデータをウェブ・サービスに同期できます。手元の機器からネットワーク側に移動したデータは、様々なネットワーク・サービスと連携させて活用ができます。

万歩計がアプセサリとなることで、潜在的な利用方法を違和感がない自然なユーザ体験にできます。

例えば、その日の達成度を記録したり伝えたりしたい気持ちから、万歩計の歩数をソーシャル・メディアに毎日手動で書き込むと、それは奇妙な人です。ですが、アプリケーションに、1日1万歩を達成したら、その記録を自動的にソーシャル・メディアに投稿する機能があるならば、そうではありません。

また、万歩計をアプセサリとすると、万歩計というハードウェアから取り出した活動量というデータが、日々ネットワークに蓄積されます。つまり、ハードウェアからデータという資源を分離して蓄積できます。

ネットワーク・サービスでは、蓄積した個人データは資産そのものです。例えば、トレーニング相談を提供する会社と活動量のデータ活用で連携すれば、万歩計を超えるサービスの魅力を増やせますし、提携先はデータに基づく強い納得感のあるアドバイス提供が可能になります。

アプセサリがまず普及し始めている分野は、アプセサリ登場以前から利用者がいて、その利用方法もよく理解されている分野です。

しかし、その利用方法を見ていくと、今まで不可能だった豊かなアプリケーション表示能力の活用からはじまり、機器からデータを分離してリアルタイムにネットワーク側に蓄積し続けること、またスマートフォンやソーシャル・メディアが普及した時代だからこそ成り立つ新しい活用方法へと、その姿が徐々に変化していることがわかります。

### アプセサリのデータの流れと蓄積

アプセサリの話題は、目に見えるハードウェア、アクセサリ部分に集まりがちです。アプセサリの登場以前からある分野から、アプセサリが普及しているのも、最初は新しいアクセサリとして受け入れられるからでしょう。

また、アプセサリは、アプリケーションという新しい要素に着目されがちでもあります。ですが、アプセサリは、アクセサリとアプリケーションとを単に組み合わせたものではありません。ここでは、データの流れをキーワードにして、アプセサリを見てみます。

まず、歩数計あるいは活動量計のデータの流れを見てみます。

まず内部には、加速度などのセンサーがあります。センサーからミリ秒単位(1ミリ秒は1000分の1秒)で得られる装着者の動きのデータ量は、かなりの量です。しかし、これを信号処理で歩数や消費カロリーにすると、1秒に1回程度でしょうから、そのデータ量は3桁程度とたいへん小さくなります。この機器内部のデータの流れは、アクセサリでもアプセサリでも、どちらでもあるものです。

アプセサリの特徴は、機器とアプリケーション間のデータの流れがあることです。

歩数や消費カロリーのデータは、スマートフォンのアプリケーションに流れていきます。この流れは、新しい計算値が常に流れていくリアルタイムな流れと、機器に蓄積しておいて後にまとめて送る流れの2つがあります。

アプセサリの体験は、ユーザに気づかせない、自然にデータが同期している振る舞いから生まれます。

運動強度を音声フィードバックするトレーニング用のアプリケーションであれば、通信圏内にスマートフォンがあり、かつユーザにリアルタイムにフィードバックをするために、データはリアルタイムに逐次流れています。

服に装着しつづけていて、頻繁に値を確認することはない歩数計では、スマートフォンが通信圏内にあるとは限りません。ですから、接続していない間は歩数計内部にデータを蓄積しておき、スマートフォンが通信圏内に入った時やユーザがデータを取り込み操作をした時に、蓄積データを流します。

いずれの場合もユーザが画面を見た時には、アクセサリ機器から送られたデータがそこに表示されている体験が作れます。これは、クラシックBluetoothと異なり、ユーザの設定操作を必要とせずに、iOSアプリケーションが機器への接続と通信処理ができるからです。

データが逐次流れるべきか、蓄積してまとめて流してもよいのかは、利用場面から自然と決まります。スマートフォンからユーザに、音声や画面表示をリアルタイムに提供するならば、データは逐次流れるべきです。またスマートフォンが通信圏内にない利用場面であれば、データは一時蓄積しておくほかありません。

蓄積したデータをスマートフォンへ流す方法は、ユーザ体験から決めます。通信速度は、スマートフォンのOSの種類などでかなり異なりますが、iOSであれば目安として 1秒に1キロバイト(1キロバイトは1000バイト)を伝送できます。

ユーザにデータ転送を気づかせたくないならば、アクセサリ機器が通信圏内に入った時に、バックグラウンドで実行されるアプリケーションにデータを取得させます。ユーザにデータ転送を画面表示するならば、1回に転送するデータ量を、ユーザが転送完了を我慢できる時間内に収めます。10キロバイトは超えないようにします。

1分あたり1バイトで歩数を記録する歩数計の、1日あたりのデータ量は1.4キロバイトです。ですから1日分のデータ量であれば、2秒程度で取得できます。ユーザはたいてい、最近のデータを見たいでしょうから、最新の1日分のデータをまず取得して画面に表示すると、心地よい体験になります。それよりも古いデータは、グラフなどを表示している間に、アプリケーションが取得を継続します。

### アプセサリのデータの加工と量

アプセサリをデータの流れで見ると、データが加工されていくことに気づきます。データの加工には、歩数計のように1つの入力から1つもしくは複数の出力が得られる1対1もしくは1対Nの関係と、また複数のデータから1つもしくは複数の出力が得られるN対1もしくはN対Nの、2種類があります。

データの流れのどの段階で、どのような加工処理を配置するかは、機能や使い心地を決めるので重要です。加工処理の配置は、1. 処理に必要なデータがそろうのはどこか、2. 利用場面はどんなデータを求めるか、 2. 演算や無線通信そして製造コストなどが適切になるか、の2点で決めます。

歩数計を例にすると、データの流れは、加速度センサ値から歩数が出てくる1対1の関係です。歩数計は人間が装着する前提なので、加速度センサ値には歩数の情報が入っているはずです。ですから、処理に必要なデータは最初の時点でそろっています。

また、歩数計は単体で歩数表示してほしいものです。ですから、歩数計本体にデータ加工の機能がなければなりません。歩数計では、利用場面でデータ加工の位置が決まってしまい、選択肢はありません。ですが、あえてスマートフォンにデータ加工を置いたらどうなるかを見てみます。

歩数計の電池や演算処理能力は、製造コストや電池交換頻度の制約で小さいものしか使えせん。それに比べると、スマートフォンには2桁以上大きな電池容量や演算処理能力があります。ですが、歩数計のデータ加工をアプリケーションに任せるなら、歩数計からスマートフォンに加速度データを無線伝送せねばなりません。

実装方法にもよりますが、加速度データの無線伝送はデータ量が大きいので、歩数を求める演算処理よりも桁違いに電力を消費します。歩数というデータに加工して無線伝送するデータ量が小さくなる方が、貴重な電池容量が節約できます。したがって、歩数計は本体でデータを加工し、スマートフォンはそのデータを受け取る構成が、最適だとわかります。

### アプセサリのデータと振る舞い

アプセサリが登場する以前からある製品は、単独で機能して、その使われ方が一般に普及しているものです。ですから、そのような分野のアプセサリには、アプリケーションが必須ではない、あとづけの付加価値になる場合と、アプリケーションがなければ意味がなくなる、見た目は同じでも本質が異なる場合があります。

このような違いは、アプセサリとしての振る舞いをみると、はっきりします。

置き忘れタグを例にします。置き忘れタグは、キーフォブとも呼ばれる商品で、キーホルダーにつけてスマートフォンの置き忘れを防止したり、あるいはキーホルダーを見つける時にスマートフォンからの指示で音を出させたりするものです。

置き忘れタグの情報の流れは、2つあります。1つは置き忘れタグからスマートフォンへの置き忘れタグが近くにあるかという情報、もう1つは、スマートフォンからキーホルダーへの音を出せという指示の情報です。

まだスマートフォンがない時代は、置き忘れタグの接続相手は、ボタンがついた別のタグでした。置き忘れタグを置き忘れタグとして使う限りは、スマートフォンである必然はありません。

では、スマートフォンと連携させる置き忘れタグを、利用場面設定を変更して、雨傘につけてみます。雨傘を置き忘れしそうなときに警告音をだす、これまでと同じ使い方ができますが、違う使い方もできそうです。

例えば、家を出る時に雨に降られそうならば、警告音を出して雨傘を持っていくように促すことができそうです。

具体的に、情報の流れとともに、動作を見てみます。まず、警告音を出すために必要な入力情報は、雨傘との近接情報、ユーザの行動予定、天気予報の3つの情報です。

ユーザが雨傘に近づいたら、それをアプリケーションが検出します。アプリケーションは、移動先や外出時間をユーザの予定データから読み取り、その行動範囲の天気予報データをネットワークから取得して、雨に降られそうかを調べます。もしも、降られそうならば、タグに警告音の出力指示を出します。

この体験は、ユーザはスマートフォンを持っているだけで、それを操作したり画面を見る場面はありません。ですが、スマートフォンが情報の流れの中核になって初めて成り立つ体験です。これは、アプセサリの自然な体験といえます。

この置き忘れタグと雨傘の2つの体験で使うタグは、ハードウェアとしては同じものです。ですが、スマートフォンが行動情報と天気予報の2つの情報を組み合わせて、それをユーザに警告音として伝える振る舞いが、雨傘をアプセサリにしています。

予定情報を管理するためにスマートフォンに入力することは、普通のことです。いっぽうで、雨傘からの通知をうけるためだけに、その通知アプリケーションに毎日の予定情報を入力することは、手間ですから、ありえません。アプリケーションは、個人情報へのアクセス許可をユーザからもらいスマートフォンにある予定情報を読み取ることで、この自然な体験を作ります。

身の回りにあらゆるものがお互いに無線通信でデータをやりとりして連携すると、1つ1つの通信でやりとりされるデータ量はわずかですが、その全体量は膨大でしかも常にデータが流れ続けています。そのようなデータの流れを人間が見続けることは不可能です。スマートフォンが、いくつものデータの流れを束ねる中核となることで、アプセサリの体験が生み出せています。

### アプセサリのデータとその所有

アプセサリのデータ収集は、常に周囲のデータを収集して、それをリアルタイムに接続先に送り続けることができます。データの流れに人間が関与しないので、データを写し間違えるようなエラーがない24時間365日のデータ収集が実現できます。

ですが、アクセサリが設置される実世界には、あらゆるものに必ず所有者がいます。例えば、これまで見てきたアプセサリは、個人がアクセサリというハードウェアを所有し、アプセサリに流れ込むデータも個人のデータでした。アプセサリの活用場面を考えるうえで、所有者が誰かは重要な項目です。

アプセサリのハードウェア部分の所有およびデータの所有が、それぞれ、個人、会社、あるいは公共なのか、その組み合わせで、異なるアプセサリの体験が生まれます。この体験の違いは、データが生じた場所と、そのデータがどこに保存されてだれが所有するかを見ていくと、はっきりします。

これまでに出てきた歩数計の体験で、歩数のグラフをウェブで見られるようにしたとします。データがなければグラフが表示できませんから、アプリケーションからウェブにデータが集約されて蓄積されます。

このデータの利用または所有権が個人に限られると、提供できるサービスはウェブでグラフが見られる、だけです。もしもユーザが許した第3者にデータの利用権理を移譲する仕組みがあれば、トレーニング相談など第3者のサービスと連携して、より豊かな体験が得られます。

情報化社会では、データは原油と同じ価値がある資源です。ただし、原油は樹脂や石油に加工して初めて資源として活用できるように、データもその加工と活用があって初めて価値を生み出せます。

もしも、利用者が原理的に特定できないよう匿名化されることを条件に、蓄積したデータの解析や販売を第3者に提供できるならば、データ提供が1つの事業になりえます。事業者は集まるデータそれ自体から価値を引き出し、それによりユーザは無料でサービスを利用できる、お互いに利益がある関係を築けるかもしれません。

また、データの発生源は個人でも、そのデータを誰かに委譲する場面もあります。

例えば、タッチをすると近接で電車の乗車履歴が取得できる、共通乗車カード・電子マネーのカードリーダーがあります。これをオフィスで活用する、旅費精算システムというアプセサリ体験はどうなるでしょうか。

まず、会社業務で移動した、旅費精算のための情報はすべて電子カードにあるとしましょう。そうであれば、電子カードの情報をすべて会社に委譲すれば、精算処理は完了できるはずです。もしも、途中で飲み物を購入したなどの個人的な消費項目があったとしても、それはアプリケーション側で自動的に処理できます。

ですが、実際の利用場面では、データの読み取りと精算書の作成までは自動化されますが、それを提出する申請は、人間に委ねます。そのため、カードをタッチするだけでは処理は完了せず、かならず書面の画面表示と申請ボタンを押す確認が入ります。

これは、個人が持っている移動履歴という情報の所有権を精算書の形で会社に委譲する、所有権を渡す確認とも取れます。

### アプセサリのデータと人間との関係

アプセサリは、様々なものからデータを取得し続けます。このデータ収集だけに着目すると、現実のものからデータを分離する分離抽出装置に見えます。しかし、蓄積した収集データだけでは価値はありません。そのデータを解析すること、解析結果から学ぶことが価値をもたらします。

データ解析は、誰が実行しても同じ結果になるはずです。ですから、解析部分はアプリケーションにして自動化することができます。自動化された解析は、その内部が複雑なプログラムであっても1つ1つ見ていけば、どのようなデータからどのような手順で結果が求められたかが、論理的にわかります。

例えば、体重管理のためのトレーニング・メニューの提案が目的とします。消費カロリーを推定するための歩数計の時系列データ、そして摂取カロリーを推定するための体重計の時系列データがあれば、現状を踏まえたいくかのメニュー提案のアプリケーションができそうです。

アプセサリのデータの分離と解析の自動化は、人間関係を変化させます。アプセサリがないと、人間が解析まで担います。ですから、解析結果に基づいた次の行動決定の相談は、人間1に対し人間1の関係になります。解析自動化されると、その結果を見て人間が互いに相談をする、アプリケーション1に対して複数の人間の関係になります。

歩数計を例にとります。使用者とトレーニングのアドバイスを提供するトレーナーの2人がいたとします。歩数計しかないならば、トレーナーが歩数データを見て、そこにトレーナーが自身の知識と経験を使い、トレーニング・メニューを提案します。使用者とトレーナーの関係は、1対1の関係になります。

もしも、解析がアプリケーションで自動化されていれば、画面に表示されたデータと推奨理由つきのメニュー・リストを見ながら、使用者とトレーナーが相談をして、次のトレーニング・メニューを決めるでしょう。トレーナーは、教科書にある誰が行っても同じ結果になる解析をアプリケーションにまかせて、使用者の好みや性格などを反映した、より高度な提案に集中できます。使用者は、トレーナーの頭のなかだけにあったデータとその解析結果が、画面に表示されることで、自分を客観できます。

### アプセサリとデータ抽出

身の回りのあらゆるものがネットワークにつながった社会を示す言葉に、Internet of Things (IoT) または Internet Of Everything (IoE) があります。Bluetooth Low Energy をはじめとする超低消費電力無線通信技術で、実用的な無線接続のセンシング・デバイスが実現してきたことで、具体性が生じて注目を浴びている言葉です。

IoT または IoE の分野で、Bluetooth Low Energy のアクセサリ機器が活用されていても、それはアプセサリとは違うでしょう。

アプセサリにおいても、データの抽出と解析は、ユーザの体験を生み出す核になる技術の1つです。ですが、アプセサリは、アクセサリとアプリケーションが連携することで新たな価値を生み出す、新しい周辺機器の概念を表す造語です。

ユーザとアクセサリは、スマートフォンのアプリケーションを通じて強く結びついています。データに強く着目しすぎる視点は、アプセサリとは呼べません。また、1つのアクセサリに着目するだけの狭い視点も、アプセサリとは呼べません。

### アプセサリとユーザとの関わり方

これまで見てきたアプセサリ体験は、アクセサリというハードウェア部分に着目して、わかりやすいデータ収集の場面を取り上げてきたので、ユーザの近くにアクセサリがある場面ばかりを取り上げてきました。しかし通知に着目するならば、スマートフォンはネットワークに常に接続しているので、アクセサリが近くにあるか遠くにあるかに関わらず、同じ体験が提供できます。

アプセサリは、ユーザが常に携帯しているスマートフォンと連動しているので、アプリケーションを通じてユーザに即時に通知を送ることができます。ユーザに何を通知するかは、その通知がユーザの行動を変化させるだろうかと考えると、わかりやすくなります。

ユーザにとって意味がない通知を頻繁に表示すれば、ユーザはそのアプリケーションからの通知をオフにするか、無意識に削除して通知があったことすら気づかなくなります。また、緊急対応が必要になる普段の通知とは重みが違う通知をするときは、文字を読まなくてもアイコンや色などで視覚的に判別できる表示方法を工夫します。

また、アプリケーションからユーザに何かを知らせる手段は、通知画面以外にも、例えばスケジュール帳に自動で予定を書き込むような間接的な方法もあります。

また、モバイル・プラットフォームの性質にも注意します。

ウェブ・サービスから発想したモバイル・プラットフォームでは、端末はウェブ・サービスがローカルで実行できるハードウェアでしかありません。ですから、ユーザのプライバシーに関わる情報は、ウェブ・サービスからアクセスできます。このようなプラットフォームでは、アクセサリが単体でネットワークに接続して、ユーザのウェブ・サービスに直接作用する設計も可能です。

iOSは、第3者にウェブ・サービスを開かないモバイル・プラットフォームです。ですから、ユーザのプライバシーに関わる情報に触れられるのは、ユーザーがインストールしたアプリケーションだけです。このようなプラットフォームでは、ユーザとの接点はアプリケーションしかないので、そのような場面にあうアプセサリ体験を組み立てます。

### データ解析と人間の行動と関係

データの解析結果を活用すると、人間の行動や人間関係を変化させられます。人間の購買活動を変化させる広告が産業になるように、データの流れに解析が加わり、人間の行動や人間関係に変化を与えて、お金の流れを変化させるならば、1大産業が作れる可能性があります。

例えば、目的地までスマートフォンの経路検索結果を見て移動することも、もはや日常の風景です。これも、交通状況というデータから解析して得られた最適な経路情報が、人間の行動を決めている例です。歩数計の例では、解析結果で次のトレーニングが決められます。

経路検索もトレーニングの例も、データと結果が1対1対応しているので、その懐石がどれほど複雑で高度なものであっても、その振る舞いは理解できます。ですが、データが個人ではなく会社や公共から取り出した膨大な量で、かつ歩数と体重といった数種類のデータではなく数十数百種類の場面では、どうなるでしょうか。

例えば、スマートフォンのカメラ・アプリケーションは、人間の顔を検出して、顔に焦点をあわせる機能があります。画像の顔認識は、黒い点や縦縞などの1つ1つは単純な形状の画像要素が、それぞれ画像のどこにあるかを検出します。この要素の数は数千から数万種類ほどあります。そして、顔に特徴的ないくつかの要素が検出された領域を、顔として検出します。

人間にとって画像から人間の顔を検出することは容易です。それは、群れの動物として、相手の顔と表情を読み取ることが生存に重要な能力だったからです。ですが、画像という2次元データの配列から顔が検出できる解析手法が確立するまでには、膨大な研究と時間が費やされました。

また、この顔検出の技術を使うと、人間には把握できない大量のデジタル・データから人間には理解ができない解析過程で、有益な情報が取り出せます。

例えば、オフィスに導入するアプセサリに、勤務時間中に従業員がどこにいたのか、誰と話していたのか等の多種多様なデータを収集、解析して、人間関係やストレスを数値化、可視化するものがあります。

解析結果をどう活かすかは、人間の工夫次第です。例えば、膨大な収集データから解析された客観的な結果を見ながら、上司と部下とが話し合う形が取れるでしょう。それまでの、上司が観察してデータ収集と解析をする1対1の関係が、データと解析を外部に取り出すことで、システム1対人間2の関係に変化させられます。

### 機器の連携

装着することはありませんが、いつも身の回りにあるあらゆる電化製品もアクセサリと言えます。自分から見ると、所有権または操作権利を持つものすべてはアクセサリです。そのような所有するアクセサリが、それぞれ連携することで、単体では得られない魅力が生まれます。

いわゆるスマート・ハウスという、電化製品や自動車などの様々な製品が連携することで成り立つ新しい生活場面が話題になってきています。連携には、機器のデータを集約してアプリケーションを実行する何か、つまり核が必要です。したがって、いままで誰も連携の核を担えなかったために、そのような体験がいままで提供されておらず、それで話題になっていると言えます。

電化製品の連携とは、つまりアプセサリ体験です。電化製品やスマートフォンがすべて無線通信で接続して、クラウド・サービスと同期します。連携の核は、スマートフォンでもクラウド・サービスでもどちらであっても、ユーザから見た振る舞いは同じに見えて区別がつきません。

いままでのアプセサリは、アクセサリとアプリケーションが1対1に対応していました。ところが、連携に価値があるアプセサリは、アクセサリとアプリケーションが1対1対応していてアプリケーションが連携の核と接続しているか、アクセサリが連携の核と直接つながるか、いずれかの構成になります。

ここで、家電メーカーが単独でアプセサリを提供するとします。そのメーカーは、アクセサリとそれに対応するアプリケーションを提供します。この構成でも、スマートフォンの位置情報を使い、帰宅した時点で照明を自動点灯させるなど、アクセサリ単体でのスマートな機能が実現できます。しかし、空調装置が他社製品であれば、それを連携動作させることは、できません。

このように、家電メーカーがそれぞれにアプセサリを提供すると、自社製品のみの連携の核しか提供できません。どれほど巨大な総合電機メーカーであっても、個人の嗜好があまりに多様化した現代では、電化製品の便利な機能がメーカーに縛られるものは、一般に普及しません。しかし、もしも同業他社との連携を試みたとしても、自社製品の魅力を高める鍵である連携の核を他社に任せるわけにはいかないので、技術ではなく経営の都合から、困難です。

したがって、製造会社を問わずに連携できるアプセサリを実現するならば、その連携の核はスマートフォンの1つのアプリケーションには置けず、クラウド・サービスに置くしかありません。

そのためには、それぞれのアクセサリまたはアプリケーションがクラウド・サービスと接続するための技術仕様と、クラウド・サービスの運営が不可欠です。また、ユーザが期待する振る舞いは人それぞれ様々なので、多種多様なアプリケーションを揃えるために、クラウド・サービスはアプリケーション開発者に解放しなければなりません。

iOSでは、HomeKitがこの役割を担います。アクセサリはHomeKitの無線通信技術仕様に従うことで、iCloudと連携します。iOSアプリケーションは、HomeKitフレームワークを通じて、iCloudと連携しているアクセサリ群と連携できます。

パソコンは、アプリケーションが様々な周辺機器を使えるように、アプリケーションと周辺機器の間にデバイス・ドライバという小さなソフトウェアを入れています。HomeKitは、iCloudという1つの本体に、自分が所有するアクセサリを接続する、パソコンで言えばデバイス・ドライバのような役割を果たしています。

### ネットワークと連携動作

ネットワークに接続して連携するものは、セキュリティやプライバシーの確保が何よりも重要です。電化製品の所有や使用権利が自分にあるのは明白です。電化製品は他人が入れない自宅に設置しているので、他人が使うことは物理的にできません。

ですが、電化製品がネットワークとつながると、このような物理的な障壁がなくなります。セキュリティとプライバシーの絶対の確保と所有と使用権利をどうとらえるかは、連携の設計基本思想に影響します。

2000年前半に日本ではネットワーク対応の電化製品が数多く登場して、すぐに市場から姿を消しました。それらは、ネットワークに接続することで遠隔操作ができることが、新機能と言われました。

それらの機器は、1つのデバイスで実行されている操作アプリケーションと電化製品が、ネットワークを通じて直接1対1で通信をしていました。ちょうど、赤外線または無線リモコンを、そのままネットワーク経由の操作アプリケーションに置き換えたものでした。

アプリケーションを実行しているデバイスと電化製品の1対1は、利用場面とそぐわないことはすぐわかります。家族世帯は言うに及ばず独身世帯でも、スマートフォンやタブレットあるいはリビングのテレビなどの数多くのデバイスで操作アプリケーションが実行され続けています。

ネットワークは通信です。通信には必ず通信相手がいます。

2000年の設計は、操作アプリケーションが操作される機器と直接通信していました。クラウド・サービスに集約されるアクセサリでは、それぞれの機器の通信相手は、クラウド・サービスにあるデータベースになります。ユーザが所有する機器はユーザのアカウントと紐付けられて、その機器の持つデータベースが常にクラウド・サービスと同期します。

Bluetooth Low Energy のサービスとキャラクタリスティクスで述べたように、あらゆるものはデータの集合として表現できます。例えば、照明機器であれば、電源、明るさや色合いのデータを持っています。それらのデータを外部から書き換えれば、照明機器の実際の動作に反映されます。

クラウド・サービスが連携の核になる設計では、クラウド・サービスのデータベースへのアクセスが機器の操作として反映されます。実際の機器は家やオフィスあるいは別荘など様々な場所にありますが、データベースにはそのような物理的な距離はありませんから、ユーザから見れば遠隔操作に見えます。

また、すべての照明を点灯したいときは、データベースの照明という属性のある値をオンにするだけです。データベースのそれぞれの値が、実世界のどの照明装置に対応しているかを、調べる必要はありません。

この設計では、セキュリティおよびプライバシーの確保は、すべてクラウド・サービスが提供します。すべての機器とクラウド・サービスの間の秘密が保たれた通信と、そのクラウド・サービスを利用できるのは自分だけであるという2つで、セキュリティが確保されます。


## アプセサリのアクセサリ

ここまでで、アプセサリの基礎知識やデータの流れといった、大きな話を見てきました。ここでは、アプセサリのアクセサリ部分を注目していきます。

アプセサリの体験を考えるうえで、そのハードウェア部分のアクセサリを常に意識する必要があります。まず、アプセサリの体験が決まれば、どのようなアクセサリが必要はほぼ自動的に決まります。ですが、アクセサリが非常に高価だったり物理的に実現不可能では、絵に描いた餅でしかありません。

また、アクセサリは目に見えるハードウェアです。そして、店頭に展示されるのはアプセサリのアクセサリ部分で、アプセサリの売上はアクセサリから得られます。したがって、アクセサリがアプセサリの体験にふさわしい外観や形状になっているか、あるいは広告媒体や売り場が適切であるかは重要です。

### 入力と出力

機器の機能は、入力系と出力系に分類できます。入力系は、温度や湿度などをセンサーで検出してスマートフォンに伝えるものです。出力系は、スマートフォンから操作できたり、あるいはスマートフォンの設定値をもとにセンサー値をフィードバックして動作を制御するものです。

アプセサリは、ほとんどが入力系です。出力系でも、室内ラジコンやモータで動くデジタルカメラの雲台など、小さなモータで実現できるものばかりです。

これは特に驚くことではありません。室内エアコンや洗濯機に冷蔵庫など、身の回りには数多くのモータを内蔵した電化製品がありますが、そのモータは人間の指が触れない機器内部で動いています。また、それ自体が移動する機器は、ロボット掃除機のような例外はありますが、ありません。

広範囲を移動するような機器は、Bluetooth Low Energy の登場で参入が容易になったから参入する企業には、不適切な領域です。

それは、機器の転倒やぶつかったりして、人や物品を傷つける可能性があるからです。ですから、設計時の安全対策や設置時のユーザ・トレーニングそしてサポート体制の確立などが求められます。そのような機器の製造販売は、それ自体が大きな挑戦です。

また、Bluetooth Low Energy の無線通信距離は、せいぜい 50 メートルです。この通信範囲を超えてほど移動する機器には、Bluetooth Low Energyは不適切です。操作範囲が100メートル程度であればWi-Fi、それ以上であれば携帯通信網の利用などを検討します。

入力系の機器を見ると、サービス分野が違ってはいても、機器の内部構成はほとんど同じものばかりです。

例えば、万歩計や活動量計の内部をみると、加速度と角速度センサー、信号処理回路と Bluetooth Low Energy 無線通信モジュール、そして電池で構成されています。動きを検出する利用場面であれば、機器の内部はこれとほぼ同じになります。例えば、この機器を玄関ドアに貼り付けて、信号処理を変更すれば、ドアの開閉検出装置になります。

さらに、スマートフォンの普及で、それに使われる半導体センサーが大量製造されたことで、高性能な半導体センサーがとても安価になっています。そして、半導体メーカーは、さらなる販売促進のために、利用場面ごとの開発キットやサンプル・アプリケーションまで提供しています。

ですから、提供されている設計例ほぼそのままで、信号処理などのソフトウェア部分だけを変更して、利用場面にあわせた機器開発すら、可能になっています。この参入の容易さが、Bluetooth Low Energy 機器に、入力系が多い1つの理由です。

### 物理量とセンサー

入力系の機器を考えるときは、どのような量が必要か、その量を検出するセンサー・デバイスはあるのか、目的や用途にあうセンサー・デバイスがあるのかに注目します。ここでの量は、現象や物体物質の属性で、計測して定量できるものを言います。

例えば、歩数計であれば加速度の値が必要です。半導体技術の進歩で加速度センサーの製品があります。そして、低消費電力で安価なので、歩数計の小さな電池で長期間動作できます。したがって、歩数計は製造できます。

どのような量が必要かは、どのような単位で表される量かをおさえることが重要です。

量、例えば重さや長さなどには単位があります。また、速さの単位が長さと時間の単位の比で表現できるように、基本的な単位の組み合わせで、いくつもの単位が表現できます。これらの単位を合理的に体系にしたものが国際単位系です。

国際単位系は、7つの基本量 (長さ、質量、時間、電流、熱力学的温度、物質量、光度)と、これらの単位を組み合わせて誘導できる単位を与えます。

国際単位系では単位が表現できない量もあります。例えば、ものの硬さや表面の粗さには、いくつもの物理的性質が関わる複雑な量です。ですが、測定方法を決めれば、測定で定量化はできます。このような量には、騒音や甘みあるいは臭気といった、人間が心理的に感じる程度を定量化したものもあります。

量とその単位がわかれば、次はセンサー・デバイスを探します。

単位が国際単位系で与えられるものは、たいていデバイスがあります。半導体技術の進歩が、高精度で小型低消費電力かつ安価なセンサー・デバイスを実現しています。

例えば、iPhoneに搭載されているセンサーとその用途は以下のようになります。

- 電磁波 (電波の送信と受信回路)
	- 無線通信 (携帯網, Wi-Fi, Bluetooth)
	- 位置検出 (GPS)
	- 近接と位置検出 (iBeaon)
- 磁気
	- コンパス
- 光
	- 画面の明るさ調整(照度センサー)
	- 顔と画面の相対位置検出 (光学式近接センサー)
	- 写真撮影 (イメージセンサー)
- 音
	- マイク 
- 静電容量分布
	- タッチ検出
- 加速度、角速度、気圧
	- デバイスの向き検出
	- 歩数や運動量の検出

国際単位系で単位が与えられない量には、適切なセンサー・デバイスがない場合が多いです。そのような場合は、その量をだいたい表せる、すでにあるセンサー・デバイスで測定方法が定義できる簡易な測定方法で代用します。

定義にしたがう正確な値でなく、単位が任意でだいたいの目安値しか取得できない測定方法でも、アプセサリでは有効に活用できます。

例えば、体脂肪率の測定があります。体脂肪率は、体内に含まれる脂肪の重量割合で表されます。この定義そのままに測定すると、測定対象を脂肪とそれ以外に解体して重量比を求めることになりますが、測定対象を破壊する測定方法は実施できません。

そのため、非破壊な測定方式が作られています。その中で、生体インピーダンス法は、体重計の体脂肪率計測機能に広く使われています。これは、筋肉と脂肪組織は電気の流れる程度が違うので、体に微弱な電圧をかけて、その時に流れる電流の大きさから、体脂肪率を推定する方法です。

この測定方法で得られる値は、人体の電気的特性インピーダンスですが、事前に様々な年齢や性別また体重の人々からより高精度な方法で計測した体脂肪率の値と特性インピーダンスとの相関データを使うなどの工夫で、体脂肪率を推定します。

### 装着部位と生体情報

いわゆるウエアラブル機器は、すでに身につける習慣がある何かに付加機能をもたせたデバイスです。個人が購入して自身が身につけて使用します。フィットネスのように、もともと運動量や心拍の計測装置を身につける習慣がある分野では、スマートフォンと連携するさらに高機能なアクセサリとして、急速に普及しました。

人間の体の部位ごとの装着習慣があるものと、その装着位置で取得できる生体情報を [#table-body-accs] に示します。どの装着位置でも取得できる、装着位置の向きや動きの情報は省略しています。

Table: #table-body-accs アクセサリの装着箇所と生体情報

 装着箇所 | 種類                  | 生体情報
:--------|:---------------------|:----------------------
頭       | 帽子、イヤホン、メガネ  | 脳波、まばたき、視線、頭の傾き、咀嚼
口       | マスク                | 咀嚼、呼吸数、呼吸深さ、呼気の二酸化炭素濃度
胴体     | シャツ、上着、ベルト    | 呼吸、心拍、体温、腹囲、背筋の姿勢
手、手首  | 腕時計、指輪          | 心拍、血圧、血中酸素飽和度
足、足首  | ズボン、靴下、靴      |  歩数、体重や重心位置

これら装着箇所のうち、アクセサリから装着者に情報を伝えられる装着箇所は、頭部と手首の2つだけです。それ以外の箇所は目につかない位置なので、ブザー音を出す以上の情報伝達方法がありません。したがって、アクセサリの機能はデータ収集のみになります。

頭部と手首に装着するアクセサリには、スマートフォンからの通知を受け取るなどの、通知機能をもたせられます。さらに手首であれば、もう片方の手で操作ができるので、操作機能も持たせられます。

これらのアクセサリは、超低消費電力無線技術を使うことで、装着可能な本体サイズに収まる小さな電池での長期間動作が可能になっています。ですが、消費電力が大きい発光ディスプレイや大量の演算処理を採用すると、その消費電力が動作時間の前提を崩します。搭載する機能は、組み合わせたときのバランスに注意します。

魅力的な外観デザインは、ぱっとみて見て購入してもらうために重要です。特に、頭部と手首に装着するものは、他人の目から見えるうえ、自宅に限らず日常利用するものです。ですから、外観デザインには、他人からどう見えるかが問われます。

腕時計を2つ身につける習慣がないように、装着するアクセサリには、1つ装着していれば2つ以上は装着しない排他性があります。またアクセサリから収集したデータは、その会社のアプリケーションに集約されます。ですから、ある1社の製品を使いはじめると、装着位置の排他性と蓄積し続けるデータの価値で、ユーザはその会社に囲い込まれます。

直接装着するアクセサリは、データ収集や通知などユーザとの入出力機能に加えて、近接検出や存在を伝える機能をもたせられます。生身の人間は電波の送受信ができないので、アクセサリやスマートフォンからは直接その存在は検出できません。ですが、無線通信機能があるアクセサリがタグとなることで、人間の存在を示すことができます。

アプセサリの収益は、アクセサリの売上からもたらされます。破棄をすれば新規購入が生まれるので、破棄の場面やタイミングの設計が大事です。破棄をした時に、また自社製品を買ってもらえる場面設計をします。ですから、そして、破棄をしなくても新規購入を生み出す仕組みづくりも重要です。これらを、企画と設計の段階から考えておきます。

頭部や手首など、他人の目につく場所は、外観デザインを変更した新モデルの投入で、買い替えを促すことができます。また、腕時計であれば色やキャラクタをデザインした替えバンドは、収集するために必要がなくとも購入されます。また、フィットネス系は、劣化や故障も、買い替え機会になります。汗汚れなどで自然に外観が劣化していくうえ、落下衝撃や洗濯するなどで使用者が納得できる理由で故障します。

### 既存製品と付加価値

Bluetooth Low Energy を使うと、スマートフォンと連携するハードウェアは、とても簡単に作れます。ですから、既存製品にスマートフォンとの連携機能を追加することは、とても容易です。

ですが、2000年前半に日本で数多く発表された、ハードウェアの機能としてネットワークへの接続機能を追加しただけの製品は、すぐに市場から消えました。既存製品とアプセサリは、アクセサリ部分だけをみると同じものでも、異なるものです。

また、スマートフォン連携があるからといって、その連携で初めて実現可能になるような、ハードウェア部分が従来にない新しい製品は、2020年までは登場しないでしょう。日常生活に必要なハードウェアは、ほぼ商品化されています。また、従来にないものは、その価値や利用場面を理解してもらうのに時間があかかるので、普及し始めるまでに5年はかかります。

既存製品をアプセサリにできる分野は、小資本の新規参入会社が急激に規模を拡大できる分野です。既存製品がある分野は、強力な製品開発力があり販売網やサポート体制をもつ大資本の企業同士の競争があります。ですが、体験を作るのは発明や発見のような創造的な活動で、資本や既存技術者などの物量だけで実現できるものではありません。

いままで例にしてきた歩数計は、まさに、歩数計という既存製品をアプセサリにした分野です。データの自動収集機能は、いままで人の手でデータを記録していた手間をなくしました。蓄積したデータに基づく、トレーニング成果の確認や、ソーシャル・メディアと連携して仲間で成果を競い合うゲーミング要素を取り入れるなどの、新しい体験がそこにあります。

成熟した市場では、基本性能のみ、高性能なもの、高機能なものと、すくなくとも3種類程度の価格帯が作られます。スマートフォン連携は、ここに新たな最高機種を生み出すための付加機能に使えます。とくに、すでに電池を内蔵している製品は、無線通信モジュールを追加しやすく開発が容易です。

電動ブラシは、そのような分野の1つです。だれしも健康には強い関心があるので、歯の健康の維持にお金を使います。汚れを取り除く機器としての電動歯ブラシにスマートフォン連携機能を追加して、価格帯がもう1つ上の商品群が作れます。

新たな最高機種では、使用時間の記録と消耗部品の交換時期を、アプリケーションから通知できます。また加速度データから、磨く時間や磨き方を記録して、よりよい使い方のアドバイスも提案できるでしょう。

### アクセサリとOEMとODM

世の中には多種多様な製品がありますが、すべての会社が自社で製品しているわけではありません。

様々な分野の製品に、生産に特化した OEM ( Original Equipment Manufacturer ) と呼ばれる会社があります。ブランドを持つ会社は、OEMに製造を委託し、OEM会社はいくつもの会社の受注をまとめて大規模な生産をすることで、低価格での生産を実現します。また、OEMをもう1歩進めて、設計まで担う ODM ( Original Design Manufacturer ) もあります。

OEM会社またはODM会社は積極的に利用すべきです。アプセサリで、ハードウェア部分をゼロから開発すると、設計や検証そして製造方法の確立に莫大な費用と時間がかかります。既存製品がある分野であれば、OEMやODMを利用することで、その費用と時間を省略できます。

どのような製品にどのようなOEM会社があるかは、半導体を扱う商社に聞くか、あるいは製品分野ごとにある展示会の出展者を調べていけば、わかります。例えば、フィットネスで使われる胸に巻く心拍計は、各社の製品を並べてみても、製品仕様や外観がよく似ています。これは各社がOEM会社を利用しているからです。

また、スマートフォン連携に向けたODM会社も登場してきています。例えば、心拍計は、フィットネス分野ではスマートフォン登場以前から広く使われてきました。心拍計のOEM会社にとっては、フィットネス分野で急速に広まるスマートフォン連携に対応すれば、自社販売量を急激に伸ばすことができます。逆に対応が遅れれば、スマートフォン連携を強みにした他社が、シェアを取ります。

フィットネス分野は Bluetooth Low Energy が普及する市場として最初から注目されていました。ですから、はやくから心拍計のプロファイルが採択されていました。ODM会社は、規格に定義されたプロファイルを実装した心拍計と、そのプロファイルに対応するアプリケーションを開発するライブラリをセットにして提供します。これらは規格で決められていますから、従来の心拍計と同じく、同じものを複数の会社に販売することができます。

アプセサリの分野では、ゼロからの製品開発を支援するODM会社が登場してきています。これは、将来の製造需要を取り込む目的で、できたばかりの会社に設計まで支援するものです。試作と製造は求められる設計要素がまったく違います。これらのODM会社は、蓄積した製造経験に基づく製造可能な設計まで提供できることが強みになります。

またアプセサリ分野での、OEM会社またはODM会社になる考え方もあります。これはハードウェアを製造せず形のない知的財産を提供しているものもODM会社といえます。

例えば、歩数計や活動量計は、加速度の値から歩数や消費カロリーを算出します。この信号処理はこれ自体が知的財産であり、また算出結果が妥当なものかを検証するなど、開発には大きな費用かかるものです。ですから、歩数や活動量の算出機能をいれた無線通信モジュール、あるいはソフトウェアそのものが販売できます。

また、アクセサリというハードウェアを販売してきた会社は、サーバーの設置や運用、そしてアプリケーション開発を、経験がないからと避けようとします。サーバーを運営まで含めて提供するODMも可能です。

また、OEMあるいはODM会社になるほうがよい分野もあります。

例えば、メガネの機能はそのままで、フレームに機能を追加したアプセサリがあるとします。メガネですから、利用者にあったレンズをフレームにはめる必要があります。このため、通常の眼鏡と同じように店頭で販売する必要があります。

販売店舗を全国に展開するには巨額の資本が必要です。ですから、そのようなアプセサリであれば、メガネのフレームのODM会社になるべきでしょう。

### アクセサリと会社設立

OEMおよびODM会社も登場して、アプセサリでの市場参入障壁は、ますます低くなってきています。しかし、ハードウェアを扱うと、たちまち個人では扱いきれない何千万円ものお金や物を扱わねばならなくなります。

ヒト・モノ・カネが、事業の3要素と呼ばれます。現在はこれに、情報や時間を付け加えることもあります。会社は事業要素を扱うための器です。アプセサリを始めるために、会社の中で独立した組織を立ち上げたり、あるいは新しく会社を作ったりします。

会社内で事業を始める場合は、かならず代表取締役社長直属の組織にします。また外部からアプセサリを売り込む場合は、かならず代表取締役社長に売り込みます。

社内で組織を立ち上げた時に、もしも命令権限が他人にあると、なにかやりたいことがあるたびに、内容報告や相談と命令発行のお願いが発生します。命令権限が自分自身になければ、アプセサリは必ず失敗します。

新規に会社を作るならば、会社の継続条件である、お金の支払い能力に注意します。

どのような会社であっても、どのような失敗をしても、お金の支払い能力があるかぎりは失敗にはなりません。また、世の中には名前を出すだけで銀行から多額の融資が受けられる一族の方もいます。成功された方が若年であることは、若年であれば成功することを意味しません。

アプセサリの分野では、クラウドファンディング ( Crowdfunding ) がよく利用されます。群衆 (crowd) と資金調達 (funding) を組み合わせた造語で、インターネットで不特定多数の人から資金や協力を集めることを指します。ソーシャル・ファンディングとも呼ばれます。アプセサリには、ハードウェアという形あるものがあるので、投資への見返りに最初に製造した製品が使われます。

## アプセサリを作るには

<!-- 個々に何か書くこと -->

### ハードウェアとソフトウェアの開発体制

アプセサリのiOSアプリケーションは、ハードウェアと密接につながります。そのため、通信部分とドライバ相当は、両方をよく理解して協調して設計することが大切です。Objective-Cもできるハードウェア開発者が担当することが最適です。

iOSアプリケーションからみて、ハードウェアが期待した振る舞いをしないときは、問題がどこにあるのかを切り分けることが困難です。原因は、iOSアプリケーションのドライバ層の使い方の間違い、Bluetooth LEの通信、ハードウェアの設計、これら4つのどれかにあります。しかし、iOSアプリケーション開発者からは、通信以降を調べる手立てがありません。それらを調べられるのはハードウェア担当者です。

なにかおかしいことが起きた時に、原因箇所の特定には時間がかかります。このときに、ハードウェアの振る舞いを確認できるデモンストレーション・アプリケーションを作製しておけば、iOSアプリケーションとドライバ相当部分が原因かそうでないかが、すぐに切り分けできます。iOSアプリケーション以外に原因があるときは、通信プロトコルを見たり、ハードウェアの設計内容を確認していきます。それはハードウェア設計の担当領域です。

### ハードウェア設計

- Made for iPhoneプログラムは不要
- 部品代は5ドル、モジュールは10ドル前後
- モジュールを利用した場合、電波法の認証及びBluetoothの認証費用はかからない

 Bluetooth Low Energy は、[Made for iPhone (MFi) プログラム](https://developer.apple.com/jp/programs/mfi/) の締結が必須ではありません。クラシックBluetoothでは、特定のiOSアプリケーションと接続するデバイスの開発には、Apple社とMFiプログラムの締結が必須でした。MFiプログラムを締結して初めて、ハードウェアやソフトウェアの開発情報が提供されます。

MFiプログラムが必須ではなくなったことで、ベンチャーの参入ハードルが極端に下がりました。 Bluetooth Low Energy デバイスと接続するiOSアプリケーションは、AppStoreの承認を得られます。ただし、デバイスにMFiロゴを掲載する場合は、ロゴの使用権を得るためにMFiプログラムの締結が必要です。

 Bluetooth Low Energy の電子回路を独自に設計した場合の製造コストは5ドル程度です。これらの電子回路を小さな基板にまとめて部品化したものを、モジュールと呼びます。モジュールの価格は10ドル前後です。

モジュールを使うことで、電波法の基準認定とBluetoothの規格認定および製品登録にかかる初期費用が省けます。

電波を出す回路は、外部に電波がもれ出ない試験環境で動作させるか、あるいは、それぞれの国ごとの電波法に基づく基準認証をうけなくてはいけません。認証を取得しているモジュールを利用すれば、製品ごとに認証をとる必要はありません。

また、 Bluetooth Low Energy ロゴを表示して販売するには、Bluetooth SIGへの製品登録が必要です。製品登録には、Bluetoooth SIGへの、最低でも年間5000ドルのメンバー登録費用と、設計ごとの認証費用が必要です。

各社のモジュールは、それ単体でのBluetoothの製品登録が完了しています。無償のBluetooth SIGのメンバー登録をおこない、 Bluetooth Low Energy のモジュールを利用した派生製品として登録すれば(この登録は無償)、製品登録が完了します。

### アクセサリの実例

アプリケーションやネットワークそして事業までを統合したアプセサリは、まだ少なくこれから登場するでしょう。アクセサリ自体は、2012年の夏あたりから次々登場しています。いくつかを紹介します。

1つは、プロトタイピングのための開発キットやアクセサリです。これらは、早い時期から登場しています。まずBluetooth LEの半導体やモジュール会社が、組み込み機器開発者向けキットの提供を開始しました。iOSアプリケーション開発者のなかにも、Bluetooth LEデバイスの開発をしてみたい要望があります。次に登場してきたのが、その要望にあわせて、組み込み機器開発者でなくても使いやすい、より安価な開発キットです。

日本の技術基準適合証明を取得しているプロトタイピングに向いたものに:

* SBBLE(サブレー) [http://sbble.micutil.com](http://sbble.micutil.com)
* Konashi [http://konashi.ux-xu.com](http://konashi.ux-xu.com)
* センサータグ [http://www.tij.co.jp/tool/jp/cc2541dk-sensor](http://www.tij.co.jp/tool/jp/cc2541dk-sensor)

があります。

SBLBLE(サブレー)はマイクロチップ・テクノロジー・ジャパン株式会社のPICマイコンを採用した開発キットです。市販のUSB Bluetooth4アダプタを挿して使います。Konashiは、iOSアプリケーション側の開発がObjective-Cに加えてJavaScriptでも開発できます。ウェブ・サービスの開発者が、フィジカル・コンピューティングをiOSでおこなう場合の唯一の選択肢です。センサータグは、テキサス・インスツルメンツ社の半導体の評価キットで、25ドルと低価格です。次のセンサを搭載しています:

* 放射温度センサ、温度センサ
* 湿度センサ
* 圧力センサ
* 加速度計
* ジャイロスコープ
* 磁力計

必要なセンサが上記にあるプロトタイピングであればセンサータグを、LEDの点灯など低速の外部装置制御をiPhoneから行うならKonashiまたはSBBLEを、任意のファームウェアを開発したいときはSBBLEを選択するとよいでしょう。

キーホルダーまたはタグは、よくあるアクセサリです:

* キーホルダー、
[iPhone用探せるキーホルダー](http://buffalo.jp/products/catalog/supply/bluetooth/bluetooth/security/bshsbtpt01/)
* StickNFind [https://www.sticknfind.com](https://www.sticknfind.com)

キーホルダーは、iPhoneと接続して使うものです。iPhoneを置き忘れしそうになった時にキーホルダーから警告音を出したり、キーホルダーのボタンを押すとiPhoneから音が出る機能でiPhoneを探すのに利用します。タグは、代表的なものにStickNFindがありますが、ものに取り付けておいて、ものを探すのに使うものです。その機能は、キーホルダーのボタンを省略したもので、おおよその距離をiPhoneで確認すること、iPhoneから操作してタグから音や光を出すこと、ができます。

たいていのキーホルダーやタグは、仕様が公開されていたり、ソフトウェア開発キットが提供されていて、アプリケーション開発に利用ができます。近接検出または光や音の出力を必要とするプロトタイピングに利用できます。

この他にも:

* 心拍センサ、 [Alpha](http://www.alphaheartrate.com)
* 活動量計、[Fitbit](https://www.fitbit.com)
* 睡眠記録、[オムロン ねむり時間計](http://www.healthcare.omron.co.jp/corp/news/detail/223)
* 姿勢検出、 [Lumoback](http://www.lumoback.com)
* 腕時計、[Pebble](http://getpebble.com)
* 顔検出、[HVC-C1B](http://plus-sensing.omron.co.jp/egg-project/)

などが市販されています。

アクセサリに直接アクセスできるSDKを提供するもの、アクセサリに直接アクセスするAPIはなく、ウェブ側に蓄積されたデータにアクセスするAPIを提供するものなど、APIやSDKの公開は、製品ごとにまちまちです。

### プロトタイピングのすすめ

プロトタイピング(Prototyping)は、プロトタイプ(Prototype)を作り、早期に設計などを検証する手法です。とくに、参加者の分野が様々なブレインストーミングでは、お互いの認識のすり合わせにプロトタイプが使えます。

これは著者個人の体験ですが、粘土をこねて外形を作った、あるいはiPhoneで機能するプロトタイプを作り、それを手で触れていると、そこから驚くような発見や広がりそして展開が、急速に出ます。アプセサリの魅力は、アクセサリとアプリケーションの連携が生み出す体験です。形あるプロトタイプに触れる体験を通して、その背後にある形のないアプセサリの体験を、肌で感じられます。

形があると、つい目を奪われますが、、しかしアクセサリはアプセサリの要素にすぎません。アプセサリの体験という大きな絵を見るための、ジグソーパズルの1つのピースとして、役立ちます。

プロトタイピングにかける期間は、できればブレインストーミング中に作製、時間がかかるならば、前回のブレインストーミングの内容を覚えていて、過熱した頭が冷える程度の期間、例えば2〜3日程度、が望ましいでしょう。体験ができればいいので、実際に実装する必要はありません。その期間でできることを、工夫します。ネットワーク・サービスが必要ならば、決め打ちの画面や、紙に書いた画面をカメラで取り込んだものでも、十分でしょう。Bluetooth LEデバイスは、iPhoneのセンサで間に合うことがほとんどで、また市販されている試作用のBluetooth LEデバイスもあります。

ブレインストーミングでアイディアを出しつくしたならば、そのなかから、面白さや楽しいさ、事業として継続できるかなどの尺度で、ふるいにかけます。アイディアのなかには、必要とするセンサが販売されていない、非常に高価な部品を必要とする、電池や回路の工夫ではどうにもできない形状や大きさを求めている、ものがあります。プロトタイプにはいる前に、そのような明らかに実現不可能なものは、実装についての知識がある担当者が、メンバーにその理由を説明して、変更を加える、もしくは不採用にします。

### アプセサリのブレインストーミング

アプセサリは、何が正解か誰も知らない、新しいものです。そのため、アプセサリの企画では、ブレインストーミングという会議方法をとることがあります。ブレインストーミングは、参加メンバーがアイディアを出しあい、そのアイディアを批判せず前向きに展開し続けることで、アイディアの連鎖反応や発想の誘発を期待する会議手法です。

しかし、Bluetooth LEに限りませんが、会議方法に工夫をこらして長い時間を費やしても、成果が出ないことがあります。多くの素晴らしいアイディア、それらの検討結果、そして膨大な議事録は残ります。しかし、その結果が事業として実行されず、何もユーザの手に渡らないならば、それは成果が出せなかったことになります。

新規事業を立ち上げる目的は、新たな利益の源泉を得ることです。そのために、これまでにない製品もしくはサービスを考えます。この、考える、がくせものです。企画会議の参加者は、営業、技術開発、製造、ときには経営など、背景知識や立場が様々です。メンバー間で、メンバーの考え方、背景知識、着目している領域を、お互いに確認を取り合える、高い議論の能力が、参加者全員に求められます。

分野をまたぐ協業には、技術でできること/できないことを判別する知識、あるいはBluetooth LEの規格を作る過程ですでに考え尽くされている、利用分野や利用場面の知識の、共有が必要です。技術でできることそれ自体は、誰が考えても、同じものに行き着きます。そのようなものは、自分で考えなくても、知識を持てばよいだけです。

ブレインストーミングは、突飛なアイディアも否定せず前向きに議論を展開していくのが、肝心です。それが会議にならないように、また、議論の焦点だけはあわせることが、主催者の手腕の見せ所です。例えば、ハードウェアの機能を話していて、その大きさに影響する議論がでてきたとします。このとき、大きさは外形デザインに影響するからと、いきなりデザインの話を切り出す人がいたとします。デザインの話に切り替わるのはよいのですが、しかしデザインの話だと節目をつけてメンバー全員の頭を切り替えないと、終わることのない楽しい雑談会の始まりになります。

## まとめ

2000年までの無線通信技術は、ほとんどがストリーム通信での定義された制御コードのやりとりでした。Bluetooth Low Energy は、ものが持つデータを表現するためにデータベースの仕組みを備えたことで、多種多様なものに無線通信を付加する強力な技術となりました。

また、無線通信には必ず通信相手がいます。iOS が開発環境を一般開発者に開放したことで、世界に広く普及したiOSデバイスが通信相手となりました。さらに、ハードウェアの設計および製造支援サービスや、クラウドファンディングの盛り上がりも後押しとなり、いまも様々なアプセサリが生み出されています。

Bluetooth Low Energy は、スマートフォン連携機能や、アプセサリを作る上での重要な技術として、いままで実現できなかったことを実現できるようにする鍵となる、使える技術です。

道具は手段です。高度に発達した技術が、たとえ魔術のように見えたとしても、それは術であるかぎり学び理解すれば、誰にでも使える手段です。しかし、どのような術であれ、その術を普及させて日常生活に溶けこませことができれば、それは魔法に見えるのかもしれません。その手に魔法を。
