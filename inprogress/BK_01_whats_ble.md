
### チームメンバーの距離感と組み合わせ

3の組み方。利害関係。
切り替える。
ハードとソフト、連携。お互いの利益が異なると、話が通じない。
目の前にいれば、何かしら話さざるをえない、見える。そういった場所。
机の配置、あいさつをする、朝決まった時間に顔を合わせる。
事業、
ネットワーク、ローカル、ハードウェア、連携その先。例えば宿泊やタクシー。
技術的に困難、費用的に困難、法的に困難、倫理的に困難、



しかし、最初の一歩、
なにが価値なのかを
成功は逆算、




Bluetooth low energy、スマートフォンなど周囲環境を通じてアプセサリという新しい造語、
その使われ方とハードウェアだけではないその背後に広がるネットワークとリアル世界の同期、
データの流れ、
事業。

面白い試作品、
展示会、個人所有ではなくて公共の場所、
最終目的、アプリケーション、利益、おもしろさ、

すでにあるハードウェア、ハード自体を無料配布、あれこれ、。千差万別。


<!-- アプセサリのプロトタイピングとその事業化 -->



外注するときの、3の構成。


積み上げではなく、組み合わせ。囲い込みではなく、共有や広がり。
ネットで面白いことをする人の話。
何かを動かす環境としてだけのネット。それは媒体でもある。人間、ソーシャル。
設けとかそういったものを度外視、おもしろさ、自分という主語の追求。
エゴ。共有、動画、センス、他人の目が入っている、それは汎用性をもつかもしれない。フィルタリング。
おもしろいだけ、でもないかもしれない。必要はない。おもちゃかもしれないけど。

積み上げではない。正解があって、底に届くかどうか、ならばうける、響く、何かしら目を引く要素、
あるいは、ポンと買ってもらえればいい、目を引く必要がないのかもしれません。
面白い、ネットにどうか、うけるかどうか。
デプロイの関係だけで、試作だけの段階では、そういった話もありなのかもしれない。
売れれば、結果が過程を正当化する。

### 全体の流れ

体験、おもしろそう? 作らない

事業
必要なハードウェア、既存、新規?
立ち上げ、
試作、配布、フィードバック、
成長期、成熟期。

製造業あるいはなんかベースになる事業があるかどうか?
資本金->しがらみ、

試作立ち上げ
製造可能なスタート、
製造販売、運用スタート、
サイクルの確立


デザイン性、
魅力的な外観デザインは、ぱっとみて見て購入してもらうために重要です。特に、頭部と手首に装着するものは、他人の目から見えるうえ、自宅に限らず日常利用するものです。ですから、外観デザインには、他人からどう見えるかが問われます。



アプセサリの収益は、アクセサリの売上からもたらされます。破棄をすれば新規購入が生まれるので、破棄の場面やタイミングの設計が大事です。破棄をした時に、また自社製品を買ってもらえる場面設計をします。ですから、そして、破棄をしなくても新規購入を生み出す仕組みづくりも重要です。これらを、企画と設計の段階から考えておきます。

頭部や手首など、他人の目につく場所は、外観デザインを変更した新モデルの投入で、買い替えを促すことができます。また、腕時計であれば色やキャラクタをデザインした替えバンドは、収集するために必要がなくとも購入されます。また、フィットネス系は、劣化や故障も、買い替え機会になります。汗汚れなどで自然に外観が劣化していくうえ、落下衝撃や洗濯するなどで使用者が納得できる理由で故障します。



これらのアクセサリは、超低消費電力無線技術を使うことで、装着可能な本体サイズに収まる小さな電池での長期間動作が可能になっています。ですが、消費電力が大きい発光ディスプレイや大量の演算処理を採用すると、その消費電力が動作時間の前提を崩します。搭載する機能は、組み合わせたときのバランスに注意します。

距離がゼロ、時間も無視できる、
データセンター、アカウント、個人、大きな壁、やりとり、物理的には実装可能、プライバシー

考えるのが人間かどうか、
どこから発生して、どこで処理蓄積されて、どこに出力されるのか
かならずデータは、何かに触れることで、処理して、意味して、判断や行動を促す。

リアル世界をネットワークに持ち込む、ネットワークからリアル世界を操作する。人間の行動すら変化させるとすれば?
データの流れ、流れが重要。止まったものではなくて、時間で変化する様子。

会社あるいは国家の枠を超えている、
ネットワークのビジネスというのは最初から国境がない。隣の人が使っているからといって、自分が使う必要はない。逆に、アプセサリは見た目ではわかりにくい。知人がつかっているから存在を知るものも多い。

ヒト・モノ・カネ、情報。
情報、顧客体験、顧客がほしい物、あるいはデジタル・データ、ありとあらゆる意味が込めらられてしまっていますが。
売り切りモデルとはちがい、購入後の体験や、そのアプセサリが破棄されるまでに生み出される。
目に見えない価値のつながりが、価値を生む。それを見ていく。

強力な処理能力と通信機能があるモバイル機器、スマートフォンと組み合わさることで、いままでにない利用場面を作り出せる Bluetooth low energy 機器は、アプリケーション(Application)とアクセサリ(Accessory)を組み合わせたアプセサリ(Appcessory = App + cessory) という造語で表現されています。

ここまで見てきた Bluetoot Low Energy の技術概略、そして iOS と Bluetooth low energy の関わりが、アプセサリを考える基礎知識になります。

アプセサリをビジネスとして見ると、それは運営のビジネスです。データの流れ、また蓄積したデータとそこから解析される情報が価値の核となるビジネスです。アクセサリというハードウェアを販売して、アプリケーションやネットワーク・サービスは無償で提供されるため、売上だけを見ていると、従来のアクセサリを販売するビジネスと混同しがちです。

この運営とはなにかを考えて、アプセサリを発想するうえで、データの流れを意識することが大切です。ここでは、アプセサリとデータの2つの単語をキーワードに、その関係を見ていきます。




どのような量が必要かは、どのような単位で表される量かをおさえることが重要です。

量、例えば重さや長さなどには単位があります。また、速さの単位が長さと時間の単位の比で表現できるように、基本的な単位の組み合わせで、いくつもの単位が表現できます。これらの単位を合理的に体系にしたものが国際単位系です。

国際単位系は、7つの基本量 (長さ、質量、時間、電流、熱力学的温度、物質量、光度)と、これらの単位を組み合わせて誘導できる単位を与えます。

国際単位系では単位が表現できない量もあります。例えば、ものの硬さや表面の粗さには、いくつもの物理的性質が関わる複雑な量です。ですが、測定方法を決めれば、測定で定量化はできます。このような量には、騒音や甘みあるいは臭気といった、人間が心理的に感じる程度を定量化したものもあります。

量とその単位がわかれば、次はセンサー・デバイスを探します。

単位が国際単位系で与えられるものは、たいていデバイスがあります。半導体技術の進歩が、高精度で小型低消費電力かつ安価なセンサー・デバイスを実現しています。



国際単位系で単位が与えられない量には、適切なセンサー・デバイスがない場合が多いです。そのような場合は、その量をだいたい表せる、すでにあるセンサー・デバイスで測定方法が定義できる簡易な測定方法で代用します。

定義にしたがう正確な値でなく、単位が任意でだいたいの目安値しか取得できない測定方法でも、アプセサリでは有効に活用できます。

例えば、体脂肪率の測定があります。体脂肪率は、体内に含まれる脂肪の重量割合で表されます。この定義そのままに測定すると、測定対象を脂肪とそれ以外に解体して重量比を求めることになりますが、測定対象を破壊する測定方法は実施できません。

そのため、非破壊な測定方式が作られています。その中で、生体インピーダンス法は、体重計の体脂肪率計測機能に広く使われています。これは、筋肉と脂肪組織は電気の流れる程度が違うので、体に微弱な電圧をかけて、その時に流れる電流の大きさから、体脂肪率を推定する方法です。

この測定方法で得られる値は、人体の電気的特性インピーダンスですが、事前に様々な年齢や性別また体重の人々からより高精度な方法で計測した体脂肪率の値と特性インピーダンスとの相関データを使うなどの工夫で、体脂肪率を推定します。




## アプセサリのアクセサリ

ここまでで、アプセサリの基礎知識やデータの流れといった、大きな話を見てきました。ここでは、アプセサリのアクセサリ部分を注目していきます。

アプセサリの体験を考えるうえで、そのハードウェア部分のアクセサリを常に意識する必要があります。まず、アプセサリの体験が決まれば、どのようなアクセサリが必要はほぼ自動的に決まります。ですが、アクセサリが非常に高価だったり物理的に実現不可能では、絵に描いた餅でしかありません。

また、アクセサリは目に見えるハードウェアです。そして、店頭に展示されるのはアプセサリのアクセサリ部分で、アプセサリの売上はアクセサリから得られます。したがって、アクセサリがアプセサリの体験にふさわしい外観や形状になっているか、あるいは広告媒体や売り場が適切であるかは重要です。














### 装着部位と生体情報

いわゆるウエアラブル機器は、すでに身につける習慣がある何かに付加機能をもたせたデバイスです。個人が購入して自身が身につけて使用します。フィットネスのように、もともと運動量や心拍の計測装置を身につける習慣がある分野では、スマートフォンと連携するさらに高機能なアクセサリとして、急速に普及しました。

人間の体の部位ごとの装着習慣があるものと、その装着位置で取得できる生体情報を [#table-body-accs] に示します。どの装着位置でも取得できる、装着位置の向きや動きの情報は省略しています。

Table: #table-body-accs アクセサリの装着箇所と生体情報

 装着箇所 | 種類                  | 生体情報
:--------|:---------------------|:----------------------
頭       | 帽子、イヤホン、メガネ  | 脳波、まばたき、視線、頭の傾き、咀嚼
口       | マスク                | 咀嚼、呼吸数、呼吸深さ、呼気の二酸化炭素濃度
胴体     | シャツ、上着、ベルト    | 呼吸、心拍、体温、腹囲、背筋の姿勢
手、手首  | 腕時計、指輪          | 心拍、血圧、血中酸素飽和度
足、足首  | ズボン、靴下、靴      |  歩数、体重や重心位置

これら装着箇所のうち、アクセサリから装着者に情報を伝えられる装着箇所は、頭部と手首の2つだけです。それ以外の箇所は目につかない位置なので、ブザー音を出す以上の情報伝達方法がありません。したがって、アクセサリの機能はデータ収集のみになります。

頭部と手首に装着するアクセサリには、スマートフォンからの通知を受け取るなどの、通知機能をもたせられます。さらに手首であれば、もう片方の手で操作ができるので、操作機能も持たせられます。

これらのアクセサリは、超低消費電力無線技術を使うことで、装着可能な本体サイズに収まる小さな電池での長期間動作が可能になっています。ですが、消費電力が大きい発光ディスプレイや大量の演算処理を採用すると、その消費電力が動作時間の前提を崩します。搭載する機能は、組み合わせたときのバランスに注意します。

魅力的な外観デザインは、ぱっとみて見て購入してもらうために重要です。特に、頭部と手首に装着するものは、他人の目から見えるうえ、自宅に限らず日常利用するものです。ですから、外観デザインには、他人からどう見えるかが問われます。

腕時計を2つ身につける習慣がないように、装着するアクセサリには、1つ装着していれば2つ以上は装着しない排他性があります。またアクセサリから収集したデータは、その会社のアプリケーションに集約されます。ですから、ある1社の製品を使いはじめると、装着位置の排他性と蓄積し続けるデータの価値で、ユーザはその会社に囲い込まれます。

直接装着するアクセサリは、データ収集や通知などユーザとの入出力機能に加えて、近接検出や存在を伝える機能をもたせられます。生身の人間は電波の送受信ができないので、アクセサリやスマートフォンからは直接その存在は検出できません。ですが、無線通信機能があるアクセサリがタグとなることで、人間の存在を示すことができます。

アプセサリの収益は、アクセサリの売上からもたらされます。破棄をすれば新規購入が生まれるので、破棄の場面やタイミングの設計が大事です。破棄をした時に、また自社製品を買ってもらえる場面設計をします。ですから、そして、破棄をしなくても新規購入を生み出す仕組みづくりも重要です。これらを、企画と設計の段階から考えておきます。

頭部や手首など、他人の目につく場所は、外観デザインを変更した新モデルの投入で、買い替えを促すことができます。また、腕時計であれば色やキャラクタをデザインした替えバンドは、収集するために必要がなくとも購入されます。また、フィットネス系は、劣化や故障も、買い替え機会になります。汗汚れなどで自然に外観が劣化していくうえ、落下衝撃や洗濯するなどで使用者が納得できる理由で故障します。


### 専有



### 既存製品と付加価値

Bluetooth low energy を使うと、スマートフォンと連携するハードウェアは、とても簡単に作れます。ですから、既存製品にスマートフォンとの連携機能を追加することは、とても容易です。

ですが、2000年前半に日本で数多く発表された、ハードウェアの機能としてネットワークへの接続機能を追加しただけの製品は、すぐに市場から消えました。既存製品とアプセサリは、アクセサリ部分だけをみると同じものでも、異なるものです。

また、スマートフォン連携があるからといって、その連携で初めて実現可能になるような、ハードウェア部分が従来にない新しい製品は、2020年までは登場しないでしょう。日常生活に必要なハードウェアは、ほぼ商品化されています。また、従来にないものは、その価値や利用場面を理解してもらうのに時間があかかるので、普及し始めるまでに5年はかかります。

既存製品をアプセサリにできる分野は、小資本の新規参入会社が急激に規模を拡大できる分野です。既存製品がある分野は、強力な製品開発力があり販売網やサポート体制をもつ大資本の企業同士の競争があります。ですが、体験を作るのは発明や発見のような創造的な活動で、資本や既存技術者などの物量だけで実現できるものではありません。

いままで例にしてきた歩数計は、まさに、歩数計という既存製品をアプセサリにした分野です。データの自動収集機能は、いままで人の手でデータを記録していた手間をなくしました。蓄積したデータに基づく、トレーニング成果の確認や、ソーシャル・メディアと連携して仲間で成果を競い合うゲーミング要素を取り入れるなどの、新しい体験がそこにあります。

成熟した市場では、基本性能のみ、高性能なもの、高機能なものと、すくなくとも3種類程度の価格帯が作られます。スマートフォン連携は、ここに新たな最高機種を生み出すための付加機能に使えます。とくに、すでに電池を内蔵している製品は、無線通信モジュールを追加しやすく開発が容易です。

電動ブラシは、そのような分野の1つです。だれしも健康には強い関心があるので、歯の健康の維持にお金を使います。汚れを取り除く機器としての電動歯ブラシにスマートフォン連携機能を追加して、価格帯がもう1つ上の商品群が作れます。

新たな最高機種では、使用時間の記録と消耗部品の交換時期を、アプリケーションから通知できます。また加速度データから、磨く時間や磨き方を記録して、よりよい使い方のアドバイスも提案できるでしょう。






### 既存機器からアプセサリへの変化

あらためて、アプセサリの立ち位置から、アプセサリとはなにかを見ていきます。

パソコン時代からあるキーボードやマウスあるいはヘッドセットなどの周辺機器は、アプセサリとは呼びません。それらは、有線接続が無線接続になった周辺機器です。

アプセサリは、その造語が示すとおり、特定のアプリケーションとの連携から価値が生まれるものです。ですから、アプセサリの利用場面には、アプリケーションと、そのアプリケーションが実行されるスマートフォンあるいは組み込み機器が、どこかで登場します。

アプセサリは新しい概念ですが、今普及してきている分野自体は、古くからあるものです。ここでは、ラジコン、フィットネスの2つの場面で、iOSアプリケーションと機器とを組み合わせたアプセサリの活用場面を見てみます。

ラジコンは無線通信技術のわかりやすい利用場面です。ラジコンは、車または飛行物の本体と、それを操作する2本のスティックのついた無線操縦装置で構成されます。この操縦装置をスマートフォンに置き換えると、タッチパネルによる操作また強力な画像処理機能などの付加機能がアプリケーションから提供できます。

このような高度な機能がある無線操縦装置は高価になりますが、ユーザが所有しているスマートフォンの活用で、手頃な価格で提供できます。

高機能なクワドロコプターには、Wi-Fiを搭載してカメラ映像が転送できるものもあります。ですが、Bluetooth low energy は、画像が転送できるほどの高速通信はできません。そこで、単純な操作データの送受信だけでよい、本体を目の前で見ながら動かす、小型の室内ラジコンによく使われます。

iOSデバイスを載せて動く雲台なども、小さなモータで機構が動くラジコンとハードウェア構成は同じになります。iOSデバイスの顔追跡機能や音声認識機能を使い、アプリケーションが人間の代わりに雲台を操縦することで、ビデオ会話で話し手を自動追尾するなど、高度な機能を提供できます。

フィットネスも、利用者に理解しやすい利用場面です。毎日の歩数測定やランニング時の速度や心拍測定は、スマートフォン登場以前から根付いている慣習です。

たんなる歩数計も、スマートフォンの表示、蓄積、解析、通信機能と組み合わせると、これまでにない魅力が出ます。アプリケーションの表示機能を使うと、大画面を活かした詳細な時間ごとの歩数データのグラフ表示もできます。安価で小さな万歩計に搭載できる、小さな白黒液晶表示器とは比べるまでもない豊かな表示表現ができます。

いまのスマートフォンは歩数計の機能を内蔵しています。ですが、スマートフォンは高額です。歩数計のように、常に持ち歩いていて紛失したり、あるいはランニング時に落として破損する恐れがある用途では、専用の安価で小型の専用機器が求められます。

アプリケーションは、蓄積された過去の情報と現在の情報を比較表示して改善度を示したり、歩数に体重など他の記録データとを合わせて解析することで、運動の効果がどの程度得られたか、あるいは今後のアドバイスも表示できます。通信機能を使い、蓄積したデータをウェブ・サービスに同期できます。手元の機器からネットワーク側に移動したデータは、様々なネットワーク・サービスと連携させて活用ができます。

万歩計がアプセサリとなることで、潜在的な利用方法を違和感がない自然なユーザ体験にできます。

例えば、その日の達成度を記録したり伝えたりしたい気持ちから、万歩計の歩数をソーシャル・メディアに毎日手動で書き込むと、それは奇妙な人です。ですが、アプリケーションに、1日1万歩を達成したら、その記録を自動的にソーシャル・メディアに投稿する機能があるならば、そうではありません。

また、万歩計をアプセサリとすると、万歩計というハードウェアから取り出した活動量というデータが、日々ネットワークに蓄積されます。つまり、ハードウェアからデータという資源を分離して蓄積できます。

ネットワーク・サービスでは、蓄積した個人データは資産そのものです。例えば、トレーニング相談を提供する会社と活動量のデータ活用で連携すれば、万歩計を超えるサービスの魅力を増やせますし、提携先はデータに基づく強い納得感のあるアドバイス提供が可能になります。

アプセサリがまず普及し始めている分野は、アプセサリ登場以前から利用者がいて、その利用方法もよく理解されている分野です。

しかし、その利用方法を見ていくと、今まで不可能だった豊かなアプリケーション表示能力の活用からはじまり、機器からデータを分離してリアルタイムにネットワーク側に蓄積し続けること、またスマートフォンやソーシャル・メディアが普及した時代だからこそ成り立つ新しい活用方法へと、その姿が徐々に変化していることがわかります。

### データの流れと蓄積

アプセサリの話題は、目に見えるハードウェア、アクセサリ部分に集まりがちです。アプセサリの登場以前からある分野から、アプセサリが普及しているのも、最初は新しいアクセサリとして受け入れられるからでしょう。

また、アプセサリは、アプリケーションという新しい要素に着目されがちでもあります。ですが、アプセサリは、アクセサリとアプリケーションとを単に組み合わせたものではありません。ここでは、データの流れをキーワードにして、アプセサリを見てみます。

まず、歩数計あるいは活動量計のデータの流れを見てみます。

まず内部には、加速度などのセンサーがあります。センサーからミリ秒単位(1ミリ秒は1000分の1秒)で得られる装着者の動きのデータ量は、かなりの量です。しかし、これを信号処理で歩数や消費カロリーにすると、1秒に1回程度でしょうから、そのデータ量は3桁程度とたいへん小さくなります。この機器内部のデータの流れは、アクセサリでもアプセサリでも、どちらでもあるものです。

アプセサリの特徴は、機器とアプリケーション間のデータの流れがあることです。

歩数や消費カロリーのデータは、スマートフォンのアプリケーションに流れていきます。この流れは、新しい計算値が常に流れていくリアルタイムな流れと、機器に蓄積しておいて後にまとめて送る流れの2つがあります。

アプセサリの体験は、ユーザに気づかせない、自然にデータが同期している振る舞いから生まれます。

運動強度を音声フィードバックするトレーニング用のアプリケーションであれば、通信圏内にスマートフォンがあり、かつユーザにリアルタイムにフィードバックをするために、データはリアルタイムに逐次流れています。

服に装着しつづけていて、頻繁に値を確認することはない歩数計では、スマートフォンが通信圏内にあるとは限りません。ですから、接続していない間は歩数計内部にデータを蓄積しておき、スマートフォンが通信圏内に入った時やユーザがデータを取り込み操作をした時に、蓄積データを流します。

いずれの場合もユーザが画面を見た時には、アクセサリ機器から送られたデータがそこに表示されている体験が作れます。これは、クラシックBluetoothと異なり、ユーザの設定操作を必要とせずに、iOSアプリケーションが機器への接続と通信処理ができるからです。

データが逐次流れるべきか、蓄積してまとめて流してもよいのかは、利用場面から自然と決まります。スマートフォンからユーザに、音声や画面表示をリアルタイムに提供するならば、データは逐次流れるべきです。またスマートフォンが通信圏内にない利用場面であれば、データは一時蓄積しておくほかありません。

蓄積したデータをスマートフォンへ流す方法は、ユーザ体験から決めます。通信速度は、スマートフォンのOSの種類などでかなり異なりますが、iOSであれば目安として 1秒に1キロバイト(1キロバイトは1000バイト)を伝送できます。

ユーザにデータ転送を気づかせたくないならば、アクセサリ機器が通信圏内に入った時に、バックグラウンドで実行されるアプリケーションにデータを取得させます。ユーザにデータ転送を画面表示するならば、1回に転送するデータ量を、ユーザが転送完了を我慢できる時間内に収めます。10キロバイトは超えないようにします。

1分あたり1バイトで歩数を記録する歩数計の、1日あたりのデータ量は1.4キロバイトです。ですから1日分のデータ量であれば、2秒程度で取得できます。ユーザはたいてい、最近のデータを見たいでしょうから、最新の1日分のデータをまず取得して画面に表示すると、心地よい体験になります。それよりも古いデータは、グラフなどを表示している間に、アプリケーションが取得を継続します。

### データの加工と量

アプセサリをデータの流れで見ると、データが加工されていくことに気づきます。データの加工には、歩数計のように1つの入力から1つもしくは複数の出力が得られる1対1もしくは1対Nの関係と、また複数のデータから1つもしくは複数の出力が得られるN対1もしくはN対Nの、2種類があります。

データの流れのどの段階で、どのような加工処理を配置するかは、機能や使い心地を決めるので重要です。加工処理の配置は、1. 処理に必要なデータがそろうのはどこか、2. 利用場面はどんなデータを求めるか、 2. 演算や無線通信そして製造コストなどが適切になるか、の2点で決めます。

歩数計を例にすると、データの流れは、加速度センサ値から歩数が出てくる1対1の関係です。歩数計は人間が装着する前提なので、加速度センサ値には歩数の情報が入っているはずです。ですから、処理に必要なデータは最初の時点でそろっています。

また、歩数計は単体で歩数表示してほしいものです。ですから、歩数計本体にデータ加工の機能がなければなりません。歩数計では、利用場面でデータ加工の位置が決まってしまい、選択肢はありません。ですが、あえてスマートフォンにデータ加工を置いたらどうなるかを見てみます。

歩数計の電池や演算処理能力は、製造コストや電池交換頻度の制約で小さいものしか使えせん。それに比べると、スマートフォンには2桁以上大きな電池容量や演算処理能力があります。ですが、歩数計のデータ加工をアプリケーションに任せるなら、歩数計からスマートフォンに加速度データを無線伝送せねばなりません。

実装方法にもよりますが、加速度データの無線伝送はデータ量が大きいので、歩数を求める演算処理よりも桁違いに電力を消費します。歩数というデータに加工して無線伝送するデータ量が小さくなる方が、貴重な電池容量が節約できます。したがって、歩数計は本体でデータを加工し、スマートフォンはそのデータを受け取る構成が、最適だとわかります。

### データと振る舞い

アプセサリが登場する以前からある製品は、単独で機能して、その使われ方が一般に普及しているものです。ですから、そのような分野のアプセサリには、アプリケーションが必須ではない、あとづけの付加価値になる場合と、アプリケーションがなければ意味がなくなる、見た目は同じでも本質が異なる場合があります。

このような違いは、アプセサリとしての振る舞いをみると、はっきりします。

置き忘れタグを例にします。置き忘れタグは、キーフォブとも呼ばれる商品で、キーホルダーにつけてスマートフォンの置き忘れを防止したり、あるいはキーホルダーを見つける時にスマートフォンからの指示で音を出させたりするものです。

置き忘れタグの情報の流れは、2つあります。1つは置き忘れタグからスマートフォンへの置き忘れタグが近くにあるかという情報、もう1つは、スマートフォンからキーホルダーへの音を出せという指示の情報です。

まだスマートフォンがない時代は、置き忘れタグの接続相手は、ボタンがついた別のタグでした。置き忘れタグを置き忘れタグとして使う限りは、スマートフォンである必然はありません。

では、スマートフォンと連携させる置き忘れタグを、利用場面設定を変更して、雨傘につけてみます。雨傘を置き忘れしそうなときに警告音をだす、これまでと同じ使い方ができますが、違う使い方もできそうです。

例えば、家を出る時に雨に降られそうならば、警告音を出して雨傘を持っていくように促すことができそうです。

具体的に、情報の流れとともに、動作を見てみます。まず、警告音を出すために必要な入力情報は、雨傘との近接情報、ユーザの行動予定、天気予報の3つの情報です。

ユーザが雨傘に近づいたら、それをアプリケーションが検出します。アプリケーションは、移動先や外出時間をユーザの予定データから読み取り、その行動範囲の天気予報データをネットワークから取得して、雨に降られそうかを調べます。もしも、降られそうならば、タグに警告音の出力指示を出します。

この体験は、ユーザはスマートフォンを持っているだけで、それを操作したり画面を見る場面はありません。ですが、スマートフォンが情報の流れの中核になって初めて成り立つ体験です。これは、アプセサリの自然な体験といえます。

この置き忘れタグと雨傘の2つの体験で使うタグは、ハードウェアとしては同じものです。ですが、スマートフォンが行動情報と天気予報の2つの情報を組み合わせて、それをユーザに警告音として伝える振る舞いが、雨傘をアプセサリにしています。

予定情報を管理するためにスマートフォンに入力することは、普通のことです。いっぽうで、雨傘からの通知をうけるためだけに、その通知アプリケーションに毎日の予定情報を入力することは、手間ですから、ありえません。アプリケーションは、個人情報へのアクセス許可をユーザからもらいスマートフォンにある予定情報を読み取ることで、この自然な体験を作ります。

身の回りにあらゆるものがお互いに無線通信でデータをやりとりして連携すると、1つ1つの通信でやりとりされるデータ量はわずかですが、その全体量は膨大でしかも常にデータが流れ続けています。そのようなデータの流れを人間が見続けることは不可能です。スマートフォンが、いくつものデータの流れを束ねる中核となることで、アプセサリの体験が生み出せています。

### データとその所有

アプセサリのデータ収集は、常に周囲のデータを収集して、それをリアルタイムに接続先に送り続けることができます。データの流れに人間が関与しないので、データを写し間違えるようなエラーがない24時間365日のデータ収集が実現できます。

ですが、アクセサリが設置される実世界には、あらゆるものに必ず所有者がいます。例えば、これまで見てきたアプセサリは、個人がアクセサリというハードウェアを所有し、アプセサリに流れ込むデータも個人のデータでした。アプセサリの活用場面を考えるうえで、所有者が誰かは重要な項目です。

アプセサリのハードウェア部分の所有およびデータの所有が、それぞれ、個人、会社、あるいは公共なのか、その組み合わせで、異なるアプセサリの体験が生まれます。この体験の違いは、データが生じた場所と、そのデータがどこに保存されてだれが所有するかを見ていくと、はっきりします。

これまでに出てきた歩数計の体験で、歩数のグラフをウェブで見られるようにしたとします。データがなければグラフが表示できませんから、アプリケーションからウェブにデータが集約されて蓄積されます。

このデータの利用または所有権が個人に限られると、提供できるサービスはウェブでグラフが見られる、だけです。もしもユーザが許した第3者にデータの利用権理を移譲する仕組みがあれば、トレーニング相談など第3者のサービスと連携して、より豊かな体験が得られます。

情報化社会では、データは原油と同じ価値がある資源です。ただし、原油は樹脂や石油に加工して初めて資源として活用できるように、データもその加工と活用があって初めて価値を生み出せます。

もしも、利用者が原理的に特定できないよう匿名化されることを条件に、蓄積したデータの解析や販売を第3者に提供できるならば、データ提供が1つの事業になりえます。事業者は集まるデータそれ自体から価値を引き出し、それによりユーザは無料でサービスを利用できる、お互いに利益がある関係を築けるかもしれません。

また、データの発生源は個人でも、そのデータを誰かに委譲する場面もあります。

例えば、タッチをすると近接で電車の乗車履歴が取得できる、共通乗車カード・電子マネーのカードリーダーがあります。これをオフィスで活用する、旅費精算システムというアプセサリ体験はどうなるでしょうか。

まず、会社業務で移動した、旅費精算のための情報はすべて電子カードにあるとしましょう。そうであれば、電子カードの情報をすべて会社に委譲すれば、精算処理は完了できるはずです。もしも、途中で飲み物を購入したなどの個人的な消費項目があったとしても、それはアプリケーション側で自動的に処理できます。

ですが、実際の利用場面では、データの読み取りと精算書の作成までは自動化されますが、それを提出する申請は、人間に委ねます。そのため、カードをタッチするだけでは処理は完了せず、かならず書面の画面表示と申請ボタンを押す確認が入ります。

これは、個人が持っている移動履歴という情報の所有権を精算書の形で会社に委譲する、所有権を渡す確認とも取れます。

### データと人間との関係

アプセサリは、様々なものからデータを取得し続けます。このデータ収集だけに着目すると、現実のものからデータを分離する分離抽出装置に見えます。しかし、蓄積した収集データだけでは価値はありません。そのデータを解析すること、解析結果から学ぶことが価値をもたらします。

アプセサリのデータの流れと蓄積そして解析から得られた情報は、それを知り学んだ人間の判断や行動を変化させます。

データ解析は、誰が実行しても同じ結果になるはずです。ですから、解析部分はアプリケーションにして自動化することができます。自動化された解析は、その内部が複雑なプログラムであっても1つ1つ見ていけば、どのようなデータからどのような手順で結果が求められたかが、論理的にわかります。

例えば、体重管理のためのトレーニング・メニューの提案が目的とします。消費カロリーを推定するための歩数計の時系列データ、そして摂取カロリーを推定するための体重計の時系列データがあれば、現状を踏まえたいくかのメニュー提案のアプリケーションができそうです。

アプセサリのデータの分離と解析の自動化は、人間関係を変化させます。アプセサリがないと、人間が解析まで担います。ですから、解析結果に基づいた次の行動決定の相談は、人間1に対し人間1の関係になります。解析自動化されると、その結果を見て人間が互いに相談をする、アプリケーション1に対して複数の人間の関係になります。

歩数計を例にとります。使用者とトレーニングのアドバイスを提供するトレーナーの2人がいたとします。歩数計しかないならば、トレーナーが歩数データを見て、そこにトレーナーが自身の知識と経験を使い、トレーニング・メニューを提案します。使用者とトレーナーの関係は、1対1の関係になります。

もしも、解析がアプリケーションで自動化されていれば、画面に表示されたデータと推奨理由つきのメニュー・リストを見ながら、使用者とトレーナーが相談をして、次のトレーニング・メニューを決めるでしょう。トレーナーは、教科書にある誰が行っても同じ結果になる解析をアプリケーションにまかせて、使用者の好みや性格などを反映した、より高度な提案に集中できます。使用者は、トレーナーの頭のなかだけにあったデータとその解析結果が、画面に表示されることで、自分を客観できます。

### データ抽出

身の回りのあらゆるものがネットワークにつながった社会を示す言葉に、Internet of Things (IoT) または Internet Of Everything (IoE) があります。Bluetooth low energy をはじめとする超低消費電力無線通信技術で、実用的な無線接続のセンシング・デバイスが実現してきたことで、具体性が生じて注目を浴びている言葉です。

IoT または IoE の分野で、Bluetooth low energy のアクセサリ機器が活用されていても、それはアプセサリとは違うでしょう。

アプセサリにおいても、データの抽出と解析は、ユーザの体験を生み出す核になる技術の1つです。ですが、アプセサリは、アクセサリとアプリケーションが連携することで新たな価値を生み出す、新しい周辺機器の概念を表す造語です。

ユーザとアクセサリは、スマートフォンのアプリケーションを通じて強く結びついています。データに強く着目しすぎる視点は、アプセサリとは呼べません。また、1つのアクセサリに着目するだけの狭い視点も、アプセサリとは呼べません。

### ユーザとの関わり方

これまで見てきたアプセサリ体験は、アクセサリというハードウェア部分に着目して、わかりやすいデータ収集の場面を取り上げてきたので、ユーザの近くにアクセサリがある場面ばかりを取り上げてきました。しかし通知に着目するならば、スマートフォンはネットワークに常に接続しているので、アクセサリが近くにあるか遠くにあるかに関わらず、同じ体験が提供できます。

アプセサリは、ユーザが常に携帯しているスマートフォンと連動しているので、アプリケーションを通じてユーザに即時に通知を送ることができます。ユーザに何を通知するかは、その通知がユーザの行動を変化させるだろうかと考えると、わかりやすくなります。

ユーザにとって意味がない通知を頻繁に表示すれば、ユーザはそのアプリケーションからの通知をオフにするか、無意識に削除して通知があったことすら気づかなくなります。また、緊急対応が必要になる普段の通知とは重みが違う通知をするときは、文字を読まなくてもアイコンや色などで視覚的に判別できる表示方法を工夫します。

また、アプリケーションからユーザに何かを知らせる手段は、通知画面以外にも、例えばスケジュール帳に自動で予定を書き込むような間接的な方法もあります。

また、モバイル・プラットフォームの性質にも注意します。

ウェブ・サービスから発想したモバイル・プラットフォームでは、端末はウェブ・サービスがローカルで実行できるハードウェアでしかありません。ですから、ユーザのプライバシーに関わる情報は、ウェブ・サービスからアクセスできます。このようなプラットフォームでは、アクセサリが単体でネットワークに接続して、ユーザのウェブ・サービスに直接作用する設計も可能です。

iOSは、第3者にウェブ・サービスを開かないモバイル・プラットフォームです。ですから、ユーザのプライバシーに関わる情報に触れられるのは、ユーザーがインストールしたアプリケーションだけです。このようなプラットフォームでは、ユーザとの接点はアプリケーションしかないので、そのような場面にあうアプセサリ体験を組み立てます。

### データ解析と人間の行動と関係

データの解析結果を活用すると、人間の行動や人間関係を変化させられます。人間の購買活動を変化させる広告が産業になるように、データの流れに解析が加わり、人間の行動や人間関係に変化を与えて、お金の流れを変化させるならば、1大産業が作れる可能性があります。

例えば、目的地までスマートフォンの経路検索結果を見て移動することも、もはや日常の風景です。これも、交通状況というデータから解析して得られた最適な経路情報が、人間の行動を決めている例です。歩数計の例では、解析結果で次のトレーニングが決められます。

経路検索もトレーニングの例も、データと結果が1対1対応しているので、その懐石がどれほど複雑で高度なものであっても、その振る舞いは理解できます。ですが、データが個人ではなく会社や公共から取り出した膨大な量で、かつ歩数と体重といった数種類のデータではなく数十数百種類の場面では、どうなるでしょうか。

例えば、スマートフォンのカメラ・アプリケーションは、人間の顔を検出して、顔に焦点をあわせる機能があります。画像の顔認識は、黒い点や縦縞などの1つ1つは単純な形状の画像要素が、それぞれ画像のどこにあるかを検出します。この要素の数は数千から数万種類ほどあります。そして、顔に特徴的ないくつかの要素が検出された領域を、顔として検出します。

人間にとって画像から人間の顔を検出することは容易です。それは、群れの動物として、相手の顔と表情を読み取ることが生存に重要な能力だったからです。ですが、画像という2次元データの配列から顔が検出できる解析手法が確立するまでには、膨大な研究と時間が費やされました。

また、この顔検出の技術を使うと、人間には把握できない大量のデジタル・データから人間には理解ができない解析過程で、有益な情報が取り出せます。

例えば、オフィスに導入するアプセサリに、勤務時間中に従業員がどこにいたのか、誰と話していたのか等の多種多様なデータを収集、解析して、人間関係やストレスを数値化、可視化するものがあります。

解析結果をどう活かすかは、人間の工夫次第です。例えば、膨大な収集データから解析された客観的な結果を見ながら、上司と部下とが話し合う形が取れるでしょう。それまでの、上司が観察してデータ収集と解析をする1対1の関係が、データと解析を外部に取り出すことで、システム1対人間2の関係に変化させられます。

### 機器の連携

装着することはありませんが、いつも身の回りにあるあらゆる電化製品もアクセサリと言えます。自分から見ると、所有権または操作権利を持つものすべてはアクセサリです。そのような所有するアクセサリが、それぞれ連携することで、単体では得られない魅力が生まれます。

いわゆるスマート・ハウスという、電化製品や自動車などの様々な製品が連携することで成り立つ新しい生活場面が話題になってきています。連携には、機器のデータを集約してアプリケーションを実行する何か、つまり核が必要です。したがって、いままで誰も連携の核を担えなかったために、そのような体験がいままで提供されておらず、それで話題になっていると言えます。

電化製品の連携とは、つまりアプセサリ体験です。電化製品やスマートフォンがすべて無線通信で接続して、クラウド・サービスと同期します。連携の核は、スマートフォンでもクラウド・サービスでもどちらであっても、ユーザから見た振る舞いは同じに見えて区別がつきません。

いままでのアプセサリは、アクセサリとアプリケーションが1対1に対応していました。ところが、連携に価値があるアプセサリは、アクセサリとアプリケーションが1対1対応していてアプリケーションが連携の核と接続しているか、アクセサリが連携の核と直接つながるか、いずれかの構成になります。

ここで、家電メーカーが単独でアプセサリを提供するとします。そのメーカーは、アクセサリとそれに対応するアプリケーションを提供します。この構成でも、スマートフォンの位置情報を使い、帰宅した時点で照明を自動点灯させるなど、アクセサリ単体でのスマートな機能が実現できます。しかし、空調装置が他社製品であれば、それを連携動作させることは、できません。

このように、家電メーカーがそれぞれにアプセサリを提供すると、自社製品のみの連携の核しか提供できません。どれほど巨大な総合電機メーカーであっても、個人の嗜好があまりに多様化した現代では、電化製品の便利な機能がメーカーに縛られるものは、一般に普及しません。しかし、もしも同業他社との連携を試みたとしても、自社製品の魅力を高める鍵である連携の核を他社に任せるわけにはいかないので、技術ではなく経営の都合から、困難です。

したがって、製造会社を問わずに連携できるアプセサリを実現するならば、その連携の核はスマートフォンの1つのアプリケーションには置けず、クラウド・サービスに置くしかありません。

そのためには、それぞれのアクセサリまたはアプリケーションがクラウド・サービスと接続するための技術仕様と、クラウド・サービスの運営が不可欠です。また、ユーザが期待する振る舞いは人それぞれ様々なので、多種多様なアプリケーションを揃えるために、クラウド・サービスはアプリケーション開発者に解放しなければなりません。

iOSでは、HomeKitがこの役割を担います。アクセサリはHomeKitの無線通信技術仕様に従うことで、iCloudと連携します。iOSアプリケーションは、HomeKitフレームワークを通じて、iCloudと連携しているアクセサリ群と連携できます。

パソコンは、アプリケーションが様々な周辺機器を使えるように、アプリケーションと周辺機器の間にデバイス・ドライバという小さなソフトウェアを入れています。HomeKitは、iCloudという1つの本体に、自分が所有するアクセサリを接続する、パソコンで言えばデバイス・ドライバのような役割を果たしています。

### ネットワークと連携動作

ネットワークに接続して連携するものは、セキュリティやプライバシーの確保が何よりも重要です。電化製品の所有や使用権利が自分にあるのは明白です。電化製品は他人が入れない自宅に設置しているので、他人が使うことは物理的にできません。

ですが、電化製品がネットワークとつながると、このような物理的な障壁がなくなります。セキュリティとプライバシーの絶対の確保と所有と使用権利をどうとらえるかは、連携の設計基本思想に影響します。

2000年前半に日本ではネットワーク対応の電化製品が数多く登場して、すぐに市場から姿を消しました。それらは、ネットワークに接続することで遠隔操作ができることが、新機能と言われました。

それらの機器は、1つのデバイスで実行されている操作アプリケーションと電化製品が、ネットワークを通じて直接1対1で通信をしていました。ちょうど、赤外線または無線リモコンを、そのままネットワーク経由の操作アプリケーションに置き換えたものでした。

アプリケーションを実行しているデバイスと電化製品の1対1は、利用場面とそぐわないことはすぐわかります。家族世帯は言うに及ばず独身世帯でも、スマートフォンやタブレットあるいはリビングのテレビなどの数多くのデバイスで操作アプリケーションが実行され続けています。

ネットワークは通信です。通信には必ず通信相手がいます。

2000年の設計は、操作アプリケーションが操作される機器と直接通信していました。クラウド・サービスに集約されるアクセサリでは、それぞれの機器の通信相手は、クラウド・サービスにあるデータベースになります。ユーザが所有する機器はユーザのアカウントと紐付けられて、その機器の持つデータベースが常にクラウド・サービスと同期します。

Bluetooth low energy のサービスとキャラクタリスティクスで述べたように、あらゆるものはデータの集合として表現できます。例えば、照明機器であれば、電源、明るさや色合いのデータを持っています。それらのデータを外部から書き換えれば、照明機器の実際の動作に反映されます。

クラウド・サービスが連携の核になる設計では、クラウド・サービスのデータベースへのアクセスが機器の操作として反映されます。実際の機器は家やオフィスあるいは別荘など様々な場所にありますが、データベースにはそのような物理的な距離はありませんから、ユーザから見れば遠隔操作に見えます。

また、すべての照明を点灯したいときは、データベースの照明という属性のある値をオンにするだけです。データベースのそれぞれの値が、実世界のどの照明装置に対応しているかを、調べる必要はありません。

この設計では、セキュリティおよびプライバシーの確保は、すべてクラウド・サービスが提供します。すべての機器とクラウド・サービスの間の秘密が保たれた通信と、そのクラウド・サービスを利用できるのは自分だけであるという2つで、セキュリティが確保されます。

### データの流れと先入観

IoTはウェブではない。
世界にあるページをアクセスする、操作も見るのも自分という主語。

機械たちの連携動作。どこに主語が? iPhoneのアプリケーションに処理を受け渡すなら、たくさんあるデバイス。どれが主人?
あなたが所有、全てが連携、あなたの意にそう。制御は1つ。クラウドにまかせるしかないでしょう。権限移譲、連携、ネット経由。
すべての装置は、あなたの所有物。あなたがだす情報も、あなたという肉体も実は概念として所有物。ネット側に主語が。
あなたの意思に沿うか。

### アプセサリとその普及

ここまでアプセサリの特色を、データの流れと蓄積から見てきました。では、アプセサリは普及しうるのでしょうか。

書店で雑誌や新書を見れば、そこにはいつも素晴らしい技術が社会を大きく変化させる話があります。技術は、潜在あるいはこれから生じる需要を見込み、先行して開発されているものです。ですから、技術開発のときに想定されただろう、その社会を変化させる話は正しいのでしょう。ですが、その技術が使われるかどうかは、わかりません。

技術が普及するかどうかは、不確定な要素が多く予測は困難です。ただし、社会に大きな変革をもたらす技術ほど、思惑の異なる複数の組織がかかわる領域では普及することはないとは言えます。

これを説明する好例は、非接触で情報をやりとりできるRFID技術です。

RFIDタグで、商品1つ1つに情報を埋め込むことで、製造から販売まで自動化された一貫した流通と在庫管理が可能になるうえ、商品のトレーサビリティなどの、いくつもの付加価値も提供できます。身近な例では、スーパーのレジで商品を台の上に置くだけで一瞬で会計が完了します。

ですが、流通分野では今も印刷された2次元バーコードが広く使われています。たしかに、一貫したシステムがあれば便利な社会に移行できますが、では、だれがそのシステムを構築して運用するのかが、問題なのです。製造者には製造者の思惑があり、流通には流通の都合があります。それらの異なる業界や企業の思惑を1つに束ねて、新しいシステムを構築するのは、それ自体が大きなチャンレンジです。

その一方で、RFID技術は電子マネーや乗車カードとして広く普及しています。電子マネーは、クレジットカードの普及と同じ流れで普及させることができたので、早期に普及しました。また、乗車カードは1社の鉄道会社がシステムとして導入するため、流通分野のような思惑の違いはありません。ただし、鉄道会社間の乗車カードの相互運用がほぼ完了するまでには、10年の歳月がかかっています。

アプセサリの普及でも、この一貫したシステムが構築できるのかが、普及の鍵となります。しかし、電子マネーや乗車カードでのシステムが、膨大な数の読み取り装置の敷設や店舗や駅員の運用教育など、実世界での膨大な手間がかかるのに対して、アクセサリとスマートフォン、そしてその先にあるネットワークで完結するアプセサリでは、システムの構築は桁違いに手間がかからないものとなりえます。


































































リ

。

1次産業、ハードウェアを製造して売り切るモデル。

事業の指標。売上。
原材料を加工して、もの。
原材料->加工と流通->製品を届ける。
お金とものとの交換。
製造、製造原価。品質を保ち、製造。
商品を仕入れてどのくらいの月数または日数で販売できているかをみる指標です。なるべく売上原価に対して、在庫を小さく。素早く仕入れたものを素早く売り続ける、流れの大小。
流通、在庫回転期間。
積み上げ、なるべく安く。

ソーシャルメディアとかは、国境を超えられるが、
金融などはグローバル足り得ない、

ネットワークビジネス、
原材料がほとんどない。ソーシャルゲーム、魅力的な音や絵と言ったコンテンツとアプリケーション、ネットワークサービス。
開発ー＞運用ー＞課金。
開発費は固定。生産にかかるお金=運用、薄い。
アカウント、利用者を増やす。デジタル・データの配布コストが極限まで小さい。コピー、ネットワーク。
重要業績評価指標（じゅうようぎょうせきひょうかしひょう、英: Key Performance Indicators, KPI）
組織の目標達成の度合いを定義する補助となる計量基準群である。 KPI はビジネスインテリジェンスにおいて、現在のビジネスの状態
形がないだけに上限なく課金できる、

Bluetooth Smart機器とスマートフォンのアプリケーションと連携するだけの個人で閉じた体験もアプセサリと呼べます。また、スマートフォンを通じてネットワーク・サービスと連携した個人や企業という枠にとらわれない開いた体験もアプセサリです。


ハードウェアという要素だけを切り出す、両方のタイプがある。ちょっと分類してみると。


ネットワーク・
利用者が増えること、
利用期間、単価、個数、
サービスの追加、

情報のやりとりや

課金タイミング、購入時、利用期間、破棄時点。
破棄タイミングは顧客が切り替えを考える、アカウントを保持する、継続。
次の製品購入と交換で

ハードウェアタイプ
売りきり必須、店頭において、見ればわかる。おまけ機能、カタログ、
電動歯ブラシなどは、良い製品。必ず電池があって、強弱操作はマイコンとか? 
BLEのSoCを既存マイコンと置き換える、通信機能を入れる。製造コスト。
スマフォで見てもいいし、見なくてもいい。健康関連の装置、自分の体、これ以上ない価値を保つための器具。
より高いものがよいものとして、欲する気持ち。

ネットワークタイプ
アカウントが必須、売り方はいろいろ。ぱっとみわかりにくい、使ってみないと良さもわからない。

売上、アカウント数、1日に利用する人の割合、利用ユーザの課金率、課金単価
アクションに繋がりにくい、問題発見にあること。実際の行動、誰がいつどこで何を行動したか。
笑顔かどうかがわからない。
外部要因が大きい。
アカウント数を伸ばしていく、継続して遊んでもらえるように工夫するなど、それが結果として売上に。形がない情報産業、知識や情報を扱う産業分野では、KPIが売上をもたらす。


同じようなハードウェアでも、2次、3次に分類。しかし1次で利用することもできるだろうし、同じハードウェアでも意味や価値が異なる。






### アプセサリの顧客

一般
業務向け
社内利用


自然人
一般向け。サービス。フィットネス。
Bluetoot Smart機器である必要はないが、新しい市場、会社を興すときには使える。
新規、まだ競合がいない。もしも大手が参入しても、だれでもできることでしかない。

法人、従業員は必然使うことに。
業務向け、一般的な経理、あるいは連携することが全体の価値。
しかしRFID。最初に出荷するところが負担、それを価格に転化できるか? 
共通仕様は。ハードウェアだけではなくて、データベース。
読み取り装置、データベースが異なれば。ハードウェア的な積み上げからの発想が招く、ロックアップ。ジャンプ。
全体がだれでも使うならば、一気に切り替わる。その仕組でよいならば。連携するならば。
会計ソフト、帳簿管理、在庫管理、パソコン黎明期に登場した利用場面。
旅費精算、
また、税務会計のように決められた手順に従った処理、定型でなくてはならず、どの会社でも共通して行う仕組み。
規模の事業。
逆にシステムを開発してメンテナンスするコストが高いならば、共通化した何処かに任せてしまうべきとも言えます。
手間賃による定型処理。それ自体が直接価値を生み出さないが、事業には必要ななにか。
それ自体が連携することで価値を産み出す何か。しかし、競合他社が切り替えないならば、必要はない何か。

経営での利用。
明確な理由があって。ネットワーク、局部で導入。
価値のつながり、流通。2次元バーコード。RFIDではなく。
差別化、事業と密接に連携して、それ自体は外部に出ることはない。ノウハウと連携した、技術が実現可能にするタイプ。











そのようなアプリケーションを基準にしているならば、
どれほど優秀であったとしても、経験とチーム人数
そのようなアプリケーションと比べると、
がいれば、動くだけのアプリケーションを作ることができます。
スマートフォンのアプリケーションは、デザインやインタフェース


また画面設計などで飛び抜けた能力がある技術者がいれば、よいアプリケーションが作れるかもしれません。しかし、

Bluetooth low energyのハードウェアや、それと通信するソフトウェアは作れたとしても、

部署の壁、
自社の家電すべてをわちゃっと。役員プレゼンテーション。鶴の一声。冷蔵庫、扇風機、照明。あらゆる電化製品。更に遠く、ぱっと見
つかわなくてもいい機能ですが、本当に使わない機能になっています。
開発者の中では、わかる。一般発売、アプリケーション、デザイン、コーディング。不適切、経験がない、自己満足。




Bluetooth low energyの利用場面を大きく3つに分類しました。事業化の過程でこの利用分野を勘違いするとどうなるかを見てみます。

アプセサリの体験は、たとえ頭で理解していても、実際に体験しなければわからないものです。また、アプセサリを構成するハードウェアという部分は、形が目に見えるだけに誰でもなにかしらの意見を言える部分でもあります。しかし、ハードウェア部分だけをみて、よかれと思われる改良をすると、体験を損なうことが、よくあります。














### 事業化と筋違い
導入時期、ハードウェアのライフサイクル、償却
サービス、特許知財、
開発組織、



見てもわからない。口コミ、ぐぐらびりてぃ、評価。
ユーザのつながりを通じて、普及初期にはとくに収束、一般への広告、
素性が良いならば、あとはお金の問題

ネットワークタイプ
アカウントが必須、売り方はいろいろ。ぱっとみわかりにくい、使ってみないと良さもわからない。

売上、アカウント数、1日に利用する人の割合、利用ユーザの課金率、課金単価
アクションに繋がりにくい、問題発見にあること。実際の行動、誰がいつどこで何を行動したか。
笑顔かどうかがわからない。
外部要因が大きい。
アカウント数を伸ばしていく、継続して遊んでもらえるように工夫するなど、それが結果として売上に。形がない情報産業、知識や情報を扱う産業分野では、KPIが売上をもたらす。



同じようなハードウェアでも、2次、3次に分類。しかし1次で利用することもできるだろうし、同じハードウェアでも意味や価値が異なる。






利用分野、ぶれ。
価値がなにか。
家庭用、リモコン、制御、手動、
業務用、売上、制御、自動化、成果がわかるもの。エネルギー消費量、行動、顧客。

企画段階でのブレ。

常時使わなくても良い、常時使わなければならない、
アプリケーションを常に起動、ユーザが操作、バックグラウンド、設計、
企画を作る、メンバー
開発メンバー
組織
サービス、アプセサリ、追加機能、がっかり

参入時期、の設定。早すぎても遅すぎてもダメ。
ユーザの期待とその中身
どっちつかずのがっかり勘。

事業化で見られる判断の誤り。

技術に価値はない。
適切な使用料金と交渉、のもとで、寡占されると、産業全体の停滞を招きかねません。
権利化は重要ですが、専有はできません。
量産の時代、工場を建てて、資本回収するまでの時間、15年。情報の流れ、ドッグイヤーといわれる10年で1世代が交代する、1年程度。
BLEの通信規格、それと同じ。ブランドでもあり、資本回収のための仕組みでもある。それはそれ。

雑談が出来る場所。部署の都合など、事業者の都合。
ゼロから作り出す、微妙なニュアンス。成熟した能力の先にあるものであり、それを使うことではない。
完成度が高いハードウェアは重要だけど、
事業部制、本社に研究開発部門を設置して、権限を与える、あるいは
経営幹部育成のための社内ベンチャーとしてではなく、最初から資本を出して子会社として分離する。

例えば、フィットネス・サービスはそれ自体で1つ会社が作れる事業規模。
運用を、部門で行うような仕事ではない。連携すること。次の製品は? アプセサリとしての事業。
閉じた世界でもないかもしれない。

過程で生じるもの。組織自体が変えてしまったほうがいいかもね。

moreはlessに劣る。
説明書を読む時代ではない。

ハードウェアに目が行くこと。考え方が、根本、利用規定、
ネットワーク・サービスの性質、グローバル。その土地への仁義。

20世紀では違う、携帯電話の中で閉じて垂直統合というのではなく、ネットワークに開かれている、会社の枠を超えている。













Bluetooth low energyの利用分野は、多種多様です。たとえ機能が同じハードウェアでも、それと組み合わせる人と時間と場所で、だれがいつどこで使うかという無数のストーリがあり、それぞれのストーリーごとにもたらされる価値を作り出せます。

情報は貨幣とちがって、その人を含む、いわばその人自身の一部。とてもプライベートなもの。取引していいものではない。

統計と処理と蓄積。
プライベートとパブリックの境目を越える可能性。
自分のデータ、身近、より切実、具体的。

知的財産。ちゃんと取引をしているのに、法外な要求で実行できない。
知的財産、産業の発展のため。停滞しているならば、実施。サービス、1年単位、速度が違う。

データが影響するもの、
機器操作、データ収集、人間が目にするもの、自動化それ自体に意味はなく

業務向け、一般的な経理、あるいは連携することが全体の価値。
しかしRFID。最初に出荷するところが負担、それを価格に転化できるか? 
共通仕様は。ハードウェアだけではなくて、データベース。
読み取り装置、データベースが異なれば。ハードウェア的な積み上げからの発想が招く、ロックアップ。ジャンプ。
全体がだれでも使うならば、一気に切り替わる。その仕組でよいならば。連携するならば。
会計ソフト、帳簿管理、在庫管理、パソコン黎明期に登場した利用場面。
旅費精算、
また、税務会計のように決められた手順に従った処理、定型でなくてはならず、どの会社でも共通して行う仕組み。
規模の事業。
逆にシステムを開発してメンテナンスするコストが高いならば、共通化した何処かに任せてしまうべきとも言えます。
手間賃による定型処理。それ自体が直接価値を生み出さないが、事業には必要ななにか。
それ自体が連携することで価値を産み出す何か。しかし、競合他社が切り替えないならば、必要はない何か。

経営での利用。
明確な理由があって。ネットワーク、局部で導入。
価値のつながり、流通。2次元バーコード。RFIDではなく。
差別化、事業と密接に連携して、それ自体は外部に出ることはない。ノウハウと連携した、技術が実現可能にするタイプ。

利用者、個人所有デバイス、周辺機器
体重計、家族で共有、個人持ちに特化、

産業革命以来続いてきた生産機械と労働集約による大規模製造の時代では、ヒト・モノ・カネの3つの要素をより大規模に扱うため、社会は大きな組織を求めてきました。しかし、ヒト・モノ・カネに、情報という4つ目の要素が掛け算されるアプセサリの時代では、その仕事を担う組織は必ずしも大きな組織であるとは限りません。




投資、製造サービス、クラウドファンディング

クラシックBluetoothでは、無線モジュールの製造会社が顧客向けのカスタマイズを行い納品しています。これは、クラシックBluetoothはプロファイルが決まっていて、独自の振る舞いをさせることはなく、カスタマイズの内容が音量ボタンを設置したいなどの単純なものだからです。また納品数量が何十万台もの桁なので、カスタマイズの経費は売上から回収できます。

しかし、Bluetooth low energyは、無線モジュールに入っている通信を制御しているマイクロ・コントローラーに、製品のアプリケーションまで実行させます。そのため、その開発の量と複雑度は、クラシックBluetoothのカスタマイズとは比べものはなりません。大規模な無線モジュールの製造会社が、Bluetooth low energyの設計製造をサポートする例はありません。

試作はハードウェアとアプリケーションそしてネットワーク・サービス開発者が、いつも同じ場所にいて雑談が出来る環境を作ります。アプセサリの事業のための試作は、常にアプセサリとして全体をみたときの価値を感じて進めなければなりません。そのため、常に同じ場所でお互いの顔を見ながら、互いの仕事を連携させていくことが不可欠です。そうでなければ、ハードウェアやアプリケーションといった、担当部門の局所最適に陥ります。

広告モデル、
ユーザが産み出すデータやアプリケーションの利用状況、通信状況、
ソーシャル・ゲーム、アプリ内課金
カーナビゲーション、ハードウェア、アプリケーション、
ハードウェアの販売を利益、サービスを利益、

では、iOS と Bluetooth low energy の今後はどうなるでしょうか。それは予測できませんが、Apple社が関わらない分野と、Apple社がつくり上げる分野にわけてみます。


一方で、Apple社はiOSデバイスと連携する独自の領域を作り始めています。HealthKitは健康データの収集と集約を、HomeKitはあらゆるスマートな家電とiOSデバイスとを連携します。

Bluetooth low energy の使い方は、データ収集 (入力)と、外部装置の操作 (出力)の2つに、大きく2つに分けられます。HealthKitとHomeKitは、ちょうどその2つに対応しています。

HealthKitとHomeKit、この2つのサービスは、1つのネットワーク・アカウントに、様々な個人情報と家電の操作権限を結びつけます。したがって、ネットワーク・アカウントとその個人情報を守るために、強固なセキュリティの確保とプライバシーの保護が求められます。

Apple ID と iCloud を通じて、決済とコンテンツ購入そして写真などのユーザ・データのアーカイブを提供してきたApple社が、このようなサービスを提供するユーザ・アカウントを提供できる会社であるのは、たしかでしょう。

あらゆる個人の権限とデータがネットワーク・アカウントに集約し蓄積する時代になれば、購買などの人間の活動の多くがネットワークを通じて行われます。ユーザ・アカウントを提供管理する会社は、コンテンツを提供することで、また購買手続きから手数料を得ることができる立場になれます。

手数料という大きな利益は、より信頼できるクラウド・サービスや魅力的な新たなサービス開発の原資となります。このループは、規模と質を向上させながら10年は継続していくと思われます。





後戻りできない、設計の最初。更新すらセキュリティの穴。長期間、過去から未来。かなり熟練の、穴は塞ぐ。
パートナー。時間、公開秘密。とりあえず動く。インターネット連携とかあとでいくらでも。

相関、気づくには。画面を見るもの。おそらく、家のパネル。NG。スマフォ。電子メール。アプリ。通知。
必ず確認したと、ハード、その場でしかリセットできない。とか。警備会社との連携、サービス化。
遠隔、BLE、物理的に。中継装置。
初期設定、ソーシャル、
リモコン。ただのアプリ化。
初期設定。豊かなUI、ネットワーク接続、初期ユーザ設定。カメラ、QRコード、アプリケーション。
新しい? いままでなかった。必要はない。体験として新しい。

個人、ソーシャル。

そういったデバイスがある前提。見守りサービス。専用ハード。ポット、意識せる。

プロトタイピング、
誰がどこでいつどのように使うのか。

物理的に可能。結果がすべて。概念が重要。
価格、営業、立場。
仕入れと販売。掛売、かけかい。帳簿の話。






iBeaconはMFiプログラムで提供されています。iBeaconへのMFiプログラムは、少しユニークです。

まず、iBeaconに限定したMFiプログラムが用意されました。それまで、iOSデバイスと連携する周辺機器開発が1つのMFiプログラムとなっていました。そのためにMFiプログラムには厳正な審査があります。ですが、iBeaconだけに限定されたことで、様々な会社からiBeaconのビーコンが販売されるようになりました。

このMFiプログラムの形態は、意図したものかどうかはわかりませんが、iBeaconが広まった経緯に沿うものでした。

2013年9月にiPhone5sが発売された頃から、一般でiBeaconが話題になり始めました。この時点では、Apple社がiBeaconのビーコンを販売するのか、あるいはMFiプログラムを提供する予定があるのかすら誰も知りませんでした。ですが、iOSという広く普及したプラットフォームの、新しい位置と近接技術の可能性に、行動を起こした人たちがいました。

ビーコンが送信しているアドバタイジング・パケットのデータ形式は単純で、すぐに解析できるものでした。2014年11月ごろから、いくつかの会社がそれぞれ独自に、解析した情報を元にiBeaconで利用できるビーコンを作り発売を開始しました。

そして、2014年2月にiBeaconのMFiプログラムが発表されました。ですが、MFiプログラムがiBeaconに限定されていたことで、それまでの周辺機器とは異なり、迅速な審査と技術情報の提供がなされたことで、すでに販売を開始していた会社は混乱なく、MFiプログラムに参加していきました。

iBeaconという技術は、Apple社だけでは広めることができな技術です。まず多種多様な利用場面にあうビーコンが必要です。MFiプログラムがあることで、それぞれの会社がそれぞれの利用場面ごとに、技術仕様に準拠してビーコンを提供しました。また、いくつかの会社が競い合うことで、ビーコンの利用場面がアプリケーション開発者の広く知るところとなり、また使いやすい開発環境や安価なビーコンの提供が急速に整いました。

iBeaconは、まだこれから活用が始まる技術です。ちょうどiOS5がCoreBluetoothを提供してから2年後に、Apple社がBluetooth low energyを利用し始めたように、例えば地図の屋内位置検出への統合のような、Apple社のiBeaconの活用は、2015年以降になるのでしょう。

iBeaconの電波が届く範囲は、アンテナを工夫したり送信電力を設定して、数センチメートルから50メートル程度まで調整できます。







### iOSの Bluetooth low energy 活用

iOSが Bluetooth low energy に対応してからの2年間、iOS5およびiOS6まで、iOS自体は Bluetooth low energy を全く利用していませんでした。この間、Bluetooth low energy は、一部の開発者や周辺機器開発で話題になっていただけでした。

Bluetooth low energy を用いた独自技術やサービスが、アップル社が毎年開催する開発者向けイベント Worldwide Developers Conference（ワールドワイド デベロッパーズ カンファレンス、WWDC) に初めて登場したのは、iOS5 が登場してから2年後の iOS7 からです。

これは、Bluetooth low energy という新技術を意識しなくても、ユーザのどの iPhone でも新しい体験ができる状況になるまでに、2年が必要だったのでしょう。

日本の携帯電話会社は、契約期間を2年間とすることで月額料金を大幅に割引するプランを提供しています。このとき、iPhoneユーザは最新機種によく買い替えます。また、2年間で iPhone5 および iPhone5s が発表されると、世界ではじめて Bluetooth low energy に対応した iPhone4s が、携帯電話会社が扱う最も古い機種となりました。

Bluetooth low energy は通信規格ですから、通信には必ず通信の相手が必要です。iOSは、通信相手となる Bluetooth low energy に対応した iPhone が十分普及した時期にあわせて、新技術の利用をはじめたのでしょう。






Blueooth Low Energyには2つの役割、セントラル・ロールとペリフェラル・ロールがあります。Bluetooth low energyのネットワークは、1つのセントラル・ロールの機器に、複数のペリフェラル・ロールの機器がつながる、スター型です。通常は、iOSデバイスがセントラル・ロール、周辺機器がペリフェラル・ロールになります。

iOS5ではじめて Bluetooth low energy に対応したときは、セントラル・ロールのみに対応していました。その翌年のiOS6では、ペリフェラル・ロールにも対応しました。さらにiOS7およびiOS8では、Bluetooth low energy を使うキーボードへの対応や、HomeKitをはじめとするiOS独自の技術が追加されています。

周辺機器と接続するときは、iOSデバイスはセントラル・ロールになります。1つのセントラルに同時に接続できるペリフェラル数は、規格では上限は6万以上で実質上限はありません。ですが、iOSデバイス自体の制約で、同時接続の上限は10です。

すでに10台のペリフェラルと接続していても、ペリフェラルの発見はできます。ですが、11台目への接続要求は失敗します。

iOSアプリケーションは、画面に表示されていない状態でも、ある限られた処理ができます。この状態をバックグラウンド状態と呼びます。バックグラウンド状態のアプリケーションは、何か外部からイベントがあれば、iOSから、そのイベント通知とアプリケーションの実行時間をもらえます。

iOSアプリケーションのビルド設定で、セントラル・ロールのバックグラウンド・モードを有効にすると、バックグラウンド状態でも周辺機器との無線接続が維持されます。周辺機器から値の変更通知を処理できます。

周辺機器を発見するスキャンは、バックグラウンド状態でも継続します。ただし、消費電力を低減するために、スキャンの頻度は10分に1回程度と低くおさえられます。

iOSアプリケーションで、リモコンなどの周辺機器の機能を提供、あるいはアドバタイジング・パケットを送信するときは、アプリケーションをペリフェラル・ロールにします。

ペリフェラル・ロールにもバックグラウンド・モードがあり、これを有効にするとバックグラウンド状態でもセントラルとの接続が維持されます。

iOS6では、iOSアプリケーションで、マウスやキーボードなどの HOGP [^1190] ( HID [^1180] Over GATT Profile ) に対応した入力機器の機能を提供できました。しかし、iOS7でHOGPがサポートされて、一般アプリケーションからは、HOGPのサービスに触れられなくなったため、iOS7位光はHOGP相当の機能をアプリケーションで提供することが、できなくなりました。

[^1180]: HID は Human Interface Device の略語で、マウスやキーボードなど人間が使う入力装置を指します。

[^1190]: [HID Over GATT Profile (HOGP) , https://developer.bluetooth.org/TechnologyOverview/Pages/HOGP.aspx](https://developer.bluetooth.org/TechnologyOverview/Pages/HOGP.aspx)









HealthKitが発表されてから1年が経ちますが、HealthKitへの対応の動きは、まったくといっていいほどありません。

その理由を、フィットネス分野のアプリケーションを例に見てみます。スマートフォン以前から、運動強度の測定の習慣が根付いているフィットネス分野は、Bluetooth low energy対応の心拍センサーと対応アプリケーションが急速に普及しています。

アプリケーションが提供するのは、ユーザの体験です。そのために心拍値は必要な情報ですが、逆に心拍値が取得できただけではユーザの体験にはなりません。

例えばランニングであれば、運動中に音声ガイドで運動強度のアドバイスをだすことで適切な運動が自動的に達成できます。また、GPSでランニングコースおよび速度を記録して、心拍値と合わせて解析することで、次回へのアドバイスの提供もできます。

このような魅力的なアプリケーションの開発には、費用がかかります。その費用は心拍センサーの販売利益から出ています。

心拍センサのプロファイルは Bluetooth SIG で採択されているので、心拍センサーとアプリケーションは、それぞれ別の会社の製品を組み合わせて使うこともできるはずです。ですが、ユーザは、快適に問題なく利用できる安心感と信頼感から、アプリケーションと同じロゴがある心拍センサーを購入します。

このような、製品とアプリケーションとが組み合わさって初めて本当のユーザ体験がもたらされる分野では、心拍センサーという製品の販売利益で、アプリケーションが開発され、そのアプリケーションが提供するより素晴らしいユーザ体験が、、ユーザがその会社の製品を選んで購入する理由になります。この魅力とお金の循環が、心拍センサーの急速な普及の原動力なのです。

すでに構築されたこの循環に、HealthKit が入り込む余地はありません。

もしも、アプリケーションがHealthKitに対応したとします。そうすると、ヘルス・アプリで心拍センサーとの接続とデータ取得設定を行って初めて、フィットネスのアプリケーションが使えるようになります。これまで1つのアプリケーションで完了していた操作が、2つのアプリケーションにまたがるのは、ユーザにとって大きな手間になり体験を大きく損ないます。

また、もしもユーザが、ヘルス・アプリで接続さえしてしまえば、フィットネスのアプリケーションが使えるのだと思うようになると、これまでのアプリケーションと製品の関連付けが切れてしまい、アプリケーションを無料で提供することはできなくなります。

これは、製品とアプリケーションとの対応づけで作られていた信頼感が、ヘルス・アプリに取って代わられることになります。こうなると、フィットネスの会社には、心拍センサーという製品販売から、サービスやフィットネス体験などのソフトウェアから利益を出さなくてはならない、大変革が必要になります。

Bluetooth low energy 対応機器に対応するほどの手間はかけられないが、もしも手軽に値が利用できるなら利用したいアプリケーション、例えば心拍と演出が連動するゲーム・アプリケーションのような、であればHealthKitを使う理由になります。

また、将来の疾患の可能性や生活改善のためのヒントのような、新しい解析手法などでデータから価値を取り出せるアプリケーションには、HealthKitは大きな価値を持ちます。

例えば、解析にはある程度のデータ量が必要だとします。これをアプリケーション単体で提供すると、アプリケーションがデータを蓄積するまでの間、ユーザに待ってもらわねばなりません。長期間、結果も得られないのに待つユーザは少ないでしょう。蓄積データが利用できるならば、即座に結果をユーザに返すことができます。

このように、HealthKitは、アプリケーション提供者がBluetooth low energy機器それ自体には興味がないが生体情報の利用には興味がある場合、アプリケーションを超えてデータを共有する利用場面に価値がある場合、あるいは、蓄積されたデータに価値を見出す場合には、有効です。¥




またBluetooth Smart機器は、
iOSやAndroidなどの特定のプラットフォーム
に縛られない周辺機器の開発が可能になったことで、フィットネス機器などの会社の参入が始まりました。

単体で独立した機器ではなく、
センサーの拡張、
iPhoneでは持ち歩きできない、不便さ、ウェアラブル機器、メガネや腕時計などの、単体

ですから、カスタム・プロファイルに対応したiOSアプリケーションが通信相手になります。このハードウェアとアプリケーションの強い結びつきから生まれる体験が、アプセサリという造語を生み出した理由です。



クラシックBluetoothと異なり、Bluetooth low energyは、機器との接続や切断などの通信や機器とのやりとりをアプリケーションが把握するので、ユーザに無線通信を意識させません。また、機器とアプリケーションが1対1対応でしばられません。ですから、ハードウェアの製造販売の会社が、販売台数を増やす目的でそのハードウェアの仕様をアプリケーション開発会社に広く公開することもできます。







万歩計、
データを共有、目標、グラフ、ソーシャルメディアを通じて仲間と成果を共有、
スマートフォンを通して、ウェブサービスと統合、


iOSが早くから Bluetooth low energy に対応したおかげで、

アプセサリは、アプリケーションが持つ高度な表示、蓄積、解析、通信と組み合わせるもので、これまでにない可能性を秘めています。

アプセサリを使うことで、これまでアプリケーションだけでは実現できない新しい利用場面が広がります。アプセサリというハードウェアで、アプリケーション販売とは異なる収益体制が組めます。アプセサリを通じて、これまでに実現できなかった新しいサービスが可能になります。

アプセサリの急激な盛り上がりは、iOSのソフトウェア開発環境とアプリ・ストアが一般解放されたばかりの時期の、iOSアプリケーション市場の盛り上がりを思い出させます。

しかし、アプセサリは不可能を可能にする万能の魔法ではありません。アプセサリは、これまで見てきた Bluetooth low energy やiOSなどの技術を手段としてつくり上げる、ものです。

ここでは、アプセサリとはどんなものかを見ていきます。







### 通信規格の役割

無線通信規格がなければ、無線通信は成り立ちません。

あたりまえのことですが、1つの機器だけでは通信はできません。通信には必ず2つ以上の機器が関わります。2つの機器が電波で通信するためには、情報の伝え方や表現など膨大な取り決めが必要です。その取り決めを提供するのが、Bluetooth をはじめとする無線通信規格です。

また、無線通信技術には、高周波回路素子や半導体素子などのハードウェアから、通信を制御するソフトウェアやアプリケーションまで、数多くの構成要素が必要です。無線通信規格にある仕様どおりに、それぞれの構成要素をそれぞれの会社が製造して組み合わせることで、初めて使える無線通信技術になります。

Bluetooth low energy は、一般に利用される無線通信技術を提供する規格です。これは、通信のための3つの仕組みを提供します。

1. 電波でデジタル信号を表現する方法
2. 付近にある機器の発見と通信
3. データの意味づけと機器の振る舞いや機能の定義

一般利用する無線通信技術には、通信できるだけではなく、さらに次の仕組みが重要です。

1. 電子レンジや他方式の無線通信との共存
2. 他のBluetooth low energy機器との共存
3. セキュリティの確保とプライバシーの保護

まず、2.4GHz帯は電子レンジやWi-Fiその他の無線通信も利用しています。ですから、同じ周波数帯を使う Bluetooth low energy が、他の無線通信を妨害したり、逆に他の機器の影響をうけて通信ができなくなりにくい工夫が重要です。

さらに、Bluetooth low energy は身の回りのものに内蔵する無線通信技術です。ですから、例えば一人が1つの機器を持っているだけでも、街の雑踏では、電波が届く半径50メートル範囲内には何百人もの人がいます。それらの多数の機器が通信をしていても、他の機器の通信を阻害しない工夫も重要です。

また、セキュリティの確保は、無線通信技術を信頼してもらうための最重要課題です。セキュリティとは、通信を通じた情報の盗み取りや、悪意ある制御を引き起こす不正アクセスから、機器を守ることです。

無線通信技術のセキュリティ確保は、チャレンジングな課題です。いま受信した電波が、どこから送信されているのかを知ることはできません。ですから、電波だけから通信相手が既知の信頼できるものかは、わかりません。

さらに、Bluetooth low energyの無線通信規格は一般公開されていますから、だれでも規格を入手してその内容を知り尽くすことができます。また、Bluetooth low energy の電波を送受信する開発者向け機材ですら、通信販売で誰でも安価に入手できます。

ですから、悪意があり技術も道具もある実行能力がある侵入者を想定しなくてはなりません。また、暗号化処理を複雑で高度なものにするほど、より大きな回路規模つまり製造費用と電力消費につながります。

Bluetooth low energy の電気回路は安価であることも重要ですから、安価かつ十分にセキュリティを確保するバランスのよい技術が求められます。

そのうえ、Bluetooth low energyは人が身につける機器、いわゆるウエアラブル機器にも使われる技術です。特定の人が特定の電波を送信する機器を身につけるため、その機器からの電波で誰がそこにいるかが検出されると、プライバシーの侵害を引き起こすかもしれません。

### 周辺機器のための通信規格の役割

Bluetooth low energy は、キーボードやヘッドセットをはじめとした多種多様な周辺機器のための無線通信規格です。ですから、この規格は、無線通信できるだけではなく、無線接続した機器が期待した動作をすることまで規格化しなければなりません。

パソコンで使われる無線LANであれば、無線ルータとパソコンとの間の無線通信を提供するだけで十分です。電子メールや動画視聴などのネットワークサービスは、パソコンのアプリケーションが処理するので、ネットワークサービスまで規格化する必要がありません。

周辺機器は、目的に応じて設計された、それ単体で機能するものです。ですから、パソコンのように万能の装置ではありませんし、またユーザがアプリケーションをインストールするようなものではありません。

クラシックBluetooth は、ヘッドセットやキーボードといった機器ごとに、通信と機器の振る舞いをセットにして細部にいたるまで規格化していました。そのおかげで、Bluetooth のロゴがあれば、何年も以前に発売された製品でも、安心して利用できるのです。

ところが、Bluetooth low energy は多種多様なもののための通信規格なので、具体的にどのようなものに使われるかは限定できません。そこで、Bluetooth low energy は、サービスとキャラクタリスで構成されるデータベースの仕組みを提供しています。

このデータベースにどのような意味があるデータをどう定義するのか、そしてデータベースの読み書きと機器の振る舞いはどう対応するのかの定義は、プロファイルと呼ばれ規格とは分離して定義が与えられています [^1100]。 

[^1100]: [Profile Overview, https://developer.bluetooth.org/TechnologyOverview/Pages/Profiles.aspx](https://developer.bluetooth.org/TechnologyOverview/Pages/Profiles.aspx)

この規格とプロファイルの定義とを分離したことで、Bluetooth low energy は、新しい機器が登場するごとに新しいプロファイルを追加できます。











376ビットなので、1回あたりの送信時間は最大でも 376 マイクロ秒と、とても短い時間です。
パケットの最大長は376ビットなので、1回あたりの送信時間は最大でも 376 マイクロ秒と、とても短い時間です。

Bluetooth low energy の無線通信技術は、1ビットの情報を1マイクロ秒( $ 1 * 10^-6 $ 秒)で送信します。つまり、物理層のビットレートは、1 Mビット/秒 ( 1 * 10^6 ビット/秒 )です。パケットの最大長は376ビットなので、1回あたりの送信時間は最大でも 376 マイクロ秒と、とても短い時間です。

Bluetooth low energyの典型的な半導体チップは、電源電圧が 1.8 ボルト、送受信動作中に 10 ミリワット から 20ミリアンペア の電流を消費します。仮に、1秒に1回パケットを送信するとすれば、平均消費電流は 8 マイクロアンペア (1マイクロアンペアは $ 1 * 10^-6 $ アンペア) になります。













[^1100]: 2.4GHz帯高度化小電力データ通信システム の技術基準は出力電力を、Bluetoothが採用する周波数ホッピング方式 で 3 mW/MHz、無線LANが採用する直接スペクトラム拡散方式で 10 mW/Hz としています。







ですが、このチャンネルの工夫があっても、同じチャンネルで同時に通信が行われて、送信したい情報が相手に届かない時があります [^1110]。さらに、機器が移動したり、パソコンや電子レンジの電源が入れられたりして電波状況が変化して、今まで通信ができていたチャンネルでも通信ができなくなることもあります。

[^1110]: Bluetooth low energyには、電波を送信する前に、そのチャンネルを受信して他の無線通信が行われていれば送信をとりやめる、キャリア・センスの仕組みはありません。

そこで、一定時間ごとにチャンネルを切り替えていきます。あるチャンネルで通信ができないのに、すぐ隣りのチャンネルに切り替えても、やはりそのチャンネルでも通信ができない確率は高そうです。そこで、チャンネルをいくつか飛ばして飛び跳ねるように切り替えていくので、周波数ホッピングと呼びます。


適応周波数ホッピング方式を使うことで、たまたま無線LANの通信と重なり通信ができなくなっても、Wi-Fiと重なっていないチャンネルに切り切り替われば、通信が再開できます。またWi-Fiにとっても、もしもBluetoothの影響で通信が乱れることがあっても、チャンネルを切り替えていくので、その状態がずっと継続することはありません。










最低値は10マイクロワット(マイクロは100万分の1)で、空中線電力は



なぜ2.4GHz帯を使うかといえば、この周波数帯が、周波数帯の割り当て申請やライセンスの取得をしなくても、世界の多くの国で使用できる周波数帯だからです。

電波は国が管理する公共の財産で、それぞれの国ごとに国が法律を作り免許制度のもとで管理運営しています。どの周波数帯をどの用途に割り当てるか、また事業者への免許発行は、すべて国が行います。

この2.4GHz帯は、国際的な組織 [国際電気通信連合 (ITU)](http://www.itu.int/) [^1090] で、電波を無線通信以外の産業・科学・医療に高周波エネルギー源として利用するために割り当てられた周波数帯です。加盟各国はこの割り当てに従っています。

[^1090]: [http://www.itu.int/](http://www.itu.int/)

携帯電話の基地局やWi-Fiのルータのように、大きな製造コストと消費電力が許される機器には、アンテナを複数もうけて、回路技術でアンテナの指向性を最適な特性に調整する技術を搭載するものもあります。これはしかし、安価に製造したい Bluetooth low energy には必要を超える技術です。

無線通信には、電磁波のやりとりがよく使われます。電界と磁界が振動しながら空間を伝搬する波を電磁波と呼びます。そのうち、周波数が 3THz (テラヘルツ) 以下の電磁波を電波と呼びます。

Hz(ヘルツ)は周波数の単位で、1Hzは1秒あたり1回の振動です。周波数はよく大きな値になるので、単位Hzの前に桁を表す接頭辞をよくつけます。T(テラ)は、 $ 1 * 10^12 $ を表す接頭辞です。

電磁波が真空中を伝わる速度は $ 3 * 10^8  メートル/秒 $ なので、最も周波数の高い電波 3THz は波長 0.1 ミリメートルの波になります。人間の目に見える可視光も電磁波ですが、可視光の波長は 500 nm  (ナノメートル、ナノは $ 1 * 10^-9 $ を表す) 、 0.0005 ミリメートル  くらいです。

現在の回路技術では、3THzの電波の送受信はとても高度な技術で、まだ日常で利用できるようなものではありません。一般で使われているBluetoothやWi-Fiは、2.4GHz帯や5GHz帯を使っています。G(ギガ)は、 $ 1 * 10^9 $ を表す接頭辞です。


電波は目に見えなくて、とらえどころがありませんが、理解する必要はありません。送信側が、高周波信号を送信回路からアンテナに入力すると、アンテナから空間に電波が波として広がっていきます。その電波が受信側のアンテナに届くと、それが高周波信号になり受信回路に入り、信号が伝わります。そんなものか、という感覚的な把握で十分です。


## それぞれの技術とその利用場面

クラシック Bluetooth3.0までの技術は、より高速な通信をより小さな電力で提供することです。その利用分野は、通話や高音質な音楽を聞くためのヘッドセットや、テザリングのような通信、あるいはファイル交換などです。LANケーブルやオーディオケーブルなどの有線接続を無線化するために発展した技術と言えます。

Bluetooth low energy は、身の回りにある些細なものに無線機能を付加する技術です。そのために必要とされたのが、超低消費電力と、ものが持つ多様なデータの表現能力です。

超低消費電力は、電池交換頻度を実用範囲にするためと、機器の外観を実用にするために必要です。

仮に Bluetooth low energy を搭載した機器が、身の回りに100個あったとします。もしも電池が1週間で切れてしまうならば、1日に約14個の充電あるいは電池交換が必要になります。実用ではありません。もしも電池が5年間で切れるならば、電池交換は18日に1回になります。また5年利用すれば破棄して新しい機器に買い換えるかもしれません。その場合には電池交換することもありません。

また、外観やデザインを満たそうとすると、回路や電池に許される物理的な形状や容積は小さなものになります。腕時計型であれば丸く薄い形状が求められますし、メガネ型であればレンズを耳に固定するツル部分に収めることになります。

電池の容積の大きさは、そのまま電池容量の大きさです。ですから、電池の交換や充電頻度が適切な程度になる電池の大きさと、その電池を内蔵する外観デザインとが両立する点を見つけなければなりません。

超低消費電力であればあるほど、電池容積が小さくできるので、外観デザインの自由度が高まります。

ものが持つ多様なデータの表現能力は、多種多様な機器を生み出すために不可欠です。

Bluetooth low energy は、多様なものの情報を格納するデータベースを提供する、ジェネリック・アトリビュート・プロファイル (Generic Attribute Profile、GATT) という仕組みを持っています。

GATT は、ものの機能をサービス、機能の中にあるセンサーや制御目標などの値をキャラクタリスティクスという概念で表します。1つのキャラクタリスティクスにはいるデータ量は最大でも512バイト<!--TBD-->です。

例えば、電池を内蔵した機器であれば、バッテリーサービスを備えています。バッテリーサービスの中にある、バッテリー残量を表すキャラクタリスティクスを読み出すことで、その残量がわかります。また、残量が変化すると、データベースから値の変化をプッシュしてもらうこともできます。

つまり、Bluetooth low energy の本質は、データ変化などのイベントごとに、小さなデータをやりとりして、ものが持っているデータベースと読み取り側とでデータを同期する無線通信技術と言えます。

このようにクラシックBluetooth とBluetooth low energy は利用分野が違います。ですから、Bluetooth low energy 機器の企画立案などでは、クラシックBluetooth での体験は邪魔な先入観でしかありません。

例えば、Bluetooth low energy には音声通信の規格はありません。通話に使われるヘッドセットのプロファイルがあるクラシックBluetoothであれば、すでに部品が通話機能を備えているので実装は容易かもしれませんが、それと同じことを Bluetooth low energy で実現しようとすると、その通話部分の技術を自分たちで実装しなくてはならなくなり、結果として大きな費用が必要になる場合もあります。
































### Bluetooth low energy と iOS

新しい無線通信技術が登場すると、その通信相手があるのか、が話題になります。

通信には必ず通信相手がいます。ですから、新しい通信技術を搭載した装置それ自体が安価であっても、その通信相手となる装置も買い換えないといけないとなると、それなりの費用とシステムの再構築のような手間がかかります。

Bluetooth low energy には、iOSがいました。

2010年に規格化された翌年2011年に発表された、iPhone4s は世界ではじめて Bluetooth4.0 に対応した端末となりました。また同時に公開された iOS5 は、Bluetooth low energy を一般アプリ開発者に開放しました。

この iOS の Bluetooth low energy の対応が、新技術普及に不可欠な3つの要素:

1. 新しい無線通信技術を採用した魅力的な周辺機器
2. その周辺機器が通信する端末
3. 周辺機器と連携する魅力的なアプリケーション群

を一度に提供したのです。

とくに、iOSアプリケーション開発にとっては、Bluetooth low energy で接続通信するフレームワーク CoreBluetooth が一般開発者に公開されたことが大きな出来事でした。

それまでは iOS デバイスの周辺機器およびその連携アプリケーション開発には、Apple社と [Made for iPhone (MFi)プログラム](https://developer.apple.com/jp/programs/mfi/) [^1030] という秘密保持契約を締結して初めて、開発に必要な情報や開発キットの提供を受けられました。契約対象の会社であると審査が通るのかなどの壁がありました。

[^1030]: [https://developer.apple.com/jp/programs/mfi/](https://developer.apple.com/jp/programs/mfi/)

ところが Bluetooth low energy については、MFiプログラムに関係なく、どのような Bluetooth low energy 機器ともiOSアプリケーションが接続できるようになりました。

これにより、iOSアプリケーションと連携するユニークな周辺機器を製造する会社が登場したり、Bluetooth low energy対応の脳波や脈拍センサーに連携するiOSアプリケーション群が登場しました。

ただし、これは一般的な Bluetooth low energy を採用した機器についてのみ当てはまります。Bluetoooth3.0 までの高速通信ができる Blueooth技術を採用する周辺機器の開発には、従来と同じくMFiプログラムが必要です。

また、無線通信技術に Bluetooth low energy を使っているものでも、次の節に登場する iBeacon や HomeKit などの、Apple社の所有する技術を使うものはMFiプログラムの対象になります。

### iOS にとっての Bluetooth low energy

iOSはいち早く 
Bluetooth low energy への対応は、iOSだけではなく Android や WindowsPhone また Windows8 などでも進められています。

このような周辺機器以外に、iOS それ自体が Bluetooth low energy を利用する独自技術を持っています。

2013年に公開されたiOS7では、次の2つの機能が実装されました:

- iBeacon
- Apple Notification Center Service

[iBeacon](https://developer.apple.com/ibeacon/) [^1039] は、Apple社の新しい位置と近接の検出技術です。MFiプログラムの対象です [^1040]。

[^1039]: [iBeacon https://developer.apple.com/ibeacon/](https://developer.apple.com/ibeacon/)

[^1040]: [iBeacon for Developers https://developer.apple.com/ibeacon/](https://developer.apple.com/ibeacon/)

iBeaconは、Bluetooth low energyのデバイス発見につかうアドバタイズメントという仕組みを利用して周囲に識別子情報を送信しつづけるビーコンと、そのビーコンをフォアグラウンドおよびバックグラウンドで検出するiOSを組み合わせたものです。

衛星からの電波が届かない屋内衛星からの電波が届かない屋内でも、屋内にビーコンを設置することで、おおよその現在位置を検出するGPSを補う技術として利用できます。また、識別子を設定したビーコンを配置させて、特定の位置でiOSアプリケーションを起動させることができます。

[Apple Notification Center Service (ANCS) ](https://developer.apple.com/library/ios/documentation/CoreBluetooth/Reference/AppleNotificationCenterServiceSpecification/Specification/Specification.html) [^1050] は、iOSデバイスのロック画面に表示されている通知情報を同期する技術です。ANCS自体は、MFiプログラムの対象ではありません。

[^1050]: [Apple Notification Center Service https://developer.apple.com/library/ios/documentation/CoreBluetooth/Reference/AppleNotificationCenterServiceSpecification/Specification/Specification.html](https://developer.apple.com/library/ios/documentation/CoreBluetooth/Reference/AppleNotificationCenterServiceSpecification/Specification/Specification.html)

iPhoneと連携する腕時計は、iPhone本体に表示された電子メールや予定などの通知情報をユーザに知らせる機能があります。ANCSを実装することで、周辺機器にそのような通知表示機能を持たせられます。[Apple Watch](https://www.apple.com/jp/watch/) [^1060] も、この技術を利用していると思われます。

[^1060]: [Apple Watch https://www.apple.com/jp/watch/](https://www.apple.com/jp/watch/) 

iOS8では、さらに次の3つで Bluetooth low energy が使われています:

- HealthKit
- HomeKit
- Handoff機能

[HealthKit](https://developer.apple.com/healthkit/) [^1090] は、ユーザの健康情報を収集蓄積するヘルス・アプリと、iOSが持つ健康データベースを読み書きするための Health Kit フレームワークから構成されます。

[^1070]: [HealthKit https://developer.apple.com/healthkit/](https://developer.apple.com/healthkit/)

iOSではユーザが追加できるものはアプリケーションだけです。ですから、パソコンのようにデバイス・ドライバを追加することはできません。そのために、パソコンであればデバイス・ドライバが担ってくれる、Bluetooth low energy 機器の動作制御やデータ取得と言った部分を、iOSアプリケーションに実装しなければなりません。

このヘルス・アプリは、心拍や血糖値センサなどの標準化されている Bluetooth low energy 機器からのデータ収集に対応しています。そして収集したデータは、iOSの健康データベースに記録します。ちょうどデバイス・ドライバと同じく、標準化されたハードウェアへのアクセス部分を担います。

この健康データのデータ・ベースには、HealthKitフレームワークを通じてアクセスできます。ですから、iOSアプリケーションは、Bluetooth low energy で通信をしなくとも、このデータベースから必要なデータを得ることができます。

[HomeKit](https://developer.apple.com/homekit/) [^1080] は、照明機器や電子錠などの身の回りの機器とiOSとを Bluetooth low energy または Wi-Fi で連携させる技術です。

[^1080]: [HomeKit https://developer.apple.com/homekit/](https://developer.apple.com/homekit/)

機器とiOSとの通信仕様と、機器の設定や操作をiOSアプリケーションに提供する HomeKit フレームワーク から構成されます。HomeKit に対応する機器は MFi の対象ですが、HomeKit フレームワークは一般開発者開放されています。

Handoff機能は、iOS 8 および OS X Yosemite の連携機能です。例えば、あるiOSデバイスでメールを書いている時に、他のiOSデバイスをや OS X Yosemite を開くと、編集作業中の状態が同期されていて、編集作業をシームレスに継続できます。

Handoff機能の通信仕様は公開されておらず、どのように実装されているかは外部からはわかりません。近くにあるデバイスの検出に Bluetooth low energy を活用して、デバイス間同期でのまとまった量のデータのやりとりには高速なクラシックBluetoothやWi-Fiを利用するようです。






通信には、通信速度とレイテンシという2つの性能があります。通信速度は1秒間にどれだけのデータを送信できるか、レイテンシは送信したいデータが相手に届くまでの時間です。どちらも同じようなものじゃないかと思われるかもしれませんが、この2つは意味が異なる性能値です。

通信速度とレイテンシを知らないと、例えば、パソコンに文字を入力するキーボードを設計しているのに、レイテンシを1秒にしていたら、押したキーが画面に表示されるまで1秒かかるキーボードになってしまいます。


















































# Bluetooth Low Energy のユーザ体験と技術
## 無線通信規格の役割
## Bluetooth Low Energy のある日常生活
### iOSと家電との連携
### iOSとアプセサリ
### 私有のデバイスと公共のデバイス
### iOSとカスタム・プロファイル
### 領域と検出
### 声で家電が操作できる体験の仕組み

### スマートフォンと身の回りの機器との通信

### 身の回りを取り巻く機器どうしの連携
### アプセサリ
### 身の回りを取り巻くデバイス
### 継続的な

## Bluetooth Low Energy の利用場面
### フィットネスとBluetooth Low Enery
## Bluetooth Low Energyで何ができるか
### ブロードキャストと通信
### クラシックBluetoothでのiOS周辺デバイス
### クラシックBluetoothと Bluetooth Low Energy の違い
### カスタム・プロファイルがもたらす柔軟さと多様性
### プロファイルと一般的なアクセサリ
### アプリケーション+アクセサリ=Appcessoryの登場
## iOSでの Bluetooth Low Energy 活用
### iOSと連携する周辺デバイス
### 位置と近接および存在の検出
### ユーザを取り囲むデバイス群との連携
### AndroidとWindows Phone8の対応

## Bluetooth Low Energy の無線通信技術
### 規格成立までの歴史
### Bluetooth SMART READYとBluetooth SMARTロゴ
### Bluetooth Low Energy の無線通信
### Bluetooth LEのネットワーク
### プライバシーとセキュリティ
## iOSと周辺機器のインタフェース
### 有線インタフェース
### 無線インタフェース
#### 無線LAN
#### クラシックBluetooth

## アプセサリを作るには
### ハードウェアとソフトウェアの開発体制
### ハードウェア設計
### アクセサリの実例
### プロトタイピングのすすめ
### アプセサリのブレインストーミング
## まとめ

## 身近な Bluetooth Low Energy 
### Bluetooth Low Energy の心拍計体験


### ATT/GATT

### iOS
### 認証


## Bluetooth Low Energy と周辺状況
# クラシックBluetoth と Bluetooth Low Energy の違い




コネクション・インターバルが短いほど、送りたいデータが直ちに送信できるので、送信の遅れ時間(レイテンシ、latency)が小さくなります。しかし、コネクション・インターバルごとに、無線通信回路をオンにするので、単純に電力消費量が増えます。



コネクション・インターバルは、用途に応じて7.5ミリ秒から4秒の範囲の値が設定できます。例えば、心拍センサーが接続完了後にデータを送信するならば 0.5秒でも十分でしょう。ボタンを押すと直ちに反応して欲しいリモコンでは、0.1秒やもっと短い値に設定するかもしれません。







超低消費電力の無線通信技術には、Bluetooth Low Energy 以外にも [ZigBee](http://www.zbsigj.org) [^1020] や [ANT+](http://www.thisisant.com) [^1030] など、いくつもの超低消費電力無線通信技術がありますが、Bluetoothというブランドに統合されたこと、そしてiOS5から標準でサポートされたことで、一気に世界中に普及しました。

[^1020]: [ZigBee http://www.zbsigj.org](http://www.zbsigj.org)
[^1030]: [ANT+ http://www.thisisant.com](http://www.thisisant.com)



クラシックBluetoothでリモコンを作ると、通信の接続を保持するために、リモコンを使っていない間も電池を消費します。そのため充電し続ける必要があります。もしも電池節約のために、ボタンが押されたら通信接続する設計にすると、通信接続に数秒は時間がかかりますから、反応が悪くて使えません。





しかしデータをやりとりした時の実効通信速度は60kbps程度で、クラシックBluetoothに比べて1桁以上落ちます。









繋がりっぱなしでなくてもいい、すぐつながる、すぐ切れる。
アプリケーションが制御しているので、べつにそれでいい。
だいぶ違うんだな、
小さい、モジュール、目安5ドル。
MFi、CoreBluetooth、


お互いに通信する意味、電波、データの形式、タイミング、振る舞い
メーカーが異なる ー＞ 規格認証、

アプリケーション
多様さ。他の仕様。同じデバイスでも1アプリから、複数アプリから。
ネットワークのトポロジー

Bluetooth4.0から4.1への差分
リンク層、ペリフェラル、セントラルの同時、複数接続
Bluetooth4.1から4.2への差分
セキュリティ、IPv6、高速化

アプセサリとは
アプリケーション+周辺ハードウェア
フィットネス分野、記録、ソーシャル共有




デバイスの発想
ライフサイクル、
インタフェースの種類、用途。
身の回りのデバイス、
特徴:身につける場所、専有。
現状
フィットネス、面白系、スマフォがあるから系
ハード構成はとても単純、機構があるものはない
ラジコン系
デバイス分類 ->
身につける場所 -> 電池の大きさ:容積、充電、交換頻度
歯ブラシ、自転車系

売り場を想定する
SDKで周りを巻き込む。
無線のためにコンセントはない、そもそもコンセントが必要	
すでにあるもの、買う習慣があるもの。
売り場、
概念。雰囲気メガネ、目に見えない周囲の情報を捉える。
リモコンとHomeKit
アプリケーションが窓口、機能の概念でアプリわけ。
データの所有権、誠実に対応、フィットネス、属性取得、自然な蓄積、第3者利用、解析。		
分類、操作系(Ring)、なんとなくインタラクション系(Moff)、フィットネス系(生体)
ユーザ登録の特徴、生体なら年齢性別の自動取得。
セキュリティの保全のために、ログインや使用履歴は保存せざるをえない。
ユーザとして、玩具、なにかハイテクな何か(従来あるもの+アルファの這い寄る混沌)
画面を見て操作って、なにかしら。
デバイスの所有権、データの所有権(利用範囲)、



試作のあれこれ
デバイスを作る->
企画
アプリやハード開発、売り物
ハード -> 電波法、規格認証
モジュール、Linux、スマートフォン、センサータグ的な、選択肢
モジュール、電波法、半導体、日本での電波法の実施の改正
電波法の概要、人任せがいいと思う
製造と設計のジレンマ
モジュール

プロジェクトについて
会社を作る、出資を募る
データを握る、存在アカウントを握る、統合。	
周囲環境、ソーシャルなんとか、お金集めと実力測定	
騎手と競馬、賞金と馬券、2重にかける?
人の集め方、ハッカソン、信頼関係、将来の利益を合意点に
値段を決める、ハードウェアはゴミ、廃棄までがお仕事	
資産はなにか。ゴールはなにか。
知財、アクティブユーザ、蓄積されるデータの種類、第3者との協業の可能性



歴史

BLE登場
その後の盛り上がり
周辺機器やモジュール、開発環境




# Bluetooth Low Energy のユーザ体験と技術

2011年に世界で初めて Bluetooth Low Energy に対応してから、現在に至るまで最も Bluetooth Low Energy の本質を活用し続けているのは iOS と iOSデバイス です。

iOS とは、Apple社が提供するオペレーティングシステムです。オペレーティングシステムとは、アプリケーションの画面表示や通信といった基本的な機能を提供するソフトウェアです。Apple社は1年ごとにiOSを更新しています。それらのiOSを区別するために、iOSに続く番号が毎年1つづつ増えてきました。2014年に公開されたiOSは、iOS8 です。iOSデバイスとは、iPhone や iPod touch などの iOS を搭載したデバイスの総称です。

Bluetooth Low Energy の通信相手が、パソコンではなく iPhone であったことで、物とアプリケーションそしてネットワーク・サービスが連携した、これまでにない新しい魅力が生み出されています。従来の概念ではこの魅力が表現できないために、アプリケーション(Application)とアクセサリ(Accessory)を組み合わせたアプセサリ(Appcessory = App + cessory) という造語までもが作られています。


無線技術の活用場面には必ず、通信で影響を与えらる対象があります。それは、家電であったり人間であったりします。ですから、Bluetooth Low Energy の活用には、その通信相手であり影響を受ける iOS と iOSデバイス の存在が不可欠です。そこで、Bluetooth Low Energy と iOS という2つのキーワードを軸にして、活用場面を見ていくことにします。


## 無線通信規格の役割

まず、0や1というデジタルな情報を電波で伝送するために、それを振幅および周波数の変化で表現する方法を提供します。この、情報を電波の信号に変換する方式のことを変調方式と呼びます。

人間の耳では電波は聞こえませんが、仮に電波が聞こえたとします。デジタル情報の0を「ピー」という周波数の高い信号で、1を「ブー」という周波数の低い信号で表現すると決めたとします。そうすると、デジタル信号"010"は、「ピーブーピー」という電波に表現できます。FAX送信時あるいは、パソコンのデータをオーディオ用のカセットテープに保存していた太古の時代に、このような変調音を聞いた方もいるかもしれません。

つぎに、わからない付近にいるだろうデバイスがお互いを発見する仕組みが必要です。

人間の目にはあたりにある機器が見えているので、それらが互いに無線接続することは当たり前に思えます。ですが、電波でしか周囲を知ることができない機器にとっては、あたりまえのことではありません。

Bluetooth Low Energy では、ある機器が自分を発見してもらいたい時に、アドバタイジング・パケットという信号を一定周期で送信します。



アドバタイジング・パケットには、機種名や機能などの情報が詰め込まれています。Bluetooth Low Energy は、このアドバタイズメントも超低消費電力に作られていて、ボタン型電池で年単位のアドバタイズメントができます。

例えば、iPhone に Bluetooth Low Energy 対応のキーボードを接続したいとします。キーボードは、自分の機種番号やキーボードという機能があるという情報を入れたアドバタイジング・パケットを送信し続けています。iPhone は、そのアドバタイジング・パケットを受信して、キーボードを発見して、接続要求を出して通信を開始できます。

また、アドバタイジング・パケットは、ブロードキャスト( 周囲にある不特定多数のデバイスに同時に情報を送ること )手段でもあります。また、Bluetooth Low Energy の アドバタイジング・パケット には、任意のバイト・データも入れられます。ですから、例えば、アドバタイジング・パケットに、位置情報や特別な識別情報を入れて、屋内位置検出やデバイスの近接検出に使うこともできます。

3つ目に、無線通信でやりとりするデータとタイミングで、デバイスがどう振る舞うのかの定義が必要です。

Bluetooth は単なる通信規格ではありません。通信を通じてデバイスが機能することまでを保証するブランドです。ですから、製品に Bluetooth のロゴマークがあれば、それがたとえ10年前に製造された製品であっても、今でも利用できるのです。

パソコンであれば、例えば動画やビデオ・チャットなど、新しい技術やサービスが登場しても、アプリケーションを入れ替えて対応できます。ですが、Bluetoothが使われるのは、機能がハードウェアで決まる、内部のソフトウェアの更新だけでは新しい機能への対応はできない周辺装置です。ですから、いつ製造されたデバイスであっても安心して利用できる環境を作るために、Bluetoothが振る舞いまでを定義していることが不可欠なのです。この相互運用のための仕組みを、プロファイルと呼びます。

## Bluetooth Low Energy のある日常生活

Bluetooth Low Energy は急速に普及しつつあるとはいえ、まだ日常生活で使わるまでには至っていません。また、パソコンにヘッドセットやキーボードを接続するクラシカルなBluetooth体験と思い浮かべて、それと同じものだろうと思ってしまうかもしれません。

Bluetooth Low Energy の体験は、Bluetooth 3.0までの体験とは異なるものです。そこで、 Bluetooth Low Energy がある日常生活を見ていきます。

朝、目を覚まして寝室の照明をつけようとします。「ヘイ、Siri(しり)。1階の照明をつけて」と声に出すと、1階にある寝室や居間の照明が点灯します。これは身の回りにある家電とiOSとを連携させる HomeKit という仕組みで実現しています。

身支度を整えて、鍵を閉めて家を出ようとすると、キーホルダーから「ぴーぴー」という電子音が出ます。これは、iPhone を家に置き忘れていていることを知らせる警告音です。家に戻りiPhoneを探しますが、あわてているので、どこにあるのかがわかりません。そこでキーホルダーのボタンを押すと、今度はiPhoneから「ぴーぴー」という電子音がでます。その音を手がかりにして、iPhoneを見つけることができます。

仕事前に、フィットネス・クラブで汗を流すことにします。ランニング・マシンに iPhone を置いて、トレーニング・アプリケーションを立ち上げます。ランニング・マシンに付属している心拍センサのデータが無線でiPhoneアプリケーションに伝送されて、iPhoneアプリは心拍データから適切な運動負荷を算出して、音声ガイドを出してくれます。

オフィスで椅子に座っていると、腕時計に「姿勢がよくないですよ」と通知が表示されました。腰につけている姿勢検出デバイスの情報から、iPhoneにインストールされているiOSアプリケーションが姿勢をただしたほうがいいと判断して、その通知がiPhoneから腕時計に通知されたのです。

仕事が終わり家に帰る前に、晩御飯の買い物をしようとスーパーに入ります。牛乳売り場の前を通った時に、iPhoneに「牛乳を買う」という通知がでました。これは、Bluetooth Low Energyを利用した新しい位置と近接の検出技術 iBeacon を使って実現されます。

帰宅して休息してから、iPhoneで明日の会議の資料に目を通します。iPhoneの画面では狭いので、広い画面で読もうと横にある MacBook Air を開くと、その資料が、まさに先ほどまでiPhoneで読んでいたページ位置で表示されています。

そして、寝室に入り「ヘイ、Siri(シリ)[^0110]。家の電気を全て消して、鍵をロックして」と声に出すと、部屋の電気が全て消え、玄関などの鍵がすべてロックされて、安心して眠りにつくのです。

[^0110]: Siriは、iOS5で搭載された、音声指示で質問に答えるなどのサービスを提供してくれる秘書機能です。

### iOSと家電との連携

目を覚ました時に音声コマンドで照明をつける体験は、iOSデバイスの音声コマンド検出と、家電とiOSの連携機能の2つの組み合わせで実現されます。この音声コマンドの常時検出も家電とiOSの連携もいずれも、1つのアプリケーションで提供できる機能ではなく、OSが提供しなければ実現できないものです。この、Apple社がiOSを通じて、Bluetooth Low Energy を活用して提供している体験を見ていきます。

まず、音声コマンドの検出は、iOS8で導入された、ホームボタンを押さなくても"Hey Siri"と話しかけるだけでSiriが利用できる機能を使います。この機能は、iOSの設定アプリのメニューを 一般 → Siri とたどり設定項目「"Hey Siri"を許可」をオンにして有効にできます。この設定をしたiOSデバイスを電源につないで置いておけば、目覚めたユーザが発した音声コマンドを検出して、その指示内容を検出できます。

次の、家電とiOSとの連携を提供しているのが、iOS8で導入されたApple社独自の技術 HomeKit です。HomeKit は、対応家電を開発するためのメーカ向けの技術情報と、iOSアプリケーション開発者向けの2つの技術情報を提供します。家電とiOSデバイス間の通信には、Wi-Fi もしくは Bluetooth Low Energy いずれかの無線通信が使われます。

ひとくちに家電といっても、家電の共通項は家にあることだけですから、ひとくちに家電といっても、電球から玄関の電動鍵まで実に多種多様な装置が含まれます。また、電球1つとっても、すべての電球が備える照明のオン・オフといった基本機能だけではなく、製品に特色を持たせるための様々な付加機能、例えば色調や明るさ調整、あるいは人体検出機能など、があります。

ですから、メーカ向けの技術情報は、多種多様な装置の種類とその操作のデータ表現方法を提供します。また無線通信を使うため、目の前に操作パネルがある機器と違い、家の外から第3者が勝手に機器を操作したり、あるいは操作内容を読み取られたりしないために、セキュリティとプライバシー保護のための技術が提供されます。

またHomeKitでは、iOSアプリケーションは家電の登録という重要な役割を果たします。例えば、HomeKitに対応した電球を1つ購入したとします。これがBluetooth Low EnergyでiOSデバイスと接続しても、iOSアプリケーションから電球をオン・オフする程度のことしかできません。つまり
昔からあるリモコンがiOSアプリケーションに置き換わるだけで、新しい体験にはなりません。

ですが、その電球の設置位置、例えば1階の玄関としましょう、をiOSアプリケーションで登録しておくと、前節の体験のように、「1階の照明をつけて」という音声コマンドだけで、1階にあるその電球も点灯します。またユーザが操作しなくても、例えば、帰宅時にユーザが玄関近くに来たならば、ユーザのバッグに入っているiPhoneが玄関の照明をつけることも、アプリケーション次第で実現できます。

### iOSとアプセサリ

iPhoneの置き忘れ防止の体験は、iOSアプリケーションとキーホルダーとの連携で実現されます。この体験にでてくる、警告音や認証などの機能を持たせたキーホルダー型の小さな電子デバイスは、一般的に Keyfob (キーフォブ)と呼ばれます。

キーフォブにとって、Bluetooth Low Energy のような超低消費電力な無線通信技術は、製品の大きさと使い勝手を実現するうえで重要な技術です。キーフォブはキーホルダー型にするために、大きな電池は搭載できませんから、小さくて一般店舗で安価に購入できて大きな電力がある電池であるコイン形リチウム電池がよく使われます。

そして、キーフォブは、毎日充電してもらえるiPhoneと違い、身の回りにある数多くのデバイスの1つです。ですから、例えば1年に1回の電池交換ですむデバイスでも、いろいろな種類のデバイスが身の回りに10個あれば、毎月1回は電池交換が必要になります。ユーザに電池交換が手間だと思われて使ってもらえなくならないように、コイン形リチウム電池でも少なくとも半年は動作し続けることが必要になります。

Bluetooth Low Energyは多種多様のハードウェアに向けた規格です。その標準化されたプロファイルの1つに、Proximity Profile (プロクシミティ・プロファイル) [^0120]があります。Proximity profile は、無線接続している2つのデバイス間の距離が離れたり、無線接続が切断したときに警告を発する振る舞いです。デバイス間の距離は、電波の受信信号強度から推定できます。

[^0120]: Proximity Profile (PXP) [https://developer.bluetooth.org/TechnologyOverview/Pages/PXP.aspx](https://developer.bluetooth.org/TechnologyOverview/Pages/PXP.aspx)

置き忘れ防止のためのキーフォブは、この Proximity profile を利用しています。また、iOS8は、Bluetooth Low Energy のキーボードや心拍計などのプロファイルをサポートしていますが、この Proximity profile はサポートしていません。ですから、このキーフォブは Proximity profile を活用するiOSアプリケーションと組み合わせて使います。

標準化されたプロファイルは、市場形成に必要です。特にキーフォブや心拍センサなどのスマートフォンが登場する以前からあった製品では、スマートフォンがなくてもそれらを利用してきたユーザと既存の製造メーカがあり、それらがすでに市場を形成しています。標準化されたプロファイルがあれば、ハードウェアとソフトウェアの開発会社が異なっていても、それらを組み合わせて利用することができるようになります。ですから、既存の市場にスマートフォンとの連携という付加価値を持ち込むためにも、標準化されたプロファイルが必要です。

標準化されたプロファイルがあれば、例えばキーフォブであれば、ハードウェアの製造会社は、Proximity profile を実装した様々なキーフォブを設計製造できます。また、iOSアプリケーションの開発会社は、Proximity profile を実装すれば、そのアプリケーションは、どの会社のキーフォブとでも連携できるようになります。

また Bluetooth Low Energy のプロファイルは、クラシックBluetoothのように用途を定義するものではなく、機能を振る舞いを定義するものです。ですから、例えばキーフォブを職場の座席に設置して職場の在席確認に使うなど、プロファイルという機能と振る舞いに、どんな意味をもたせるかを掛け算することで、1つのプロファイルから多様な利用場面が生み出せます。

プロファイルにどのような意味をもたせるかは、アプリケーションの役割です。アプリケーションが、ハードウェアがもつ機能をユーザ体験につなぐ鍵となります。ですからBluetooth Low Energyを搭載したハードウェアは、アプリケーションと切り離しては語れないので、アクセサリ(Accessory)とアプリケーション(Application)を組み合わせた造語、アプセサリ(Appcessory)と呼ばれるのです。

### 私有のデバイスと公共のデバイス

フィットネス・クラブのランニング・マシンに付属している心拍センサとiPhoneとの連携の体験は、 Bluetooth Low Energy で標準化されている Heart Rate Profile (ハートレート・プロファイル) [^0130] を使い実現できます。

[^0130]: Heart Rate Profile (HRP) [https://developer.bluetooth.org/TechnologyOverview/Pages/HRP.aspx](https://developer.bluetooth.org/TechnologyOverview/Pages/HRP.aspx)

置き忘れ防止の体験と同じく、心拍計の体験にもiOSアプリケーションが欠かせません。iOS7までのiOSは Heart Rate Profile に対応しておらず、iOSアプリケーションがプロファイルに対応する必要がありました。iOS8は Heart Rate Profile に対応しており、設定アプリのBluetoothで心拍センサを選択して接続できるようになりました。

Heart Rate Profileを搭載したデバイスと無線接続ができるけでは意味がなく、デバイスから心拍データを取得しなければなりません。これを担うのが、iOS8で導入された健康データの収集と蓄積を担う HealthKit です。HealthKit は、アプリケーションの名前ではなく、iOS8の機能の名称です。

iOS8のアプリケーションはHealthKitを通じて、いま取得されているデータをリアルタイムに受け取ることと、これまでに蓄積されたデータを読み出すこと、そしてデータを書き込むことができます。これまでのように Bluetooth Low Energy のプロファイルを実装しなくても、HealthKitを使うだけで健康データを活用するアプリケーションが開発できるようになりました。

Bluetooth Low Energy は、すぐに繋がりすぐに使える手軽さも重要です。Bluetooth対応機器が広く普及した現在は、もはや個人所有のデバイスを個人が利用する場面だけではなく、公共や施設付属のデバイスを一時的に利用する場面もあります。

先のフィットネス・クラスの体験では、心拍センサとiPhoneをすぐに接続させることができました。iPhoneと心拍センサを無線接続させてもよいか認証するのは、ユーザの権限です。個人が所有するデバイスであれば、初回接続時に4桁のPINコード(Personal Identification Number 、ピン、ピーアイエヌ)を入力して認証する方法でよいのですが、公共や施設付属のデバイスを一時的に利用したい場面では、この認証方式ではわずらわしいです。

Bluetooth Low Energy の認証方式には、PINコードを入力する方式に加えて、Just works (ジャスト・ワークス、すぐに使えるという意味)と呼ばれるPINコードを入力しなくともよい方式があります。この認証方式は、データの暗号化やセキュリティやプライバシーに関わる機能が利用できませんが、心拍センサの体験のように目の前のデバイスを一時的に利用したい場面で、手軽で便利な利用体験を提供します。

### iOSとカスタム・プロファイル

Bluetooth Low Energy は、標準化されたプロファイルのみではなく、カスタムなプロファイルを開発して製造販売することができます。例えば、Bluetooth Low Energy に、姿勢のよしあしを検出する標準化されたプロファイルはありません。ですが、開発会社がカスタムなプロファイルを開発して、そのプロファイルを実装したデバイスとアプリケーションの両方を提供して、アプセサリの体験が作れます。

新しいデバイスを接続して利用するときは、パソコンであればデバイス・ドライバをインストールします。ですが、iPhoneではユーザがインストールできるのはアプリケーションだけです。



カスタムなプロファイルを実装したハードウェアを利用するアプセサリでは、iOSアプリケーションが
Bluetooth Low Energyのカスタムなプロファイルを実装したハードウェアを使うには、パソコンでいうデバイス・ドライバに相当する機能までを実装したアプリケーションを提供します。
カスタムなプロファイルを実装したハードウェアを使うには、そのプロファイルに対応したアプリケーションが必要です。
iOSはパソコンでいうデバイス・ドライバ
iOSアプリケーション




1対1、ハード、それのみで設ける会社であれば、市場形成するための標準化させることも意味がある。


カスタムでもアプリケーション連携。iOSアプリケーション、通信や振る舞い部分がアプリに入るので。特別なものでも、ハードとアプリが1対1対応するので。
オフィスで姿勢を検出するデバイスの体験は、カスタムなプロファイルを実装したデバイスとiOSアプリケーションとの連携で実現されます。多種多様なものを許す。

心拍センサーのように標準化されたプロファイルだけではなく、



開発したカスタムなプロファイルを標準化することもできます。Bluetooth規格の策定を行う団体 Bluetooth Technology Special Interest Group (Bluetooth SIG) [^0140] のメンバーに参加して、新しいプロファイルの技術情報を提出して標準化の手続きをはじめることができます。

多種多様な利用場面やふるまい、つまり無数のプロファイルをBluetooth Low Energyで、普及させることも、また標準化して市場を形成することも。

[^0140]: Bluetooth Technology Special Interest Group [https://www.bluetooth.org/ja-jp/home](https://www.bluetooth.org/ja-jp/home)



市場を広げる可能性、
ハードウェの販売売上が利益となる。
アプリケーションと連携することで、アプリは無償。

ですが、このようなユニークなアプセサリでは、自社で開発したカスタムなプロファイルを標準化しても得られるものはありません。
販売により得られます。
アプセサリでは、必ずハードウェアを販売します。そのハードウェアを購入したユーザがすぐにそれを利用できるように、アプリケーションはたいてい無料です。

自社のハードウェアとのみ連携するアプリケーション


アプセサリの売上はハードウェアの販売

ハードウェアの販売売上
ハードウェアと連携する
アプリケーションは無償で公開されます。

ハードウェアの販売利益、アプリケーションは無償。
プロファイルの標準化、ハードウェアだけを製造する会社、切り開いた新しい商品分野に、利益が取れる製造販売だけの、ただ乗り。

この姿勢を検出するようなユニークなアプセサリでは、その開発会社がプロファイルを標準化することで得られる利益はありません。
また、姿勢を検出するというプロファイルは世の中一般に広く使われるものではありませんから、もしも標準化されても他社

姿勢を検出するという目的をみたすハードウェアとアプリケーションを

姿勢を検出するというデバイスは、世の中一般に広まったデバイスではありませんし、

また、姿勢を検出する装置というのは一般的なデバイスではありませんから、

Bluetooth Low Energy の標準化されたプロファイルに、姿勢のよしあしを検出するプロファイルはありません。ですが、カスタムなプロファイルを実装したハードウェアと、そのハードウェアと連携するアプリケーションを開発することで、前述の姿勢のよしあしを検出するアプセサリの体験が実現できます。

また、自社のアプセサリの魅力を追い求めていくので、そのプロファイルを標準化する必要がありません。
一般にアプセサリはハードウェアとアプリケーションが強く連携するので、
標準化されたプロファイルではなくカスタムなプロファイル

自社で

これまでの体験は、Bluetooth Low Energyの標準化されたプロファイルで実現されていました。
標準化することで、ハードウェアとアプリケーションが分離できる。でも一品物、標準化する必要がない。

Bluetooth Low Energyの標準化されたプロファイルのなかには、人間の姿勢を検出するプロファイルはありません。Bluetooth Low Energy は多種多様な利用場面で利用するために、Bluetoothの規格認証のもとで標準化されていないカスタムなプロファイルを設計できるようになっています。



アプリケーション、デバイスの分離。スマートフォンでは実現ができない。

検出位置と表示位置が異なる、無線。

加速度センサー、過去の姿勢データと比較したり、改善度。より高度な良い悪いの判断、通知、ユーザが情報を見るタイミング
クラウドやソーシャル、データの蓄積、改善、トレーニングやゲームとして、日常的に利用。
一人ではなく、連携した人のグループでの利用。




### 領域と検出

iBeacon、バックグラウンド。

シームレスな、お互いのデバイスの存在。Wi-Fiや高速なBluetooth、BLEではなく。データ交換。




パソコンのようにアプリケーションを入れ替えて、どのような処理でもできるデバイスと違い、

どんな通信をしたらデバイスはどう振る舞うのかの定義が必要です。


通信でやりとりするデータの意味と、その通信をした時のデバイスの振る舞いや機能の定義


して、接続処理要求に進むことができます。



やはりボタン電池1つでも年単位のアドバタイズメント
をし続けていても電池


例えば、iPhoneが周囲にある Bluetooth Low Energy のデバイスを発見したいときは、

電波の送受信機能しかないデバイスには当たり前のことではありません。

品番や機能、無線通信のアドレス、例えば、AとBとCがいたら、Bだよという、物理的に識別できる情報。
相手が接続するものか判定できる情報。



その2つのデバイスが無線通信で接続することが当たり前に思ってしまいますが
の目には



advertising broadcast

最も単純な変調方式は、デジタル'0'


電波で
表現する方法を提供します。


電波には、周波数と振幅という2つのパラメータがあるので

無線通信は電波で信号を表現
周波数、
振幅変調、周波数変調

お互いに付近にあデバイスが
お互いの存在の発見

4つの役割あります。まず電波で0と1のデジタル信号を伝え合う仕組みを提供します。2つめに、付近にあるデバイスお互いのデバイスの存在を発見




スマートフォンと直接接続、
WiFiとかじゃなくて、
同時に複数のスマートフォンとの接続もできる。
データ形式、Bluetooth Low Energyの規格。

### 声で家電が操作できる体験の仕組み

### スマートフォンと身の回りの機器との通信

### 身の回りを取り巻く機器どうしの連携




### アプセサリ
無線通信、あらゆる仕様を飲み込む。アプリケーションとiOS。

その支える技術。
個人持ちデバイス、接続、ペアリング。Bluetooth3.0では、Just works。
キーホルダー。Keyfob。無線接続が切れたりしたら。

HealthKit。データの集約。

カスタムなデバイス。アプリケーションと連携することで。

### 身の回りを取り巻くデバイス
統合された規格。

HomeKitという技術、家電とあれこれ。システムとして購入しなくてもいい。


部屋のどこかにあるiOSデバイスが常にユーザの音声をモニタしています。
「ヘイ、Siri」という呼びかけ


"

### 継続的な
存在を知る。

アンビエントでシームレス。
同じIDがあれば、同じデバイス。お互いの存在を知るには。AdHocなどネットワーク環境がなくても、外側でも。
お互いに存在を知ることが必要です。

### 

























































### ユーザの文脈と連携

主語。ユーザが権限を委譲した。クラウド・サービスなので、スマートフォンなど、手元のデバイス自体が、なくてもよい。

内部情報、
ユーザの行動を変化さるものは通知、
それ以外は、自動化

電子錠、本体よりも、情報が大事。

その文脈でかならずそういう操作をする。自動化。

音声操作、
クラウド側連携、操作
テレビ、録画、再生

洗濯機、冷蔵庫、などアクチュエータ、人間の関与を前提とする。
自動タイマー以上のことはない。状態監視。
人がいないなら、停止とか。状況判断。

リモコンのみかた。リモコンではない。
自動的に。判断。
連携に価値がある。リモートで状態確認。
ネットワーク、ファースト。もともと場所がないので。クラウド側、アプリ側で動いていても。
1つのアプリケーションにデータと振る舞いが集約されるので。ネットワークごしに。

単品、
全て揃えなければ意味が無いもの、
システムとしての連携、

でも操作系は、違う。連携、ネットワークからの操作、
リモコンではなくて、クラウド側、アプリ側の状態反映。どうしてもネットワーク側で連携していないとだめ。
設定?面倒。場面似あわせて。iOSのHomeKitのように。アプリから連携とか。
でも、機器は。

人間自体は、ネットワークからみると、透明人間、iPhoneがあるから認識できる。

場所系は、排他性がある。

入るもの。
家の錠。エアコン。照明。
情報が大切。
HomeKitの赤外線は、内部情報は取れない。



ライフサイクル。売上。値段。捨ててもらうまでが利用。身近な例でいえば、iftbit。

自動化、データ集約。他に迷惑を与えない系。画像処理とかは無理でも、特徴量とか意味を引き出す、圧縮。




### 商品の足し算


使う人はだれか。
製造価格と販売価格が妥当な金額か

売り場はどこか
Amazon、
キャリア代理店、
園芸用品的なもの、雑貨屋、業務用でもいいのだろうけど。

個人利用か、作りて=利用者、
社内利用か、作りて=利用者(不特定多数)、管理された環境。
一般販売目的。これは手強い。

社内利用
販売不可能だけど、切実な。
回転すしの廃棄率的な。競合他社にその存在すら知られてはならない的な。

一般販売
ライフサイクル。売上。値段。
捨ててもらうまでが利用。
身近な例でいえば、iftbit。

自動化、データ集約。
他に迷惑を与えない系。
画像処理とかは無理でも、特徴量とか意味を引き出す、圧縮。

潜んだデータを解析して。
コンビニとか、すでにやっているところいっぱい。

人間の顔認識とか。
目の前、ひざ掛けをしている人がいる。見ればわかる。人の関係。
言いにくい、見えていても気づけない、強制的に機械化。処理すべき事項として突きつける。
改善というより、低レベル。素晴らしい人の知能を、機械化して広げるパターン。

結果が見えているパターン。
結果すら見えないパターン。気付きという結果。売りやすい。問題の提示ではなくて、予想される結果。


リアルなものには、必ず所有者がいる。






















アプセサリのハードウェア

要は、個人と法人の違いがあまりない。なぜか、

電池が限られている。
処理能力=電池消費量、充電頻度。

センサと電池、大きさ、半導体入手性。
制約条件、小さなモニタ、本体、ベルト、ハードウェア単体では、1万個生産。
プラスチックの外装、デザインとか。

資本がないと手が出にくい。
無線充電。
特注の有機EL表示器とかは無理でも、かなり。デザイン性、特殊な部品が必要となる。
アルミニウムの削りだし外観とか、

















iOSのBLEではアクセスさせない。

Bluetooth Low Energy を利用するiOSの独自機能
MFiだけど、扱いが異なる。

近接と位置
新しい位置と近接の検出技術

アプリ排他ではない。





BLE、利用目的自体が多種多様。同じ機能(サービス)でも、利用目的が異なる。
FindMeの発見のための、置き忘れ防止の、Immediate Alert Service、
家電のエラー通知とか、一般的にアラート出力には全て使えるし、
あるいは、ゲーム機器でコントローラで、警告音を出すだけ

クラシックBTのときは、認証チップ。通信路。特定の機器。iOS機器とだけの通信。

CoreBluetoothが大きい。
自由度、

バックグラウンド

CoreBluetoothだけでは対応できないところ。ANCSとか、iBeaconとか。

### 機器の登場

エコシステム、普及。背景と流れ的なもの。
買い手と売り手、市場。

フィットネス分野、従来製品。
ロギング、ソーシャルな要素、アプリ。
FitBitの例。

機器というより、サービスかもね。収益源。

ベンチャー、新種の企業。
アプリ配信、BLE作りやすさ、クラウドソーシングとか

アプリの、排他性はない。デバイスの売り方は2つある。
SDKを配りまくる、採択されたプロファイルにする、
閉じる。


デバイスドライバ相当
HealthKitなど、パソコンと違い、アプリケーション以外の部分をインストールできる時代ではない。
パソコン時代そのままの、常時稼働のもの、デバイスドライバ  = セキュリティ・ホール
iOS8からは、アプリケーションの一部を外部アプリケーションで利用するなど、
仕組みが提供されるのかもしれない。

BT、
利用分野を決めないといけない。機器メーカだけでは、独立できない。
採択されたプロファイル、ハードウェアとアプリケーションの分離、設計製造は1社とか、
ロゴだけ、外観デザインだけで、自社製品。


iOS とは、Apple社が提供するオペレーティングシステムです。オペレーティングシステムとは、アプリケーションの画面表示や通信といった基本的な機能を提供するソフトウェアです。Apple社は1年ごとにiOSを更新しています。それらのiOSを区別するために、iOSに続く番号が毎年1つづつ増えてきました。2014年に公開されたiOSは、iOS8 です。iOSデバイスとは、iPhone や iPod touch などの iOS を搭載したデバイスの総称です。

Bluetooth Low Energy の通信相手が、パソコンではなく iPhone であったことで、物とアプリケーションそしてネットワーク・サービスが連携した、これまでにない新しい魅力が生み出されています。従来の概念では



プロファイルにどのような意味をもたせるかは、アプリケーションの役割です。アプリケーションが、ハードウェアがもつ機能をユーザ体験につなぐ鍵となります。ですからBluetooth Low Energyを搭載したハードウェアは、アプリケーションと切り離しては語れないので、アクセサリ(Accessory)とアプリケーション(Application)を組み合わせた造語、アプセサリ(Appcessory)と呼ばれるのです。



例えば、[Fitbit](http://www.fitbit.com/jp) [^1060] というサービスは、毎日の歩行数や階段の昇り降りを記録し続ける Bluetooth Low Energy の活動量計を販売しています。この活動量計は単体でも十分に魅力ある活動量計です。それがiOSアプリケーションと結びつくと、アプリケーションを通じてウェブ・ネットワークとも連携します。そして、Facebookなどのソーシャル・ネットワークで歩いた歩数を共有するなど、これまでになかったユーザ体験が提供されています。

[^1060]: [Fitbit http://www.fitbit.com/jp](http://www.fitbit.com/jp)

<!-- ここ編集すること -->
iOSアプリケーションには、 Bluetooth Low Energy 専用のバックグラウンド・モードが用意されています。バックグラウンドで、 Bluetooth Low Energy デバイスと接続して通信しつづける、あるいはデバイスを発見して接続をすることができます。

このように、Bluetooth Low Energyは、周辺デバイス(アクセサリ)とアプリケーションの2つが融合して魅力が生まれます。これ表すのが、周辺デバイスを意味するアクセサリ(accessory)と、iOSアプリケーション(application)の2つの単語を組み合わせた *Appcessory (アプセサリ)* という造語です。

まとめると、iOSとBluetooth Low Energy デバイスは:

- Bluetooth Low Energy だけをつかうデバイスは、MFiプログラムへの参加は必要ない
- 一般開発者が CoreBluetoothフレームワーク を使いアプリケーションを開発できる
- Bluetooth Low Energy のバックグラウンド・モードがある
- アプセサリという造語が作られるほど、デバイスとiOSアプリケーションは不可分

となります。


アプセサリの解説

例えばFitbit。

独自の技術利用。
OSで組み込んでもらわないと手が出せないところ、通知系、MFi対象ですらなく。
iBeacon、ゆるいMFi。技術と商標それぞれにライセンス。
Siriとの音声連携、HomeKit。セキュリティとか。絶対の防御。



ベンチャー系、
MFi不要、センシング。植木の水涸れ検出や赤ちゃんの体温検出など、
クラウドソーシング
kickstarter cloud funding

不特定多数の人が通常インターネット経由で他の人々や組織に財源の提供や協力などを行うことを指す、群衆（crowd）と資金調達（funding）を組み合わせた造語である[1][2]。ソーシャルファンディングとも呼ばれる











多様さ、同じアプリでも1アプリから、複数アプリから。

ドライバ的なところまでアプリ、
アプリにより振る舞いが定義。意味が異なる。Fitbitの例。

クラシックBluetooth都の違い、
同時接続、7台が、10台、
発見はできる。
発見がめちゃくちゃはやい、接続と切断までが、アプリに管理されている。

<!-- これ以降 ちょっとコピペ -->

## Bluetooth Low Energy の利用場面

Bluetooth Low Energy はどのような場面で、どのように利用されているのかを見ていきます。

Bluetooth Low Energy が使われている周辺デバイスは、クラウド・ファウンディングでベンチャー企業が販売を開始していたり、あるいは通信販売で入手できるものは数多くありますが、電気量販店などの店頭で一般販売されているものは、まだ多くはありません。

Bluetooth Low Energy が最初に活用されはじめた分野は、フィットネス、ヘルスケア、ラジコンなどの玩具、そしてベンチャー企業が発表するユニークな製品群です。

### フィットネスとBluetooth Low Enery

Bluetooth Low Energy が体験できる最も身近な分野は、フィットネスです。フィットネスは、健康の維持、増進を目的とした運動のことです。この分野では、Bluetooth Low Energy が登場する以前から、適切なトレーニング効果を得るために、ランニングや屋内トレーニングでの運動強度や心拍数の計測がおこなわれています。

フィットネスの用具を販売する [Wahoo Fitness](http://www.wahoofitness.com) [^1010] の商品一覧を見ると、心拍計測デバイスや自転車の速度センサやバイク・トレイナーなどがあります。

[^1010] [Wahoo Fitness](http://www.wahoofitness.com)

Bluetooth Low Energy が搭載されていないスマートフォンと連携しない単体の心拍センサと、スマートフォンにリアルタイムに心拍データを送信する心拍センサとの体験の違いを、運動中のデータ表示と、データの蓄積と分析の2点で見てみます。

体を動かしていても安定して脈拍が取れる心拍センサには、胸ベルト型と腕時計型の2種類があります。ここでは腕時計型の心拍センサを身につけているとしましょう。

単体の心拍センサは、腕時計の液晶表示板があるので、現在の心拍をテキストで、その時間変化を簡単なグラフに表示できます。そして、事前に設定した心拍値の運動強度の上限値と下限値の範囲にいるかを表示したり、その範囲から心拍値がはずれたら、ブザー音でユーザにそれを知らせることができます。

ほとんどの単体の心拍センサは、計測する機能だけしかありませんが、もしもデータを内部メモリに保存できるものであれば、パソコンなど外部にデータを読み出せるでしょう。そのような機能があれば、運動が終わったあとにデータを読みだして、表計算ソフトを使い運動時間と心拍値のグラフ表示もできます。

Bluetooth Low Energyを搭載してスマートフォンと連携した心拍センサは、この単体での機能に、スマートフォンのアプリケーションとの連携が加わります。

スマートフォンにはあらかじめ、Bluetooth Low Energy の心拍センサに対応したアプリケーションをインストールしておかねばなりません。スマートフォンのアプリケーションからみた心拍センサは、無線で接続されたデータベースに見えます。アプリケーションは、心拍センサというデータベースから心拍値データを読み出す処理をするわけです。

心拍センサはデータベースに見えているので、1つの心拍センサに対して、複数のアプリケーションが同時にアクセスできます。また、アプリケーションがバックグラウンド(アプリケーションが画面に表示されていない状態)でも、心拍センサにアクセスできます。

デバイスがアプリケーションに独占されない、そして、バックグラウンドでもアクセスできるので、スマートフォンにある複数のアプリケーションがそれぞれ独立して動作し、多様な利用ができます。例えば音声ガイダンスのトレーニング・アプリケーションを実行しながら、心拍値の記録や分析専用のアプリケーションも実行できます。

スマートフォンの高い性能をアプリケーションで活用できるので、様々な運動中のデータ表示が実現できます。大画面と高いグラフィック表示機能を活かしたデザイン性の高い画面表示ができますし、またランニングなど画面を見続けられない利用場面には、走行ペースや距離を自然な音声でお知らせする音声ガイダンス機能も提供ができます。

そしてデータの蓄積と分析では、スマートフォンは大きな価値を提供します。大容量のフラッシュメモリを活かして、全てのトレーニング・データを蓄積できます。そして、ランニング時には、これまでのデータに基づいて走行タイムの確認やペース配分の提示もできるでしょう。

さらに、スマートフォンに内蔵されたGPSや加速度センサのデータも統合して利用すると、例えば位置情報から坂道にさしかかるとわかれば、坂道での最適なペース配分についてのアドバイスを提供したり、あるいは加速度データから歩幅や腕や足の動きを解析してフォーム改善に利用したりと、心拍センサ単体のデータが他のデータと統合されて分析することで、心拍だけでははわからなかった魅力のある情報が引き出せます。

ここまでが、心拍センサとスマートフォンとが作り出す利用場面です。ここにネットワーク・サービスを連携させると、例えば運動スコアをソーシャル・メディアで共有するなど、心拍センサ単体で利用していた時代にはなかった利用方法へと広がっていきます。

<!--  ### ベンチャー企業とBluetooth Low Enery -->


## Bluetooth Low Energyで何ができるか

Bluetooth Low Energy のデバイスは、iOSデバイスと組み合わせてはじめて、いろいろなことができます ( [#fig-ios-and-ble-intro] )。

![ #fig-ios-and-ble-intro iOSデバイスと周辺デバイスとの通信](fig/ch01-ios-and-ble-intro.png)

### ブロードキャストと通信

Bluetooth Low Energy の無線通信は、周囲にある不特定多数のiOSデバイスにデータを送信するブロードキャストと、特定のiOSデバイスと無線接続をしてデータの読み書きを行う通信の2つができます。

ブロードキャストは、もともと Bluetooth Low Energy デバイスが自分をiOSデバイスに発見してもらうための仕組みです。Bluetooth Low Energy デバイスは、自分の機種名や機能などの情報を周囲に送信します。近くにいるiOSデバイスは、たまたまそれを受信してデバイスが発見されます。

このブロードキャストは、デバイスの発見以外に、周囲にある不特定多数のiOSデバイスへの一方的な情報送信にも利用されます。

例えば、iOS7から搭載された iBeacon は、このブロードキャストを利用しています。iBeacon は、識別子を送信し続けるビーコンとそれを検出するiOSデバイスを組み合わせた、新しい位置と近接検出技術です。とくに、オフラインとオンラインとを滑らかにつなげた購買体験を生み出すための技術手段として、注目されています。

例えば、建物のあちこちにビーコンを設置しておけば、GPSが届かない屋内でもビーコンの電波強度から屋内位置を推定できます。屋内位置推定や、その推定情報を使った屋内地図表示また目的地へのナビゲーションに使えます。この技術を使えうと、食品スーパーの販売促進では、売り場を訪れたタイミングでユーザが嬉しいと思うクーポンを配布するなどの、アプリケーションからユーザに、その場所にあった働きかけができます。

ブロードキャストは、Bluetooth Low Energy デバイスの情報を周囲に送信するのにも使えます。例えば、気温計のデバイスであれば、センサで検出した気温をそれが周囲にブロードキャストしていれば、その電波を受信したiOSデバイスは、その場所での気温を知ることができます。

Bluetooth Low Energy のブロードキャストは、データの種類を表すヘッダとデータの配列データを送信できます。その配列の大きさは最大31バイトで、決して大きくはありませんが、先ほどのiBeaconやセンサのように広い利用場面があります。

ブロードキャストでは送りきれないバイト数や複雑なデータをやりとりするには、ブロードキャストで発見したデバイスとiOSデバイスが接続処理をしてからデータをやりとり、通信します。

例えば、心拍計測デバイスにも、計測場所が胸や手首だったり、心拍データも1分間あたりの値が取れるだけのシンプルなものから心拍間の時間まで取れるものもあります。このような多種多様なデバイスからデータを取得するのは、ブロードキャストの最大31バイトでは取得しきれません。だから、接続してデータをやりとりする通信が使われます。

まとめると:

- Bluetooth Low Energy には、ブロードキャストと接続して通信をする、2つの方式がある
- ブロードキャストは、デバイスの発見や、位置と近接検出技術や、簡単なデータ送信にも使われる
- 接続して通信することで、複雑な構造をもつデータをデバイス間でやりとりすることができる

となります。

### クラシックBluetoothでのiOS周辺デバイス

Bluetooth Low Energy はクラシックBluetoothとは異なり、規格の範疇で機器メーカ独自のプロファイル (カスタム・プロファイル) を実装することができます。だから、Bluetooth Low Energy では多種多様なデバイスを展開できます。

プロファイルとは、デバイスの振る舞いの仕様のことで、通信でやりとりするデータのフォーマットや意味、そしてデバイスがどのタイミングでどのような動作をするのかなどを含みます。

クラシックBluetooth では、周辺デバイスとそれが接続するデバイスの両方の振る舞いが、キーボードやヘッドセットのような用途ごとにプロファイルとして定義されています。

例えば、キーボードやマウスなどの入力デバイスにはヒューマン・インターフェイス・デバイス・プロファイル (HID)が、ヘッドセットなど音楽を聞くデバイスには高度オーディオ配信プロファイル(A2DP)のように、用途それぞれにプロファイルが定義されています。

クラシックBluetoothは、接続先であるiOSの振る舞いもプロファイルに含まれます。ですから、[iOS：iOS デバイス対応の Bluetooth プロファイル](http://support.apple.com/kb/HT3647?viewlocale=ja_JP) [^1010] の一覧表のように、1つ1つのプロファイルごとに規格に従っているかがチェックされています。iOSデバイスから使える周辺デバイスは、ここにあるプロファイルのものだけになります。

[^1010]: [iOS：iOS デバイス対応の Bluetooth プロファイル http://support.apple.com/kb/HT3647?viewlocale=ja_JP](http://support.apple.com/kb/HT3647?viewlocale=ja_JP)

iOSに実装されたプロファイルは、パソコンでいうデバイス・ドライバの働きをします。ですから、iOSアプリケーションは、Bluetoothか有線かの接続形式を気にせず、キーボードやヘッドセットといった単なる周辺デバイスとして扱えます。

このように、iOS自体にプロファイルが実装されているので、クラシックBluetoothでiOSアプリケーションが周辺デバイスと直接通信することはありませんし、通信できません。

もしもiOSアプリケーションからクラシックBluetoothの周辺デバイスへの直接通信を許すと、クラシックBluetoothのプロファイルの規格認証時に、そのiOSアプリケーションも含めてプロファイルに対応していることを証明しなければなりません。任意のiOSアプリケーションがインストールされるので、それは不可能です。

クラシックBluetoothで、規格にプロファイルが定義されていないオリジナルの機能を実現するために、シリアル・ポート・プロファイル(Serial Port Profile, SPP)という双方向の単なるデータ・ストリームを提供するプロファイルがあります。SPPには、データのフォーマットや意味の定義がない単なる通信で、それをどう使うかは自由です。

ですが、[iOS：iOS デバイス対応の Bluetooth プロファイル](http://support.apple.com/kb/HT3647?viewlocale=ja_JP) の一覧表にSPPはありません。

iOSアプリケーションと独自のクラシックBluetooth周辺デバイスとの通信は、[#fig-ios-and-ble-details] (a) のように実現されます。

クラシックBluetoothでiOSの周辺デバイスを開発するには、Apple社とMade for iPhone(MFi)プログラムという秘密保持契約を締結してはじめて、秘密のハードウェア開発情報の開示と開発機材の提供をうけられます。iOSは、周辺デバイスに実装したMFiプログラムで提供される認証用ハードウェアを確認して、そのデバイスが対応するiOSアプリケーションに通信をつなぎます。iOSアプリケーションは、外部機器との通信を提供するExternal Accessoryフレームワークを使って、この周辺デバイスと通信ができます。

![ #fig-ios-and-ble-details アプリケーションと周辺デバイスとの通信](fig/ch01-ios-and-ble-detail.png)

まとめると:

- クラシックBluetooth のiOS周辺デバイスの開発にはMFiが必須
- External Accessoryフレームワークを使い、周辺デバイスと1対1で対応するiOSアプリケーションを開発する

となります。





### カスタム・プロファイルがもたらす柔軟さと多様性

[#fig-ios-and-ble-details] (b) が、iOSアプリケーションと Bluetooth Low Energy の周辺デバイスとの通信です。

クラシックBluetoothは、周辺デバイスの機能とその振る舞いをセットにして、プロファイルという1つの概念にしていました。Bluetooth Low Energy は、機器の振る舞いの定義をプロファイル、周辺デバイスの機能の定義をサービスと、振る舞いと機能を2つの概念に分離しています。

例えば、鍵の置き忘れを防止するためのキーホルダーには [Find Me プロファイル](https://developer.bluetooth.org/TechnologyOverview/Pages/FMP.aspx) [^1040] が使われます。これは、キーホルダーを見つけたいときに、iOSデバイスから信号を送ると、キーホルダーからピーという音や振動が出るプロファイルです。

Find Me プロファイルは[Immediate Alert サービス](https://developer.bluetooth.org/gatt/services/Pages/ServiceViewer.aspx?u=org.bluetooth.service.immediate_alert.xml) [^1050]を使います。このサービスはピーという音や振動を出すサービス、つまり周辺デバイスの機能を表します。

[^1040]: [Find Me Profile https://developer.bluetooth.org/TechnologyOverview/Pages/FMP.aspx](https://developer.bluetooth.org/TechnologyOverview/Pages/FMP.aspx)

[^1050]: [Immediate Alert Service https://developer.bluetooth.org/gatt/services/Pages/ServiceViewer.aspx?u=org.bluetooth.service.immediate_alert.xml](https://developer.bluetooth.org/gatt/services/Pages/ServiceViewer.aspx?u=org.bluetooth.service.immediate_alert.xml)

この例をみると、キーホルダーを探すときに音や振動を出すFind Me プロファイルの振る舞い部分は、iOSアプリケーションに実装されます。その振る舞いに必要な振動や音の出力機能は、Immediate Alert サービスとして周辺デバイスに実装されます。

振る舞いはiOSアプリケーションに、周辺デバイスの機能はサービスに分離されたことで、それぞれの可能性をかけあわせることで、多様性が生まれます。

このImmediate Alert サービスを別の目的に使ってもかまいません。例えば、気温や湿度が高い時に熱中症の危険性をユーザに知らせるiOSアプリケーションを開発したとします。そのiOSアプリケーションがユーザにより直接働きかけるために、Immediate Alert サービスを使うこともできるのです。

Bluetooth Low Energy は、データ・ストリームを提供する技術ではありません。周辺デバイスの機能をサービスという単位でオブジェクト指向で表現するデータ構造があり、全てのデータのやり取りはそのデータ構造を通して行います。そしてそのデータ構造をどう使うかというアプリケーション層を担うプロファイルとサービスは、規格が用途ごとにしばったりせず、カスタムのプロファイルとサービスの実装が許されています。

ですから、Bluetooth Low Energyの規格認証のもとで、カスタムなプロファイルとサービスを一般販売できます。これは、SPPしかなかったクラシックBluetoothとは大きな違いです。

一方で、例えばキーボードなどの一般的な周辺デバイスは、規格として標準のサービスとプロファイルが定義されなければ周辺デバイス市場が立ち上がりません。クラシックBluetooth のプロファイルは、Bluetoohの規格開発を監督する [Bluetooth SIG](https://www.bluetooth.org) [^1040] が定義していましたが、Bluetooth Low Energyは、業界団体の企業が Bluetooth SIG に参加して、その業界でのプロファイルを取りまとめて標準化していくボトムアップ型をとっています。

 ^[2040]: [Bluetooth SIG https://www.bluetooth.org](https://www.bluetooth.org)

ですから、Bluetooth Low Energyは、カスタムなプロファイルとサービスを使い、自社のサービスでのみ使えるカスタムな周辺デバイスを販売することも、またプロファイルを標準化して、キーボードや血圧計のような一般的な周辺デバイス市場を業界として立ち上げていくことも、できるのです。

まとめると、Bluetooth Low Energyでは:

- 周辺デバイスの振る舞いはプロファイルに、機能はサービスに分離されている
- プロファイルは複数のサービスを組み合わせて実現され、プロファイルはiOSアプリケーションとして実装される
- 規格がカスタムなプロファイルとサービスの実装を許している
- Bluetooth SIGに参加してプロファイルとサービスの標準化を提案できる

となります。

### プロファイルと一般的なアクセサリ

プロトタイピングに、市販されているアクセサリを流用できると便利です。

無線で接続した装置の振る舞いを、Bluetooth LEはプロファイルと呼びます。Bluetooth LEの規格は、独自の実装を許すように作られています。自社の装置と、その装置とのみ接続するアプリケーションを開発するならば、独自に仕様を決めて実装すればよいのです。

しかし、一般的に、業界には、装置の製造会社、アプリケーション開発会社など、複数の会社があります。このような会社をまたぐ場合にアプセサリを作っていくには、どこかの会社の独自プロファイルではなく、一般化した振る舞いの定義が必要です。

Bluetooth SIGは、ある業界に関わる会社群が一般化したプロファイルを提出すれば、それをプロファイルとして承認します。この仕組みにより、特定の企業に依存しない一般化されたプロファイルのもとで、装置やアプリケーションの開発ができます。また、新たな装置のプロファイルが、今後も追加されていくでしょう。

これらのプロファイルの分野は、大きくフィットネスとヘルスケアそしてモバイル機器の3つに分けられます。Bluetooth LEの規格制定時から、応用を考えられていた分野で、プロファイルも、いち早く成立しています。機能は、センサと通知に分類できます。スマートフォンから腕時計などに、メールや電話着信を通知するアラート通知は、クラシックBluetoothから提供されてきた機能です。

### アプリケーション+アクセサリ=Appcessoryの登場

iOSは、Bluetooth Low Energy の多様性の鍵です。

iOSアプリケーションは、CoreBluetoothフレームワークを通じて、周辺デバイスと直接通信できます ([#fig-ios-and-ble-details] (b))。また周辺デバイスの検索、発見したデバイスへの接続そして切断もできます。iOSアプリケーションが周辺デバイスを掌握できるうえ、周辺デバイスの設計次第でペアリングも不要にできるので、ユーザに設定の手間をかけさせない体験も作れます。

なによりも CoreBluetoothフレームワーク は一般開発者に開放されました。これで、iOSアプリケーションで多種多様なプロファイルが実現できるようになり、そしてMFiプログラムを締結しなくてもiOS周辺デバイスを発売できるようになりました。

Bluetooth Low Energy のカスタム・プロファイルとサービスの柔軟さと、このiOSの方針が、多種多様のユニークな周辺デバイスとiOSアプリケーションが続々と登場するプラットフォームとなったのです。

iOSアプリケーションとBluetooth Low Energy の周辺デバイスは、とても強く結びつきます。iOSアプリケーションは、表示機能の乏しい周辺デバイスの代替表示のようなおまけではありませんし、また周辺デバイスはiOSアプリケーションのセンサなどの単なる機能拡張ではありません。

例えば、[Fitbit](http://www.fitbit.com/jp) [^1060] というサービスは、毎日の歩行数や階段の昇り降りを記録し続ける Bluetooth Low Energy の活動量計を販売しています。この活動量計は単体でも十分に魅力ある活動量計です。それがiOSアプリケーションと結びつくと、アプリケーションを通じてウェブ・ネットワークとも連携します。そして、Facebookなどのソーシャル・ネットワークで歩いた歩数を共有するなど、これまでになかったユーザ体験が提供されています。

[^1060]: [Fitbit http://www.fitbit.com/jp](http://www.fitbit.com/jp)

<!-- ここ編集すること -->
iOSアプリケーションには、 Bluetooth Low Energy 専用のバックグラウンド・モードが用意されています。バックグラウンドで、 Bluetooth Low Energy デバイスと接続して通信しつづける、あるいはデバイスを発見して接続をすることができます。

このように、Bluetooth Low Energyは、周辺デバイス(アクセサリ)とアプリケーションの2つが融合して魅力が生まれます。これ表すのが、周辺デバイスを意味するアクセサリ(accessory)と、iOSアプリケーション(application)の2つの単語を組み合わせた *Appcessory (アプセサリ)* という造語です。

まとめると、iOSとBluetooth Low Energy デバイスは:

- Bluetooth Low Energy だけをつかうデバイスは、MFiプログラムへの参加は必要ない
- 一般開発者が CoreBluetoothフレームワーク を使いアプリケーションを開発できる
- Bluetooth Low Energy のバックグラウンド・モードがある
- アプセサリという造語が作られるほど、デバイスとiOSアプリケーションは不可分

となります。


## iOSでの Bluetooth Low Energy 活用

iOS5およびiOS6では、ベンチャー企業が多種多様なアプセサリーを発表していましたが、iOSそれ自体がBluetooth Low Energyを使うことはありませんでした。iOS7からは、iOS自体が標準的なBluetooth Low Energy 周辺デバイスに対応したり、独自機能を提供しはじめています。

iOSでBluetooth Low Energyをつかって、できること、それをするためにハードウェアおよびアプリケーション開発が不要か必要かを [#table_ios_and_ble] にまとめます。

Table: #table_ios_and_ble iOSでのBluetooth Low Energy活用

番号 | 使用目的                           | iOS対応 | ハードウェア | アプリケーション | MFi
-----+-----------------------------------+--------+------------+----------------+----
1|カスタムな周辺デバイスの販売               | iOS5    | 開発        | 開発           | 不要
2|市販の周辺デバイスを使うアプリケーション開発 | iOS5    | 市販品       | 開発           | 不要
3|iOSがサポートする周辺デバイス開発          | iOS7    | 開発        | 不要            | 不要
4|位置と近接検出                           | iOS7    | ビーコン製造 | 開発/不要       | 必要
 |                                       |         | 市販品       | アプリ         | 不要
 |                                       |         | アプリ       | アプリ         | 不要 
5|iOSの通知情報と同期する周辺デバイス開発     | iOS7    | 開発する     | 不要           | 不明
6|ユーザの健康情報の集約と参照               | iOS8    | 市販/開発    | 開発/不要      | 不要
7|iOSと連携する家電の開発                   | iOS8    | 開発        | 必要           | 必要


### iOSと連携する周辺デバイス

[#table_ios_and_ble] の1および2は、前節で述べたアプセサリーです。

カスタムな周辺デバイスを販売したいならば、ハードウェアとその対応アプリケーション開発が必要です。市販の周辺デバイスを使うアプリケーション開発、例えば心拍センサーをつかったフィットネス・アプリケーション、もできます。その場合はハードウェアは製造を委託する、あるいは市販品を利用します。

iOS7から標準的な周辺デバイスのサポートがはじまりました ([#table_ios_and_ble] 3) 。iOS7はヒューマン・インタフェース・デバイスの HID over GATT に対応したので、Bluetooth Low Energyのキーボードが使えます。iOS8は、MIDI over Bluetooth Low Energy に対応するので、音楽データのAPIで演奏データの送受信ができます。

このようなiOSがサポートする周辺デバイスは、すでにAppStoreにある文字入力や音楽に対応したアプリケーションからすぐに使えるので、独自のアプセサリと違いiOSアプリケーションを開発する必要はありません。ハードウェアの製造販売だけで事業になります。

キーボードまたは楽器インタフェースのような汎用の周辺デバイスを、独自のアプセサリとして開発しても得られるものはありません。汎用の周辺デバイスをより多く販売するためには、多くのアプリケーションが対応していなければなりません。

カスタム・プロファイルで開発してしまうと、iOSアプリケーションを自分たちで開発するか、もしくは開発キットを広く配布して対応アプリケーションを作ってもらわなければなりません。後者の場合、iOSが既に持っている標準のAPIとは別に、その周辺デバイスのための特別な文字入力や音楽データのAPIを実装する手間に見合う魅力がなければ、対応アプリケーションが広まることはないでしょう。

### 位置と近接および存在の検出

[#table_ios_and_ble] の4は、
[iBeacon](https://developer.apple.com/ibeacon/) [^1070]というApple社の新しい位置と近接の検出技術の活用です。これは、Bluetooth Low Energyのデバイス発見につかうアドバタイズメントという仕組みを利用して、周囲に識別子情報を送信しつづけるビーコンと、それをフォアグラウンドおよびバックグラウンドで検出しつづけるiOSデバイスを組み合わせた技術です。

[^1070]: [iBeacon https://developer.apple.com/ibeacon/](https://developer.apple.com/ibeacon/)

iBeaconの活用は3つあります。

1つは電波を出すビーコンの製造販売です。Bluetooth Low Energyの電波到達範囲はせいぜい50メートルなので、店舗や建物での屋内位置検出には多数のビーコン設置が必要です。各社から、用途に合わせた多種のビーコン、安価なもの、電池で何年間も送信しつづけるもの、あるいはUSB給電の据置型など、が発売されています。

ビーコンを利用するアプリケーションは、iBeaconを利用したサービス提供側が開発するので、ビーコンの製造側がiOSアプリケーションを開発する必要はありません。ですが、ビーコンの設定や運営管理を手軽にするためにiOSアプリケーションは便利なので、たいていのビーコン製造側は販売しているビーコン専用のiOSアプリケーションを提供しています。

2つめは、アプリケーション開発およびサービス提供です。販売あるいは自社製造のビーコンを使い、建物などに用途にあったビーコンの設置およびiOSアプリケーション開発を提供します。iOSアプリケーションは、位置情報を扱う CoreLocationフレームワーク でビーコンの情報を取得できるので、iOSアプリケーション開発者は電波伝搬などの知識を持たなくても開発ができます。

iBeaconを使うiOSアプリケーション開発には、ビーコンの詳細な技術情報は必要ないので、MFiプログラムは不要です。ただし、アプリケーションやサービスを提供している建物に、iBeaconの商標やロゴを表示したい場合は、iBeaconの商標とロゴ利用に限定されたMFiプログラムへの参加が必要です。

3つめは、ビーコンも受信側もiOSアプリケーションで実現するものです。iOSアプリケーションはフォアグラウンド(画面が表示されている状態)のときに、ビーコンになれます。例えば、すれ違いの検出や、複数所有しているデバイス間で繋ぎ目を感じさせないアプリケーション連携をするなど、お互いの存在を伝える技術手段として使えます。

### ユーザを取り囲むデバイス群との連携

[#table_ios_and_ble]の5から7は、ユーザを取り囲む様々なデバイス群とiOSとの連携です。ユーザが装着する、いわゆるウエアラブル・デバイスは、生体情報検出とユーザへの情報通知デバイスとして、2014年以降に成長すると期待される分野です。また、家電も、ユーザがその内部に入る環境制御装置としてみれば、広義のウエアラブル・デバイスと考えられます。

iOS7から、iOSのロック画面に表示される通知情報を Bluetooth Low Energy で周辺デバイスに通知する [Apple Notification Center Service ,ANCS ](https://developer.apple.com/library/ios/documentation/CoreBluetooth/Reference/AppleNotificationCenterServiceSpecification/Specification/Specification.html) [^1070A] というサービスが実装されて、そのサービスの仕様が公開されています。周辺デバイスが ANCS の仕様を実装すれば、腕時計型のウエアラブル・デバイスでよくあるメールやソーシャルメディアの通知情報の表示ができます。

<!-- TBD 質問すること -->
ANCSはiOSが提供するサービスなので、周辺デバイスを開発するだけです。iOSアプリケーションの開発は不要です。ただし設定や周辺デバイスの独自の機能を利用する場合は、専用のiOSアプリケーションを開発します。ANCSにMFiプログラムが必要かいなかは、Apple社に問い合わせてください。

<!-- TBD 質問すること -->
iOSとつながるBluetooth Low Energyデバイスの開発はMFiプログラムへの参加は不要です。ですが、Apple社のアクセサリ設計ガイドライン [Bluetooth Accessory Design Guidelines for Apple Products](https://developer.apple.com/hardwaredrivers/bluetoothdesignguidelines.pdf) [^1080]には、アクセサリ設計に認証機能を取り込むには、MFiプログラムで提供される認証仕様をサポートしなければならないとあります。周辺デバイスがiOSデバイスのANCSにアクセスするとき、iOSは認証を要求します。そのためANCSを使う周辺デバイスは、MFiプログラムの対象かもしれません。

[^1070A]: [Apple Notification Center Service https://developer.apple.com/library/ios/documentation/CoreBluetooth/Reference/AppleNotificationCenterServiceSpecification/Specification/Specification.html](https://developer.apple.com/library/ios/documentation/CoreBluetooth/Reference/AppleNotificationCenterServiceSpecification/Specification/Specification.html)

[^1080]: [Bluetooth Accessory Design Guidelines for Apple Products https://developer.apple.com/hardwaredrivers/bluetoothdesignguidelines.pdf](https://developer.apple.com/hardwaredrivers/bluetoothdesignguidelines.pdf)

iOS8から[HealthKit](https://developer.apple.com/healthkit/) [^1090] が導入されました。これはiOS自体が心拍や血糖値などプロファイルが規格化されているヘルスケア・デバイスからデータを取得してiOSのデータベースに集約します。集約されたデータは、iOSの標準アプリケーション Health で表示できます。また、一般のiOSアプリケーションもHealthKitフレームワークを通じて、データベースの参照や書き込みができます。

[^1090]: [HealthKit https://developer.apple.com/healthkit/](https://developer.apple.com/healthkit/)

iOS7までは、例えばフィットネスのiOSアプリケーションを開発しようとすると、心拍センサーなどの標準的なデバイスでも、iOSアプリケーションにデバイス・ドライバに相当する部分も実装しなければなりませんでした。さらに、iOSアプリケーションはそれぞれがデータを蓄積するもので、他のアプリケーションが蓄積されたデータを参照する標準の仕組みはiOSにはありませんでした。

iO8からは、周辺デバイスからのデータ取得をiOSがおこなうので、iOSアプリケーションはアプリケーション本来の機能に注力できます。また、iOSがデータを集約するので、iOSアプリケーションをインストールすればすぐに、蓄積されたデータを過去にさかのぼり参照できます。

iOSアプリケーションはHealthKitのデータベースに書き込むことができるので、独自のヘルスケア・デバイスを開発した場合は、そのデバイスに対応したiOSアプリケーションを開発して、HealthKitのデータに書き込むこともできます。

HealthKitに対応した周辺デバイスの開発は、規格化されたプロファイル、およびカスタム・プロファイルを実装した Bluetooth LowEnergy 技術だけを使うデバイスであれば、MFiプログラムへの参加は不要です。HealthKitを使うiOSアプリケーション開発も、MFiプログラムは不要です。

iOS8で導入された家のオートメーションをもたらす[HomeKit](https://developer.apple.com/homekit/) [^1100] は、Apple社の通信仕様と、iOSアプリケーションがデバイスと通信や制御をおこなうためのHomeKitフレームワークで構成されます。

[^1100]: [HomeKit https://developer.apple.com/homekit/](https://developer.apple.com/homekit/)

HomeKitフレームワークは、周辺デバイスのグループ化とアクションを設定するものです。例えば、1階にある家電群、2階にある家電群のようなグループを設定できます。また、昼の照明設定と夜の照明設定のように、アクションを設定できます。デバイス群の操作はSiriを通しておこないます。この例であれば「1階にある照明を夜の設定にしろ」と命令すれば、グループ化とアクションの設定から、1Fにある照明群に対して、夜の設定を適用する処理を、iOSがおこないます。

HomeKitのiOSアプリケーションは、家電に付属する赤外線リモコンのように装置を個別に操作するものではなく、装置群をiOSに登録する役割を担います。また、Bluetooth Low Energyを通じたデバイスの詳細設定などの機能も必要でしょうから、専用のiOSアプリケーション開発は必要です。HomeKitを使うiOSアプリケーション開発には、MFiプログラムは必要ありません。

HomeKitに対応する家電は、Bluetooth Low EnergyまたはWiFiで通信します。それぞれMFiプログラムのもとで開示される Apple社の独自の通信仕様 Home Automation Protocol を実装します。ですから、HomeKit対応デバイスの開発は、MFiプログラムへの参加が必要です。


### AndroidとWindows Phone8の対応

周辺機器の企画作成では、対応機種が多いほど、より多く売れる感じがするため、iOS以外のモバイルOSの対応を考えるかもしれません。OS(オーエス、Operating System、オペレーティングシステム)とは、アプリケーションに基本的な機能を提供する、システム全体を管理するソフトウェアのことです。

iOS以外のモバイルOSは、Android OSがあります。このほか、2013年には、Windows Phone 8、Tizen、Firefox OS、も登場するかもしれません。

[http://www.android.com](http://www.android.com)
[http://www.mozilla.jp/firefoxos/](http://www.mozilla.jp/firefoxos/)
[https://www.tizen.org/ja](https://www.tizen.org/ja)

一般開発者から見た Bluetooth Low Energy 対応の条件は:

1. ハードウェアがBluetooth4.0に対応している
2. OSがBluetoth LEに対応している
3. ソフトウェア開発環境から Bluetooth Low Energy が使える(開発環境が一般開発者に開放されている)

の3条件が必要です。

Androidは、ハードウェアの認定要件がありません。2013年7月時点での新製品でも、Bluetooth2.0, 3.0そして4.0が混在しています。特に低価格帯にBluetooth2.0が多いようです。ただ、Bluetooth3.0の機種が、発売後にBluetooth4.0の再認証を取得してきています。発売時点で、Android OSが公式に Bluetooth Low Energy に対応していないため、ハードウェアはBluetooth4.0に対応していても、Bluetooth3.0として発売したのでしょう。

Android OSに、2013年秋頃に公開定のAPI Level18で、はじめて Bluetooth Low Energy に対応します。セントラルのみに対応していています。これ以前から、半導体や端末メーカが、それぞれ独自に Bluetooth Low Energy 開発ライブラリを提供していました。ライブラリごとに対応機種が限定されて、採用しにくいものでした。

 [https://developers.google.com/events/io/sessions/326240948](https://developers.google.com/events/io/sessions/326240948)

[http://developer.samsung.com/ble](http://developer.samsung.com/ble)

Windows Phone8は、2013年7月時点では、ハードウェア要件にBluetoothのバージョンの指定はありません。OSのサポートは、まったくありません。パソコンに使うWindows8は、ハードウェア認定要件でBluetoothは4.0を搭載することが決められています。






<!-- 電池との相性 -->
化学変化で電流を流す電池、なまもの。温度や動作条件で、性能値が大きく変化。
220 ミリアンペア時 (220 mAh)、
標準放電電流 0.1ミリアンペア。
ピーク電流は取れる、流し続けると内部抵抗が大きくなり、取り出せる電流が減っていく
この電池にあっている。


### 電波法と技術基準適合





総務省
電波利用ホームページ
http://www.tele.soumu.go.jp/index.htm

技適マーク

（免許を受けずに無線局を開設若しくは運用した場合は電波法違反となり、１年以下の懲役又は１００万円以下の罰金の対象となります。また、公共性の高い無線局に妨害を与えた場合は、５年以下の懲役又は２５０万円以下の罰金の対象となります。）

技適マーク、無線機の購入・使用に関すること http://www.tele.soumu.go.jp/j/adm/monitoring/summary/qa/giteki_mark/


第110条　次の各号のいずれかに該当する者は、１年以下の懲役又は100万円以下の罰金に処する



### クラシックBluetooth と Bluetooth Low Energy の利用場面の違い


モジュールは2種類。
デュアル・モード
シングル・モード
Bluetooth Smart Ready 機器と Bluetooth Smart 機器



Bluetooth Low Energyという技術の理解は、超低消費電力で無線通信ができるもの、程度で十分です。ハードウェアやソフトウェアは、本質のアイディアや技術仕様への要求がはずれていなければ、プロがやってくれる。

流れ、Bluetooth Low Energy という技術が、なぜ周辺機器が登場しているのか、その周囲の流れ、状況、ちょっと概要を、ヒトコトではちょっと足りない。かいつまんでみます。

スマートフォンと直接つながる、同時に10台つながる。
BLEらしさは何も使っていないようだけど。
Wi-Fiとの使い分け。

iOSアプリケーションも、HomeKitを使って提供できます。
、HomeKitがあれば

構成
複雑、シンプル


また、家電それ自体と
ユーザの位置をモニタして、ユーザが玄関近くに移動したならば、玄関の照明を点灯させるiOSアプリケーションを、開発することも可能でしょう。

HomeKitを通じて、
玄関近くに

が玄関の照明
帰宅時に

誰かが開発した
HomeKit対応の電球メーカが、その電球をiOSに登録するアプリケーションを提供すると
と同じ体験


HomeKitでは、
iOSアプリケーションが対応家電の登録と操作

HomeKitに対応した家電を購入しただけでは、
登録、
Siriでもできるけど。操作、リモコン。

アプリケーション、使われ方、使われる場面の両方を提供。
家電メーカが作った規格、
2014年で8億台[^0120]を超える
iOSデバイスの累計販売台数、
iOSアプリケーションは、
HomeKit対応の家電


エコシステム

[^0120]: これは、The Apple Worldwide Developers Conference（WWDC）2014 基調講演で発表された数値で、iPod touch 1億台、iPad 2

Bluetooth Low Energy は、
無線通信回路が低価格で電球
スマートフォンのアプリケーションから直接接続できる。
Wi-Fi、1つしか繋げない。ルータがないと、不便がある。

Bluetooth、iOSに限定されない技術と、AndroidやWindows Phoneで使える技術。

Wi-FiまたはBluetooth Low Energy

統合することもできるし、電球とか。近接通信通信。
iPhoneと直接接続、多数のWi-Fi。家にルータ。

電球1つではじめられる。








Bluetooth3.0までは、ヘッドフォンやキーボードといった種類ごとに、通信でやりとりするデータがどんな意味を持つのかを、1つ1つ決めていました。Bluetoothのプロファイルにない、オリジナルのデバイスを開発する用途には、シリアル・ポート・プロファイル (Serial Port Profile, SPP) という、バイナリ・データの通信を提供するプロファイルを使い、パケットのレベルで独自の開発が可能でした。

Bluetooth Low Energyは、通信から見るのではなく、まず物の持つデータ構造を表現するデータベースの仕組みと、そのデータベースの読み書き方法を定義して、それを実現するための通信方式が作られています。物の内部機能はサービスという単位で表現されます。

物の持つデータをデータベースとして表現する方法を提供して、通信を意識せずに、そのデータベースの読み書き
その物が持つ内部機能を
サービスという単位で表現

プロファイル。

Bluetooth Low Energy
データがどんな意味を持つのかは

Bluetooth3.0までは、ヘッドフォンやキーボードといった種類ごとに1つ1つ規格を作っていました。

ですが、身の回りにある膨大で多種多様な物に、それぞれ規格を作ることは手間がかかりすぎるので、従来のこの方法では対処できません。

Bluetooth Low Energy は、
物がもつ機能をサービスという概念で表し、サービスをどう組み合わせて使うか(これをプロファイルと呼びます)

物の振る舞いをそのサービスの組み合わせと使い方で
キーボードや心拍センサといった一般的な領域ごとに規格を提供する








その





キャラクタリスティクスというデータ構造で表現して、その物の振る舞いをプロファイルと
この方法では


 Bluetooth Low Energy 
Bluetooth Low Energy は、
多種多様な物

無線通信には、必ず2つのデバイスが必要です。
ですから、新しい無線通信技術が一般に広く使われるまでには、通信相手となるデバイスが普及するための長い時間がかかります。

無線通信には、必ず2つのデバイスが必要です。
新しい無線通信規格が一般に普及するには、それに対応したハードウェア通常長い時間がかかります。


無線通信技術は、必ず通信相手がいます。ですから、Bluetooth Low Energy が使われる場面は、それを使うユーザと、Bluetooth Low Energy を搭載した物、そしてiPhoneなどの通信相手の3つが必ず登場します。

このように、うえで、 iPhone の存在なくして Bluetooth Low Energy のユーザ体験は語れません。そこで本書は、 iPhone を中心として Bluetooth Low Energy の利用場面を示していきます。

また、





Android も2013年7月にリリースされた Android4.3 から Bluetooth Low Energy に対応しましたが、iPhone の Bluetooth Low Energy 活用は、更にその先へと

2013年7月 Android4.3







## Bluetooth Low Energy の無線通信技術
<!-- 個々イントロ -->
<!--通信規格、技術的に深堀り。-->






### Bluetooth Low Energy の無線通信

[#table-ble-specification ]に、Bluetoot LEの特徴を示します。

Table: #table-ble-specification Bluetooth LEの無線通信の概要

項目               | 値                    
------------------|----------------------
周波数             |   2.400-2.4835 GHz    
物理層のビットレート | 1 Mbps                
通信送信電力        | 10ミリワット ~ 10マイクロワット
伝達距離           |  50 メートル (見通し)          


Bluetooth LEが利用する周波数は、クラシックBluetoothと同じです。周波数が同じなので、デュアル・モードのデバイスは、アンテナや高周波回路をクラシックBluetoothとBluetooth LEで共用できます。

通信のビットレートは、1Mbpsです。これは0,1というビットの通信速度です。Bluetooth LEでは、データは決められた時間周期ごとにパケットの送受信でやりとりします。パケット自体の通信速度は1Mbpsですが、常にパケットが流れ続けられる規格ではないので、パケットのやり取りによる実際の通信速度は、300kbps程度になります。Bluetooth LEデバイス間の通信速度は、通信パラメータで大きく異なります。iOSデバイスでの通信速度は、おおよそ10 Kバイト/秒です。

Blueooth LEの送信電力は、最大10mW、最小10 μWです。最大出力電力時の通信距離は、見通し距離で150m程度になります。距離は、受信回路の感度や送受信アンテナの利得(高周波電力を電波にして空間に放つ効率)が高ければ、これより大きくなるかもしれません。また、建物の壁などの遮蔽物があったり、見通しではない環境では、通信距離は見通し距離よりもずっと短くなります。目安としてオフィスで30m程度は通信できます。<!--TBD 確認-->

送信電力は、Bluetooth LEデバイス内部のソフトウェアから設定できます。ハードウェアで固定されないので、状況に合わせた、必要な通信距離が得られるような、送信電力の設定動作が可能です。例えば位置ビーコンであれば、位置を知らせたい範囲内に届く程度に送信電力を設定します。またiPhoneに取り付けるキーホルダのように、常に近距離にあるものならば、通信距離が数メートル程度になるように、送信電力を絞り込むこともできるでしょう。

### Bluetooth LEのネットワーク



<!--TBD: スター型の図、アドバタイズメント、iPhoneを中心にペリフェラル, iPhoneがペリフェラル-->

<!-- 接続手順 -->
マスターとスレイブのの接続手順は:

* スレイブがアドバタイズメント・パケットを送出
* マスターが、接続要求を出して接続
* 通信
* 切断

です。

まず、マスターがスレイブがあることを知らないといけません。スレイブは、機種情報や個体識別番号などが入ったアドバタイズメント・パケットを送出します。どのマスターでも、アドバタイズメント・パケットを受信できます。アドバタイズメント・パケットは、スレイブが、まだどのピコネットにも属していないときにだけ、送出できます。

Bluetooth LEの特徴は、スレイブの発見がとても早いことです。アドバタイズメント・パケットは、最小20ミリ秒周期(1秒に50回)で送出できます。アドバタイズメント・パケットは、は、アドバタイズメントのために割り当てられた特定の周波数範囲で送信することで、マスターはほぼ確実にこのパケットを受信できます。実際に、デバイスの発見に1秒もかかりません。<!--TBD 実験-->

アドバタイズメント・パケットを受信してスレイブを発見したマスターは、接続要求を出して接続を確立します。接続している間、スレイブはそのマスターのピコネットに属します。接続したマスターとスレイブは、そのマスターとスレイブだけが知っている切り替え順番で、通信に使う周波数領域を切り替えながら、通信します。これを適応周波数ホッピング方式と呼びます。


スレイブは、同時に2つ以上のピコネットに属することはできません。必ず1つのピコネットに属します。スレイブとの接続は特定のピコネットに縛られることはありません。任意のマスターと接続できます。スレイブが別のピコネットに接続するときは、まず接続を切断してから、別のマスターとの接続処理をおこないます。

切断要求は、マスターからでも、スレイブからでも、出すことができます。また、マスターとスレイブは、それぞれ一定時間通信ができなければ、切断とみなします。接続切断したスレイブは、またアドバタイズメント・パケットを送出して、次の接続要求が来るのを待ちます。

Bluetooth LEのネットワークは、とてもシンプルな設計です。接続が切断しても再接続をしたりしません。クラシックBluetoothは、iOSの設定アプリケーションから、ユーザに、スレイブとのネットワーク接続をしてもらわなくてはなりません。Bluetooth LEは、しかし、スレイブの発見と接続が速いことに加えて、iOSアプリケーションがスレイブとの接続処理を直接実行できます。接続切断時は、iOSアプリケーションで再接続が必要だと判断すれば、iOSアプリケーションから接続処理を再開できます。これにより、なんの不便もありません。

<!-- 追加 -->
他の超低消費電力無線通信技術には、例えばZigbee、他のデバイスからの通信を他のデバイスに中継する、マルチホップ通信の機能があります。マルチホップ通信ができれば、広域に散らばった多数のデバイスがネットワークを形成して、例えばセンサネットワークなどを、デバイス単体で構築出来ます。


### プライバシーとセキュリティ

無線通信の電波は四方八方に飛んでいくため、その通信がいつどこで傍受されるかは、わかりません。Bluetooth LEの規格は、利用者のプライバシーと、通信内容が第三者に漏れないセキュリティを考慮しています。

まず、無線通信は、その通信内容から容易に人物を特定して追跡できるものであっては、なりません。Bluetooth LEのマスターとスレーブは、互いを識別するために、通信でアドレスを使います。もしも、誰かのスレーブのアドレスが分かっていれば、傍受した通信からそのアドレスを探すことで、その人がいつどこにいるかを容易に追跡できてしまします。

<!-- アドレスの解説 -->
Bluetooth LEのアドレスには、パブリック・アドレスとランダム・アドレスの2つがあります。パブリック・アドレスは、製造企業が割り当てる固定値のアドレスです。このアドレスは製品が作られた時に書き込まれ、変化することはありません。もう1つの、ランダム・アドレスは、文字通り、ランダムなアドレスです。スレイブの電源を入れた時に、ランダムなアドレスが設定され、さらに15分毎に、あるルールに従って、別のランダムなアドレスに変更されます。

<!-- アドレスの選択-->
プライバシーを守るために、パブリック・アドレスを使うか、ランダム・アドレスを使うかは、そのデバイスの使われ方などで、設計者が決めます。

<!-- 通信路暗号化 -->
セキュリティーを確保するために、パケットのデータ自体を暗号化できます。スレーブはマスターに接続するときに、パケットのデータを平文(暗号化しない)とするか、AES(Advanced Encryption Standard)という暗号方式を使うかを、マスターに通知します。

<!-- 実装の選択 -->
プライバシーとセキュリティをどうするかは、利用場面にあわせて選びます。プライバシーとセキュリティを求めると、Bluetooth LEでは、スレイブとの接続時に、少し手間がかかります。

ランダム・アドレスを採用すると、例えば、スレーブの電源がOFF/ONされると、アドレスが再生成されます。そのため、iOSアプリケーションには、そのスレイブが以前に接続したものだと、識別できなくなります。ですから、例えばスレイブの電池交換をするたび、iOSアプリケーションでの接続設定が必要になります。

セキュリティーを採用すると、マスターが初めてスレイブと接続する時に、iOSアプリケーションから、iOSの設定アプリのBluetooth設定に表示が遷移します。スレイブの接続が完了すると、クラシックBlueoothと同じく、このBluetooth設定にデバイス名が表示されます。これは、暗号化につかう鍵がiPhoneに保存されたことを、示しています。このBluetoothの接続を削除すると、鍵が削除されます。


## iOSと周辺機器のインタフェース

Bluetooth LEは、iOSと周辺機器との接続手段、インタフェースの1つです。Bluetooth LEはMFiプログラムが必須ではないので、たしかに取り組みやすいのですが、想定する利用場面に使えるのか、あるいは他により適切なインタフェースがないかを検討することは、必要です。

インタフェースは用途似あわせて、適切なものを選択します。ここでBluetooth LE以外のインタフェースをみてみます。

### 有線インタフェース

iOSには、有線インタフェースと無線インタフェースがあります。

有線インタフェースは、ドックコネクタがあります。iPhone4Sまでの30ピン ドックコネクタと、iPhone5以降のライトニング  ドッグコネクタの2種類があります。ドックコネクタを通じて、USB2.0、480Mbpsのビットレートでの通信ができます。

ドックコネクタのハードウェア開発情報を入手するには、MFiプログラミングの参加が必須です。これに参加して提供される、ドックコネクタの認証チップは、Apple社の承認を受けた正規の製品であることを、ドックコネクタを通じてiPhoneに通知します。また、その製品に対応したiOSアプリケーションがiPhoneにないときは、ダウンロード画面を表示させます。

しかし機能実証のための試作で、MFiプログラムに参加するのは時間も費用もかかります。試作であれば、MFiプログラムに参加せずにドックコネクタを使うには、2つの方法があります。

* シリアル・アダプタを利用する
* MIDIインタフェースを転用する

ドックコネクタのシリアル・アダプタが60ドル程度で販売されています。115.2kbpsまでのシリアル通信ができます。試作に用途が限定されており、このアダプタに接続するiOSアプリケーションをAppStoreに出すことは、利用規約で禁止されています。

[http://www.redpark.com/c2db9.html](http://www.redpark.com/c2db9.html)

演奏装置のインタフェース規格 MIDI(ミディ、Musical Instrument Digital Interface)のドックコネクタ・アダプタが一般に販売されています。MIDI規格は、演奏データをシリアル通信で送受信するものです。このインタフェースを転用して、サーボモータを動かすデモンストレーション例があります。iOSアプリケーションのAppStoreの承認は、この方法を使うiOSアプリケーションがAppStoreで見つからず前例が見つけられないので、わかりません。

[http://youtu.be/S90heTt5-Ko](http://youtu.be/S90heTt5-Ko)

また、音響モデムの原理を利用して、イヤホン端子でデータ通信をするワザもあります。これは10kbps程度の通信ができます。iOSアプリケーションのストア承認は、AppStoreの担当者との交渉次第です。

[http://web.eecs.umich.edu/~prabal/projects/hijack/](http://web.eecs.umich.edu/~prabal/projects/hijack/)


### 無線インタフェース

iPhoneの無線インタフェースは、WiFi、Bluetooth(クラシックBluetoothとBluetooth LE)です。それぞれのビットレートとMFiプログラムの要不要をまとめます ( [#table-wireless-speed-list] )。

Table: #table-wireless-speed-list 無線インタフェースの通信速度

名称              | 物理層のビットレート | MFiプログラム | 接続設定
-----------------|------------------|-------------+---------
無線LAN (802.11g) |54Mbps             | 不要         | 必要
Bluetooth2.0     | 3Mbps             | 必須         | 必要(※)
Bluetooth LE     | 1Mbps             | 不要         | 不要

※Bluetoothの標準プロファイルを利用する場合はMFiは不要。

#### 無線LAN

無線LANは、最も高速な無線通信です。動画のストリーミングなど、高い通信速度が必要な用途には、無線LANを使います。通信速度が早いほど、電力消費量も大きくなります。ですから、大容量の電池を搭載していて頻繁に交換や充電をおこなう機器、例えばラジコンなどには、自然に適用できます。また、通信頻度や通信速度が低くてもよい分野に特化した、単三電池電池で数ヶ月も長期間動作するような、低消費電力の無線LANモジュールもあります。

[http://www.gainspan.com/](http://www.gainspan.com/)

無線LANの接続形態は、機器と1対1で接続するアドホック・モードと、複数の機器と無線LANルータを介して接続できるインフラストラクチャ・モードの2つのモードです。

インフラストラクチャ・モードは、無線LANルータが必要なので、屋内など移動しない場合に使えます。移動したり屋外での利用では、無線LANルータがあるとは限らないので、アドホック・モードを使います。周辺機器とアドホック・モードで接続すると、iPhoneの無線LANは、その機器に専有されます。もしもこのときに、外部ネットワーク接続が必要になると、WiFi以外の、3G通信かBluetoothでのテザリングを使うしかありません。

無線LANは、ユーザによる設定が必要です:

* 無線LANの接続先の設定
* iOSアプリケーションのダウンロード
* 接続機器のIPアドレスの入力

無線LANの接続先は、設定アプリからユーザがおこなう必要があります。さらに、インフラストラクチャ・モードのときは、iOSアプリケーションに、接続先機器のIPアドレスの設定が必要になります。この無線LANの設定手順は、図入りで説明した説明書を別に用意しておくとよいです。設定アプリに画面遷移してしまうので、iOSアプリケーションに設定方法を表示する方法が使えません。ですから設定アプリを見ながら設定するときに説明書があれば、ユーザが迷いにくくなります。

無線LANを使う周辺機器には、MFiプログラムは必要ありません。MFiプログラムが必要ないということは、逆に、Apple社から、機器接続やiOSアプリケーションのインストール方法などの特別の配慮を受けられない、ことでもあります。

ユーザ自身が、機器に対応するiOSアプリケーションをダウンロードしなくてはなりません。機器に接続しても、iOSアプリケーションは自動でダウンロードされません。

また、例えばUPnP(ユーピーエヌピー，ユニバーサルプラグアンドプレイ、Universal Plug and Play)やBonjour(ボンジュール)など、ネットワークに接続すれば、ユーザが設定をしなくても機器が使用可能になる、ゼロ・コンフィギュレーション技術を使えば、IPアドレス設定などを不要に出来ます。しかし、iOSからゼロ・コンフィギュレーション技術は提供されていません。必要であれば独自に実装します。

#### クラシックBluetooth

ここでは、Bluetooth LEと区別するために、Bluetooth3.0での技術をクラシックBluetoothとよびます。

クラシックBluetoothは、常時接続してデータを送り続ける用途に適し、通信速度も高いので、ヘッドセットやテザリングなどに利用できます。クラシックBluetoothの接続は、iPhoneに多数の周辺機器が接続するスター型です。コインサイズの小さなリチウムイオン電池で、1週間程度の通信ができます。電池交換は頻繁すぎて不便ですから、充電式に設計されます。

クラシックBluetoothでは、通信のみならず接続機器の振る舞いまでを含んだ機能を、プロファイルと呼びます。パソコンで言えば、通信プロトコルのみならず、デバイスドライバの仕様までを含むものが、プロファイルと呼ばれます。

プロファイルには、キーボードやマウスなどの入力装置、メールや電話着信の通知など、様々なものが定義されています。利用目的にあったプロファイルがすでにあれば、それを利用して少ない開発労力で機器開発ができます。

[Bluetooth Developer Portal, Profiles Overview](http://developer.bluetooth.org/TechnologyOverview/Pages/Profiles.aspx#Profiles)

クラシックBluetoothデバイスとの接続に、まずペアリングが必要です。ペアリングはiOSが処理するため、ユーザは、設定アプリのBluetooth設定で、デバイスを選択してペアリングをします。接続が切れるたび、ユーザによる接続操作が必要です。

クラシックBluetoothのプロファイルに従う周辺機器には、MFiプログラムは不要です。しかし、利用できるプロファイルがなく、iOSアプリケーションと直接通信したい場合は、MFiプログラムへの参加が必須です。

プロファイルの利用例として、例えば、iOSデバイスと接続できるバーコードリーダがあります。バーコードリーダ専用のプロファイルはありませんが、例えばキーボードに使うHID(Human Interface Device Profile)を採用して、読みだしたバーコード情報をテキストで送信して、iOSアプリケーションに情報を伝えることができます。

クラシックBluetoothでは、任意の通信には、SPP(Seerial Port Profile)を使います。このプロファイルは、端末間の通信を決めるものです。接続先に、端末内部で動作しているアプリケーションまでを指定する仕組みはありません。

MFiプログラムに参加すると、iOSアプリケーションと接続するための認証チップを含むハードウェアなどの開発キットが提供されます。この認証チップは、Apple社が承認した周辺機器のみがiOSアプリケーションと接続できる排他的な振る舞いをしますが、同時に、SPPに欠けている、モバイル機器には必要な、周辺機器が指定されたiOSアプリケーションにのみ接続する仕組みも、提供しています。































おもちゃ。ラジコン的な。

ベンチャー企業。
置き忘れ防止タグ。姿勢検出。ウエアラブル機器。メガネ系デバイス。
単体ではキツイけど、スマートフォンと連携することで初めて意味がある。


[Flipboard: iOSとかの、おもしろハード](http://flip.it/HSH3C) [^2020]


[^2020]: [Flipboard: iOSとかの、おもしろハード](http://flip.it/HSH3C)


### iOSとBluetooth Low Energy

iOSと連携するもの。
iBeacon
Apple Notification Center Service
HealthKit
HomeKit





























## 身近な Bluetooth Low Energy 

Bluetooth Low Energy という超低消費電力無線通信技術を使えば、低コストで使い捨ての電池(1次電池)で長期間動作するハードウェアが実現できること、そして、iOSが多種多様な周辺デバイスとアプリケーションをつなぐ開発環境を提供していることで、多種多様な周辺デバイスが生み出されてきています。ですが、まだ身近な存在というほどではありません。

最初に Bluetooth Low Energy を利用した周辺デバイスが登場したのは、フィットネスやサイクリングといった分野です。これらの分野では、Bluetooth Low Energy 登場以前から、運動強度を計測するための心拍センサやパワーメータといった無線接続の計測デバイスが普及していました。iOSデバイスと接続できる新たな付加価値として、これらの商品群から Bluetooth Low Energy に対応してきました。

これらの分野を除くと、Bluetooth Low Energy を使った周辺デバイスは、まだそれほど身近にはありません。新しい周辺デバイスは新しい利用場面をもたらしますが、その新しさゆえに普及には時間がかかります。電車で利用している人を見かけるほど一般に普及するには、話題になり急速に普及したとしても2~3年はかかるでしょう。

まずは、通信販売で手軽に購入ができる Bluetooth Low Energy 対応の周辺デバイスとして、フィットネスに使われる心拍計を取り上げ、そのユーザ体験と、その体験を支えている無線通信通信とアプリケーションの概要を見ていきます。

### Bluetooth Low Energy の心拍計体験

Bluetooth Low Energy が体験できる最も身近な分野は、フィットネスです。この分野では、Bluetooth Low Energy が登場する以前から、適切なトレーニング効果を得るために、ランニングや屋内トレーニングでの運動強度や心拍数の計測がおこなわれています。

体を動かしていても安定して脈拍が取れる心拍計には、胸ベルト型と腕時計型の2種類があります。

胸ベルト型は、胸に巻き付けたベルトに電極と本体がとりつけてあるもので、心臓の筋肉が動くときに生じる微小な電気信号から心拍を検出します。各社から製品が出ていますが、例えば、米国 [Wahoo Fitness L.L.C.](http://www.wahoofitness.com/)[^1010] の Blue HR および TICKR RUN などの製品があります。

[^1010]: [Wahoo Fitness L.L.C.](http://www.wahoofitness.com/) 

腕時計型は、時計の文字盤部分の裏面に発光素子と光検出センサーが取り付けてあるもので、皮膚の散乱光の強さから脈拍による血流量変化、つまり心拍を検出します。これも数社から製品が出ていますが、例えば、米国 Physical Enterprises Inc. の [Mio ALPHA Heart Rate Watches](http://www.mioglobal.com/) [^1020] があります。

[^1020]: [Mio ALPHA Heart Rate Watches](http://www.mioglobal.com/) 

これらのデバイスは各社のサイトあるいはアマゾンなどから通信販売で購入できます。入手した心拍計をiOSデバイスと接続して使う手順は、次の3つです。

1. アプリケーションのインストール
2. iOSデバイスと心拍計との接続
3. 心拍数の計測

まずiOSデバイスにアプリケーションをインストールします。AppStoreで検索すると Bluetooth Low Energy の心拍計に対応したiOSアプリケーションが数多く見つかります。心拍計を販売する会社が自社製品を使うために提供しているものや、トレーニング専用アプリケーションが心拍計測にも対応しているものなど、アプリケーションの開発元も提供目的も様々です。

ここでは Bluetooth Low Energy の半導体を開発販売しているノルウェーの [Nordic Semiconductor ASA](http://www.nordicsemi.com) [^1030] が出している [nRF Toolbox](https://itunes.apple.com/jp/app/nrf-toolbox/id820906058) [^1040] を使います。

[^1030]: [Nordic Semiconductor ASA](http://www.nordicsemi.com)
[^1040]: [nRF Toolbox](https://itunes.apple.com/jp/app/nrf-toolbox/id820906058)

<!-- 図を入れること、a)アプリケーション画面、b)BT設定ダイアログがでているところ、 c)心拍の画面 -->

実際に心拍計に接続してアプリケーションから利用してみます。

まず、アプリケーションをインストールします。次に、iOSデバイスと心拍計を接続して、心拍値を見てみます。アプリケーションを立ち上げると、デバイスの種類を選択するアイコン一覧画面が表示されます<!-- a)アプリ画面 -->。この画面中央にある下にHRMと書かれたハートマークのアイコンをタッチして選択します。このHRMは、heart rate monitor 心拍計の略称です。


ここで心拍計を装着します。Bluetooth Low Energy は超低消費電力無線通信技術ですが、周辺デバイスが常に電波を送信するように作られているかどうかは、設計次第です。心拍計のような利用している間だけ無線接続ができればよいものは、装着して心拍計測している間だけ無線通信するように設計されてるものが多いです。

胸ベルト型の心拍計であれば、たいていは、装着されて皮膚に接触したことを検出した心拍計が、自動的に計測と無線通信を開始します。腕時計型のMIO ALPHAであれば、本体右側のボタンを長押して心拍計測を開始することで、計測と無線通信が開始されます。

心拍計の計測を開始したなら、心拍計のモニタ画面<!-- c)心拍の画面-->の下にある"Connect"ボタンを押します。これでiOSデバイスと心拍計との無線接続が確立されます。

このとき、iOSデバイスの Bluetooth がオフだと、Bluetoothをオンにしてくださいというダイアログが表示されます<!-- b)-->。このダイアログの"設定"ボタンを押すか、あるいは自分で設定アプリを立ち上げて、Bluetoothの電源をオンにします。

心拍計が無線通信を開始していて、iOSデバイスのBluetoothがオンになっていれば、デバイスの一覧リストに心拍計があるはずです。デバイスを選択すれば、iOSデバイスと心拍計の無線接続が完了して、一定時間ごと更新される測定値が数値とグラフで表示されます<!--c-->。

従来のBluetooth3.0までの周辺デバイスと違い、Bluetooth Low Energy の周辺デバイスの発見および接続と切断は、すべてiOSアプリケーションから操作ができます。

また、アプリケーションがバックグラウンド状態になっても無線通信を継続できます。ですから、別のアプリケーションに移動したり、あるいはロック画面が表示されても、nRF Toolbox のアプリケーションはデータを受信し続けられます。

画面下の"Disconnect"ボタンを押すと、iOSデバイス側から心拍計との無線通信を切断します。あるいはiOSデバイスから遠くに離れて電波が届かなくなると、無線通信は切断します。

無線通信が切断すると、心拍計は再接続ができるように再接続のための電波を送信し続けます。ですから、iOSデバイスに電波が届く範囲にはいれば、心拍計を再発見して自動的に再度接続するiOSアプリケーションが作れます。

残念ながら、この nRF Toolbox のアプリケーションは、自動で再接続するようには作られていません。そのため、ユーザが画面下の"Connect"ボタンを押して再接続させます。

### クラシックBluetoothでの体験

本書は、Blutooth Low Energy を統合した Bluetooth4.0 と、それ以前の Blutooth Low Energy を含まないBluetooth3.0までのBluetoothとを区別するために、Bluetooth3.0 までの Bluetooth を、クラシックBluetooth と呼ぶことにします。

もしも心拍計をBluetooth3.0 までの技術、クラシックBluetooth の技術で作ると、どんな体験になるかを見てみます。

アプリのインスト、無線接続、利用、一緒。
ただし設定画面のみから、ユーザが、
無線接続と切断はユーザが行う。

アプリの開発、特定の製品に対して。開発。"心拍計"というジャンルは、クラシックBluetoothには、ない。iPhoneの開発になるから。

信頼できる機器だと、4桁もしくは6桁の数値(PINコード、ピンコード)を入力して接続。(ペアリング)

2年程度は通常の使い方で、電池は1日は持たない。充電式。
アプリケーションの対応が必要。ちょっと特別。

細かいところ、製品にMFiのロゴマークが掲載されている。




















#### クラシックBluetooth の無線通信技術

まず、クラシックBluetooth の無線通信技術を見ていきます。

当然のことですが、無線通信は電波で情報をやりとりするので、電波でデータを送受信する2つの何かがあって初めて通信が成り立ちます。そしてユーザには、2つのデバイスが無線で通信をして期待する動作や機能をすることが、当然だと思われます。

この当然を実現するには、2つのそれぞれのデバイスに:

1. お互いを発見する仕組み
2. 無線通信をする仕組み
3. データをやりとりするタイミングおよびデータの意味と機器の振る舞いの定義

の3つの仕組みが必要です。

このうち1と2は、Bluetoothに限らず無線LANなど、一般的な無線通信が必ず備えている仕組みです。3は、無線で接続した2つのデバイスが相互に機能するために不可欠な要素です。

パソコンであれば、インストールするアプリケーションで、様々な機能に対応できます。ですが、Bluetoothを採用する周辺デバイスは、設計時点で機能に合わせてハードウェアとソフトウェアが作り込まれる装置です。ですから、あとからソフトウェアを入れ替えて機能を変更することが、できません。ですから、この3が相互接続のために重要なのです。

<!-- TBD Bluetoothのロゴマークを掲載 -->

クラシックBluetooth は、より早い通信速度でより低消費電力で、隣り合うデバイスを無線で接続する技術として発展してきました。イメージとしては、電気配線のための電線を文字通りワイヤレスにするための技術、と思えばわかりやすいでしょう。

クラシックBluetoothでは、ヘッドセットやキーボードといった応用機器の種類や用途ごとに、通信と機器の振る舞いを決めていて、それをプロファイル(Profile)と呼びます。

そして、所定のプロファイルに適合していると認定をうけたデバイスに、 Bluetooth の青色のロゴマークの表示が許されます。これらがあるおかげで、ユーザはBluetoothのロゴを見るだけで、それが何年も前に開発されたデバイスであっても、開発販売している会社が聞いたこともない会社であっても、それらのデバイスを無線で相互接続して使えるのです。

#### クラシックBluetooth のプロファイル

クラシックBluetoothは、通信と機器の振る舞いをあわせて1つのプロファイルとして定義して、規格としているところが、ポイントになります。

通信には必ず、通信速度と遅延時間、2つの要素、


使ったiOSデバイスの周辺デバイスの仕組みを見ていきます。
これが クラシックBluetooth の無線通信技術の概要です。





月まで往復、
パケット(データの小さい塊)やりとりするタイミング、
実質の通信速度



Hands-Free Profile(HFP)
Advanced Audio Distribution Profile (A2DP)

通信はかならず

つなぐ技術

無線通信は必ず相手。
機器の振る舞い。
通信の性質。電話するときのヘッドセット、データが欠損しても、再送しない。相手の話が遅れてはしかたない、リアルタイム。音質はそれなり。音楽を聞くときのヘッドフォンでは。遅れる時間があってもいいけど、ぶっつっときれてはしかたない。

#### クラシックBluetoothとiOSの周辺デバイス

アプリとハードの構造。
SPP。
デバイス間、どのアプリ? 判定。正しいハードウェアなのか?
ただの通信路。

クラシックBluetooth を使うiOSデバイスの周辺デバイスは、Apple社とMade for iPhone Program (MFi Program、エムエフアイ・プログラム)という秘密保持契約を締結することで、初めて開発ができます。

通信を維持するだけで ~10ミリアンペア (mA)。
1500ミリアンペア時 (mAh)。電圧変換とかあるから、正しくないですが、目安として 150時間程度。

12 x 28 x 5.7 mm 110mAh 
12 x 16 x 5   mm 40mAh


通信規格が違う。

ハードウェアが違ってくる。機能と振る舞い。

アプリケーションの作り方が違う。
MFi、外部アクセサリのフレームワークとCoreBluetoothのフレームワーク。
通信制御の振る舞いが違う。アプリが完全にもっていける。PIN入力がない、接続と切断がアプリ管理。バックグラウンドで通信しつづけられる&発見、接続切断も。

Bluetooth3.0までの、
クラシックBluetoothで作ったらどうなるか。

作りやすさ。
MFiが不要。電波法とか電磁放射、その他規制やら認定やら。
多種多様なデバイス、
アプリケーションが全てを牛耳っているから、
電池消費量、使い捨てとか、半年程度。

ハードウェア、
心拍を検出、電位で、信号処理とか。増幅とかアナログの。

無線通信、
せいぜい1秒に50回。その時に、変更があれば。通信は、スループットとレイテンシ(遅延時間)。
無線通信する時間を極小。

サービスとキャラクタリスティクス。
ATT/GATT。モジュール化。値の変更。機能と振る舞いを分離している。
キャラクタリスティクスは、センサ値、機器の制御目標値と内部状態。

プロファイル、
標準プロファイル。かってなカスタムプロファイル。

アプセサリ
売ってからが大事。体験。














### アプセサリと心拍計

ここまでの心拍計の体験では、心拍値がiOSデバイスでみられるだけなのかと思うでしょう。そのとおりです。それは、nRF Toolbox が心拍計測のデモンストレーション用アプリケーションで、これは周辺デバイスの体験だからです。アプセサリの体験ではないからです。

Bluetooth Low Energy の周辺デバイスとアプリケーションとが連携して、はじめてアプセサリになります。例えば、ランニングのアプリケーションであれば、心拍値をもとにユーザにトレーニング内容の音声ガイダンスが流せます。また、心拍数をずっと計測しつづけることで、ストレスや心理状態まで推定するアプリケーションが作れるかもしれません。

このように、心拍計というデバイスが1つ登場するだけでも、iOSデバイスの活用場面が無数に生まれます。

ですが、iPhone自体に心拍計測機能が搭載されることは、ありえないでしょう。というのは、安定して心拍を計測し続けるには、腕時計型にしろ胸ベルト型にしろ、デバイスがユーザの皮膚と接触していなくてはなりません。ですが、肌にiPhoneが触れ続ける利用場面は、ランニングのように限られた場面ではあるかもしれませんが、一般的ではありません。

利用場面が限られて一般的ではなかったり、あるいは物理的に設置できないためiOSデバイスには搭載されない機能でも、無線でiOSデバイスにつながる周辺デバイスがそれらを提供することで、iOSデバイスだけでは生まれない可能性が生まれるのです。

また、心拍計というデバイスがiOSアプリケーションと連携することで、これまでなかった心拍計の活用場面が生まれます。

トレーニングでの活用はもちろんですが、iOSアプリケーションがあることで、心拍計というハードウェア単体では実現ができなかった、計測値の記録保存や解析、またネットワーク・サービスとの連携が可能になります。例えば、何百万人ものユーザの年単位での計測データがネットワーク・サービスに蓄積していれば、それらを統計的に解析することで、ユーザそれぞれの疲労度やストレスを数値化して、ストレッチング運動などでそれらを低減していく、新しいサービスが生まれるかもしれません。

周辺デバイスは、購入しやすい価格で製造するために、メモリや処理能力はなるべく小さく設計されます。また、そのデバイスが破棄されれば、内部に保存されたデータも失われます。しかしiOSアプリケーションと連携することで、単なるデバイスでは実現できない膨大な記録容量や処理能力が使えます。さらに、データがネットワーク側に保存することで、デバイスの寿命を超えてたユーザ・データの蓄積が可能となります。

そして、アプセサリとなった周辺デバイスは、もはや単なるハードウェアではなく、提供サービスの重要な1要素になります。

例えば、トレーニングのネットワーク・サービスを考えてみます。iOSアプリケーションそしてネットワーク・サービスに、心拍や走行距離などのユーザ・データが記録蓄積されます。これらのデータがあると、同じサービスを利用するユーザ間での競争や、あるいはFacebookやTwitterなどのソーシャル・メディアで達成度を共有するユーザ体験が提供できます。

蓄積されたユーザ・データは、そのサービスを使い続ける大きな理由になります。例えば、ユーザのトレーニング・データは、サービスそれぞれが独自形式で蓄積していますから、あるサービスから別のサービスにデータを移し替えることは困難です。ですから、蓄積したデータを捨て去りゼロからデータを蓄積してまで使いたくなる魅力でもないかぎり、ユーザがサービスを変更することはないでしょう。

周辺デバイスはネットワーク・サービスの収益構造を変化させます。ユーザはサービスを利用するために周辺デバイスを購入するので、周辺デバイスの売上がネットワーク・サービスも含むサービス全体の売上となります。そして周辺デバイスは、適度な周期で買い替えられます。

例えば、心拍計や活動量計などの身につける周辺デバイスは、洗濯したり落としたりして破損したり置き忘れて紛失します。ユーザは自分に責があると納得して再購入します。また、使用するうち自然と汗で汚れたり塗装がはげ外観が劣化します。1年ごとに外観デザインを変更した新モデルが出れば、外装の劣化は新モデルに買い換える理由になります。

周辺デバイスはアプセサリですから、新しく周辺デバイスを購入してデバイスを変更しても、それまでの蓄積データはそのまま利用でき、体験が引き継がれます。





## iOSの Bluetooth Low Energy 体験

#### キーワード、多様性、普及インフラ、アプリケーション、エコ・システム
#### ユーザ所有、公共物。接近、個人所有。サービスとの連携。HomeKit、HealthKit。ドライバ。

Bluetooth Low Energy の活用には必ず3つの要素、周辺デバイスというハードウェア、Bluetooth Low Energyという無線通信技術、そしてiOSアプリケーションとネットワーク・サービスが登場します。ハードウェアとソフトウェア、そして通信と3つの分野をまたぐので、そのすべてを詳細まで理解するのは大変です。

ですが、アプセサリの魅力は、これら3つの要素のかけ算で生まれます。ですから、アプセサリの素晴らしいユーザ体験を生み出すには、どれか1つの分野の専門家であるだけでは不十分です。お互いの領域の概要をも知ることが、必要です。

前節で心拍計を例にして、周辺デバイスとアプセサリの違い、そしてアプセサリのユーザ体験とサービスの収益構造の1例を述べました。この例から分かるように、技術に関わる領域であっても、エンジニアに限定せずチーム・メンバー全員で概要を共有することが、プロジェクトの成功に必要です。

アプセサリを支える技術の概要を見ていきます。

### 無線通信と相互接続

前節で心拍計をiOSデバイスに接続して、心拍を計測しました。このときに、2つのデバイスがどのような通信をしているのかを、デバイスの立場になってみます。

まず、ユーザの目には2つのデバイスが見えています。ですが、デバイスには目はありませんから、お互いが近くにあることが分かりません。2つのデバイスの間で電波を送受信しあって、はじめてお互いに存在がわかります。ところが、人間の目や耳では、この電波を知覚できません。この違いがあるために、目の前にデバイスが見えているのに無線接続ができなくてイライラすることが起きます。

#### デバイスになりきった通信体験

2人の人間がデバイスになりきって無線通信をシミュレーションしている場面を想像してみます。1人をA、もう一方をBと名づけましょう。AもBも、目をつむり耳と口だけで会話しようとしている状況です。耳で聞くことが電波の受信、口で話すことが電波の送信にあたります。

通信には必ず通信相手がいます。ですから通信は、まず相手を見つけることから始まります。まずAが、自分はここにいるよと話してから、Bからの返答がないかを聞きます。いっぽうBは、Aの声が聞こえないからをじっと聞きつづけていて、Aの声が聞こえたら、適切なタイミングで、私もここにいるよと返答します。

これで、AとBがお互いの存在を発見できました。じつは、AもBも、自分が話している間は自分の声が邪魔をして、相手の声を聞き取れません。そのため、相手を発見してから通信しつづけるために、お互いが話を始めたり聞いたりするタイミングを示し合わせます。

Bluetooth Low Energy では、一定時間ごとにBが、おーいA、と呼びかけます。AはBの呼びかけを聞いてから、聞いているよとか、新しいデータがあるよとか、返答をします。

ここまでの、AとBがやりとりを続けられている状態が、無線接続している状態です。

このAとBしかいない状況は、実際にはありえません。

2.4GHz、80MHz、2MHz、40個のチャンネル、同時に
チャンネルを次々と切り替えていく(ホッピング)、
使えないと分かっているチャンネルを、最初に示し合わせておいて使わない(アダプティブ・ホッピング)

#### Bluetoothの相互接続

Bluetooth は近くにあるデバイスとの無線通信と相互接続の技術です。無線通信を通して、接続したデバイスの機能が使えなければなりません。

例えば、Aが心拍計の機能をもっているとします。Bは通信を通じて、Aに心拍計の機能があることを知り、そしてAの使い方にしたがって通信のやりとりを行い、Aから一定時間毎に心拍値を受け取ってはじめて、BはAの機能を使えたと言えます。

パソコンであれば、アプリケーションを選んでインストールできるので、電子メールの送受信であれば電子メールのアプリケーションを、音楽や動画を視聴したければストリーミング再生のアプリケーションをインストールすれば、通信を介してサービスを利用できます。もしも将来に新しい技術が普及しても、その新しい技術が使えるアプリケーションをインストールすればいいのです。

<!-- 後方互換性 と未来-->
ですが、Bluetoothを採用する周辺デバイスは、その機能とハードウェアが、パソコンでいうアプリケーションに相当するプログラム部分といっしょになって機能するよううに設計されます。ですから新しい技術が登場しても、ハードウェアは製造後に変更できませんから、対応はできません。



ハードウェアは変更できないので、パソコンのようにアプリケーションをインストールした対応


新技術が出たからといってもハードウェアは変更できませんし、またハードウェアといっしょになって動くように設計されているアプリケーション相当部分の更新は、

ハードウェアは変更することはできませんから、

ハードウェアの機能と

がいっしょに設計されるので、新技術が出たからといって製造後に新技術変更することはできません。

#### サービスとキャラクタリスティクス

用途に応じてアプリケーションをインストールすれば、
通信を介したメールや音楽や動画の視聴をします。


ですが Bluetooth を採用する周辺デバイスは、
そのアプリケーションに相当する部分
設計時、組み込み機器なので
そのアプリケーションに相当する部分、つまり機器の
その使われ方
組み込み機器







無線接続だけでは

相互に接続するためには、そのデータがどんな意味を持っているのか、そのデータが来たらデバイスはどう振る舞うのかまで

パソコンであれば、アプリケーションをインストールして、どんな機能でもあとから追加できます。ですから、パソコンの無線LANは通信さえできればよい技術です。

Bluetooth は近くにある周辺デバイスと、無線通信をして相互接続するための技術です。

パソコンの無線LANであれば、通信さえできれば、あとはパソコンにインストールするアプリケーションで

パソコンの無線LANであれば、通信





どんな機能があるのかを知ったり、

お互いに意味があるやりとりをするためには、データの意味



無線LANと違い
無線通信
Bluetooth はすぐ近くにあるデバイスとの無線通信技術です。
無線通信技術

<!-- 無線通信は過酷 -->

相手がいついなくなるか、わからない。
省電力、聞くだけでも電力をくう。むしろ聞くほうが、電力をくう。テンプレの電波を出せばいいだけじゃないから。信号レベルもわからない。桁違い。実際に無線の受信信号の電力は8桁。

他の方式、自分たち。

<!-- 通信規格は -->


お互いがいなくなるかもしれない、Cの話し声で、AとBの会話が途切れるかもしれない。
省電力
次はAとBが通信をし続けます。
AもBも、自分が話している
次はAとBがお互いに通信をし続けるために、タイミングをどうするかを示し合わせます。


次は、お互いが話したり聞いたりするタイミングを示し合わせます。

聞くのと話すのは同時にはできません。

ですから、Aは話したあとに、Bの返答がないかを聞きます。

どちらかが、自分はここにいるよ、と話します。自分の声が聞こえる範囲に相手がいれば、私もここにいるよ、と返答してくるはずです。ですから


自分の意味、話すタイミング、聞くタイミング、聞き役、話し役、ルール。
Bluetooth Low Energy 通信規格

相手を見つけるには、どちらかが、自分はここにいるよ、としゃべり続けます。
聴き続けます。

それぞれの人は、
、周りにあるだろう他のデバイスと会話しようとしている状況です。




お互いに会話するためには、1. 耳で聞くことと話すことができる、2. お互いに話すのと聞くタイミングがわかっている、3. 言語が同じこと、が必要です。

耳で聞くことと話すことができる、

お互いに話すのと聞くタイミングがわかっている

言語が同じこと

1. 同じ言語を話せる


発見。

あいうえおの50音、
0と1のデジタルデータ、
変調。
単語、文章。



Bluetooth Low Energy は2.4GHz(ギガヘルツ、1ギガヘルツは1秒間に$10^{9}$の振動を表す)の電磁波で通信する技術です。

という

電波の送受信でお互い
の目の前には
意思や情報を伝達すること。

目の前に、Bluetooth Low Energy で接続する周辺デバイスとiOSデバイスが2つがある。

外国語を理解するがごとく。
会話を成り立たせているのは、タイミング。同じタイミングで同時に話したら、お互い聞き取れない。

Bluetooth Low Energy の開発に用いられる受信機があれば、空中を飛び交う Bluetooth Low Energy のパケットを読み取ることもできますが、そのパケットの内容を理解するには、通信規格の知識が必要です。

ですから、目の前にある2つのデバイスが無線接続できないとき、ユーザは繋がらないことに強い不満を感じます。

電波は、人間の目には見えず、また
iOSデバイスと無線接続した周辺デバイス

Bluetooth Low Energyを採用した周辺デバイスを買ってきて、iOSデバイスに接続しようと
ユーザ
無線通信で2つのデバイス

無線で通信する技術、

 でiOSデバイスと周辺デバイスが接続する様子。
無線通信。目の前に見えている。

見つけること、伝えること、やりとりすること、

あ/い

え/お

人間の声、

同じ言語、

交互に、

喋ると、


の3つの要素を組み合わせて
初めて活用できます。

多種多様な周辺デバイスが作れる


本書を手に取られた方は、自分たちのサービスと周辺デバイスを作るために 

知識を求めている


技術の組み合わせ。


心拍計、自分のオリジナル。ハードウェア、

Bluetooth Low Energy がなにかを知るには、要素ごとの知識だけではなく、それぞれの要素がどうユーザ体験につながっていくかの、全体の俯瞰が重要です。

無線通信、ハードウェア、かなり違う。

アトリビュート・プロトコル(Attribute Protocol、ATT)
ジェネリック・アトリビュート・プロファイル

(Generic Attribute Profile、GATT

### 電波で通信する
0/1を伝える

2.4GHzと言う過酷なバンド。自分たち、他の方式。

低消費電力にする工夫。

### プライバシー、セキュリティ
電波、
暗号化。

### ATT/GATT

### iOS
バックグラウンド、
ドライバ相当部分

### 柔軟性

### 開発
ドライバ、ハード。
どっちがやるねん。
定義付け、デモンストレーション。ハードとアプリケーション。
一緒に。

### 認証
各国の電波法。FCCであれば、ECMも。部分的な認証のモジュールもあるので。
組み込みしたら、本体も。電気製品としての。
設計の性能がちゃんとしていること、製造で確認していること。
Direct modeという、電波を出すためだけの規格。

Bluetoothの認証。製造方法。
会員は有料と無償の2つ。
80万円。モジュールを利用してても。40万円。
1億円以下2年以内25万円。

### この体験を電波から見てみましょう

電波、目に見えない。人間からは目に見える。
2.4GHzっていうのは激戦区。人間には感知できない。電子レンジとかあれこれ。
発見と接続
データの読み出し、コマンド、どれを読み出すか指定して、あれこれ

発見、接続、通信、切断。



電波を出すっていうのは、それだけで電力を食う。特に受信、信号レベルが電力値で8桁も変化する。増幅率を変えて、検出する。
プロセッサの2.4GHzと同じで、電力がいるん。でも、パソコンのプロセッサみたいに、あっちっちにならないのは、回路の規模が小さいのもあるけど、常時動き続けるわけではないから。

電波を如何に出さないか、電波を如何に受信しないか。無駄に。
超低消費電力、といっても、

周りに広がるもの、電波。傍受、アタック。セキュリティ、プライバシー。



アプリケーションがないとどうしょうもない。
使い方次第、
ハードウェアの形ではなくて、機能。複合できる。


### 無線通信と相互接続




電池、12ヶ月、
3日間程度、充電必要。

無線通信が微弱だとはいえ、センサー、とかが電力を消費すれば、避けようがない。

無線通信、あれこれ。完全にタイミングを合わせて通信することで。
レイテンシ、


電波の飛び方、

近接具合
レイテンシとスループット

マスター(Master)とスレイブ(Slave)
ピコネット(Piconet )
アドバタイズメント・パケット(Advertisement packet)

無線通信の超低消費電力っぷり
	タイミングを合わせて通信することで。
	1パケットは最大37xビット。1ビットが1マイクロ秒で送られる。
	1つのパケットで読み書きできる量は、20バイト。
	もちろん、複数のパケットに分割する仕組みはある。最大(512 - 3 TBD)バイト。

コマンドライクなの。

セキュリティ、プライバシー。


アプリケーションの作り、
ペアリング、ボンディング。セキュリティ・モード。必須ではない。
発見、接続と切断、通信。
バックグラウンドでも。
バックグラウンド、繋がりっぱなし。

Bluetoothのリストに一覧が出ていない。
ペアリングがなかった。PINコード、4桁の数値入力。


複数、
サービス、

ハードウェアの作り方。



### BLEの体験


### 無線通信,コマンドで通信,アプリケーション







### 使ってみる
アプリでつなぐあれこれ。

心拍計って、
どんなもの、
方式とかいろいろ
Bluetooth Low Energy の心拍計は、ハートレートプロファイルという仕様。
だから、これに準拠していれば、どのアプリケーションでもいい。
フィットネスのアプリケーションはどんどん使っているでしょう。
専用アプリケーション、ダウンロード。

心電図、心臓の筋肉の微弱な電気信号。胸に直接貼り付ける。
手首、動脈。光の反射、血流量の変動。

心拍計測を開始。
BLEのデバイス、装着、腕時計型であれば計測ボタンを押す。

計測、専用アプリ、データがリアルタイムに表示されて、保存されて、
一定心拍になるように、音声ガイダンスあるいは、ピッピという音を出したり。もちろんデバイスも出すけど、
フィットネス。

サービスをキャラクタリスティクス。

これは専用アプリ以外、
はい、おしまい。

### 何が違うねん
無線通信と消費電力
タイミングを合わせる。

ペアリングとボンディング
小さくても、プライバシー、セキュリティ。

プロファイルとサービス。
設定画面。自由さ。



### カスタムなプロファイルの製品群を見てみましょう




## ユーザ体験と無線通信規格

最初に Bluetooth Low Energy に限らず一般的に無線通信規格は、どのような意味と役割を持っているのかを見ていきます。

あたりまえのことですが、通信には必ず2つのデバイスがいます。そして2つのデバイスは、メーカーや製造年さえ異なるでしょう。そのようなデバイス群が無線通信で利用し続けられるのは、無線通信規格を作られて、その規格の適合試験と承認制度が運営されつづけているからです。

無線通信で2つのデバイスが通信をして、機能するためには次の3つの仕組みが必要です:

1. 発見。2つのデバイスが、互いに存在を知ること。
2. 通信。2つのデバイスが、双方向にデータをやりとりすること。
3. 振る舞い。やりとりするデータの意味と振る舞いが定義されていること。

まず、2つのデバイスが、お互いにお互いの存在を発見する仕組みが必要です。ユーザは、目の前に2つのデバイスを並べて無線接続をさせようとしているのですから、デバイスが互いを発見するのは当然のことと思います。ですが、デバイスの立場になると、人間に例えれば、目をつむり耳と声だけで周囲に誰かいないかを探り当てようとしているようなものです。

目で見て見える、電波の伝搬、電池が切れている。齟齬。思い込み。



どのような周波数で、どのようなタイミングで
そのデバイスが何者か

お互いにお互い、
自分は何者か、機種番号やモデル名、どんな機能を持っているのか、などの情報、周波数とそしてタイミング。

2つのデバイスが目に見えているので、これはあたりまえのことに思えます。ですが、2つのデバイスはユーザのように目で周囲を見ることはできません。


デバイスの立場になってみると、

ユーザにとっては、自分が2つのデバイスを

ユーザ

Bluetoothのように、規格を作り、その規格に適合したものにBluetoothのロゴ掲載を許可する運営をし続けている
Bluetooth という規格


Bluetoothの役割は、通信で機器が機能すること (ロゴ、ブランド)
発見、お互いの存在をお互いが知る
通信、双方向にデータをやりとりする
データの意味と振る舞い(プロファイル)、組み込み機器
無線LAN(通信規格)とWiFi(相互接続の認証)の違い  (わかりにくい例えだけど)
だから、Bluetoothロゴがついていれば、何年も前に発売されたものでも、使える
人間に例えると、空気が媒体の可聴音、同じ言語と文化圏。
無線通信は、出会いと、ご縁、それとお互いの理解





Bluetooth Low Energy は、会社や社会のあり方も変えていきます。

例えば、腕時計型デバイスが Bluetooth Low Energy で内蔵した加速度センサーのデータを常にスマートフォンに同期するとします。個人利用であれば、運動量をモニタして健康維持に役立てられるでしょう。会社であれば、活動パターンから感情や気分そして体調までを推定して、オフィスのよい雰囲気作りに役立てられるかもしれません。社会にとっては、個々人が健康で活発でありつづけられれば、社会の活力の源となるでしょう。

Bluetooth4.0 は、それまでの Bluetooth3.0 の技術に Bluetooth Low Energy を統合したもの、そして Bluetooth4.1 は、Bluetooth4.0と後方互換性を保ちながら改良を加えた通信規格です。

1秒にせいぜい数十回、1回にせいぜい数十バイトの通信ができれば十分だが、電池消費量は小さくしたいといった、
Bluetooth Low Energy は、スマートフォンのように単体でインターネットに接続できる技術ではありません。

インターネットが時代を変えると、2000年頃に大きな話題になりました。駅前ではADSLモデムが配布までされ、高速なネットワークが、またたくまに家庭に普及しました。それから、通信端末はパソコンからスマートフォンに、固定回線は携帯通信へと移り変わりました。14年が経過した現在は、1人が1台のスマートフォンを所有し、決済そして音声とテキストが統合されたメッセージング・アプリも普及して、成熟したモバイル市場が生み出されました。





よいサービスを考えだすために、





しかし、様々な物とネットワークの間には、これまで深い溝がありました。この溝を埋める無線通信技術が、本書がとりあげる 超低消費電力無線通信技術 Bluetooth Low Energy (ブルートゥース ロー エナージー) です。Bluetooth Low Energy は Bluetooth4.0 の規格の1部です。


時代の推移:
画面を見ている時代、
ネットワークと一緒にいる時間、

会社経営的に:
システム的な、ハードだけじゃなくて、サービスまで含めた。
可能性、でっかい。



この IoT あるいは IoE の時代は、もうすぐ近くに来ています。いまでは、スマートフォンの地図や路線図の検索アプリケーションに表示された経路通りに移動すれば、最適な経路で目的地にたどり着けます。スマートフォンを通じて、ネットワークにある交通網の情報と最適な経路検索結果が、人に作用しているわけです。これは、人間が通信回線の1パケットになっているのと違いはありません。

しかし、様々な物とネットワークの間には、これまで深い溝がありました。この溝を埋める無線通信技術が、本書がとりあげる 超低消費電力無線通信技術 Bluetooth Low Energy (ブルートゥース ロー エナージー) です。Bluetooth Low Energy は Bluetooth4.0 の規格の1部です。

Bluetooth Low Energy は、コイン型電池1つで数年間も無線通信ができます。ですから、わずらわしい配線に悩まされることがなく、また電池の充電や交換の手間がかかりません。そして、物の機能をサービスという概念でモジュール化したこと、そしてデータベースのサーバ・クライアント構成をとったことで、従来の Bluetooth では実現できなかった、多種多様な物との無線接続が可能になりました。

ですが、新しい無線通信技術が普及するには、その通信相手が同時に普及しなければなりません。この大きな障壁は、Apple社が2011年に、世界で初めて Bluetooth4.0 に対応したスマートフォン、iPhone4s を発売したことで、一気に打ち破られました。

2011年のこの出来事から、Bluetooth Low Energy を使うiOSデバイスと連携するユニークな製品群を発表するベンチャーが続々と登場しています。












を活かしたユーザ体験は、分野や背景知識の異なるメンバーが目的や知識を共有して協業するチームから生まれます。

本書は、そのようなチームのためのハンドブックです。









2014年、iOSの誕生から7年が経過して、世界に広く普及したiOSデバイスとAppStoreが、成熟したモバイル・アプリケーションの市場を作り上げました。アプセサリは、iOS8の登場とともに、次の成長への鍵として注目されています。

その次の成長は、ネットワークとアプリケーションそしてiOSデバイスで完結するこれまでの時代から、それらが我々人間が住むリアルな世界とつながり相互に影響を与え合う新しい時代へと移ることで、もたらされます。この日常とネットワークとの連携の鍵となるのが、アプセサリなのです。



Apple社も、iOS5からiOS8に至るまでの3年間に、iBeacon、 Apple Notification Center Service (ANCS)、 HealthKit そして HomeKit と毎年矢継ぎ早に、iOSの新しい魅力となるアプセサリの世界を切り開いてきています。

Bluetooth Low Energy は、iOSを支える根幹技術の1つとして知っておくべき技術となってきています。

たとえば、iOS7で統合された新しい位置と近接の検出技術 iBeacon は、 Bluetooth Low Energy の技術を使い識別子をブロードキャストするビーコンとiOSデバイスを組み合わせて利用します。アプセサリを開発するつもりなどない、アプリケーションやサービス開発においてさえ、我々の住むリアルな世界とiOSデバイスとを連携させるためには、Bluetooth Low Energy の基礎知識が欠かせないのです。



















電池消費量が小さい、電池交換頻度、充電式にしなくてもいい。使い捨てまたは。
iOSデバイスとの連携、
多種多様、従来に無いジャンル、オリジナル。
とはいえ、前例のないハードウェア、使い方を想像できない。市場に広まるまでの時間。
フィットネスやサイクリングでは、計測、無線のもの。







この章は、 Bluetooth Low Energy とはなにかを、俯瞰していきます。


多種多様、従来のBTを侵略するものではなく、
無線通信技術、
環境、iOS、
アプセサリ、

Bluetooth Low Energy 




Bluetooth Low Energy は、多種多様なハードウェアを実現できる通信規格でもあります。無線通信には必ず通信相手がいます。

Bluetooth
が使われる周辺デバイスは、ハードウェアとして最初から設計されるため、機能の追加や変更が


Bluetooth 3.0
アトリビュート・プロトコル(Attribute Protocol)、
ジェネリック・アトリビュート・プロファイル(Generic Attribute Profile)
モジュール化
サービス、キャラクタリスティクス
プロファイル

多種多様
その超低消費電力

Bluetooth Low Energy 以前のBluetoothを採用した周辺デバイスは、スピーカやヘッドセットなど、分野が限られていました。

ですが、Bluetooth Low Energy は多種多様な周辺デバイスを実現できる技術です。


Bluetooth Low Energy 
ユーザの体験





電池がもつので充電式にしなくてもよくなること、半導体素子などの製造費用が安価であること、また多種多様なハードウェアを設計できる特徴があります。

また、iOS5およびiPhone4s以降のiOSデバイスが Bluetooth Low Energy に対応しています。この市場に向けて、iOSデバイスと周辺デバイスとの間にあるラスト1mをつなぐ無線通信技術である Bluetooth Low Energy を用いた様々な周辺デバイスが、いままさに開発そして販売されてきています。



Bluetooth Low Energy がなにかを知るには、それぞれの要素がどうユーザ体験につながっていくか、全体の俯瞰が重要です。

Bluetooth Low Energy を利用した周辺デバイスは、よく アプセサリ (Appsessory) と呼ばれます。これは、アプリケーション (Application) とアクセサリ (Accessory) を組み合わせた ( App + cessory ) 造語です。この造語は、iOSアプリケーションと周辺デバイスというハードウェアが連携してはじめて、素晴らしいユーザ体験につながることを表しています。





Bluetooth Low Energy は、健康やフィットネス機器など、製造コストや電池消費量への要求が厳しく、Bluetooth 3.0 までの無線通信技術では応えきれなかった分野に向けて開発された技術です。小さなコイン形電池1つで年単位の無線通信ができ、多種多様な周辺デバイスが設計できる技術です。したがって、スマートフォンと周辺デバイスとの間にあるラスト1メートルをつなぐ、重要な技術になっています。





このような Bluetooth Low Energy への注目度の高まりに答えるように、無線通信規格そして組み込み機器開発の素晴らしい書籍が登場してきています。しかし、本当に Bluetooth Low Energy を活用するには、ハードウェアから無線通信そしてアプリケーションといった要素技術を学ぶだけでは不十分です。全体を俯瞰して要素技術がどう有機的に関わりあっているかまでを、理解することが必要です。







周辺デバイス

したことで、世界中にいるiOSユーザに向けて、Bluetooth Low Energy に対応した周辺デバイスの開発や販売が一気に

として注目されています。


使い捨ての設計もできること、
製造費用が安くなるように、また
ローコストで製造ができること、また電池がもつので充電式にしなくてもよいこと、さらに多種多様なハードウェアが開発できるよう
工夫されてい

iOSデバイスと周辺デバイスの間にある







Bluetooth Low Energy は、Bluetooth という単語が入っていることからわかるように Bluetooth 4.0 から統合された技術です。超低消費電力にするために、Bluetooth 3.0 までの無線通信技術とは互換性がありません。ですから、 Bluetooth 4.0 は Bluetooth 3.0 プラス Bluetooth Low Energy 

Bluetooth 3.0 までの

Bluetoothという名前が入っていますが、Bluetooth




心拍計は市販品、アプリケーション、ブランド化。

としては、まさにそのとおりです。
そして







Bluetooth Low Energy の周辺デバイス、これは


ここまでは Bluetooth Low Energy の周辺デバイスの体験です。



日常生活においても、

適切なトレーニング強度を保てるように、

iPhoneが心拍を搭載することはありえない。

データの蓄積
統計データの学習による判定
サービス(倒れたり、体調の計測、予測。医療サービス)
 
 のアプリケーション

まとめ的に、体験。アプリがないと意味がない。画面を見ていても、心拍とかのデータ、加速度とかのデータ、統合。
あるいは、心拍の管理、音楽の再生とか、体験につなげるために、リアルなデータ。iOSデバイス、データ、通信、ハブ。
場所のロギング。倒れていたら、心臓の異常。


心拍計、接続。
省電力。
通信、発見、接続、読み書き。
iOSアプリケーション、接続管理。

セキュリティ・モデル。
盗み見、デバイス横取り。

クラシック Bluetooth と違うところ、
ちょと詳しく。
プロファイル
サービス
キャラクタリスティクス
GATTサーバ、クライアント、
セントラル、ペリフェラル。
接続の制御、

## ほげ

もう少し詳しく書くと、Bluetooth Low Energy は、Bluetooth 3.0 までの無線通信技術では電池消費量や開発用途の要求が合わなかった分野に向けて開発された、コイン型リチウム電池1つで1年程度の無線通信をし続けられるほど超低消費電力な無線通信技術です。

Bluetooth 4.0 は、Bluetooth 3.0 と Bluetooth Low Energy とを1つに統合したものです。2011年に発売された iPhone4s が世界ではじめて Bluetooth 4.0 に対応してから、iOSデバイスと周辺デバイスをつなぐ無線通信技術として活用されています。

Bluetooth Low Energy は、データ量が小さく通信頻度もさほどないが無線接続し続けたい用途、例えば心拍センサーや家電のリモート・コントロールといった分野に適した技術です。








本書は、CoreBluetoothフレームワーク のクラス構造や使い方を、Bluetooth Low Energy の仕組みに基づき、なぜそうなっているのかまで踏み込んで解説します。また、ハードウェアと連携するアプリケーション開発に独特のノウハウを述べます。


ハードウェアとソフトウェアの基礎知識や、試作品を作る実践的な知識と経験、そしてサービスが求める数量のハードウェアを製造するやりとりなど、iOSアプリケーション開発でこれまで接点がない分野の知識が必要です。












す。Bluetooth 3.0 までの無線通信技術は、用途ごとに相互接続が確保した高速なデータ通信を提供してきました。これによりヘッドフォン
配線の無線化


Bluetooth 3.0 
無線接続し続けたい、
でも充電とかは…
電池消費量がシビアな用途。

カバーしきれない


2011年に規格が公開された Bluetooth4.0 は Low Energy
2011年に規格が公開された Bluetooth 4.0 で、Bluetooth の規格の一部として統合されました。

使い方、
簡単なしくみや用語、
歴史、取り巻く環境。
BLuetooth Low Energyの歴史、
iOSのアクセサリ機器のインタフェース、流れ

iOSアプリケーション、周辺機器開発、技術的なもの。


Bluetooth Low Energy をもちいる開発は、アイディアが技術的に実現可能かを確認しながら、イメージをつかみ具体化していく繰り返し作業からはじまります。短期間になんども試作を繰り返すためにも、自分たちで実現可能性をちゃんと理解するためにも、自分たちでモックアップと簡単な動作をする回路を組み合わせた試作をすることが大切です。

# Bluetooth Low Energy のある世界

新しい無線通信技術の普及には対応デバイスの普及が不可欠です。2011年に発売されたiOS5を搭載するiPhone4sが Bluetooth4.0 に対応したことで、世界中に広く普及しているiOSデバイスという接続先ができ、文字通り一夜にして巨大な周辺機器市場が誕生しました。これが Bluetooth Low Energy が注目されている理由です。

この章は、 Bluetooth Low Energy という技術で何ができるのか、また2010年から始まる Bluetooth Low Energy の歴史を通して、技術情報やユーザ体験の全体像を見ていきます。

## iOSデバイスとBluetooth Low Energy

iOSデバイスが牽引。PCとの相性、よくない気がする。従来周辺機器でしょ。
動き続けてデータ収集的な。モバイル機器と組み合わせる、もしくは家の固定用。PCではない。マウスとキーボードのベターだろうけど。
iOSデバイスの話。

### 周辺機器の1例
周辺装置、
iOS8からHealthKit。

### 新しい位置と近接の検出技術
ビーコン

### iOSデバイスとホーム・オートメーション
音声コマンド、対応。

## Bluetooth Low Energyとプロトタイピング
事業を目指した、ライフな事業。
クラウド・ファウンディング。事業が成功するかいなか。もともとは初期投資。ハードがからむと、事前予約販売に勘違いされがちだけど。

### 製造メーカとして
Haxele
Solid
日本でも。


## 技術的なお話
### クラシックBTとBLE
音声とかあっち周り。
iOSでの扱い。
### インタフェースとして
### モジュールとは
技適やらあれこれ。

## 歴史的なお話

## 開発環境的なお話














本書は Bluetooth Low Energy と区別するために、Bluetooth3までの無線通信技術を、クラシックBluetooth と書きます。


基礎知識
ユーザ体験

始まった ハードウェアやソフトウェアの開発環境やアクセサリ開発の変遷


新しい技術は常に万能ではありません。新しい技術は、これまにできなかったことを可能としますが、また適さない使い方もあります。企画会議やチーム・メンバー全員でのブレイン・ストーミングでは、適切なアイディアを出し議論をするために、たとえ担当分野が技術ではなくてもBluetooth Low Energy の全体像や基礎知識が不可欠です。

Bluetooth Low Energy に注目する理由は




Bluetooth3までの近接無線通信技術では製品が作りにくい領域のために開発された、無線通信の方式からして従来のBluetoothとは異なる技術です。



# Bluetooth Low Energy がある世界

レイヤを垂直にまたがる。いままでにある要素が、いままでにないものに。

繰り返し同じことを書くと思うけど、そこは勘弁してね。

## BLEの概要

どんなものなのか、仕組み。ちょっと使えるまでを見てみる。
BLEっていうのは、これまでのBTと違っている。

### ちょっとした仕組み

ハードがあってiPhoneがあって。
アプリを起動したら、データが取れる。ペアリングが必要な場合もある。
接続と切断、アプリケーション、バックグラウンドでもデータが取れる。
半年くらい電池が持つ。

### この辺りの仕組み。 ### 接続系の使い方

中身を見てみる。
デバイス、アドバタイズメント。デバイス名。
iOSアプリ、CoreBluetoothフレームワーク、検索、発見、接続、読み書き。
セキュリティ、暗号化。これはiOSが管理。ペアリング/ボンディング。

アプリが、データの読み書きとか全てを制御する。

クラシックBTとは違う。速度とか、電力とか。用途に合わせた。
SPP、プロファイル。縛り。認証チップ。MFi。足りない部分。ハードウェア。
電池消費量、充電式。高速通信ができるけど、接続管理はユーザ。センサ系、有象無象の。
敷居が高かった。

デバイスの発見
	ペアリング

データを読み書きするのは、接続がいるけど。

接続しない使い方もある。同時通報、一方向のデータの伝え方。ビーコン。

### 接続しない使い方もある
ビーコン系とか、データの周囲への同報。


### ハードウェアのあれこれ
s
モジュール、小さい、無線通信。
お安く、1チップ、開発、ユーザのアプリケーション。通信と一緒に処理。
処理能力。
クラウドファウンディング。1stロットを。
開発のリソース、コストが1/10程度。簡易な。

## 時系列ストーリー

iOSだから、そんな感じで。
時代をしるのも。失敗も含めて。
Bluetooth Low Energyが登場して、注目されるまでのストーリー。
背景や事情を交えながら。主語が大切。

### これを見るときの視点は

チームの構築と体制
 企業が入っているかどうか、企業内か、外部からか
 独自の小規模

プロトタイピング環境
 Arduino、サブレー、mbed フィジカルコンピューティング
 アプリ側から。techBASIC、Konashi。

事業化のプロセス
 Makerの支援体制(資金、試作、ビジネス・モデル、専門家のサポート支援、製造)
 クラウドファウンディング

日本の電波法、技適
 ソケットありきから、

半導体のところ、モジュールのところ
 3社ある。開発環境、無償化、手軽か。ユーザフォーラム。

Bluetooth SIGのところ
 つい最近までEPLが無償。

アプリケーション。これは? むりね。
 意外と、危険モードとか。

### 2011年、はじまり
iOS5、iPhone4sの年。

黎明期、これなんだろう?

6月、WWDC、iOS5。CoreBluetooth。なんだろう?
Bluetoothのアクセサリが開放されるのだろうか。

従来のBluetooth3.0まで、ケーブルの無線化。だから繋がりっぱなし。無線通信、無線LANみたいな、アプリで。
Bluetoothという規格のもとで、任意の機器が接続できる。
相互接続、相手は組み込み機器だから。音声通信とか用途を決めて、プロファイル。データの形式。
用途ががっちがっちに固定されて、任意のデバイス作りにくい。MFiであれば作れた。

当時のBluetoothは。周辺機器として。ヘッドフォンとか規格で決められた周辺機器。それ以外?
SPP、これはMFiの対象。作るとしても、消費電力でリチウムイオンポリマーバッテリー、1周間、
充電と電池管理、製品の価格。それしか解決方法はないが、しかしMFiの手間が。
当然ながら、MFi。技術情報も閉じている。おそらく認証チップ。
Bluetoothの、特定のアプリとしかつながらない。でもSPPにはそんな機能はない。ただの通信路。
規格にない部分をAppleが独自の規格で上乗せ。Appleは、独自技術はMFiの対象とする。とても自然な流れ。

それが開放されるのかなと思った。周辺機器の豊かな世界を開こうとすれば、勝手に作って、例えば販売するときに認証させるとか。アプリケーションはストアでコントロールできるiOSであれば。

iOS5、CoreBluetoothフレームワーク。
なんだろこれ? iPhone4s、 10月発売、わっほ。Bluetooth4に対応、つまりBluetooth Low Energy。
その時は、コイン型電池で1年位通信できる、従来Bluetoothとは違う、MFiはいらない。iOSでアプリ開発ができる。
あれこれ。

Bluetooth Low Energyってなんだろう? 
情報はない。技術は、仕様書を読む?
情報、Bluetooth Low Energyハンドブック、2012年の冬。テキスト。
ハードウェア、規格、半導体、iOSアプリケーション開発。

### 2012年、プロジェクトが動き出す。

iOS6の年、iPhone5の年。ペリフェラル+セントラル。周辺機器にiOS自体がなれる。

例えばリモコンとかだと、Bluetooth4.0、複数のデバイスを接続。ネットワークの接続のトポロジが、セントラル-Nのペリフェラル。なので、同時に接続、iOS側をペリフェラルにするしかなかった。
周辺機器としてのリアリティが強くなったなと思った。

MFiがいらない、手軽っぽい?
Bluetooth SIG。情報を出し始めた。特に、Nordic Semiconductor社、日本、山崎さん。
ブランクなモジュール。
開発環境。出来る人はできる。

半導体。これが無いと始まらない。でも従来のBluetoothとは、違う。
大手、ホシデンや太陽誘電も出している。商売のやり方が違ってしまう。

ハードウェアとファームウェア、できる人とできるところ。

モジュールのメーカの立場とは。モジュール。高周波の回路、デジタル回路は極論、配線が繋がっていればいい。
2.4GHz、電波を出すもの。配線の長さや太さが、電波の飛び方に影響する。また、"きれいな電波"、各国の承認、Bluetoothの承認。

何かといえば、ファームウェアを誰が開発するのか?
半導体、1チップか2チップ。通信を制御する部分と、装置を制御する部分。ケースバイケース。
BLEであれば、規模が小さい、安くしたい = 半導体の数を少なく。今のBLEのチップ自体は、用途が1チップで収まるだろうというので、通信制御しつつ、ユーザのアプリケーションも実行できる工夫ができてた。
1チップ、実装のコスト、実装の手間、半導体のコスト、大きさ、消費電力(2つチップがあるよりも、1つのほうが小さくできる)、あらゆる面で、利用場面にあう。

だが、従来であれば、プロファイル自体に使い方が入っているから、例えば操作ボタンを付けたいとか。
音の再生制御で、早送りとかボリュームとか。タッチとかボタンとか、いろいろある。ペアリングのときのLEDの光らせ方とか、ちょっとした、でも製品ごとに違うもの。
カタログにはないけど、メーカーごとにカスタム。ちょっとしたカスタム。通信プロトコルとかそういうところはいじらなくてもいい。面倒なところはモジュールに。で、専売で万単位でまとまった販売、開発費は薄く広くで回収できる。製品の会社は、自分で厄介なところをやらなくてもいい。手間が小さい。

MFi。iOS自体も、Bluetooth LEの違いに対応。
特徴は、少量のデータに特化。例えば心拍であれば1秒に1回、心拍も最大200程度だから、せいぜい2バイト程度。

クラシックBluetooth、接続と切断まで、アプリケーションから。
ドライバ相当のレイヤが入っている。

年表をどこかで

このころ、Kickstarterでいろんなプロジェクト。Pebble、決済用デバイス、腕時計の心拍計とか。
同時にHaxelleatorとか、ハッカソン+企業支援、VC+製造。1stロットの売上、フィードバックで。

2012年の終わりぐらい、カシオ。腕時計。最初はAndroidのみ対応。iPhoneからはつなぐこともできない。
実はBLEの規格もいろいろある。通信路自体を暗号化もできれば、必要な部分だけを暗号化とか。たぶん通信路自体を暗号化するのはiPhoneは対応していないから、そういう違いなのかもしれない。

次に出たモデルは、外観は全く同じだけど、iPhoneに対応していた。専用アプリケーションで、メール通知とかに対応。
この時代は、アプセサリ。アプリから完全にデバイスを操れるが、iOSは何も手助けしてくれない。メール通知とかそういうiOSが持っている機能は、その他のアプリから取得する方法は、iOSにはない。ノーティフィケーションとして、明示的に出してくれていれば別だけど。iOSにはそんな機能はなかった。

Konashiがで始めて、プロトタイピング。

Arduinoのプロトタイピング用のシールド。

### 2013年
iOS7の年。
iBeaconと、ANCSの登場。iOS7だから、2013年

雰囲気メガネ。

iBeaconは注目された。iOS7は、デザインの大幅な変更と見た目は変わったけど、本体はiPhone5sになったが、それが新たな強烈な魅力があるわけでもなく、標準アプリの変更も、素晴らしいが、3rdの取り込みにしか見えない、本質は?

9月辺りから話題になりだして、12月あたり。ハッカソン。
大垣市で4回開催。これは新しい位置と近接の検出技術。経営、企画、デザイナ、エンジニア、バリスタ(コーヒ店舗経営者)、高校教師、多彩な。

### 2014年
iOS8。

mbedのBLE対応。
Arduino系のガジェット。

開発環境。書籍。アプリ。アプローチ。

日本でも、

### 日本での

NECカシオ
Meaias
リモッピ、3万台、Keyfobという定番商品。先着プレゼント。

G-Shock、カシオ、腕時計。
通知がわかる。ウエアラブル・デバイス

盛り上がらない。

### ソーシャルファウンディングと

速度、規模、立ち上げ。

タイミングのよさ。ウェブサービスがとことん広がり、アプリ単体の可能性が出尽くしたか?
ゲーム、ソーシャル、メッセージ、それら大手。市場、それぞれがインフラとして、集金。

それを皮切りに、Kickstarterなどのソーシャルで、プロジェクト。
ビジネス・モデルにハードウェアが要素としてある、投資家。プロジェクト。やはりKickstarter。1stロット。
個人というよりも、市場調査的な。または、運動量的なデバイス、スマフォ要素でサービスに。

まだまだ小さいけど。

iBeacon、商圏。位置と近接。屋内、自由に設置、アプリとビーコンが紐付けられるという。
Apple社自体は、2年後、買い替えタイミング。iOS5からの、iOS7。

Apple Notification Center Service、雰囲気メガネ、Apple独自の周辺機器。
多様性、腕時計が無数のブランド、個人ブランドすら登場する、ハードウェアが成熟すれば、それはパーツとして。
レイヤ、専業化が進めば、品質の高いものが、劇的に安く。同じものなら安く。

### iOS8の
MFi。
HomeKitやHealthKit。iOS8から、
実にiOS5から3年後。Apple独自の技術。HealthKitは、一般品。
HealthKitは、データ集約。いままでアプリケーション自体が収集しないとけいない、デバイスドライバ。
HomeKitは、音声コマンド、常時Siriが稼働する。

盛り上がりとしては、ハードウェアをビジネスに取りこんだサービスがこうちく、インフラになり得る。
それを支えるのがiOSとMFiの戦略。

一般的な日常の場面、Apple独自の世界、日常の世界。iOSが日常の生活。

## BLEの周り(簡単にトピックス、販売とかそっち視点で)
外の会社で話していたあれこれ。

商売として

事業計画(予算、不測の事態への対応のコスト、回収などリアルにあれば、無料交換)
立ち上げ期。よくあるのは不具合があれば、まずは無料交換。その後、回収? 故障解析、次のモデルへのノウハウ。

価格の納得感
 入手性、ポチれること。
  存在していることを知ってもらう
  手で触れる
正しくゴミに。捨ててもらうまでが計画。使ったもらうよりも、その後。メンテナンス、回収コスト。

Kickstarter
1万個のサンプル、リアル店頭。それだけでかなりお金を使う。
宣伝、ユーザ評価、口コミ、もちろん同業者からのそれとはわからないdisりも、可視化される。

どの程度売れたらいいのだろうか
 5000円、1万円、1.5万円以上。
 ご町内に一人、1億人、1000人に一人、10万個/年。1万円ならば、10億円。コンビニ2億円、5つ分。
 利益は少ない。一人頭人件費1000万円として、粗利益30%、会社の成長を全て人に当てたとしたら、3億円、最大30人。
 開発のコアメンバー、経営、企画、広告、技術、コミコミ常時10人チームまで。

BLEの規格と密接に結びつく商品企画

ブロードキャストなのか、接続なのか。データを受け取るタイミング、取り逃しが許されない
どの程度のセキュリティ?
トポロジ。同時接続数は10。4.0か4.1か。中継? 記録をもたせる?
開発、デバイスでできることが体験を変える、インタラクション、繰り返し。

ラスト1mをつなぐ技術、モバイルなデバイス、外部拡張ができない。過去にあったインタフェースを省略すると、後方互換性が保てない。よほどの慎重さで考えるしかないもの。
無線ものは、特殊な規格は使えない。周辺機器、エコシステム。BLEは今後10年は使われるでしょう。

面白いのが、モデル。
デバイスの概念、さーびすという単位。機能をアトミックにモデル化。その中には、キャラクタリスティクスという読み書きするものが。変更通知。
ハードウェア。iOSアプリケーション、オブジェクト指向。それと相性が良い。
サービスは継承ができる(インクルードサービス)。キャラクタリスティクスを消し去ると、後方互換性ができないが、機能の追加。バージョンで検索。

モジュール。
SoC、ワンチップ。コスト。RFと認証。あれこれ。だからモジュールで。もちろん、極端に物理制約、誰が作っても同じ半導体。
従来モジュールメーカ、アプリケーション、ユーザの。開発をするのか? ユーザ体験が絡むから、技術と不可分。

Cortexi-M0からM4Fまで。

BLEの登録、25万円、80万円。
モジュール 500円前後。1000個単位の量産であれば。もちろん基板やケースにパッケージ。1000円から2000円で、かなりできるかもしれない。金型とかデザインとか設計コストとか。

大手はやりにくい。小規模なところ、小回りの聞くところ。体制を揃えて。製造で収益が上がるから。
BLEはとにかく、変化がある。企画しつづけるものになる(消耗品)。小さいから。

デバイス、MVC。

### 試作との違い、
危険の解析とか。アプリケーション。これは? むりね。
 意外と、危険モードとか。

## BLE周り、主に技術な視点で

### BLEまわり
### クラシックBTとBLEの違い
### 接続と非接続、ブロードキャストと通信
### カスタムプロファイルと柔軟性
### 一般的なデバイス、どんなものがあるのか
### MFiなBLEのもの

### 一般的に iOSの周辺デバイス、インタフェース
### 実際に開発するなら
### AndroidやWindowsの対応
要素、ハードウェア、OS。柔軟さ。
ドライバ

## BLEの基本的なところ(詳しい)
### 規格の歴史
### ネットワークのトポロジ
### プライバシーとセキュリティ
### 他の無線通信都の比較

## 開発体験













































































































































































Bluetooth Low Energy のネットワーク・トポロジーには、セントラルとペリフェラルという2つの役割があります。前節で例に上げたテレビのリモコンの場合は、テレビがセントラル、リモコンがペリフェラルです。iOS6では、iOSアプリケーションはセントラルにも、ペリフェラルにもなれます。つまり、iOSアプリケーション自体が、テレビのリモコンとして振る舞うことができます。

### アクセサリとiOSアプリケーションの連携

アクセサリとiOSアプリケーションの連携には、その間をつなぐオペレティング・システムが、連携に必要な機能を提供していなければなりません。クラシックBluetoothと異なり、Bluetooth LEを使うiOSアプリケーションは、MFiプログラムがなくても一般開発者プログラムだけで、開発とAppStoreの承認がでるようになりました。それだけではなく、Apple社は、連携に不可欠の機能を提供しています:

* デバイスの発見と接続
* アプリケーションがドライバ相当の機能をもつ
* セントラルとペリフェラルの両方になれる
* ユーザ通知機能
* バックグラウンド動作

#### デバイスの発見と接続

Bluetooth LEデバイスの発見と接続は、iOSアプリケーションの役割です。iOSは、接続などに、何も関与しません。クラシックBluetoothは、ペアリングおよびデバイスへの接続は、設定アプリでユーザが操作しなければなりませんでした。どのようなBluetooth LEデバイスがあるか、どのデバイスに接続するか、また切断した時の再接続処理などは、iOSアプリケーションの役割です。例えば、Bluetooth LEは、接続が切れたならば、切れたままにする通信規格です。もしも再接続が必要になる都度、ユーザに接続操作を要求していたら、ユーザはいらいらするでしょう。

#### アプリケーションがドライバ相当の機能をもつ

Bluetooth LEデバイスとの接続はiOSアプリケーションに任されているため、パソコンのデバイス・ドライバに相当するソフトウェア、接続したデバイスの動作を制御する機能も、iOSアプリケーションに実装することになります。パソコンのように、iOSにドライバ・ソフトウェアをインストールすることは、不可能です。もしもそんなことを許せば、セキュリティや安定動作などの、iOSが提供する価値が損なわれるでしょう。

たいていの場合、iOSアプリケーション開発者がドライバ相当の機能を実装することはありません。市販されているBluetooth LEデバイスは、たいてい製造開発会社からiOSアプリケーション開発者に、そのデバイスを使うためのソフトウェア開発キットが提供されています。そのデバイスに対応するiOSアプリケーションの数が、売上につながるからです。

また独自仕様のBluetooth LEデバイスを開発する場合は、iOSアプリケーション開発者ではなく、デバイス開発者がドライバ部分を担当します。これは、デバイスの正常動作を確認するために、ドライバ部分も含めて作ることが、必要だからです。

#### セントラルとペリフェラルの両方になれる

Bluetooth LEのネットワークは、1つのセントラルに複数のペリフェラルが接続する、1対N接続のスター型です。1つのiPhoneに複数の周辺機器が接続するため、iPhoneをセントラル、周辺機器をペリフェラルにします。

iOS5は、セントラルの機能を提供しています。iOS6は、セントラルに加えてペリフェラルの機能も提供されます。iPhoneがペリフェラルになると、例えばBluetooth LEのワイヤレス・マウスとして振る舞うようiOSアプリケーションが作れますから、iOSアプリからパソコン操作もできるでしょう。

iPhoneがペリフェラルになると、Bluetooth LEデバイスのプロトタイピングが容易になります。iOS5の時代は、ペリフェラルになる組み込み機器向けのBluetooth LEデバイスの開発セットを使うほかありませんでした。このために、組み込み機器の開発手順の学習が必要でした。さらに、たいていのプロトタイピングは加速度センサを必要としますが、その回路も作らねばなりませんでした。iOS6では、これがiOSアプリケーション開発のスキルで、iPhoneの豊富なセンサがそのまま利用できるようになりました。

#### ユーザ通知機能

iOSはBluetooth LEの通信には関与しません。しかし、iOSアプリケーションがアクセサリに接続したままで終了すると、そのアクセサリとiPhoneとの接続は維持されます。このときに、アクセサリがiOSアプリケーションに通知を送信すると、それを受信すべきiOSアプリケーションが停止しているので、その通知があったことが通知センターに表示されます。<TBD 確認。ほんとうか？>

アプセサリは、アプリケーションと強く結びつきます。しかし、iOSアプリケーションは、メモリ不足により強制終了されるなど、常に実行されているとは保証ができません。このユーザ通知表示は、iOSアプリケーションが実行されていないときでも、最低限の機能の提供に使えます。

例えば、置き忘れ防止のキーホルダーに使えます。キーホルダーは、通信の電波強度が弱くなればiPhoneとの距離があいたとして、置き忘れの警告をiPhoneに送信します。対応するiOSアプリケーションが起動していれば、適切な音や表示が出せますが、iOSアプリケーションが動いていなくても、最低限の通知はできます。

この通知は補助的なもので、必ず動作するものではありません。もしも、アクセサリとiPhoneの接続が切断すれば、iOSは再接続をしませんから、切断したままになります。そして、アクセサリとの接続が切断しても、ユーザには何も通知されませんから、ユーザが切断に気づくことはありません。もしも、ユーザが必ず通知が来るものだと思っていると、この振る舞いはユーザには見えませんから、期待と異なる商品と受け取られます。

#### バックグラウンド動作

iOS4から、音楽再生やVoIPなど分野を限定して、アプリケーションのバックグラウンド・モードが導入されました。iOS5では、Bluetooth LEのセントラルとしてのバックグラウンド・モードが、iOS6では、それに加えてペリフェラルでのバックグラウンド・モードが、追加されました。

iOSアプリケーションのバックグラウンド動作は、アプリケーションが自分で好きなだけ処理をおこなうものでは、ありません。Bluetooth LEのバックグラウンド動作では、Bluetooth LEの発見や通知などのイベントが発生するたびに、iOSアプリケーションに10秒間の処理時間が与えられます。<TBD ペリフェラルでのBG動作＞

このバックグラウンド・モードを使い、例えばBluetooth LEデバイスとの通信が切断したときに、前節の通知と異なり、iOSアプリケーションから再接続処理を行うことも、またユーザに切断を通知することもできます。

### iPhoneはハブ・デバイス

アクセサリは、安価で小さいことが求められます。コストと大きさは、電池容量や液晶などの表示器を、小さいものに制約します。アプセサリはiPhoneの機能:

* iOSアプリケーションの表示やユーザ・インタフェース
* 計算処理能力や記憶媒体、データの統合
* 3Gを含めたネットワーク接続

を、アクセサリの機能として利用します。

iPhoneの液晶とユーザインタフェースが利用できると、アクセサリの表現力がぐっと広がります。アクセサリは、たいてい本体が小さいので、液晶表示器自体の大きさも小さくなります。操作手段も、本体が小さいと、小さな押ボタンを2~3個搭載するのが、精一杯です。本体の製造価格を抑えると、まず液晶が決まった数字やキャラクタを表示する簡素なものになります。ドット表示で任意の文字と図形とを表示するには、高精度のドットマトリクス方式の表示器が必要です。このように、アクセサリは本体の大きさと製造費用の2点でユーザ・インタフェースが制約されます。

例えば、ありきたりの万歩計がiPhoneのユーザ・インタフェースを使えるようになったとします。アクセサリ単体ではその日の歩数の表示だけです。最近のマイクロコントローラの処理能力であれば、万歩計が1時間あたりの歩数を記録することは容易に実現できます。ですが、万歩計自体の小さな液晶では、それを魅力的に表示できません。iPhoneの液晶表示であれば、iOSアプリケーションの実装次第で、例えば、その日の1時間あたりの歩数を、運動の強度にあわせたカラーバーでグラフ表示など、アクセサリ単体ではできない表示が、追加コストをかけずに容易に得られます。

iPhoneの記憶媒体は大容量で、端末にデータを貯めていけます。先ほどの万歩計を例に取れば、iPhoneはギガバイト単位の記憶容量があります。ですから、何百年分でも、過去の履歴データを保存できます。そして、アクセサリが壊れたり失われたりすると、そこに記録されたデータも失います。アクセサリは消耗品ですから、長期間の過去データを置いてもデータを失うようでは、意味がありません。

iPhoneは、すべてのアクセサリのデータが集積する、ハブとして機能します。また、その強力な計算処理能力で、集積したデータを統合して解析もできます。例えば、体重管理が目的のとき、万歩計以外にも心拍センサや体重計など複数のBluetooth LEデバイスで、計測をしていたとします。歩数データに心拍データを加えることで、消費カロリーをより高精度に計算できるでしょう。また体重計のデータを統合することで、運動の成果と食事内容の提案を、iPhoneから出せるようになります。

iPhoneは、集積したデータをネットワークに同期させるハブとして機能します。例えば、あるiPhoneが読みだした万歩計のデータは、Apple社のiCloudなどを使えば、iPadなどの他の自分の端末とネットワーク同期します。また、ネットワークを通じてサーバにデータを保存できます。

また、iOSアプリケーションがソーシャル・ネットワーク・サービスと連携すれば、例えば万歩計ならば毎日の運動量を仲間と共有したり競争ができます。このソーシャル・ネットワークは、サービスの魅力であり、かつ、買い替え時に他社への乗り換えの抑止にもなります。Bluetooth LEアクセサリ単体のハードウェアは単純で、設計製造を請け負う企業と通じて、参入が容易です。ですから類似製品がいろいろ出てきます。ですが、アプリケーションを通して、ソーシャル・ネットワークのつながりが形成されていれば、仲間が一斉に他社製品に乗り換えでもしない限り、次も同じ会社の製品を購入するでしょう。

### iPhoneを拡張するアプセサリ

iPhoneは加速度をはじめとする多くのセンサを内蔵していて、万能です。しかしiPhone自体の大きさや頻繁に充電が必要なことがそぐわない用途も、あります。iPhoneから見てアプセサリは:

* 機能の一部切り出しや小型化
* iPhoneにない機能を拡張

します。

アクセサリは何かの検出をするものがほとんどです。たとえiPhoneが持っているセンサであっても、アクセサリとしてそれを切り話すことで、小型化や電池交換頻度の低減、また破損するかもしれない場面でも安心して使えるようになります。

例えば、万歩計ではどうしょううか。iPhone自体にも加速度センサがあります。ですから、iOSアプリケーションで万歩計は作れます。しかしそれでは、ユーザは計測のためにiPhoneを絶えず持ち歩いていなければなりません。また、カバンに入れられたりして、歩数の計測データが取れない状態になるかもしれません。

万歩計単体をアクセサリにすれば、安価で親指の先程度の小型なものになります。たいてい1台だけを持っているiPhoneの場合と違い、いくつも購入しておいて、それぞれのズボンのポケットに入れておく使い方ができます。万歩計単体ならば、コイン型電池で半年程度動作しますから、入れたままにしておけますし、電池残量が少なくなっても、Bluetooth LEで通信をしてiPhoneからユーザに交換をうながすこともできます。iPhoneの機能の一部を、アクセサリとして切り離すことで、アクセサリの存在を忘れてしまえる使い方ができるようになります。

また自転車などのフィットネス分野では、iPhoneを自転車に固定して利用する場合、衝撃による破損や直射日光による温度上昇で動作が停止するかもしれません。このような過酷な状況では、利用場面に合わせて設計したアクセサリを利用することで、破損でiPhone自体を壊す恐れがなくなり、またアクセサリならば破損しても買い換えも容易です。

またiPhoneに搭載されていないセンサや通信機能を、アクセサリで拡張できます。例えば、糖尿病などで日常的に血糖値を測定しなければならない方のために、血糖値測定器があります。血糖値センサをBluetooth LEでiOSアプリケーションとつなぐことで、iPhoneを血糖値測定装置に拡張できます。






